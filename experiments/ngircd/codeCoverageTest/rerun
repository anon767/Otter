TOPDIR=~/t
LIBCDIR=$TOPDIR/libc
MOCKEDDIR=./mockedFns
CILLY="env CILLY_DONT_COMPILE_AFTER_MERGE=1 ../../../cil/bin/cilly --merge --useLogicalOperators -D_FILE_OFFSET_BITS=64 -U __OPTIMIZE__ --warnall"

# 
echo "--> Merging ngIRCd sources"
cd ../src && make merge && cd ../codeCoverageTest
# 
echo "--> Merging ngIRCd with mockedFns"
$CILLY --out=ngircd_comb.c -I $LIBCDIR -I $MOCKEDDIR otherFiles/libc_comb.c $MOCKEDDIR/*.c ngircd.c
#
echo "--> Doing symbolic execution"
$CILLY \
	-DCONF_MAXCONNECTIONS \
	-I $MOCKEDDIR \
	--doexecute \
	--printNoEscapedString \
	--covStats=ngircd.stats \
	otherFiles/symtest_driver.c \
	--lineCov \
	$*

#	--printLittle \
#	-DCONF_CONNECTRETRY \
#	-DCONF_UID \
#	-DCONF_GID \
#	-DCONF_OPERCANMODE \
#	-DCONF_NODNS \
#	-DCONF_LISTENIPV6 \
#	-DCONF_LISTENIPV4 \
#	-DCONF_OPERSERVERMODE \
#	-DCONF_CONNECTIPV6 \
#	-DCONF_CONNECTIPV4 \
#	-DCONF_MAXJOINS \
#	-DCONF_MAXCONNECTIONSIP \
#	-DCONF_MAXNICKLENGTH \
#	-DCONF_PINGTIMEOUT \
#	-DCONF_PONGTIMEOUT \
