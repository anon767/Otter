TOPDIR=~/t
LIBCDIR=$TOPDIR/libc
MOCKEDDIR=./mockedFns
CILLY="env CILLY_DONT_COMPILE_AFTER_MERGE=1 ../../../cil/bin/cilly --merge --useLogicalOperators -D_FILE_OFFSET_BITS=64 -U __OPTIMIZE__ --warnall"

# 
echo "--> Merging ngIRCd sources"
cd ../src && make merge && cd ../codeCoverageTest
# 
echo "--> Merging ngIRCd with mockedFns"
$CILLY --out=ngircd_comb.c -I $LIBCDIR -I $MOCKEDDIR otherFiles/libc_comb.c $MOCKEDDIR/*.c ngircd.c
#
echo "--> Doing symbolic execution"
$CILLY \
	-DCONF_MAXJOINS=10 \
	-DCONF_MAXCONNECTIONSIP=0 \
	-DCONF_MAXNICKLENGTH=9 \
	-DCONF_UID=0 \
	-DCONF_GID=0 \
	-DCONF_CONNECTRETRY=0 \
	-DCONF_OPERCANMODE=0 \
	-DCONF_PINGTIMEOUT=1000 \
	-DCONF_PONGTIMEOUT=1000 \
	-DCONF_NODNS=0 \
	-DCONF_LISTENIPV6=0 \
	-DCONF_LISTENIPV4=1 \
	-DCONF_OPERSERVERMODE=0 \
	-DCONF_CONNECTIPV6=0 \
	-DCONF_CONNECTIPV4=1 \
	-I $MOCKEDDIR \
	--doexecute \
	--printNoEscapedString \
	--covStats=ngircd.stats \
	otherFiles/symtest_driver.c \
	--lineCov \
	$*

