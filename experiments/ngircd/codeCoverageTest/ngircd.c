/* Generated by CIL v. 1.3.6 */
/* print_CIL_Input is true */

#line 213 "/usr/lib/gcc/i386-redhat-linux/3.4.6/include/stddef.h"
typedef unsigned int size_t;
#line 59 "/usr/include/bits/types.h"
typedef long long __quad_t;
#line 137 "/usr/include/bits/types.h"
typedef unsigned int __uid_t;
#line 138 "/usr/include/bits/types.h"
typedef unsigned int __gid_t;
#line 141 "/usr/include/bits/types.h"
typedef unsigned int __mode_t;
#line 143 "/usr/include/bits/types.h"
typedef long __off_t;
#line 144 "/usr/include/bits/types.h"
typedef __quad_t __off64_t;
#line 145 "/usr/include/bits/types.h"
typedef int __pid_t;
#line 147 "/usr/include/bits/types.h"
typedef long __clock_t;
#line 151 "/usr/include/bits/types.h"
typedef long __time_t;
#line 182 "/usr/include/bits/types.h"
typedef int __ssize_t;
#line 67 "/usr/include/sys/types.h"
typedef __gid_t gid_t;
#line 82 "/usr/include/sys/types.h"
typedef __uid_t uid_t;
#line 100 "/usr/include/sys/types.h"
typedef __pid_t pid_t;
#line 110 "/usr/include/sys/types.h"
typedef __ssize_t ssize_t;
#line 76 "/usr/include/time.h"
typedef __time_t time_t;
#line 28 "/usr/include/bits/sigset.h"
struct __anonstruct___sigset_t_2 {
   unsigned long __val[1024U / (8U * sizeof(unsigned long ))] ;
};
#line 28 "/usr/include/bits/sigset.h"
typedef struct __anonstruct___sigset_t_2 __sigset_t;
#line 46 "/usr/include/stdio.h"
struct _IO_FILE;
#line 46 "/usr/include/stdio.h"
typedef struct _IO_FILE FILE;
#line 176 "/usr/include/libio.h"
typedef void _IO_lock_t;
#line 182 "/usr/include/libio.h"
struct _IO_marker {
   struct _IO_marker *_next ;
   struct _IO_FILE *_sbuf ;
   int _pos ;
};
#line 267 "/usr/include/libio.h"
struct _IO_FILE {
   int _flags ;
   char *_IO_read_ptr ;
   char *_IO_read_end ;
   char *_IO_read_base ;
   char *_IO_write_base ;
   char *_IO_write_ptr ;
   char *_IO_write_end ;
   char *_IO_buf_base ;
   char *_IO_buf_end ;
   char *_IO_save_base ;
   char *_IO_backup_base ;
   char *_IO_save_end ;
   struct _IO_marker *_markers ;
   struct _IO_FILE *_chain ;
   int _fileno ;
   int _flags2 ;
   __off_t _old_offset ;
   unsigned short _cur_column ;
   signed char _vtable_offset ;
   char _shortbuf[1] ;
   _IO_lock_t *_lock ;
   __off64_t _offset ;
   void *__pad1 ;
   void *__pad2 ;
   void *__pad3 ;
   void *__pad4 ;
   size_t __pad5 ;
   int _mode ;
   char _unused2[(15U * sizeof(int ) - 4U * sizeof(void *)) - sizeof(size_t )] ;
};
#line 33 "/usr/include/bits/siginfo.h"
union sigval {
   int sival_int ;
   void *sival_ptr ;
};
#line 33 "/usr/include/bits/siginfo.h"
typedef union sigval sigval_t;
#line 51 "/usr/include/bits/siginfo.h"
struct __anonstruct__kill_20 {
   __pid_t si_pid ;
   __uid_t si_uid ;
};
#line 51 "/usr/include/bits/siginfo.h"
struct __anonstruct__timer_21 {
   int si_tid ;
   int si_overrun ;
   sigval_t si_sigval ;
};
#line 51 "/usr/include/bits/siginfo.h"
struct __anonstruct__rt_22 {
   __pid_t si_pid ;
   __uid_t si_uid ;
   sigval_t si_sigval ;
};
#line 51 "/usr/include/bits/siginfo.h"
struct __anonstruct__sigchld_23 {
   __pid_t si_pid ;
   __uid_t si_uid ;
   int si_status ;
   __clock_t si_utime ;
   __clock_t si_stime ;
};
#line 51 "/usr/include/bits/siginfo.h"
struct __anonstruct__sigfault_24 {
   void *si_addr ;
};
#line 51 "/usr/include/bits/siginfo.h"
struct __anonstruct__sigpoll_25 {
   long si_band ;
   int si_fd ;
};
#line 51 "/usr/include/bits/siginfo.h"
union __anonunion__sifields_19 {
   int _pad[128U / sizeof(int ) - 3U] ;
   struct __anonstruct__kill_20 _kill ;
   struct __anonstruct__timer_21 _timer ;
   struct __anonstruct__rt_22 _rt ;
   struct __anonstruct__sigchld_23 _sigchld ;
   struct __anonstruct__sigfault_24 _sigfault ;
   struct __anonstruct__sigpoll_25 _sigpoll ;
};
#line 51 "/usr/include/bits/siginfo.h"
struct siginfo {
   int si_signo ;
   int si_errno ;
   int si_code ;
   union __anonunion__sifields_19 _sifields ;
};
#line 51 "/usr/include/bits/siginfo.h"
typedef struct siginfo siginfo_t;
#line 25 "/usr/include/bits/sigaction.h"
union __anonunion___sigaction_handler_37 {
   void (*sa_handler)(int  ) ;
   void (*sa_sigaction)(int  , siginfo_t * , void * ) ;
};
#line 25 "/usr/include/bits/sigaction.h"
struct sigaction {
   union __anonunion___sigaction_handler_37 __sigaction_handler ;
   __sigset_t sa_mask ;
   int sa_flags ;
   void (*sa_restorer)(void) ;
};
#line 131 "/usr/include/time.h"
struct tm {
   int tm_sec ;
   int tm_min ;
   int tm_hour ;
   int tm_mday ;
   int tm_mon ;
   int tm_year ;
   int tm_wday ;
   int tm_yday ;
   int tm_isdst ;
   long tm_gmtoff ;
   char const   *tm_zone ;
};
#line 50 "/usr/include/pwd.h"
struct passwd {
   char *pw_name ;
   char *pw_passwd ;
   __uid_t pw_uid ;
   __gid_t pw_gid ;
   char *pw_gecos ;
   char *pw_dir ;
   char *pw_shell ;
};
#line 43 "/usr/include/grp.h"
struct group {
   char *gr_name ;
   char *gr_passwd ;
   __gid_t gr_gid ;
   char **gr_mem ;
};
#line 19 "array.h"
struct __anonstruct_array_9 {
   char *mem ;
   size_t allocated ;
   size_t used ;
};
#line 19 "array.h"
typedef struct __anonstruct_array_9 array;
#line 52 "/usr/include/stdint.h"
typedef unsigned int uint32_t;
#line 76 "./../portab/portab.h"
typedef void POINTER;
#line 81 "./../portab/portab.h"
typedef uint32_t UINT32;
#line 32 "conn.h"
typedef int CONN_ID;
#line 36 "client.h"
struct _CLIENT {
   time_t starttime ;
   char id[64] ;
   UINT32 hash ;
   POINTER *next ;
   int type ;
   CONN_ID conn_id ;
   struct _CLIENT *introducer ;
   struct _CLIENT *topserver ;
   char pwd[21] ;
   char host[64] ;
   char user[10] ;
   char info[64] ;
   char modes[9] ;
   int hops ;
   int token ;
   int mytoken ;
   int oper_by_me ;
   char away[128] ;
   char flags[100] ;
};
#line 36 "client.h"
typedef struct _CLIENT CLIENT;
#line 20 "lists.h"
struct list_elem;
#line 22 "lists.h"
struct list_head {
   struct list_elem *first ;
};
#line 27 "channel.h"
struct _CHANNEL {
   struct _CHANNEL *next ;
   char name[51] ;
   UINT32 hash ;
   char modes[9] ;
   array topic ;
   time_t topic_time ;
   char topic_who[32] ;
   char key[21] ;
   unsigned long maxusers ;
   struct list_head list_bans ;
   struct list_head list_invites ;
};
#line 27 "channel.h"
typedef struct _CHANNEL CHANNEL;
#line 44 "channel.h"
struct _CLIENT2CHAN {
   struct _CLIENT2CHAN *next ;
   CLIENT *client ;
   CHANNEL *channel ;
   char modes[9] ;
};
#line 44 "channel.h"
typedef struct _CLIENT2CHAN CL2CHAN;
#line 51 "conf.h"
struct _Conf_Channel {
   char name[51] ;
   char modes[9] ;
   char key[21] ;
   unsigned long maxusers ;
   array topic ;
};
#line 51 "conf.h"
typedef struct _Conf_Channel CONF_CHANNEL;
#line 96 "/usr/include/netdb.h"
struct hostent {
   char *h_name ;
   char **h_aliases ;
   int h_addrtype ;
   int h_length ;
   char **h_addr_list ;
};
#line 64 "client.h"
struct _WHOWAS {
   time_t time ;
   char id[32] ;
   char host[64] ;
   char user[10] ;
   char info[64] ;
   char server[64] ;
};
#line 64 "client.h"
typedef struct _WHOWAS WHOWAS;
#line 50 "/usr/include/stdint.h"
typedef unsigned short uint16_t;
#line 80 "./../portab/portab.h"
typedef uint16_t UINT16;
#line 43 "/usr/lib/gcc/i386-redhat-linux/3.4.6/include/stdarg.h"
typedef __builtin_va_list __gnuc_va_list;
#line 105 "/usr/lib/gcc/i386-redhat-linux/3.4.6/include/stdarg.h"
typedef __gnuc_va_list va_list;
#line 337 "/usr/include/libio.h"
typedef struct _IO_FILE _IO_FILE;
#line 29 "/usr/include/bits/sockaddr.h"
typedef unsigned short sa_family_t;
#line 145 "/usr/include/bits/socket.h"
struct sockaddr {
   sa_family_t sa_family ;
   char sa_data[14] ;
};
#line 92 "/usr/include/netinet/in.h"
typedef uint16_t in_port_t;
#line 136 "/usr/include/netinet/in.h"
typedef uint32_t in_addr_t;
#line 137 "/usr/include/netinet/in.h"
struct in_addr {
   in_addr_t s_addr ;
};
#line 219 "/usr/include/netinet/in.h"
struct sockaddr_in {
   sa_family_t sin_family ;
   in_port_t sin_port ;
   struct in_addr sin_addr ;
   unsigned char sin_zero[((sizeof(struct sockaddr ) - sizeof(unsigned short )) - sizeof(in_port_t )) - sizeof(struct in_addr )] ;
};
#line 36 "./../ipaddr/ng_ipaddr.h"
struct NG_IP_ADDR_DONTUSE {
   struct sockaddr_in sin4 ;
};
#line 39 "./../ipaddr/ng_ipaddr.h"
typedef struct NG_IP_ADDR_DONTUSE ng_ipaddr_t;
#line 26 "resolve.h"
struct _Res_Stat {
   pid_t pid ;
   int resolver_fd ;
};
#line 26 "resolve.h"
typedef struct _Res_Stat RES_STAT;
#line 28 "conf.h"
struct _Conf_Oper {
   char name[21] ;
   char pwd[21] ;
   char *mask ;
};
#line 28 "conf.h"
typedef struct _Conf_Oper CONF_OPER;
#line 35 "conf.h"
struct _Conf_Server {
   char host[256] ;
   char name[64] ;
   char pwd_in[21] ;
   char pwd_out[21] ;
   UINT16 port ;
   int group ;
   time_t lasttry ;
   RES_STAT res_stat ;
   int flags ;
   CONN_ID conn_id ;
   ng_ipaddr_t bind_addr ;
   ng_ipaddr_t dst_addr[2] ;
};
#line 35 "conf.h"
typedef struct _Conf_Server CONF_SERVER;
#line 153 "/usr/include/bits/types.h"
typedef long __suseconds_t;
#line 194 "/usr/include/bits/types.h"
typedef unsigned int __socklen_t;
#line 69 "/usr/include/bits/time.h"
struct timeval {
   __time_t tv_sec ;
   __suseconds_t tv_usec ;
};
#line 245 "/usr/include/unistd.h"
typedef __socklen_t socklen_t;
#line 56 "conn.h"
struct _Connection {
   int sock ;
   ng_ipaddr_t addr ;
   RES_STAT res_stat ;
   char host[256] ;
   array rbuf ;
   array wbuf ;
   time_t signon ;
   time_t lastdata ;
   time_t lastping ;
   time_t lastprivmsg ;
   time_t delaytime ;
   long bytes_in ;
   long bytes_out ;
   long msg_in ;
   long msg_out ;
   int flag ;
   UINT16 options ;
   CLIENT *client ;
};
#line 56 "conn.h"
typedef struct _Connection CONNECTION;
#line 32 "io.c"
struct __anonstruct_io_event_15 {
   void (*callback)(int  , short  ) ;
   short what ;
};
#line 32 "io.c"
typedef struct __anonstruct_io_event_15 io_event;
#line 30 "/usr/include/sys/poll.h"
typedef unsigned long nfds_t;
#line 33 "/usr/include/sys/poll.h"
struct pollfd {
   int fd ;
   short events ;
   short revents ;
};
#line 22 "parse.h"
struct _REQUEST {
   char *prefix ;
   char *command ;
   char *argv[15] ;
   int argc ;
};
#line 22 "parse.h"
typedef struct _REQUEST REQUEST;
#line 31 "parse.h"
struct _COMMAND {
   char *name ;
   int (*function)(CLIENT *Client , REQUEST *Request ) ;
   int type ;
   long lcount ;
   long rcount ;
   long bytes ;
};
#line 31 "parse.h"
typedef struct _COMMAND COMMAND;
#line 38 "lists.c"
struct list_elem {
   struct list_elem *next ;
   char mask[128] ;
   int onlyonce ;
};
#line 55 "parse.c"
struct _NUMERIC {
   int numeric ;
   int (*function)(CLIENT *Client , REQUEST *Request ) ;
};
#line 1 "ngircd.o"
#pragma merger(0,"/tmp/cil-dXCcwSXz.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 140 "./../portab/portab.h"
size_t strlcat(char *dst , char const   *src , size_t size ) ;
#line 144
size_t strlcpy(char *dst , char const   *src , size_t size ) ;
#line 38 "/usr/include/bits/errno.h"
extern  __attribute__((__nothrow__)) int *__errno_location(void)  __attribute__((__const__)) ;
#line 143 "/usr/include/stdio.h"
extern struct _IO_FILE *stdout ;
#line 144
extern struct _IO_FILE *stderr ;
#line 213
extern int fflush(FILE *__stream ) ;
#line 323
extern int fprintf(FILE * __restrict  __stream , char const   * __restrict  __format 
                   , ...) ;
#line 329
extern int printf(char const   * __restrict  __format  , ...) ;
#line 353
extern  __attribute__((__nothrow__)) int ( /* format attribute */  snprintf)(char * __restrict  __s ,
                                                                             size_t __maxlen ,
                                                                             char const   * __restrict  __format 
                                                                             , ...) ;
#line 591
extern int puts(char const   *__s ) ;
#line 640 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__, __noreturn__)) void exit(int __status ) ;
#line 260 "/usr/include/signal.h"
extern  __attribute__((__nothrow__)) int sigaction(int __sig , struct sigaction  const  * __restrict  __act ,
                                                   struct sigaction * __restrict  __oact ) ;
#line 59 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) void *memset(void *__s , int __c , size_t __n )  __attribute__((__nonnull__(1))) ;
#line 92
extern  __attribute__((__nothrow__)) char *strcat(char * __restrict  __dest , char const   * __restrict  __src )  __attribute__((__nonnull__(1,2))) ;
#line 99
extern  __attribute__((__nothrow__)) int strcmp(char const   *__s1 , char const   *__s2 )  __attribute__((__pure__,
__nonnull__(1,2))) ;
#line 242
extern  __attribute__((__nothrow__)) size_t strlen(char const   *__s )  __attribute__((__pure__,
__nonnull__(1))) ;
#line 256
extern  __attribute__((__nothrow__)) char *strerror(int __errnum ) ;
#line 307 "/usr/include/unistd.h"
extern int close(int __fd ) ;
#line 320
extern ssize_t write(int __fd , void const   *__buf , size_t __n ) ;
#line 436
extern  __attribute__((__nothrow__)) int chdir(char const   *__path )  __attribute__((__nonnull__(1))) ;
#line 471
extern  __attribute__((__nothrow__)) int dup2(int __fd , int __fd2 ) ;
#line 551
extern  __attribute__((__nothrow__)) __pid_t getpid(void) ;
#line 612
extern  __attribute__((__nothrow__)) __pid_t setsid(void) ;
#line 620
extern  __attribute__((__nothrow__)) __uid_t getuid(void) ;
#line 626
extern  __attribute__((__nothrow__)) __gid_t getgid(void) ;
#line 645
extern  __attribute__((__nothrow__)) int setuid(__uid_t __uid ) ;
#line 662
extern  __attribute__((__nothrow__)) int setgid(__gid_t __gid ) ;
#line 697
extern  __attribute__((__nothrow__)) __pid_t fork(void) ;
#line 746
extern  __attribute__((__nothrow__)) int unlink(char const   *__name )  __attribute__((__nonnull__(1))) ;
#line 858
extern  __attribute__((__nothrow__)) int chroot(char const   *__path )  __attribute__((__nonnull__(1))) ;
#line 184 "/usr/include/time.h"
extern  __attribute__((__nothrow__)) time_t time(time_t *__timer ) ;
#line 197
extern  __attribute__((__nothrow__)) size_t strftime(char * __restrict  __s , size_t __maxsize ,
                                                     char const   * __restrict  __format ,
                                                     struct tm  const  * __restrict  __tp ) ;
#line 233
extern  __attribute__((__nothrow__)) struct tm *localtime(time_t const   *__timer ) ;
#line 275 "/usr/include/sys/stat.h"
extern  __attribute__((__nothrow__)) __mode_t umask(__mode_t __mask ) ;
#line 138 "/usr/include/sys/wait.h"
extern __pid_t waitpid(__pid_t __pid , int *__stat_loc , int __options ) ;
#line 72 "/usr/include/fcntl.h"
extern int open(char const   *__file , int __oflag  , ...)  __attribute__((__nonnull__(1))) ;
#line 79 "/usr/include/pwd.h"
extern void endpwent(void) ;
#line 111
extern struct passwd *getpwuid(__uid_t __uid ) ;
#line 117
extern struct passwd *getpwnam(char const   *__name ) ;
#line 103 "/usr/include/grp.h"
extern struct group *getgrgid(__gid_t __gid ) ;
#line 75 "client.h"
void Client_Init(void) ;
#line 76
void Client_Exit(void) ;
#line 86 "conn.h"
void Conn_Init(void) ;
#line 87
void Conn_Exit(void) ;
#line 89
unsigned int Conn_InitListeners(void) ;
#line 90
void Conn_ExitListeners(void) ;
#line 92
void Conn_Handler(void) ;
#line 98
void Conn_SyncServerStruct(void) ;
#line 62 "channel.h"
void Channel_Init(void) ;
#line 63
void Channel_InitPredefined(void) ;
#line 64
void Channel_Exit(void) ;
#line 66 "conf.h"
char Conf_ServerName[64] ;
#line 92
uid_t Conf_UID ;
#line 93
gid_t Conf_GID ;
#line 96
char Conf_Chroot[256] ;
#line 99
char Conf_PidFile[256] ;
#line 122
int Conf_OperCanMode ;
#line 157
unsigned int Conf_MaxNickLength ;
#line 159
void Conf_Init(void) ;
#line 160
int Conf_Rehash(void) ;
#line 161
int Conf_Test(void) ;
#line 38 "log.h"
void Log_Init(int Daemon_Mode ) ;
#line 39
void Log_Exit(void) ;
#line 41
void Log(int Level , char const   *Format  , ...) ;
#line 25 "ngircd.h"
time_t NGIRCd_Start  ;
#line 26 "ngircd.h"
char NGIRCd_StartStr[64]  ;
#line 27 "ngircd.h"
char NGIRCd_Version[126]  ;
#line 28 "ngircd.h"
char NGIRCd_VersionAddition[126]  ;
#line 38 "ngircd.h"
int NGIRCd_Passive  ;
#line 40 "ngircd.h"
int NGIRCd_SignalQuit  ;
#line 41 "ngircd.h"
int NGIRCd_SignalRestart  ;
#line 42 "ngircd.h"
int NGIRCd_SignalRehash  ;
#line 44 "ngircd.h"
char NGIRCd_DebugLevel[2]  ;
#line 46 "ngircd.h"
char NGIRCd_ConfFile[256]  ;
#line 48 "ngircd.h"
char NGIRCd_ProtoID[513]  ;
#line 51
void NGIRCd_Rehash(void) ;
#line 56 "ngircd.c"
static void Initialize_Signal_Handler(void) ;
#line 57
static void Signal_Handler(int Signal ) ;
#line 59
static void Show_Version(void) ;
#line 60
static void Show_Help(void) ;
#line 62
static void Pidfile_Create(pid_t pid ) ;
#line 63
static void Pidfile_Delete(void) ;
#line 65
static void Fill_Version(void) ;
#line 67
static void Setup_FDStreams(void) ;
#line 69
static int NGIRCd_Init(int NGIRCd_NoDaemon ) ;
#line 82 "ngircd.c"
void (*symtest_Conf_Init)()  ;
#line 84 "ngircd.c"
int main(int argc , char const   **argv ) 
{ int ok ;
  int configtest ;
  int NGIRCd_NoDaemon ;
  int i ;
  size_t n ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  size_t __cil_tmp___5 ;
  int __cil_tmp___6 ;
  struct tm *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  unsigned int __cil_tmp___9 ;

  {
#line 87
  configtest = 0;
#line 88
  NGIRCd_NoDaemon = 0;
#line 92
  umask(63U);
#line 94
  NGIRCd_SignalRehash = 0;
#line 94
  NGIRCd_SignalRestart = NGIRCd_SignalRehash;
#line 94
  NGIRCd_SignalQuit = NGIRCd_SignalRestart;
#line 95
  NGIRCd_Passive = 0;
#line 103
  strlcpy(NGIRCd_ConfFile, "/usr/local/etc", sizeof(NGIRCd_ConfFile));
#line 104
  strlcat(NGIRCd_ConfFile, "/ngircd.conf", sizeof(NGIRCd_ConfFile));
#line 106
  Fill_Version();
#line 109
  i = 1;
#line 109
  while (i < argc) {
#line 111
    ok = 0;
#line 112
    if ((int const   )*(*(argv + i) + 0) == 45 && (int const   )*(*(argv + i) + 1) == 45) {
#line 116
      __cil_tmp = strcmp(*(argv + i), "--config");
#line 116
      if (__cil_tmp == 0) {
#line 118
        if (i + 1 < argc) {
#line 121
          strlcpy(NGIRCd_ConfFile, *(argv + (i + 1)), sizeof(NGIRCd_ConfFile));
#line 124
          i ++;
#line 124
          ok = 1;
        }
      }
#line 127
      __cil_tmp___0 = strcmp(*(argv + i), "--configtest");
#line 127
      if (__cil_tmp___0 == 0) {
#line 129
        configtest = 1;
#line 130
        ok = 1;
      }
#line 139
      __cil_tmp___1 = strcmp(*(argv + i), "--help");
#line 139
      if (__cil_tmp___1 == 0) {
#line 141
        Show_Version();
#line 142
        puts("");
#line 142
        Show_Help();
#line 142
        puts("");
#line 143
        exit(1);
      }
#line 145
      __cil_tmp___2 = strcmp(*(argv + i), "--nodaemon");
#line 145
      if (__cil_tmp___2 == 0) {
#line 147
        NGIRCd_NoDaemon = 1;
#line 148
        ok = 1;
      }
#line 150
      __cil_tmp___3 = strcmp(*(argv + i), "--passive");
#line 150
      if (__cil_tmp___3 == 0) {
#line 152
        NGIRCd_Passive = 1;
#line 153
        ok = 1;
      }
#line 162
      __cil_tmp___4 = strcmp(*(argv + i), "--version");
#line 162
      if (__cil_tmp___4 == 0) {
#line 164
        Show_Version();
#line 165
        exit(1);
      }
    } else {
#line 168
      if ((int const   )*(*(argv + i) + 0) == 45 && (int const   )*(*(argv + i) + 1) != 45) {
#line 171
        n = 1U;
#line 171
        while (1) {
#line 171
          __cil_tmp___5 = strlen(*(argv + i));
#line 171
          if (! (n < __cil_tmp___5)) {
#line 171
            break;
          }
#line 173
          ok = 0;
#line 181
          if ((int const   )*(*(argv + i) + n) == 102) {
#line 183
            if (! *(*(argv + i) + (n + 1U)) && i + 1 < argc) {
#line 186
              strlcpy(NGIRCd_ConfFile, *(argv + (i + 1)), sizeof(NGIRCd_ConfFile));
#line 189
              i ++;
#line 190
              n = strlen(*(argv + i));
#line 191
              ok = 1;
            }
          }
#line 194
          if ((int const   )*(*(argv + i) + n) == 110) {
#line 196
            NGIRCd_NoDaemon = 1;
#line 197
            ok = 1;
          }
#line 199
          if ((int const   )*(*(argv + i) + n) == 112) {
#line 201
            NGIRCd_Passive = 1;
#line 202
            ok = 1;
          }
#line 211
          if ((int const   )*(*(argv + i) + n) == 116) {
#line 213
            configtest = 1;
#line 214
            ok = 1;
          }
#line 217
          if (! ok) {
#line 219
            printf((char const   * __restrict  )"%s: invalid option \"-%c\"!\n", "ngircd",
                   *(*(argv + i) + n));
#line 220
            printf((char const   * __restrict  )"Try \"%s --help\" for more information.\n",
                   "ngircd");
#line 221
            exit(1);
          }
#line 171
          n ++;
        }
      }
    }
#line 226
    if (! ok) {
#line 228
      printf((char const   * __restrict  )"%s: invalid option \"%s\"!\n", "ngircd",
             *(argv + i));
#line 229
      printf((char const   * __restrict  )"Try \"%s --help\" for more information.\n",
             "ngircd");
#line 230
      exit(1);
    }
#line 109
    i ++;
  }
#line 235
  NGIRCd_DebugLevel[0] = (char )'\000';
#line 248
  if (configtest) {
#line 250
    Show_Version();
#line 250
    puts("");
#line 251
    __cil_tmp___6 = Conf_Test();
#line 251
    exit(__cil_tmp___6);
  }
#line 254
  while (! NGIRCd_SignalQuit) {
#line 257
    NGIRCd_Start = time((time_t *)((void *)0));
#line 258
    __cil_tmp___7 = localtime((time_t const   *)(& NGIRCd_Start));
#line 258
    strftime((char * __restrict  )(NGIRCd_StartStr), 64U, (char const   * __restrict  )"%a %b %d %Y at %H:%M:%S (%Z)",
             (struct tm  const  * __restrict  )__cil_tmp___7);
#line 260
    NGIRCd_SignalRehash = 0;
#line 261
    NGIRCd_SignalRestart = 0;
#line 262
    NGIRCd_SignalQuit = 0;
#line 265
    Log_Init(! NGIRCd_NoDaemon);
#line 266
    Conf_Init();
#line 268
    (*symtest_Conf_Init)();
#line 273
    __cil_tmp___8 = NGIRCd_Init(NGIRCd_NoDaemon);
#line 273
    if (! __cil_tmp___8) {
#line 274
      Log(1, "Fatal: Initialization failed");
#line 275
      exit(1);
    }
#line 280
    Channel_Init();
#line 281
    Client_Init();
#line 285
    Conn_Init();
#line 295
    Initialize_Signal_Handler();
#line 301
    snprintf((char * __restrict  )(NGIRCd_ProtoID), sizeof(NGIRCd_ProtoID), (char const   * __restrict  )"%s%s %s|%s:%s",
             "0210", "-IRC+", "ngircd", "0.12.0", "CHL");
#line 305
    if (Conf_OperCanMode) {
#line 305
      strcat((char * __restrict  )(NGIRCd_ProtoID), (char const   * __restrict  )"o");
    }
#line 309
    strlcat(NGIRCd_ProtoID, " P", sizeof(NGIRCd_ProtoID));
#line 313
    Log(7, "Protocol and server ID is \"%s\".", NGIRCd_ProtoID);
#line 316
    Channel_InitPredefined();
#line 319
    __cil_tmp___9 = Conn_InitListeners();
#line 319
    if (__cil_tmp___9 < 1U) {
#line 321
      Log(1, "Server isn\'t listening on a single port!");
#line 322
      Log(1, "%s exiting due to fatal errors!", "ngircd");
#line 323
      Pidfile_Delete();
#line 324
      exit(1);
    }
#line 328
    Conn_Handler();
#line 331
    Conn_Exit();
#line 335
    Client_Exit();
#line 336
    Channel_Exit();
#line 337
    Log_Exit();
  }
#line 339
  Pidfile_Delete();
#line 341
  return (0);
}
}
#line 351 "ngircd.c"
static void Fill_Version(void) 
{ 

  {
#line 354
  NGIRCd_VersionAddition[0] = (char )'\000';
#line 402
  if (NGIRCd_VersionAddition[0]) {
#line 403
    strlcat(NGIRCd_VersionAddition, "+", sizeof(NGIRCd_VersionAddition));
  }
#line 405
  strlcat(NGIRCd_VersionAddition, "IRCPLUS", sizeof(NGIRCd_VersionAddition));
#line 413
  if (NGIRCd_VersionAddition[0]) {
#line 414
    strlcat(NGIRCd_VersionAddition, "-", sizeof(NGIRCd_VersionAddition));
  }
#line 416
  strlcat(NGIRCd_VersionAddition, "i686", sizeof(NGIRCd_VersionAddition));
#line 417
  strlcat(NGIRCd_VersionAddition, "/", sizeof(NGIRCd_VersionAddition));
#line 418
  strlcat(NGIRCd_VersionAddition, "pc", sizeof(NGIRCd_VersionAddition));
#line 419
  strlcat(NGIRCd_VersionAddition, "/", sizeof(NGIRCd_VersionAddition));
#line 420
  strlcat(NGIRCd_VersionAddition, "linux-gnu", sizeof(NGIRCd_VersionAddition));
#line 422
  snprintf((char * __restrict  )(NGIRCd_Version), sizeof(NGIRCd_Version), (char const   * __restrict  )"%s %s-%s",
           "ngircd", "0.12.0", NGIRCd_VersionAddition);
#line 424
  return;
}
}
#line 430 "ngircd.c"
void NGIRCd_Rehash(void) 
{ char old_name[64] ;
  unsigned int old_nicklen ;
  int __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 436
  Log(1029, "Re-reading configuration NOW!");
#line 437
  NGIRCd_SignalRehash = 0;
#line 440
  strlcpy(old_name, (char const   *)(Conf_ServerName), sizeof(old_name));
#line 441
  old_nicklen = Conf_MaxNickLength;
#line 444
  __cil_tmp = Conf_Rehash();
#line 444
  if (! __cil_tmp) {
#line 445
    return;
  }
#line 448
  Conn_ExitListeners();
#line 452
  __cil_tmp___0 = strcmp((char const   *)(old_name), (char const   *)(Conf_ServerName));
#line 452
  if (__cil_tmp___0 != 0) {
#line 453
    strlcpy(Conf_ServerName, (char const   *)(old_name), sizeof(Conf_ServerName));
#line 454
    Log(3, "Can\'t change \"ServerName\" on runtime! Ignored new name.");
  }
#line 456
  if (old_nicklen != Conf_MaxNickLength) {
#line 457
    Conf_MaxNickLength = old_nicklen;
#line 458
    Log(3, "Can\'t change \"MaxNickLength\" on runtime! Ignored new value.");
  }
#line 462
  Channel_InitPredefined();
#line 465
  Conn_InitListeners();
#line 468
  Conn_SyncServerStruct();
#line 470
  Log(1029, "Re-reading of configuration done.");
#line 471
  return;
}
}
#line 477 "ngircd.c"
static void Initialize_Signal_Handler(void) 
{ struct sigaction saction ;

  {
#line 489
  memset((void *)(& saction), 0, sizeof(saction));
#line 490
  saction.__sigaction_handler.sa_handler = & Signal_Handler;
#line 492
  saction.sa_flags |= 268435456;
#line 495
  saction.sa_flags |= 2;
#line 499
  sigaction(2, (struct sigaction  const  * __restrict  )(& saction), (struct sigaction * __restrict  )((void *)0));
#line 500
  sigaction(3, (struct sigaction  const  * __restrict  )(& saction), (struct sigaction * __restrict  )((void *)0));
#line 501
  sigaction(15, (struct sigaction  const  * __restrict  )(& saction), (struct sigaction * __restrict  )((void *)0));
#line 502
  sigaction(1, (struct sigaction  const  * __restrict  )(& saction), (struct sigaction * __restrict  )((void *)0));
#line 503
  sigaction(17, (struct sigaction  const  * __restrict  )(& saction), (struct sigaction * __restrict  )((void *)0));
#line 506
  saction.__sigaction_handler.sa_handler = (void (*)(int  ))1;
#line 507
  sigaction(13, (struct sigaction  const  * __restrict  )(& saction), (struct sigaction * __restrict  )((void *)0));
#line 521
  return;
}
}
#line 530 "ngircd.c"
static void Signal_Handler(int Signal ) 
{ __pid_t __cil_tmp ;

  {
#line 533
  switch (Signal) {
  case 15: 
  case 2: 
  case 3: 
#line 539
  NGIRCd_SignalQuit = 1;
#line 540
  break;
  case 1: 
#line 543
  NGIRCd_SignalRehash = 1;
#line 544
  break;
  case 17: 
#line 547
  while (1) {
#line 547
    __cil_tmp = waitpid(-1, (int *)((void *)0), 1);
#line 547
    if (! (__cil_tmp > 0)) {
#line 547
      break;
    }
  }
#line 548
  break;
  }
#line 555
  return;
}
}
#line 561 "ngircd.c"
static void Show_Version(void) 
{ 

  {
#line 564
  puts((char const   *)(NGIRCd_Version));
#line 565
  puts("Copyright (c)2001-2008 Alexander Barton (<alex@barton.de>) and Contributors.");
#line 566
  puts("Homepage: <http://ngircd.barton.de/>\n");
#line 567
  puts("This is free software; see the source for copying conditions. There is NO");
#line 568
  puts("warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.");
#line 569
  return;
}
}
#line 577 "ngircd.c"
static void Show_Help(void) 
{ 

  {
#line 583
  puts("  -f, --config <f>   use file <f> as configuration file");
#line 584
  puts("  -n, --nodaemon     don\'t fork and don\'t detach from controlling terminal");
#line 585
  puts("  -p, --passive      disable automatic connections to other servers");
#line 589
  puts("  -t, --configtest   read, validate and display configuration; then exit");
#line 590
  puts("      --version      output version information and exit");
#line 591
  puts("      --help         display this help and exit");
#line 592
  return;
}
}
#line 598 "ngircd.c"
static void Pidfile_Delete(void) 
{ int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 602
  if (! Conf_PidFile[0]) {
#line 602
    return;
  }
#line 608
  __cil_tmp___1 = unlink((char const   *)(Conf_PidFile));
#line 608
  if (__cil_tmp___1) {
#line 609
    __cil_tmp = __errno_location();
#line 609
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 609
    Log(3, "Error unlinking PID file (%s): %s", Conf_PidFile, __cil_tmp___0);
  }
#line 610
  return;
}
}
#line 617 "ngircd.c"
static void Pidfile_Create(pid_t pid ) 
{ int pidfd ;
  char pidbuf[64] ;
  int len ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  ssize_t __cil_tmp___3 ;
  int *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 625
  if (! Conf_PidFile[0]) {
#line 625
    return;
  }
#line 631
  pidfd = open((char const   *)(Conf_PidFile), 194, (384 | (256 >> 3)) | ((256 >> 3) >> 3));
#line 632
  if (pidfd < 0) {
#line 633
    __cil_tmp = __errno_location();
#line 633
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 633
    Log(3, "Error writing PID file (%s): %s", Conf_PidFile, __cil_tmp___0);
#line 634
    return;
  }
#line 637
  len = snprintf((char * __restrict  )(pidbuf), sizeof(pidbuf), (char const   * __restrict  )"%ld\n",
                 (long )pid);
#line 638
  if (len < 0 || len >= (int )sizeof(pidbuf)) {
#line 639
    Log(3, "Error converting pid");
#line 640
    return;
  }
#line 643
  __cil_tmp___3 = write(pidfd, (void const   *)(pidbuf), (unsigned int )len);
#line 643
  if (__cil_tmp___3 != len) {
#line 644
    __cil_tmp___1 = __errno_location();
#line 644
    __cil_tmp___2 = strerror(*__cil_tmp___1);
#line 644
    Log(3, "Can\'t write PID file (%s): %s", Conf_PidFile, __cil_tmp___2);
  }
#line 646
  __cil_tmp___6 = close(pidfd);
#line 646
  if (__cil_tmp___6 != 0) {
#line 647
    __cil_tmp___4 = __errno_location();
#line 647
    __cil_tmp___5 = strerror(*__cil_tmp___4);
#line 647
    Log(3, "Error closing PID file (%s): %s", Conf_PidFile, __cil_tmp___5);
  }
#line 648
  return;
}
}
#line 654 "ngircd.c"
static void Setup_FDStreams(void) 
{ int fd ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;

  {
#line 662
  fd = open("/dev/null", 2);
#line 663
  if (fd < 0) {
#line 664
    __cil_tmp = __errno_location();
#line 664
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 664
    Log(4, "Could not open /dev/null: %s", __cil_tmp___0);
#line 665
    return;
  }
#line 668
  fflush(stdout);
#line 669
  fflush(stderr);
#line 672
  dup2(fd, 0);
#line 672
  dup2(fd, 1);
#line 672
  dup2(fd, 2);
#line 675
  if (fd > 2) {
#line 675
    close(fd);
  }
#line 676
  return;
}
}
#line 679 "ngircd.c"
static int NGIRCd_getNobodyID(uid_t *uid , gid_t *gid ) 
{ struct passwd *pwd ;

  {
#line 684
  pwd = getpwnam("nobody");
#line 685
  if (! pwd) {
#line 685
    return (0);
  }
#line 687
  if (! pwd->pw_uid || ! pwd->pw_gid) {
#line 688
    return (0);
  }
#line 690
  *uid = pwd->pw_uid;
#line 691
  *gid = pwd->pw_gid;
#line 692
  endpwent();
#line 694
  return (1);
}
}
#line 701 "ngircd.c"
static int initialized  ;
#line 698 "ngircd.c"
static int NGIRCd_Init(int NGIRCd_NoDaemon ) 
{ int chrooted ;
  struct passwd *pwd ;
  struct group *grp ;
  int real_errno ;
  pid_t pid ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char const   *__cil_tmp___9 ;
  int *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  int *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  int *__cil_tmp___14 ;
  int *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  __gid_t __cil_tmp___18 ;
  int *__cil_tmp___19 ;
  int *__cil_tmp___20 ;
  char *__cil_tmp___21 ;
  int __cil_tmp___22 ;
  __uid_t __cil_tmp___23 ;
  int *__cil_tmp___24 ;
  char *__cil_tmp___25 ;
  char const   *__cil_tmp___26 ;
  char const   *__cil_tmp___27 ;
  int *__cil_tmp___28 ;
  char *__cil_tmp___29 ;
  int __cil_tmp___30 ;

  {
#line 702
  chrooted = 0;
#line 708
  if (initialized) {
#line 709
    return (1);
  }
#line 711
  if (Conf_Chroot[0]) {
#line 712
    __cil_tmp___1 = chdir((char const   *)(Conf_Chroot));
#line 712
    if (__cil_tmp___1 != 0) {
#line 713
      __cil_tmp = __errno_location();
#line 713
      __cil_tmp___0 = strerror(*__cil_tmp);
#line 713
      Log(3, "Can\'t chdir() in ChrootDir (%s): %s", Conf_Chroot, __cil_tmp___0);
#line 714
      return (0);
    }
#line 717
    __cil_tmp___5 = chroot((char const   *)(Conf_Chroot));
#line 717
    if (__cil_tmp___5 != 0) {
#line 718
      __cil_tmp___4 = __errno_location();
#line 718
      if (*__cil_tmp___4 != 1) {
#line 719
        __cil_tmp___2 = __errno_location();
#line 719
        __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 719
        Log(3, "Can\'t change root directory to \"%s\": %s", Conf_Chroot, __cil_tmp___3);
#line 722
        return (0);
      }
    } else {
#line 725
      chrooted = 1;
#line 726
      Log(6, "Changed root and working directory to \"%s\".", Conf_Chroot);
    }
  }
#line 730
  if (Conf_UID == 0U) {
#line 731
    Log(6, "ServerUID must not be 0, using \"nobody\" instead.", Conf_UID);
#line 733
    __cil_tmp___13 = NGIRCd_getNobodyID(& Conf_UID, & Conf_GID);
#line 733
    if (! __cil_tmp___13) {
#line 734
      __cil_tmp___12 = __errno_location();
#line 734
      if (*__cil_tmp___12) {
#line 734
        __cil_tmp___10 = __errno_location();
#line 734
        __cil_tmp___11 = strerror(*__cil_tmp___10);
#line 734
        __cil_tmp___9 = (char const   *)__cil_tmp___11;
      } else {
#line 734
        __cil_tmp___9 = "not found";
      }
#line 734
      Log(4, "Could not get user/group ID of user \"nobody\": %s", __cil_tmp___9);
#line 736
      return (0);
    }
  }
#line 740
  __cil_tmp___18 = getgid();
#line 740
  if (__cil_tmp___18 != Conf_GID) {
#line 742
    __cil_tmp___17 = setgid(Conf_GID);
#line 742
    if (__cil_tmp___17 != 0) {
#line 743
      __cil_tmp___14 = __errno_location();
#line 743
      real_errno = *__cil_tmp___14;
#line 744
      __cil_tmp___15 = __errno_location();
#line 744
      __cil_tmp___16 = strerror(*__cil_tmp___15);
#line 744
      Log(3, "Can\'t change group ID to %u: %s", Conf_GID, __cil_tmp___16);
#line 745
      if (real_errno != 1) {
#line 746
        return (0);
      }
    }
  }
#line 750
  __cil_tmp___23 = getuid();
#line 750
  if (__cil_tmp___23 != Conf_UID) {
#line 752
    __cil_tmp___22 = setuid(Conf_UID);
#line 752
    if (__cil_tmp___22 != 0) {
#line 753
      __cil_tmp___19 = __errno_location();
#line 753
      real_errno = *__cil_tmp___19;
#line 754
      __cil_tmp___20 = __errno_location();
#line 754
      __cil_tmp___21 = strerror(*__cil_tmp___20);
#line 754
      Log(3, "Can\'t change user ID to %u: %s", Conf_UID, __cil_tmp___21);
#line 755
      if (real_errno != 1) {
#line 756
        return (0);
      }
    }
  }
#line 760
  initialized = 1;
#line 765
  if (! NGIRCd_NoDaemon) {
#line 766
    pid = fork();
#line 767
    if (pid > 0) {
#line 769
      exit(0);
    }
#line 771
    if (pid < 0) {
#line 773
      __cil_tmp___24 = __errno_location();
#line 773
      __cil_tmp___25 = strerror(*__cil_tmp___24);
#line 773
      fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"%s: Can\'t fork: %s!\nFatal error, exiting now ...\n",
              "ngircd", __cil_tmp___25);
#line 775
      exit(1);
    }
#line 779
    setsid();
#line 780
    chdir("/");
#line 783
    Setup_FDStreams();
  }
#line 785
  pid = getpid();
#line 787
  Pidfile_Create(pid);
#line 791
  Conf_UID = getuid();
#line 792
  Conf_GID = getgid();
#line 794
  pwd = getpwuid(Conf_UID);
#line 795
  grp = getgrgid(Conf_GID);
#line 797
  if (grp) {
#line 797
    __cil_tmp___26 = (char const   *)grp->gr_name;
  } else {
#line 797
    __cil_tmp___26 = "unknown";
  }
#line 797
  if (pwd) {
#line 797
    __cil_tmp___27 = (char const   *)pwd->pw_name;
  } else {
#line 797
    __cil_tmp___27 = "unknown";
  }
#line 797
  Log(6, "Running as user %s(%ld), group %s(%ld), with PID %ld.", __cil_tmp___27,
      Conf_UID, __cil_tmp___26, Conf_GID, pid);
#line 801
  if (chrooted) {
#line 802
    Log(6, "Running chrooted, chrootdir \"%s\".", Conf_Chroot);
#line 803
    return (1);
  } else {
#line 805
    Log(6, "Not running chrooted.");
  }
#line 811
  if (pwd) {
#line 812
    if (! NGIRCd_NoDaemon) {
#line 813
      __cil_tmp___30 = chdir((char const   *)pwd->pw_dir);
#line 813
      if (__cil_tmp___30 == 0) {
#line 814
        Log(7, "Changed working directory to \"%s\" ...", pwd->pw_dir);
      } else {
#line 816
        __cil_tmp___28 = __errno_location();
#line 816
        __cil_tmp___29 = strerror(*__cil_tmp___28);
#line 816
        Log(6, "Notice: Can\'t change working directory to \"%s\": %s", pwd->pw_dir,
            __cil_tmp___29);
      }
    }
  } else {
#line 820
    Log(3, "Can\'t get user informaton for UID %d!?", Conf_UID);
  }
#line 823
  return (1);
}
}
#line 1 "array.o"
#pragma merger(0,"/tmp/cil-eBFvZdQ1.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 32 "array.h"
void array_init(array *a ) ;
#line 36
void *array_alloc(array *a , size_t size , size_t pos ) ;
#line 42
size_t array_length(array const   *a , size_t membersize ) ;
#line 49
int array_copy(array *dest , array const   *src ) ;
#line 52
int array_copyb(array *dest , char const   *src , size_t len ) ;
#line 55
int array_copys(array *dest , char const   *src ) ;
#line 62
int array_catb(array *dest , char const   *src , size_t len ) ;
#line 65
int array_cats(array *dest , char const   *src ) ;
#line 68
int array_cat0(array *a ) ;
#line 71
int array_cat0_temporary(array *a ) ;
#line 74
int array_cat(array *dest , array const   *src ) ;
#line 79
void *array_get(array *a , size_t membersize , size_t pos ) ;
#line 82
void array_free(array *a ) ;
#line 88
void *array_start(array const   *a ) ;
#line 91
void array_trunc(array *a ) ;
#line 94
void array_truncate(array *a , size_t membersize , size_t len ) ;
#line 97
void array_moveleft(array *a , size_t membersize , size_t pos ) ;
#line 595 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *realloc(void *__ptr , size_t __size )  __attribute__((__malloc__)) ;
#line 597
extern  __attribute__((__nothrow__)) void free(void *__ptr ) ;
#line 38 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) void *memcpy(void * __restrict  __dest , void const   * __restrict  __src ,
                                                  size_t __n )  __attribute__((__nonnull__(1,2))) ;
#line 43
extern  __attribute__((__nothrow__)) void *memmove(void *__dest , void const   *__src ,
                                                   size_t __n )  __attribute__((__nonnull__(1,2))) ;
#line 36 "array.c"
static int safemult_sizet(size_t a , size_t b , size_t *res ) 
{ size_t tmp ;

  {
#line 39
  tmp = a * b;
#line 41
  if ((int )b && tmp / b != a) {
#line 42
    return (0);
  }
#line 44
  *res = tmp;
#line 45
  return (1);
}
}
#line 49 "array.c"
void array_init(array *a ) 
{ 

  {
#line 53
  a->mem = (char *)((void *)0);
#line 54
  a->allocated = 0U;
#line 55
  a->used = 0U;
#line 56
  return;
}
}
#line 60 "array.c"
void *array_alloc(array *a , size_t size , size_t pos ) 
{ size_t alloc ;
  size_t pos_plus1 ;
  size_t aligned ;
  char *tmp ;
  int __cil_tmp ;
  void *__cil_tmp___0 ;

  {
#line 63
  pos_plus1 = pos + 1U;
#line 64
  aligned = (size_t )0;
#line 69
  if (pos_plus1 == 0U) {
#line 69
    goto _L;
  } else {
#line 69
    __cil_tmp = safemult_sizet(size, pos_plus1, & alloc);
#line 69
    if (! __cil_tmp) {
      _L: /* CIL Label */ 
#line 70
      return ((void *)0);
    }
  }
#line 72
  if (a->allocated < alloc) {
#line 73
    if (alloc < 128U) {
#line 74
      aligned = (alloc + 31U) & 4294967264U;
    } else {
#line 76
      if (alloc < 4096U) {
#line 77
        aligned = (alloc + 1023U) & 4294966272U;
      } else {
#line 79
        aligned = (alloc + 4095U) & 4294963200U;
      }
    }
#line 88
    if (aligned < alloc) {
#line 89
      return ((void *)0);
    }
#line 91
    alloc = aligned;
#line 97
    __cil_tmp___0 = realloc((void *)a->mem, alloc);
#line 97
    tmp = (char *)__cil_tmp___0;
#line 98
    if (! tmp) {
#line 99
      return ((void *)0);
    }
#line 101
    a->mem = tmp;
#line 102
    a->allocated = alloc;
#line 106
    memset((void *)(a->mem + a->used), 0, a->allocated - a->used);
#line 108
    a->used = alloc;
  }
#line 110
  return ((void *)(a->mem + pos * size));
}
}
#line 115 "array.c"
size_t array_length(array const   *a , size_t membersize ) 
{ size_t __cil_tmp ;

  {
#line 121
  if (! a->mem || 0U == a->allocated) {
#line 122
    return (0U);
  }
#line 124
  if (membersize) {
#line 124
    __cil_tmp = a->used / (size_t const   )membersize;
  } else {
#line 124
    __cil_tmp = (unsigned int const   )0;
  }
#line 124
  return ((unsigned int )__cil_tmp);
}
}
#line 129 "array.c"
int array_copy(array *dest , array const   *src ) 
{ int __cil_tmp ;

  {
#line 132
  if (! src->mem || 0U == src->allocated) {
#line 133
    return (0);
  }
#line 135
  __cil_tmp = array_copyb(dest, (char const   *)src->mem, (unsigned int )src->used);
#line 135
  return (__cil_tmp);
}
}
#line 140 "array.c"
int array_copyb(array *dest , char const   *src , size_t len ) 
{ int __cil_tmp ;

  {
#line 146
  if (! src || ! dest) {
#line 147
    return (0);
  }
#line 149
  array_trunc(dest);
#line 150
  __cil_tmp = array_catb(dest, src, len);
#line 150
  return (__cil_tmp);
}
}
#line 155 "array.c"
int array_copys(array *dest , char const   *src ) 
{ size_t __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 158
  __cil_tmp = strlen(src);
#line 158
  __cil_tmp___0 = array_copyb(dest, src, __cil_tmp);
#line 158
  return (__cil_tmp___0);
}
}
#line 164 "array.c"
int array_catb(array *dest , char const   *src , size_t len ) 
{ size_t tmp ;
  size_t used ;
  char *ptr ;
  void *__cil_tmp ;

  {
#line 174
  if (! len) {
#line 175
    return (1);
  }
#line 177
  if (! src || ! dest) {
#line 178
    return (0);
  }
#line 180
  used = dest->used;
#line 181
  tmp = used + len;
#line 183
  if (tmp < used || tmp < len) {
#line 184
    return (0);
  }
#line 186
  __cil_tmp = array_alloc(dest, 1U, tmp);
#line 186
  if (! __cil_tmp) {
#line 187
    return (0);
  }
#line 189
  ptr = dest->mem;
#line 198
  memcpy((void * __restrict  )(ptr + used), (void const   * __restrict  )src, len);
#line 199
  dest->used = tmp;
#line 200
  return (1);
}
}
#line 205 "array.c"
int array_cats(array *dest , char const   *src ) 
{ size_t __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 208
  __cil_tmp = strlen(src);
#line 208
  __cil_tmp___0 = array_catb(dest, src, __cil_tmp);
#line 208
  return (__cil_tmp___0);
}
}
#line 213 "array.c"
int array_cat0(array *a ) 
{ int __cil_tmp ;

  {
#line 216
  __cil_tmp = array_catb(a, "", 1U);
#line 216
  return (__cil_tmp);
}
}
#line 221 "array.c"
int array_cat0_temporary(array *a ) 
{ char *endpos ;
  void *__cil_tmp ;

  {
#line 224
  __cil_tmp = array_alloc(a, 1U, a->used);
#line 224
  endpos = (char *)__cil_tmp;
#line 225
  if (! endpos) {
#line 226
    return (0);
  }
#line 228
  *endpos = (char )'\000';
#line 229
  return (1);
}
}
#line 233 "array.c"
int array_cat(array *dest , array const   *src ) 
{ int __cil_tmp ;

  {
#line 236
  if (! src->mem || 0U == src->allocated) {
#line 237
    return (0);
  }
#line 239
  __cil_tmp = array_catb(dest, (char const   *)src->mem, (unsigned int )src->used);
#line 239
  return (__cil_tmp);
}
}
#line 246 "array.c"
void *array_get(array *a , size_t membersize , size_t pos ) 
{ size_t totalsize ;
  size_t posplus1 ;
  int __cil_tmp ;

  {
#line 250
  posplus1 = pos + 1U;
#line 255
  if (! posplus1 || (! a->mem || 0U == a->allocated)) {
#line 256
    return ((void *)0);
  }
#line 258
  __cil_tmp = safemult_sizet(posplus1, membersize, & totalsize);
#line 258
  if (! __cil_tmp) {
#line 259
    return ((void *)0);
  }
#line 261
  if (a->allocated < totalsize) {
#line 262
    return ((void *)0);
  }
#line 264
  totalsize = pos * membersize;
#line 265
  return ((void *)(a->mem + totalsize));
}
}
#line 269 "array.c"
void array_free(array *a ) 
{ 

  {
#line 278
  free((void *)a->mem);
#line 279
  a->mem = (char *)((void *)0);
#line 280
  a->allocated = 0U;
#line 281
  a->used = 0U;
#line 282
  return;
}
}
#line 285 "array.c"
void *array_start(array const   *a ) 
{ 

  {
#line 289
  return ((void *)a->mem);
}
}
#line 293 "array.c"
void array_trunc(array *a ) 
{ 

  {
#line 297
  a->used = 0U;
#line 298
  return;
}
}
#line 301 "array.c"
void array_truncate(array *a , size_t membersize , size_t len ) 
{ size_t newlen ;
  int __cil_tmp ;

  {
#line 306
  __cil_tmp = safemult_sizet(membersize, len, & newlen);
#line 306
  if (! __cil_tmp) {
#line 307
    return;
  }
#line 309
  if (newlen <= a->allocated) {
#line 310
    a->used = newlen;
  }
#line 311
  return;
}
}
#line 315 "array.c"
void array_moveleft(array *a , size_t membersize , size_t pos ) 
{ size_t bytepos ;
  int __cil_tmp ;

  {
#line 323
  __cil_tmp = safemult_sizet(membersize, pos, & bytepos);
#line 323
  if (! __cil_tmp) {
#line 324
    a->used = 0U;
#line 325
    return;
  }
#line 328
  if (! bytepos) {
#line 329
    return;
  }
#line 336
  if (a->used <= bytepos) {
#line 337
    a->used = 0U;
#line 338
    return;
  }
#line 341
  a->used -= bytepos;
#line 342
  memmove((void *)a->mem, (void const   *)(a->mem + bytepos), a->used);
#line 343
  return;
}
}
#line 1 "channel.o"
#pragma merger(0,"/tmp/cil-Ha80Jb2M.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 584 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *malloc(size_t __size )  __attribute__((__malloc__)) ;
#line 84 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) char *strcpy(char * __restrict  __dest , char const   * __restrict  __src )  __attribute__((__nonnull__(1,2))) ;
#line 167
extern  __attribute__((__nothrow__)) char *strchr(char const   *__s , int __c )  __attribute__((__pure__,
__nonnull__(1))) ;
#line 184
extern  __attribute__((__nothrow__)) size_t strcspn(char const   *__s , char const   *__reject )  __attribute__((__pure__,
__nonnull__(1,2))) ;
#line 325
extern  __attribute__((__nothrow__)) int strcasecmp(char const   *__s1 , char const   *__s2 )  __attribute__((__pure__,
__nonnull__(1,2))) ;
#line 92 "client.h"
int Client_Type(CLIENT *Client ) ;
#line 93
CONN_ID Client_Conn(CLIENT *Client ) ;
#line 94
char *Client_ID(CLIENT *Client ) ;
#line 95
char *Client_Mask(CLIENT *Client ) ;
#line 108
CLIENT *Client_NextHop(CLIENT *Client ) ;
#line 29 "conn-func.h"
void Conn_UpdateIdle(CONN_ID Idx ) ;
#line 27 "lists.h"
struct list_elem *Lists_GetFirst(struct list_head  const  *h ) ;
#line 28
struct list_elem *Lists_GetNext(struct list_elem  const  *e ) ;
#line 30
int Lists_Check(struct list_head *header , CLIENT *Client ) ;
#line 33
int Lists_Add(struct list_head *header , char const   *Mask , int OnlyOnce ) ;
#line 38
void Lists_Free(struct list_head *head ) ;
#line 41
char const   *Lists_GetMask(struct list_elem  const  *e ) ;
#line 59 "channel.h"
struct list_head *Channel_GetListBans(CHANNEL *c ) ;
#line 60
struct list_head *Channel_GetListInvites(CHANNEL *c ) ;
#line 66
int Channel_Join(CLIENT *Client , char *Name ) ;
#line 67
int Channel_Part(CLIENT *Client , CLIENT *Origin , char const   *Name , char const   *Reason ) ;
#line 69
void Channel_Quit(CLIENT *Client , char *Reason ) ;
#line 71
void Channel_Kick(CLIENT *Client , CLIENT *Origin , char *Name , char *Reason ) ;
#line 73
unsigned long Channel_Count(void) ;
#line 74
unsigned long Channel_MemberCount(CHANNEL *Chan ) ;
#line 75
int Channel_CountForUser(CLIENT *Client ) ;
#line 77
char const   *Channel_Name(CHANNEL const   *Chan ) ;
#line 78
char *Channel_Modes(CHANNEL *Chan ) ;
#line 79
char *Channel_Topic(CHANNEL *Chan ) ;
#line 80
char *Channel_Key(CHANNEL *Chan ) ;
#line 81
unsigned long Channel_MaxUsers(CHANNEL *Chan ) ;
#line 83
void Channel_SetTopic(CHANNEL *Chan , CLIENT *Client , char *Topic ) ;
#line 84
void Channel_SetModes(CHANNEL *Chan , char *Modes ) ;
#line 85
void Channel_SetKey(CHANNEL *Chan , char *Key ) ;
#line 86
void Channel_SetMaxUsers(CHANNEL *Chan , unsigned long Count___0 ) ;
#line 88
CHANNEL *Channel_Search(char const   *Name ) ;
#line 90
CHANNEL *Channel_First(void) ;
#line 91
CHANNEL *Channel_Next(CHANNEL *Chan ) ;
#line 93
CL2CHAN *Channel_FirstMember(CHANNEL *Chan ) ;
#line 94
CL2CHAN *Channel_NextMember(CHANNEL *Chan , CL2CHAN *Cl2Chan ) ;
#line 95
CL2CHAN *Channel_FirstChannelOf(CLIENT *Client ) ;
#line 96
CL2CHAN *Channel_NextChannelOf(CLIENT *Client , CL2CHAN *Cl2Chan ) ;
#line 98
CLIENT *Channel_GetClient(CL2CHAN *Cl2Chan ) ;
#line 99
CHANNEL *Channel_GetChannel(CL2CHAN *Cl2Chan ) ;
#line 101
int Channel_IsValidName(char const   *Name ) ;
#line 103
int Channel_ModeAdd(CHANNEL *Chan , char Mode ) ;
#line 104
int Channel_ModeDel(CHANNEL *Chan , char Mode ) ;
#line 106
int Channel_UserModeAdd(CHANNEL *Chan , CLIENT *Client , char Mode ) ;
#line 107
int Channel_UserModeDel(CHANNEL *Chan , CLIENT *Client , char Mode ) ;
#line 108
char *Channel_UserModes(CHANNEL *Chan , CLIENT *Client ) ;
#line 110
int Channel_IsMemberOf(CHANNEL *Chan , CLIENT *Client ) ;
#line 112
int Channel_Write(CHANNEL *Chan , CLIENT *From , CLIENT *Client , char const   *Text ) ;
#line 113
int Channel_Notice(CHANNEL *Chan , CLIENT *From , CLIENT *Client , char const   *Text ) ;
#line 115
CHANNEL *Channel_Create(char *Name ) ;
#line 118
unsigned int Channel_TopicTime(CHANNEL *Chan ) ;
#line 119
char *Channel_TopicWho(CHANNEL *Chan ) ;
#line 122
int Channel_AddInvite(CHANNEL *c , char const   *mask , int onlyonce ) ;
#line 123
int Channel_AddBan(CHANNEL *c , char const   *mask ) ;
#line 125
int Channel_ShowBans(CLIENT *Client , CHANNEL *Channel ) ;
#line 126
int Channel_ShowInvites(CLIENT *Client , CHANNEL *Channel ) ;
#line 21 "irc-write.h"
int IRC_WriteStrClient(CLIENT *Client , char *Format  , ...) ;
#line 22
int IRC_WriteStrClientPrefix(CLIENT *Client , CLIENT *Prefix , char *Format  , ...) ;
#line 25
int IRC_WriteStrChannelPrefix(CLIENT *Client , CHANNEL *Chan , CLIENT *Prefix , int Remote ,
                              char *Format  , ...) ;
#line 28
void IRC_WriteStrServersPrefix(CLIENT *ExceptOf , CLIENT *Prefix , char *Format  , ...) ;
#line 31
int IRC_WriteStrRelatedPrefix(CLIENT *Client , CLIENT *Prefix , int Remote , char *Format 
                              , ...) ;
#line 116 "conf.h"
CONF_CHANNEL Conf_Channel[16] ;
#line 117
unsigned int Conf_Channel_Count ;
#line 20 "hash.h"
UINT32 Hash(char const   *String ) ;
#line 46 "log.h"
__inline static void LogDebug(char const   *Format  __attribute__((__unused__))  , ...) 
{ 

  {
#line 46
  return;
}
}
#line 53 "channel.c"
static CHANNEL *My_Channels  ;
#line 54 "channel.c"
static CL2CHAN *My_Cl2Chan  ;
#line 57
static CL2CHAN *Get_Cl2Chan(CHANNEL *Chan , CLIENT *Client ) ;
#line 58
static CL2CHAN *Add_Client(CHANNEL *Chan , CLIENT *Client ) ;
#line 59
static int Remove_Client(int Type , CHANNEL *Chan , CLIENT *Client , CLIENT *Origin ,
                         char const   *Reason , int InformServer ) ;
#line 60
static CL2CHAN *Get_First_Cl2Chan(CLIENT *Client , CHANNEL *Chan ) ;
#line 61
static CL2CHAN *Get_Next_Cl2Chan(CL2CHAN *Start , CLIENT *Client , CHANNEL *Channel ) ;
#line 62
static int Delete_Channel(CHANNEL *Chan ) ;
#line 65 "channel.c"
void Channel_Init(void) 
{ 

  {
#line 68
  My_Channels = (CHANNEL *)((void *)0);
#line 69
  My_Cl2Chan = (CL2CHAN *)((void *)0);
#line 70
  return;
}
}
#line 73 "channel.c"
struct list_head *Channel_GetListBans(CHANNEL *c ) 
{ 

  {
#line 77
  return (& c->list_bans);
}
}
#line 81 "channel.c"
struct list_head *Channel_GetListInvites(CHANNEL *c ) 
{ 

  {
#line 85
  return (& c->list_invites);
}
}
#line 89 "channel.c"
void Channel_InitPredefined(void) 
{ CHANNEL *chan ;
  char *c ;
  unsigned int i ;
  int __cil_tmp ;
  void *__cil_tmp___0 ;
  void *__cil_tmp___1 ;
  char *__cil_tmp___2 ;

  {
#line 98
  i = 0U;
#line 98
  while (i < Conf_Channel_Count) {
#line 101
    if (! Conf_Channel[i].name[0]) {
#line 101
      goto __Cont;
    }
#line 104
    __cil_tmp = Channel_IsValidName((char const   *)(Conf_Channel[i].name));
#line 104
    if (! __cil_tmp) {
#line 106
      Log(3, "Can\'t create pre-defined channel: invalid name: \"%s\"!", Conf_Channel[i].name);
#line 107
      array_free(& Conf_Channel[i].topic);
#line 108
      goto __Cont;
    }
#line 112
    chan = Channel_Search((char const   *)(Conf_Channel[i].name));
#line 113
    if (chan) {
#line 115
      Log(6, "Can\'t create pre-defined channel \"%s\": name already in use.", Conf_Channel[i].name);
#line 116
      array_free(& Conf_Channel[i].topic);
#line 117
      goto __Cont;
    }
#line 121
    chan = Channel_Create(Conf_Channel[i].name);
#line 122
    if (chan) {
#line 123
      Channel_ModeAdd(chan, (char )'P');
#line 125
      __cil_tmp___1 = array_start((array const   *)(& Conf_Channel[i].topic));
#line 125
      if ((unsigned int )__cil_tmp___1 != (unsigned int )((void *)0)) {
#line 126
        __cil_tmp___0 = array_start((array const   *)(& Conf_Channel[i].topic));
#line 126
        Channel_SetTopic(chan, (CLIENT *)((void *)0), (char *)__cil_tmp___0);
      }
#line 128
      array_free(& Conf_Channel[i].topic);
#line 130
      c = Conf_Channel[i].modes;
#line 131
      while (*c) {
#line 132
        __cil_tmp___2 = c;
#line 132
        c ++;
#line 132
        Channel_ModeAdd(chan, *__cil_tmp___2);
      }
#line 134
      Channel_SetKey(chan, Conf_Channel[i].key);
#line 135
      Channel_SetMaxUsers(chan, Conf_Channel[i].maxusers);
#line 137
      Log(6, "Created pre-defined channel \"%s\".", Conf_Channel[i].name);
    } else {
#line 140
      Log(3, "Can\'t create pre-defined channel \"%s\"!", Conf_Channel[i].name);
    }
    __Cont: /* CIL Label */ 
#line 98
    i ++;
  }
#line 143
  return;
}
}
#line 146 "channel.c"
void Channel_Exit(void) 
{ CHANNEL *c ;
  CHANNEL *c_next ;
  CL2CHAN *cl2chan ;
  CL2CHAN *cl2chan_next ;

  {
#line 153
  c = My_Channels;
#line 154
  while (c) {
#line 156
    c_next = c->next;
#line 157
    array_free(& c->topic);
#line 158
    free((void *)c);
#line 159
    c = c_next;
  }
#line 163
  cl2chan = My_Cl2Chan;
#line 164
  while (c) {
#line 166
    cl2chan_next = cl2chan->next;
#line 167
    free((void *)cl2chan);
#line 168
    cl2chan = cl2chan_next;
  }
#line 170
  return;
}
}
#line 173 "channel.c"
int Channel_Join(CLIENT *Client , char *Name ) 
{ CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  CL2CHAN *__cil_tmp___1 ;
  CL2CHAN *__cil_tmp___2 ;

  {
#line 181
  __cil_tmp___0 = Channel_IsValidName((char const   *)Name);
#line 181
  if (! __cil_tmp___0) {
#line 182
    __cil_tmp = Client_ID(Client);
#line 182
    IRC_WriteStrClient(Client, (char *)"403 %s %s :No such channel", __cil_tmp, Name);
#line 183
    return (0);
  }
#line 186
  chan = Channel_Search((char const   *)Name);
#line 187
  if (chan) {
#line 189
    __cil_tmp___1 = Get_Cl2Chan(chan, Client);
#line 189
    if (__cil_tmp___1) {
#line 189
      return (0);
    }
  } else {
#line 194
    chan = Channel_Create(Name);
#line 195
    if (! chan) {
#line 195
      return (0);
    }
  }
#line 199
  __cil_tmp___2 = Add_Client(chan, Client);
#line 199
  if (__cil_tmp___2) {
#line 200
    return (1);
  } else {
#line 199
    return (0);
  }
}
}
#line 211 "channel.c"
int Channel_Part(CLIENT *Client , CLIENT *Origin , char const   *Name , char const   *Reason ) 
{ CHANNEL *chan ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  CL2CHAN *__cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 220
  chan = Channel_Search(Name);
#line 221
  if (! chan) {
#line 222
    __cil_tmp = Client_ID(Client);
#line 222
    IRC_WriteStrClient(Client, (char *)"403 %s %s :No such channel", __cil_tmp, Name);
#line 224
    return (0);
  }
#line 226
  __cil_tmp___1 = Get_Cl2Chan(chan, Client);
#line 226
  if (! __cil_tmp___1) {
#line 227
    __cil_tmp___0 = Client_ID(Client);
#line 227
    IRC_WriteStrClient(Client, (char *)"442 %s %s :You are not on that channel", __cil_tmp___0,
                       Name);
#line 229
    return (0);
  }
#line 232
  __cil_tmp___2 = Remove_Client(0, chan, Client, Origin, Reason, 1);
#line 232
  if (__cil_tmp___2) {
#line 235
    return (1);
  } else {
#line 233
    return (0);
  }
}
}
#line 239 "channel.c"
void Channel_Kick(CLIENT *Client , CLIENT *Origin , char *Name , char *Reason ) 
{ CHANNEL *chan ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;

  {
#line 249
  chan = Channel_Search((char const   *)Name);
#line 250
  if (! chan) {
#line 252
    __cil_tmp = Client_ID(Origin);
#line 252
    IRC_WriteStrClient(Origin, (char *)"403 %s %s :No such channel", __cil_tmp, Name);
#line 253
    return;
  }
#line 256
  __cil_tmp___1 = Channel_IsMemberOf(chan, Origin);
#line 256
  if (! __cil_tmp___1) {
#line 258
    __cil_tmp___0 = Client_ID(Origin);
#line 258
    IRC_WriteStrClient(Origin, (char *)"442 %s %s :You are not on that channel", __cil_tmp___0,
                       Name);
#line 259
    return;
  }
#line 263
  __cil_tmp___3 = Channel_UserModes(chan, Origin);
#line 263
  __cil_tmp___4 = strchr((char const   *)__cil_tmp___3, 'o');
#line 263
  if (! __cil_tmp___4) {
#line 265
    __cil_tmp___2 = Client_ID(Origin);
#line 265
    IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                       __cil_tmp___2, Name);
#line 266
    return;
  }
#line 270
  __cil_tmp___7 = Channel_IsMemberOf(chan, Client);
#line 270
  if (! __cil_tmp___7) {
#line 272
    __cil_tmp___5 = Client_ID(Client);
#line 272
    __cil_tmp___6 = Client_ID(Origin);
#line 272
    IRC_WriteStrClient(Origin, (char *)"441 %s %s %s :They aren\'t on that channel",
                       __cil_tmp___6, __cil_tmp___5, Name);
#line 273
    return;
  }
#line 276
  Remove_Client(2, chan, Client, Origin, (char const   *)Reason, 1);
#line 277
  return;
}
}
#line 280 "channel.c"
void Channel_Quit(CLIENT *Client , char *Reason ) 
{ CHANNEL *c ;
  CHANNEL *next_c ;

  {
#line 288
  IRC_WriteStrRelatedPrefix(Client, Client, 0, (char *)"QUIT :%s", Reason);
#line 290
  c = My_Channels;
#line 291
  while (c) {
#line 293
    next_c = c->next;
#line 294
    Remove_Client(1, c, Client, Client, (char const   *)Reason, 0);
#line 295
    c = next_c;
  }
#line 297
  return;
}
}
#line 300 "channel.c"
unsigned long Channel_Count(void) 
{ CHANNEL *c ;
  unsigned long count ;

  {
#line 304
  count = 0UL;
#line 306
  c = My_Channels;
#line 307
  while (c) {
#line 309
    count ++;
#line 310
    c = c->next;
  }
#line 312
  return (count);
}
}
#line 316 "channel.c"
unsigned long Channel_MemberCount(CHANNEL *Chan ) 
{ CL2CHAN *cl2chan ;
  unsigned long count ;

  {
#line 320
  count = 0UL;
#line 324
  cl2chan = My_Cl2Chan;
#line 325
  while (cl2chan) {
#line 327
    if ((unsigned int )cl2chan->channel == (unsigned int )Chan) {
#line 327
      count ++;
    }
#line 328
    cl2chan = cl2chan->next;
  }
#line 330
  return (count);
}
}
#line 334 "channel.c"
int Channel_CountForUser(CLIENT *Client ) 
{ CL2CHAN *cl2chan ;
  int count ;

  {
#line 340
  count = 0;
#line 344
  cl2chan = My_Cl2Chan;
#line 345
  while (cl2chan) {
#line 347
    if ((unsigned int )cl2chan->client == (unsigned int )Client) {
#line 347
      count ++;
    }
#line 348
    cl2chan = cl2chan->next;
  }
#line 351
  return (count);
}
}
#line 356 "channel.c"
char const   *Channel_Name(CHANNEL const   *Chan ) 
{ 

  {
#line 360
  return ((char const   *)(Chan->name));
}
}
#line 364 "channel.c"
char *Channel_Modes(CHANNEL *Chan ) 
{ 

  {
#line 368
  return (Chan->modes);
}
}
#line 372 "channel.c"
char *Channel_Key(CHANNEL *Chan ) 
{ 

  {
#line 376
  return (Chan->key);
}
}
#line 380 "channel.c"
unsigned long Channel_MaxUsers(CHANNEL *Chan ) 
{ 

  {
#line 384
  return (Chan->maxusers);
}
}
#line 388 "channel.c"
CHANNEL *Channel_First(void) 
{ 

  {
#line 391
  return (My_Channels);
}
}
#line 395 "channel.c"
CHANNEL *Channel_Next(CHANNEL *Chan ) 
{ 

  {
#line 399
  return (Chan->next);
}
}
#line 403 "channel.c"
CHANNEL *Channel_Search(char const   *Name ) 
{ CHANNEL *c ;
  UINT32 search_hash ;
  int __cil_tmp ;

  {
#line 413
  search_hash = Hash(Name);
#line 414
  c = My_Channels;
#line 415
  while (c) {
#line 417
    if (search_hash == c->hash) {
#line 420
      __cil_tmp = strcasecmp(Name, (char const   *)(c->name));
#line 420
      if (__cil_tmp == 0) {
#line 420
        return (c);
      }
    }
#line 422
    c = c->next;
  }
#line 424
  return ((CHANNEL *)((void *)0));
}
}
#line 428 "channel.c"
CL2CHAN *Channel_FirstMember(CHANNEL *Chan ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 432
  __cil_tmp = Get_First_Cl2Chan((CLIENT *)((void *)0), Chan);
#line 432
  return (__cil_tmp);
}
}
#line 436 "channel.c"
CL2CHAN *Channel_NextMember(CHANNEL *Chan , CL2CHAN *Cl2Chan ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 441
  __cil_tmp = Get_Next_Cl2Chan(Cl2Chan->next, (CLIENT *)((void *)0), Chan);
#line 441
  return (__cil_tmp);
}
}
#line 445 "channel.c"
CL2CHAN *Channel_FirstChannelOf(CLIENT *Client ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 449
  __cil_tmp = Get_First_Cl2Chan(Client, (CHANNEL *)((void *)0));
#line 449
  return (__cil_tmp);
}
}
#line 453 "channel.c"
CL2CHAN *Channel_NextChannelOf(CLIENT *Client , CL2CHAN *Cl2Chan ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 458
  __cil_tmp = Get_Next_Cl2Chan(Cl2Chan->next, Client, (CHANNEL *)((void *)0));
#line 458
  return (__cil_tmp);
}
}
#line 462 "channel.c"
CLIENT *Channel_GetClient(CL2CHAN *Cl2Chan ) 
{ 

  {
#line 466
  return (Cl2Chan->client);
}
}
#line 470 "channel.c"
CHANNEL *Channel_GetChannel(CL2CHAN *Cl2Chan ) 
{ 

  {
#line 474
  return (Cl2Chan->channel);
}
}
#line 478 "channel.c"
int Channel_IsValidName(char const   *Name ) 
{ size_t __cil_tmp ;
  size_t __cil_tmp___0 ;

  {
#line 483
  if ((int const   )*(Name + 0) != 35) {
#line 483
    goto _L;
  } else {
#line 483
    __cil_tmp = strlen(Name);
#line 483
    if (__cil_tmp >= 51U) {
      _L: /* CIL Label */ 
#line 483
      return (0);
    }
  }
#line 485
  __cil_tmp___0 = strcspn(Name, " ,:\a");
#line 485
  return ((int const   )*(Name + __cil_tmp___0) == 0);
}
}
#line 489 "channel.c"
int Channel_ModeAdd(CHANNEL *Chan , char Mode ) 
{ char x[2] ;
  char *__cil_tmp ;

  {
#line 501
  x[0] = Mode;
#line 501
  x[1] = (char )'\000';
#line 502
  __cil_tmp = strchr((char const   *)(Chan->modes), (int )x[0]);
#line 502
  if (__cil_tmp) {
#line 508
    return (0);
  } else {
#line 505
    strlcat(Chan->modes, (char const   *)(x), sizeof(Chan->modes));
#line 506
    return (1);
  }
}
}
#line 512 "channel.c"
int Channel_ModeDel(CHANNEL *Chan , char Mode ) 
{ char *p ;

  {
#line 523
  p = strchr((char const   *)(Chan->modes), (int )Mode);
#line 524
  if (! p) {
#line 524
    return (0);
  }
#line 527
  while (*p) {
#line 529
    *p = *(p + 1);
#line 530
    p ++;
  }
#line 532
  return (1);
}
}
#line 536 "channel.c"
int Channel_UserModeAdd(CHANNEL *Chan , CLIENT *Client , char Mode ) 
{ CL2CHAN *cl2chan ;
  char x[2] ;
  char *__cil_tmp ;

  {
#line 550
  cl2chan = Get_Cl2Chan(Chan, Client);
#line 553
  x[0] = Mode;
#line 553
  x[1] = (char )'\000';
#line 554
  __cil_tmp = strchr((char const   *)(cl2chan->modes), (int )x[0]);
#line 554
  if (__cil_tmp) {
#line 560
    return (0);
  } else {
#line 557
    strlcat(cl2chan->modes, (char const   *)(x), sizeof(cl2chan->modes));
#line 558
    return (1);
  }
}
}
#line 564 "channel.c"
int Channel_UserModeDel(CHANNEL *Chan , CLIENT *Client , char Mode ) 
{ CL2CHAN *cl2chan ;
  char *p ;

  {
#line 578
  cl2chan = Get_Cl2Chan(Chan, Client);
#line 581
  p = strchr((char const   *)(cl2chan->modes), (int )Mode);
#line 582
  if (! p) {
#line 582
    return (0);
  }
#line 585
  while (*p) {
#line 587
    *p = *(p + 1);
#line 588
    p ++;
  }
#line 590
  return (1);
}
}
#line 594 "channel.c"
char *Channel_UserModes(CHANNEL *Chan , CLIENT *Client ) 
{ CL2CHAN *cl2chan ;

  {
#line 604
  cl2chan = Get_Cl2Chan(Chan, Client);
#line 607
  return (cl2chan->modes);
}
}
#line 611 "channel.c"
int Channel_IsMemberOf(CHANNEL *Chan , CLIENT *Client ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 618
  __cil_tmp = Get_Cl2Chan(Chan, Client);
#line 618
  return ((unsigned int )__cil_tmp != (unsigned int )((void *)0));
}
}
#line 622 "channel.c"
char *Channel_Topic(CHANNEL *Chan ) 
{ char *ret ;
  void *__cil_tmp ;
  char const   *__cil_tmp___0 ;

  {
#line 627
  __cil_tmp = array_start((array const   *)(& Chan->topic));
#line 627
  ret = (char *)__cil_tmp;
#line 628
  if (ret) {
#line 628
    __cil_tmp___0 = (char const   *)ret;
  } else {
#line 628
    __cil_tmp___0 = "";
  }
#line 628
  return ((char *)__cil_tmp___0);
}
}
#line 634 "channel.c"
unsigned int Channel_TopicTime(CHANNEL *Chan ) 
{ 

  {
#line 638
  return ((unsigned int )Chan->topic_time);
}
}
#line 642 "channel.c"
char *Channel_TopicWho(CHANNEL *Chan ) 
{ 

  {
#line 646
  return (Chan->topic_who);
}
}
#line 652 "channel.c"
void Channel_SetTopic(CHANNEL *Chan , CLIENT *Client , char *Topic ) 
{ size_t len ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 659
  len = strlen((char const   *)Topic);
#line 660
  if (len < Chan->topic.used) {
#line 661
    array_free(& Chan->topic);
  }
#line 663
  if (len >= 513U) {
#line 663
    goto _L;
  } else {
#line 663
    __cil_tmp___1 = array_copyb(& Chan->topic, (char const   *)Topic, len + 1U);
#line 663
    if (! __cil_tmp___1) {
      _L: /* CIL Label */ 
#line 664
      __cil_tmp = __errno_location();
#line 664
      __cil_tmp___0 = strerror(*__cil_tmp);
#line 664
      Log(4, "could not set new Topic \"%s\" on %s: %s", Topic, Chan->name, __cil_tmp___0);
    }
  }
#line 667
  Chan->topic_time = time((time_t *)((void *)0));
#line 668
  if ((unsigned int )Client != (unsigned int )((void *)0)) {
#line 668
    __cil_tmp___3 = Client_Type(Client);
#line 668
    if (__cil_tmp___3 != 32) {
#line 669
      __cil_tmp___2 = Client_ID(Client);
#line 669
      strlcpy(Chan->topic_who, (char const   *)__cil_tmp___2, sizeof(Chan->topic_who));
    } else {
#line 668
      goto _L___0;
    }
  } else {
    _L___0: /* CIL Label */ 
#line 672
    strlcpy(Chan->topic_who, "-Server-", sizeof(Chan->topic_who));
  }
#line 677
  return;
}
}
#line 680 "channel.c"
void Channel_SetModes(CHANNEL *Chan , char *Modes ) 
{ 

  {
#line 686
  strlcpy(Chan->modes, (char const   *)Modes, sizeof(Chan->modes));
#line 687
  return;
}
}
#line 690 "channel.c"
void Channel_SetKey(CHANNEL *Chan , char *Key ) 
{ 

  {
#line 696
  strlcpy(Chan->key, (char const   *)Key, sizeof(Chan->key));
#line 697
  LogDebug("Channel %s: Key is now \"%s\".", Chan->name, Chan->key);
#line 698
  return;
}
}
#line 701 "channel.c"
void Channel_SetMaxUsers(CHANNEL *Chan , unsigned long Count___0 ) 
{ 

  {
#line 706
  Chan->maxusers = Count___0;
#line 707
  LogDebug("Channel %s: Member limit is now %lu.", Chan->name, Chan->maxusers);
#line 708
  return;
}
}
#line 711 "channel.c"
static int Can_Send_To_Channel(CHANNEL *Chan , CLIENT *From ) 
{ int is_member ;
  int has_voice ;
  int is_op ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 716
  is_op = 0;
#line 716
  has_voice = is_op;
#line 716
  is_member = has_voice;
#line 718
  __cil_tmp___3 = Channel_IsMemberOf(Chan, From);
#line 718
  if (__cil_tmp___3) {
#line 719
    is_member = 1;
#line 720
    __cil_tmp = Channel_UserModes(Chan, From);
#line 720
    __cil_tmp___0 = strchr((char const   *)__cil_tmp, 'v');
#line 720
    if (__cil_tmp___0) {
#line 721
      has_voice = 1;
    }
#line 722
    __cil_tmp___1 = Channel_UserModes(Chan, From);
#line 722
    __cil_tmp___2 = strchr((char const   *)__cil_tmp___1, 'o');
#line 722
    if (__cil_tmp___2) {
#line 723
      is_op = 1;
    }
  }
#line 732
  __cil_tmp___4 = Channel_Modes(Chan);
#line 732
  __cil_tmp___5 = strchr((char const   *)__cil_tmp___4, 'n');
#line 732
  if ((int )__cil_tmp___5 && ! is_member) {
#line 733
    return (0);
  }
#line 735
  if (is_op || has_voice) {
#line 736
    return (1);
  }
#line 738
  __cil_tmp___6 = Channel_Modes(Chan);
#line 738
  __cil_tmp___7 = strchr((char const   *)__cil_tmp___6, 'm');
#line 738
  if (__cil_tmp___7) {
#line 739
    return (0);
  }
#line 741
  __cil_tmp___8 = Lists_Check(& Chan->list_bans, From);
#line 741
  if (__cil_tmp___8) {
#line 741
    __cil_tmp___9 = 0;
  } else {
#line 741
    __cil_tmp___9 = 1;
  }
#line 741
  return (__cil_tmp___9);
}
}
#line 745 "channel.c"
int Channel_Write(CHANNEL *Chan , CLIENT *From , CLIENT *Client , char const   *Text ) 
{ char const   *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  CONN_ID __cil_tmp___3 ;
  CONN_ID __cil_tmp___4 ;
  char const   *__cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 748
  __cil_tmp___2 = Can_Send_To_Channel(Chan, From);
#line 748
  if (! __cil_tmp___2) {
#line 749
    __cil_tmp = Channel_Name((CHANNEL const   *)Chan);
#line 749
    __cil_tmp___0 = Client_ID(From);
#line 749
    __cil_tmp___1 = IRC_WriteStrClient(From, (char *)"404 %s %s :Cannot send to channel",
                                       __cil_tmp___0, __cil_tmp);
#line 749
    return (__cil_tmp___1);
  }
#line 751
  __cil_tmp___4 = Client_Conn(From);
#line 751
  if (__cil_tmp___4 > -1) {
#line 752
    __cil_tmp___3 = Client_Conn(From);
#line 752
    Conn_UpdateIdle(__cil_tmp___3);
  }
#line 754
  __cil_tmp___5 = Channel_Name((CHANNEL const   *)Chan);
#line 754
  __cil_tmp___6 = IRC_WriteStrChannelPrefix(Client, Chan, From, 1, (char *)"PRIVMSG %s :%s",
                                            __cil_tmp___5, Text);
#line 754
  return (__cil_tmp___6);
}
}
#line 759 "channel.c"
int Channel_Notice(CHANNEL *Chan , CLIENT *From , CLIENT *Client , char const   *Text ) 
{ int __cil_tmp ;
  CONN_ID __cil_tmp___0 ;
  CONN_ID __cil_tmp___1 ;
  char const   *__cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 762
  __cil_tmp = Can_Send_To_Channel(Chan, From);
#line 762
  if (! __cil_tmp) {
#line 763
    return (1);
  }
#line 765
  __cil_tmp___1 = Client_Conn(From);
#line 765
  if (__cil_tmp___1 > -1) {
#line 766
    __cil_tmp___0 = Client_Conn(From);
#line 766
    Conn_UpdateIdle(__cil_tmp___0);
  }
#line 768
  __cil_tmp___2 = Channel_Name((CHANNEL const   *)Chan);
#line 768
  __cil_tmp___3 = IRC_WriteStrChannelPrefix(Client, Chan, From, 1, (char *)"NOTICE %s :%s",
                                            __cil_tmp___2, Text);
#line 768
  return (__cil_tmp___3);
}
}
#line 773 "channel.c"
CHANNEL *Channel_Create(char *Name ) 
{ CHANNEL *c ;
  void *__cil_tmp ;

  {
#line 781
  __cil_tmp = malloc(sizeof(CHANNEL ));
#line 781
  c = (CHANNEL *)__cil_tmp;
#line 782
  if (! c) {
#line 784
    Log(0, "Can\'t allocate memory! [New_Chan]");
#line 785
    return ((CHANNEL *)((void *)0));
  }
#line 787
  memset((void *)c, 0, sizeof(CHANNEL ));
#line 788
  strlcpy(c->name, (char const   *)Name, sizeof(c->name));
#line 789
  c->hash = Hash((char const   *)(c->name));
#line 790
  c->next = My_Channels;
#line 791
  My_Channels = c;
#line 792
  LogDebug("Created new channel structure for \"%s\".", Name);
#line 793
  return (c);
}
}
#line 797 "channel.c"
static CL2CHAN *Get_Cl2Chan(CHANNEL *Chan , CLIENT *Client ) 
{ CL2CHAN *cl2chan ;

  {
#line 805
  cl2chan = My_Cl2Chan;
#line 806
  while (cl2chan) {
#line 808
    if ((unsigned int )cl2chan->channel == (unsigned int )Chan && (unsigned int )cl2chan->client == (unsigned int )Client) {
#line 808
      return (cl2chan);
    }
#line 809
    cl2chan = cl2chan->next;
  }
#line 811
  return ((CL2CHAN *)((void *)0));
}
}
#line 815 "channel.c"
static CL2CHAN *Add_Client(CHANNEL *Chan , CLIENT *Client ) 
{ CL2CHAN *cl2chan ;
  void *__cil_tmp ;
  char *__cil_tmp___0 ;

  {
#line 824
  __cil_tmp = malloc(sizeof(CL2CHAN ));
#line 824
  cl2chan = (CL2CHAN *)__cil_tmp;
#line 825
  if (! cl2chan) {
#line 827
    Log(0, "Can\'t allocate memory! [Add_Client]");
#line 828
    return ((CL2CHAN *)((void *)0));
  }
#line 830
  cl2chan->channel = Chan;
#line 831
  cl2chan->client = Client;
#line 832
  strcpy((char * __restrict  )(cl2chan->modes), (char const   * __restrict  )"");
#line 835
  cl2chan->next = My_Cl2Chan;
#line 836
  My_Cl2Chan = cl2chan;
#line 838
  __cil_tmp___0 = Client_Mask(Client);
#line 838
  Log(7, "User \"%s\" joined channel \"%s\".", __cil_tmp___0, Chan->name);
#line 840
  return (cl2chan);
}
}
#line 844 "channel.c"
static int Remove_Client(int Type , CHANNEL *Chan , CLIENT *Client , CLIENT *Origin ,
                         char const   *Reason , int InformServer ) 
{ CL2CHAN *cl2chan ;
  CL2CHAN *last_cl2chan ;
  CHANNEL *c ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  CLIENT *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  CONN_ID __cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  CONN_ID __cil_tmp___9 ;
  int __cil_tmp___10 ;
  CL2CHAN *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  char *__cil_tmp___13 ;

  {
#line 855
  last_cl2chan = (CL2CHAN *)((void *)0);
#line 856
  cl2chan = My_Cl2Chan;
#line 857
  while (cl2chan) {
#line 859
    if ((unsigned int )cl2chan->channel == (unsigned int )Chan && (unsigned int )cl2chan->client == (unsigned int )Client) {
#line 859
      break;
    }
#line 860
    last_cl2chan = cl2chan;
#line 861
    cl2chan = cl2chan->next;
  }
#line 863
  if (! cl2chan) {
#line 863
    return (0);
  }
#line 865
  c = cl2chan->channel;
#line 869
  if (last_cl2chan) {
#line 869
    last_cl2chan->next = cl2chan->next;
  } else {
#line 870
    My_Cl2Chan = cl2chan->next;
  }
#line 871
  free((void *)cl2chan);
#line 873
  switch (Type) {
  case 1: 
#line 879
  __cil_tmp = Client_Mask(Client);
#line 879
  LogDebug("User \"%s\" left channel \"%s\" (%s).", __cil_tmp, c->name, Reason);
#line 881
  break;
  case 2: 
#line 884
  if (InformServer) {
#line 885
    __cil_tmp___0 = Client_ID(Client);
#line 885
    __cil_tmp___1 = Client_NextHop(Origin);
#line 885
    IRC_WriteStrServersPrefix(__cil_tmp___1, Origin, (char *)"KICK %s %s :%s", c->name,
                              __cil_tmp___0, Reason);
  }
#line 887
  __cil_tmp___2 = Client_ID(Client);
#line 887
  IRC_WriteStrChannelPrefix(Client, c, Origin, 0, (char *)"KICK %s %s :%s", c->name,
                            __cil_tmp___2, Reason);
#line 889
  __cil_tmp___4 = Client_Conn(Client);
#line 889
  if (__cil_tmp___4 > -1) {
#line 889
    __cil_tmp___5 = Client_Type(Client);
#line 889
    if (__cil_tmp___5 == 16) {
#line 892
      __cil_tmp___3 = Client_ID(Client);
#line 892
      IRC_WriteStrClientPrefix(Client, Origin, (char *)"KICK %s %s :%s", c->name,
                               __cil_tmp___3, Reason);
    } else {
#line 889
      goto _L;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 895
  __cil_tmp___6 = Client_ID(Origin);
#line 895
  __cil_tmp___7 = Client_Mask(Client);
#line 895
  LogDebug("User \"%s\" has been kicked of \"%s\" by \"%s\": %s.", __cil_tmp___7,
           c->name, __cil_tmp___6, Reason);
#line 897
  break;
  default: ;
#line 899
  if (InformServer) {
#line 900
    IRC_WriteStrServersPrefix(Origin, Client, (char *)"PART %s :%s", c->name, Reason);
  }
#line 902
  IRC_WriteStrChannelPrefix(Origin, c, Client, 0, (char *)"PART %s :%s", c->name,
                            Reason);
#line 905
  __cil_tmp___9 = Client_Conn(Origin);
#line 905
  if (__cil_tmp___9 > -1) {
#line 905
    __cil_tmp___10 = Client_Type(Origin);
#line 905
    if (__cil_tmp___10 == 16) {
#line 908
      IRC_WriteStrClientPrefix(Origin, Client, (char *)"PART %s :%s", c->name, Reason);
#line 909
      __cil_tmp___8 = Client_Mask(Client);
#line 909
      LogDebug("User \"%s\" left channel \"%s\" (%s).", __cil_tmp___8, c->name, Reason);
    } else {
#line 905
      goto _L___0;
    }
  } else {
    _L___0: /* CIL Label */ ;
  }
  }
#line 915
  __cil_tmp___12 = Channel_Modes(Chan);
#line 915
  __cil_tmp___13 = strchr((char const   *)__cil_tmp___12, 'P');
#line 915
  if (! __cil_tmp___13) {
#line 917
    __cil_tmp___11 = Get_First_Cl2Chan((CLIENT *)((void *)0), Chan);
#line 917
    if (! __cil_tmp___11) {
#line 917
      Delete_Channel(Chan);
    }
  }
#line 920
  return (1);
}
}
#line 924 "channel.c"
int Channel_AddBan(CHANNEL *c , char const   *mask ) 
{ struct list_head *h ;
  struct list_head *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 927
  __cil_tmp = Channel_GetListBans(c);
#line 927
  h = __cil_tmp;
#line 928
  __cil_tmp___0 = Lists_Add(h, mask, 0);
#line 928
  return (__cil_tmp___0);
}
}
#line 932 "channel.c"
int Channel_AddInvite(CHANNEL *c , char const   *mask , int onlyonce ) 
{ struct list_head *h ;
  struct list_head *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 935
  __cil_tmp = Channel_GetListInvites(c);
#line 935
  h = __cil_tmp;
#line 936
  __cil_tmp___0 = Lists_Add(h, mask, onlyonce);
#line 936
  return (__cil_tmp___0);
}
}
#line 940 "channel.c"
static int ShowInvitesBans(struct list_head *head , CLIENT *Client , CHANNEL *Channel ,
                           int invite ) 
{ struct list_elem *e ;
  char *msg ;
  char const   *__cil_tmp ;
  char *msg_end ;
  char const   *__cil_tmp___0 ;
  char const   *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char const   *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 944
  if (invite) {
#line 944
    __cil_tmp = "346 %s %s %s";
  } else {
#line 944
    __cil_tmp = "367 %s %s %s";
  }
#line 944
  msg = (char *)__cil_tmp;
#line 950
  e = Lists_GetFirst((struct list_head  const  *)head);
#line 951
  while (e) {
#line 952
    __cil_tmp___0 = Lists_GetMask((struct list_elem  const  *)e);
#line 952
    __cil_tmp___1 = Channel_Name((CHANNEL const   *)Channel);
#line 952
    __cil_tmp___2 = Client_ID(Client);
#line 952
    __cil_tmp___3 = IRC_WriteStrClient(Client, msg, __cil_tmp___2, __cil_tmp___1,
                                       __cil_tmp___0);
#line 952
    if (! __cil_tmp___3) {
#line 953
      return (0);
    }
#line 954
    e = Lists_GetNext((struct list_elem  const  *)e);
  }
#line 957
  if (invite) {
#line 957
    msg_end = (char *)"347 %s %s :End of channel invite list";
  } else {
#line 957
    msg_end = (char *)"368 %s %s :End of channel ban list";
  }
#line 958
  __cil_tmp___4 = Channel_Name((CHANNEL const   *)Channel);
#line 958
  __cil_tmp___5 = Client_ID(Client);
#line 958
  __cil_tmp___6 = IRC_WriteStrClient(Client, msg_end, __cil_tmp___5, __cil_tmp___4);
#line 958
  return (__cil_tmp___6);
}
}
#line 962 "channel.c"
int Channel_ShowBans(CLIENT *Client , CHANNEL *Channel ) 
{ struct list_head *h ;
  int __cil_tmp ;

  {
#line 969
  h = Channel_GetListBans(Channel);
#line 970
  __cil_tmp = ShowInvitesBans(h, Client, Channel, 0);
#line 970
  return (__cil_tmp);
}
}
#line 974 "channel.c"
int Channel_ShowInvites(CLIENT *Client , CHANNEL *Channel ) 
{ struct list_head *h ;
  int __cil_tmp ;

  {
#line 981
  h = Channel_GetListInvites(Channel);
#line 982
  __cil_tmp = ShowInvitesBans(h, Client, Channel, 1);
#line 982
  return (__cil_tmp);
}
}
#line 986 "channel.c"
static CL2CHAN *Get_First_Cl2Chan(CLIENT *Client , CHANNEL *Chan ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 989
  __cil_tmp = Get_Next_Cl2Chan(My_Cl2Chan, Client, Chan);
#line 989
  return (__cil_tmp);
}
}
#line 993 "channel.c"
static CL2CHAN *Get_Next_Cl2Chan(CL2CHAN *Start , CLIENT *Client , CHANNEL *Channel ) 
{ CL2CHAN *cl2chan ;

  {
#line 1000
  cl2chan = Start;
#line 1001
  while (cl2chan) {
#line 1003
    if ((int )Client && (unsigned int )cl2chan->client == (unsigned int )Client) {
#line 1003
      return (cl2chan);
    }
#line 1004
    if ((int )Channel && (unsigned int )cl2chan->channel == (unsigned int )Channel) {
#line 1004
      return (cl2chan);
    }
#line 1005
    cl2chan = cl2chan->next;
  }
#line 1007
  return ((CL2CHAN *)((void *)0));
}
}
#line 1011 "channel.c"
static int Delete_Channel(CHANNEL *Chan ) 
{ CHANNEL *chan ;
  CHANNEL *last_chan ;

  {
#line 1018
  last_chan = (CHANNEL *)((void *)0);
#line 1019
  chan = My_Channels;
#line 1020
  while (chan) {
#line 1022
    if ((unsigned int )chan == (unsigned int )Chan) {
#line 1022
      break;
    }
#line 1023
    last_chan = chan;
#line 1024
    chan = chan->next;
  }
#line 1026
  if (! chan) {
#line 1026
    return (0);
  }
#line 1028
  Log(7, "Freed channel structure for \"%s\".", Chan->name);
#line 1031
  Lists_Free(& chan->list_bans);
#line 1032
  Lists_Free(& chan->list_invites);
#line 1035
  if (last_chan) {
#line 1035
    last_chan->next = chan->next;
  } else {
#line 1036
    My_Channels = chan->next;
  }
#line 1037
  free((void *)chan);
#line 1039
  return (1);
}
}
#line 1 "client.o"
#pragma merger(0,"/tmp/cil-VhSeBw4Q.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 793 "/usr/include/unistd.h"
extern  __attribute__((__nothrow__)) int gethostname(char *__name , size_t __len )  __attribute__((__nonnull__(1))) ;
#line 138 "/usr/include/netdb.h"
extern struct hostent *gethostbyname(char const   *__name ) ;
#line 78 "client.h"
CLIENT *Client_NewLocal(CONN_ID Idx , char *Hostname , int Type , int Idented ) ;
#line 79
CLIENT *Client_NewRemoteServer(CLIENT *Introducer , char *Hostname , CLIENT *TopServer ,
                               int Hops , int Token , char *Info , int Idented ) ;
#line 80
CLIENT *Client_NewRemoteUser(CLIENT *Introducer , char *Nick , int Hops , char *User ,
                             char *Hostname , int Token , char *Modes , char *Info ,
                             int Idented ) ;
#line 82
void Client_Destroy(CLIENT *Client , char *LogMsg , char *FwdMsg , int SendQuit ) ;
#line 84
CLIENT *Client_ThisServer(void) ;
#line 86
CLIENT *Client_GetFromToken(CLIENT *Client , int Token ) ;
#line 88
CLIENT *Client_Search(char *Nick ) ;
#line 89
CLIENT *Client_First(void) ;
#line 90
CLIENT *Client_Next(CLIENT *c ) ;
#line 96
char *Client_Info(CLIENT *Client ) ;
#line 97
char *Client_User(CLIENT *Client ) ;
#line 98
char *Client_Hostname(CLIENT *Client ) ;
#line 99
char *Client_Password(CLIENT *Client ) ;
#line 100
char *Client_Modes(CLIENT *Client ) ;
#line 101
char *Client_Flags(CLIENT *Client ) ;
#line 102
CLIENT *Client_Introducer(CLIENT *Client ) ;
#line 103
int Client_OperByMe(CLIENT *Client ) ;
#line 104
int Client_Hops(CLIENT *Client ) ;
#line 105
int Client_Token(CLIENT *Client ) ;
#line 106
int Client_MyToken(CLIENT *Client ) ;
#line 107
CLIENT *Client_TopServer(CLIENT *Client ) ;
#line 109
char *Client_Away(CLIENT *Client ) ;
#line 110
time_t Client_StartTime(CLIENT *Client ) ;
#line 112
int Client_HasMode(CLIENT *Client , char Mode ) ;
#line 114
void Client_SetHostname(CLIENT *Client , char *Hostname ) ;
#line 115
void Client_SetID(CLIENT *Client , char *ID ) ;
#line 116
void Client_SetUser(CLIENT *Client , char *User , int Idented ) ;
#line 117
void Client_SetInfo(CLIENT *Client , char *Info ) ;
#line 118
void Client_SetPassword(CLIENT *Client , char *Pwd ) ;
#line 119
void Client_SetType(CLIENT *Client , int Type ) ;
#line 120
void Client_SetHops(CLIENT *Client , int Hops ) ;
#line 121
void Client_SetToken(CLIENT *Client , int Token ) ;
#line 122
void Client_SetOperByMe(CLIENT *Client , int OperByMe ) ;
#line 123
void Client_SetModes(CLIENT *Client , char *Modes ) ;
#line 124
void Client_SetFlags(CLIENT *Client , char *Flags ) ;
#line 125
void Client_SetIntroducer(CLIENT *Client , CLIENT *Introducer ) ;
#line 126
void Client_SetAway(CLIENT *Client , char *Txt ) ;
#line 128
int Client_ModeAdd(CLIENT *Client , char Mode ) ;
#line 129
int Client_ModeDel(CLIENT *Client , char Mode ) ;
#line 131
int Client_CheckNick(CLIENT *Client , char *Nick ) ;
#line 132
int Client_CheckID(CLIENT *Client , char *ID ) ;
#line 134
long Client_UserCount(void) ;
#line 135
long Client_ServiceCount(void) ;
#line 136
long Client_ServerCount(void) ;
#line 137
unsigned long Client_OperCount(void) ;
#line 138
unsigned long Client_UnknownCount(void) ;
#line 139
long Client_MyUserCount(void) ;
#line 140
long Client_MyServiceCount(void) ;
#line 141
unsigned long Client_MyServerCount(void) ;
#line 142
long Client_MaxUserCount(void) ;
#line 143
long Client_MyMaxUserCount(void) ;
#line 145
int Client_IsValidNick(char const   *Nick ) ;
#line 147
WHOWAS *Client_GetWhowas(void) ;
#line 148
int Client_GetLastWhowasIndex(void) ;
#line 150
void Client_RegisterWhowas(CLIENT *Client ) ;
#line 96 "conn.h"
void Conn_Close(CONN_ID Idx , char *LogMsg , char *FwdMsg , int InformClient ) ;
#line 69 "conf.h"
char Conf_ServerInfo[64] ;
#line 125
int Conf_NoDNS ;
#line 53 "client.c"
static CLIENT *This_Server  ;
#line 53 "client.c"
static CLIENT *My_Clients  ;
#line 54 "client.c"
static char GetID_Buffer[106]  ;
#line 56 "client.c"
static WHOWAS My_Whowas[64]  ;
#line 57 "client.c"
static int Last_Whowas  =    -1;
#line 58 "client.c"
static long Max_Users  ;
#line 58 "client.c"
static long My_Max_Users  ;
#line 61
static unsigned long Count(int Type ) ;
#line 62
static unsigned long MyCount(int Type ) ;
#line 64
static CLIENT *New_Client_Struct(void) ;
#line 65
static void Generate_MyToken(CLIENT *Client ) ;
#line 66
static void Adjust_Counters(CLIENT *Client ) ;
#line 68
static CLIENT *Init_New_Client(CONN_ID Idx , CLIENT *Introducer , CLIENT *TopServer ,
                               int Type , char *ID , char *User , char *Hostname ,
                               char *Info , int Hops , int Token , char *Modes , int Idented ) ;
#line 73 "client.c"
void Client_Init(void) 
{ struct hostent *h ;

  {
#line 78
  This_Server = New_Client_Struct();
#line 79
  if (! This_Server) {
#line 81
    Log(0, "Can\'t allocate client structure for server! Going down.");
#line 82
    Log(1, "%s exiting due to fatal errors!", "ngircd");
#line 83
    exit(1);
  }
#line 87
  This_Server->next = (void *)0;
#line 88
  This_Server->type = 32;
#line 89
  This_Server->conn_id = -1;
#line 90
  This_Server->introducer = This_Server;
#line 91
  This_Server->mytoken = 1;
#line 92
  This_Server->hops = 0;
#line 94
  gethostname(This_Server->host, 64U);
#line 95
  if (! Conf_NoDNS) {
#line 96
    h = gethostbyname((char const   *)(This_Server->host));
#line 97
    if (h) {
#line 97
      strlcpy(This_Server->host, (char const   *)h->h_name, sizeof(This_Server->host));
    }
  }
#line 99
  Client_SetID(This_Server, Conf_ServerName);
#line 100
  Client_SetInfo(This_Server, Conf_ServerInfo);
#line 102
  My_Clients = This_Server;
#line 104
  memset((void *)(& My_Whowas), 0, sizeof(My_Whowas));
#line 105
  return;
}
}
#line 108 "client.c"
void Client_Exit(void) 
{ CLIENT *c ;
  CLIENT *next ;
  int cnt ;
  char const   *__cil_tmp ;

  {
#line 114
  if (NGIRCd_SignalRestart) {
#line 114
    Client_Destroy(This_Server, (char *)"Server going down (restarting).", (char *)((void *)0),
                   0);
  } else {
#line 115
    Client_Destroy(This_Server, (char *)"Server going down.", (char *)((void *)0),
                   0);
  }
#line 117
  cnt = 0;
#line 118
  c = My_Clients;
#line 119
  while (c) {
#line 121
    cnt ++;
#line 122
    next = (CLIENT *)c->next;
#line 123
    free((void *)c);
#line 124
    c = next;
  }
#line 126
  if (cnt) {
#line 126
    if (cnt == 1) {
#line 126
      __cil_tmp = "";
    } else {
#line 126
      __cil_tmp = "s";
    }
#line 126
    Log(6, "Freed %d client structure%s.", cnt, __cil_tmp);
  }
#line 127
  return;
}
}
#line 130 "client.c"
CLIENT *Client_ThisServer(void) 
{ 

  {
#line 133
  return (This_Server);
}
}
#line 141 "client.c"
CLIENT *Client_NewLocal(CONN_ID Idx , char *Hostname , int Type , int Idented ) 
{ CLIENT *__cil_tmp ;

  {
#line 144
  __cil_tmp = Init_New_Client(Idx, This_Server, (CLIENT *)((void *)0), Type, (char *)((void *)0),
                              (char *)((void *)0), Hostname, (char *)((void *)0),
                              0, 0, (char *)((void *)0), Idented);
#line 144
  return (__cil_tmp);
}
}
#line 153 "client.c"
CLIENT *Client_NewRemoteServer(CLIENT *Introducer , char *Hostname , CLIENT *TopServer ,
                               int Hops , int Token , char *Info , int Idented ) 
{ CLIENT *__cil_tmp ;

  {
#line 157
  __cil_tmp = Init_New_Client(-1, Introducer, TopServer, 32, Hostname, (char *)((void *)0),
                              Hostname, Info, Hops, Token, (char *)((void *)0), Idented);
#line 157
  return (__cil_tmp);
}
}
#line 166 "client.c"
CLIENT *Client_NewRemoteUser(CLIENT *Introducer , char *Nick , int Hops , char *User ,
                             char *Hostname , int Token , char *Modes , char *Info ,
                             int Idented ) 
{ CLIENT *__cil_tmp ;

  {
#line 170
  __cil_tmp = Init_New_Client(-1, Introducer, (CLIENT *)((void *)0), 16, Nick, User,
                              Hostname, Info, Hops, Token, Modes, Idented);
#line 170
  return (__cil_tmp);
}
}
#line 180 "client.c"
static CLIENT *Init_New_Client(CONN_ID Idx , CLIENT *Introducer , CLIENT *TopServer ,
                               int Type , char *ID , char *User , char *Hostname ,
                               char *Info , int Hops , int Token , char *Modes , int Idented ) 
{ CLIENT *client ;
  char *__cil_tmp ;

  {
#line 191
  client = New_Client_Struct();
#line 192
  if (! client) {
#line 192
    return ((CLIENT *)((void *)0));
  }
#line 195
  client->starttime = time((time_t *)((void *)0));
#line 196
  client->conn_id = Idx;
#line 197
  client->introducer = Introducer;
#line 198
  client->topserver = TopServer;
#line 199
  client->type = Type;
#line 200
  if (ID) {
#line 200
    Client_SetID(client, ID);
  }
#line 201
  if (User) {
#line 201
    Client_SetUser(client, User, Idented);
  }
#line 202
  if (Hostname) {
#line 202
    Client_SetHostname(client, Hostname);
  }
#line 203
  if (Info) {
#line 203
    Client_SetInfo(client, Info);
  }
#line 204
  client->hops = Hops;
#line 205
  client->token = Token;
#line 206
  if (Modes) {
#line 206
    Client_SetModes(client, Modes);
  }
#line 207
  if (Type == 32) {
#line 207
    Generate_MyToken(client);
  }
#line 209
  __cil_tmp = strchr((char const   *)(client->modes), 'a');
#line 209
  if (__cil_tmp) {
#line 210
    strlcpy(client->away, "Away", sizeof(client->away));
  }
#line 213
  client->next = (POINTER *)My_Clients;
#line 214
  My_Clients = client;
#line 217
  Adjust_Counters(client);
#line 219
  return (client);
}
}
#line 223 "client.c"
void Client_Destroy(CLIENT *Client , char *LogMsg , char *FwdMsg , int SendQuit ) 
{ CLIENT *last ;
  CLIENT *c ;
  char msg[256] ;
  char *txt ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  CLIENT *__cil_tmp___1 ;
  CLIENT *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  CLIENT *__cil_tmp___4 ;
  CLIENT *__cil_tmp___5 ;
  char const   *__cil_tmp___6 ;

  {
#line 233
  if (LogMsg) {
#line 233
    txt = LogMsg;
  } else {
#line 234
    txt = FwdMsg;
  }
#line 235
  if (! txt) {
#line 235
    txt = (char *)"Reason unknown.";
  }
#line 238
  if (Client->type == 32) {
#line 239
    strlcpy(msg, (char const   *)(This_Server->id), sizeof(msg));
#line 240
    strlcat(msg, " ", sizeof(msg));
#line 241
    strlcat(msg, (char const   *)(Client->id), sizeof(msg));
  }
#line 244
  last = (CLIENT *)((void *)0);
#line 245
  c = My_Clients;
#line 246
  while (c) {
#line 248
    if ((Client->type == 32 && (unsigned int )c->introducer == (unsigned int )Client) && (unsigned int )c != (unsigned int )Client) {
#line 252
      Client_Destroy(c, (char *)((void *)0), msg, 0);
#line 253
      last = (CLIENT *)((void *)0);
#line 254
      c = My_Clients;
#line 255
      continue;
    }
#line 257
    if ((unsigned int )c == (unsigned int )Client) {
#line 260
      if (last) {
#line 260
        last->next = c->next;
      } else {
#line 261
        My_Clients = (CLIENT *)c->next;
      }
#line 263
      if (c->type == 16) {
#line 265
        if (c->conn_id != -1) {
#line 268
          __cil_tmp = Client_Mask(c);
#line 268
          Log(5, "User \"%s\" unregistered (connection %d): %s", __cil_tmp, c->conn_id,
              txt);
#line 270
          if (SendQuit) {
#line 273
            if (FwdMsg) {
#line 273
              IRC_WriteStrServersPrefix((CLIENT *)((void *)0), c, (char *)"QUIT :%s",
                                        FwdMsg);
            } else {
#line 274
              IRC_WriteStrServersPrefix((CLIENT *)((void *)0), c, (char *)"QUIT :");
            }
          }
        } else {
#line 280
          __cil_tmp___0 = Client_Mask(c);
#line 280
          Log(7, "User \"%s\" unregistered: %s", __cil_tmp___0, txt);
#line 282
          if (SendQuit) {
#line 287
            if (FwdMsg) {
#line 287
              __cil_tmp___1 = Client_NextHop(c);
#line 287
              IRC_WriteStrServersPrefix(__cil_tmp___1, c, (char *)"QUIT :%s", FwdMsg);
            } else {
#line 288
              __cil_tmp___2 = Client_NextHop(c);
#line 288
              IRC_WriteStrServersPrefix(__cil_tmp___2, c, (char *)"QUIT :");
            }
          }
        }
#line 293
        if (FwdMsg) {
#line 293
          __cil_tmp___3 = FwdMsg;
        } else {
#line 293
          __cil_tmp___3 = c->id;
        }
#line 293
        Channel_Quit(c, __cil_tmp___3);
#line 296
        Client_RegisterWhowas(c);
      } else {
#line 298
        if (c->type == 32) {
#line 300
          if ((unsigned int )c != (unsigned int )This_Server) {
#line 302
            if (c->conn_id != -1) {
#line 302
              Log(1029, "Server \"%s\" unregistered (connection %d): %s", c->id, c->conn_id,
                  txt);
            } else {
#line 303
              Log(1029, "Server \"%s\" unregistered: %s", c->id, txt);
            }
          }
#line 307
          if (! NGIRCd_SignalQuit) {
#line 309
            if (FwdMsg) {
#line 309
              __cil_tmp___4 = Client_NextHop(c);
#line 309
              IRC_WriteStrServersPrefix(__cil_tmp___4, c, (char *)"SQUIT %s :%s",
                                        c->id, FwdMsg);
            } else {
#line 310
              __cil_tmp___5 = Client_NextHop(c);
#line 310
              IRC_WriteStrServersPrefix(__cil_tmp___5, c, (char *)"SQUIT %s :", c->id);
            }
          }
        } else {
#line 315
          if (c->conn_id != -1) {
#line 317
            if (c->id[0]) {
#line 317
              Log(5, "Client \"%s\" unregistered (connection %d): %s", c->id, c->conn_id,
                  txt);
            } else {
#line 318
              Log(5, "Client unregistered (connection %d): %s", c->conn_id, txt);
            }
          } else {
#line 320
            if (c->id[0]) {
#line 320
              __cil_tmp___6 = (char const   *)(c->id);
            } else {
#line 320
              __cil_tmp___6 = "(No Nick)";
            }
#line 320
            Log(4, "Unregistered unknown client \"%s\": %s", __cil_tmp___6, txt);
          }
        }
      }
#line 325
      free((void *)c);
#line 326
      break;
    }
#line 328
    last = c;
#line 329
    c = (CLIENT *)c->next;
  }
#line 331
  return;
}
}
#line 334 "client.c"
void Client_SetHostname(CLIENT *Client , char *Hostname ) 
{ 

  {
#line 342
  strlcpy(Client->host, (char const   *)Hostname, sizeof(Client->host));
#line 343
  return;
}
}
#line 346 "client.c"
void Client_SetID(CLIENT *Client , char *ID ) 
{ 

  {
#line 354
  strlcpy(Client->id, (char const   *)ID, sizeof(Client->id));
#line 357
  Client->hash = Hash((char const   *)(Client->id));
#line 358
  return;
}
}
#line 361 "client.c"
void Client_SetUser(CLIENT *Client , char *User , int Idented ) 
{ 

  {
#line 369
  if (Idented) {
#line 369
    strlcpy(Client->user, (char const   *)User, sizeof(Client->user));
  } else {
#line 372
    Client->user[0] = (char )'~';
#line 373
    strlcpy(Client->user + 1, (char const   *)User, sizeof(Client->user) - 1U);
  }
#line 375
  return;
}
}
#line 378 "client.c"
void Client_SetInfo(CLIENT *Client , char *Info ) 
{ 

  {
#line 386
  strlcpy(Client->info, (char const   *)Info, sizeof(Client->info));
#line 387
  return;
}
}
#line 390 "client.c"
void Client_SetModes(CLIENT *Client , char *Modes ) 
{ 

  {
#line 398
  strlcpy(Client->modes, (char const   *)Modes, sizeof(Client->modes));
#line 399
  return;
}
}
#line 402 "client.c"
void Client_SetFlags(CLIENT *Client , char *Flags ) 
{ 

  {
#line 410
  strlcpy(Client->flags, (char const   *)Flags, sizeof(Client->flags));
#line 411
  return;
}
}
#line 414 "client.c"
void Client_SetPassword(CLIENT *Client , char *Pwd ) 
{ 

  {
#line 422
  strlcpy(Client->pwd, (char const   *)Pwd, sizeof(Client->pwd));
#line 423
  return;
}
}
#line 426 "client.c"
void Client_SetAway(CLIENT *Client , char *Txt ) 
{ char *__cil_tmp ;

  {
#line 434
  strlcpy(Client->away, (char const   *)Txt, sizeof(Client->away));
#line 435
  __cil_tmp = Client_Mask(Client);
#line 435
  Log(7, "User \"%s\" is away: %s", __cil_tmp, Txt);
#line 436
  return;
}
}
#line 439 "client.c"
void Client_SetType(CLIENT *Client , int Type ) 
{ 

  {
#line 443
  Client->type = Type;
#line 444
  if (Type == 32) {
#line 444
    Generate_MyToken(Client);
  }
#line 445
  Adjust_Counters(Client);
#line 446
  return;
}
}
#line 449 "client.c"
void Client_SetHops(CLIENT *Client , int Hops ) 
{ 

  {
#line 453
  Client->hops = Hops;
#line 454
  return;
}
}
#line 457 "client.c"
void Client_SetToken(CLIENT *Client , int Token ) 
{ 

  {
#line 461
  Client->token = Token;
#line 462
  return;
}
}
#line 465 "client.c"
void Client_SetIntroducer(CLIENT *Client , CLIENT *Introducer ) 
{ 

  {
#line 470
  Client->introducer = Introducer;
#line 471
  return;
}
}
#line 474 "client.c"
void Client_SetOperByMe(CLIENT *Client , int OperByMe ) 
{ 

  {
#line 478
  Client->oper_by_me = OperByMe;
#line 479
  return;
}
}
#line 482 "client.c"
int Client_ModeAdd(CLIENT *Client , char Mode ) 
{ char x[2] ;
  char *__cil_tmp ;

  {
#line 494
  x[0] = Mode;
#line 494
  x[1] = (char )'\000';
#line 495
  __cil_tmp = strchr((char const   *)(Client->modes), (int )x[0]);
#line 495
  if (__cil_tmp) {
#line 501
    return (0);
  } else {
#line 498
    strlcat(Client->modes, (char const   *)(x), sizeof(Client->modes));
#line 499
    return (1);
  }
}
}
#line 505 "client.c"
int Client_ModeDel(CLIENT *Client , char Mode ) 
{ char x[2] ;
  char *p ;

  {
#line 517
  x[0] = Mode;
#line 517
  x[1] = (char )'\000';
#line 519
  p = strchr((char const   *)(Client->modes), (int )x[0]);
#line 520
  if (! p) {
#line 520
    return (0);
  }
#line 523
  while (*p) {
#line 525
    *p = *(p + 1);
#line 526
    p ++;
  }
#line 528
  return (1);
}
}
#line 532 "client.c"
CLIENT *Client_Search(char *Nick ) 
{ char search_id[64] ;
  char *ptr ;
  CLIENT *c ;
  UINT32 search_hash ;
  int __cil_tmp ;

  {
#line 540
  c = (CLIENT *)((void *)0);
#line 546
  strlcpy(search_id, (char const   *)Nick, sizeof(search_id));
#line 547
  ptr = strchr((char const   *)(search_id), '!');
#line 548
  if (ptr) {
#line 548
    *ptr = (char )'\000';
  }
#line 550
  search_hash = Hash((char const   *)(search_id));
#line 552
  c = My_Clients;
#line 553
  while (c) {
#line 555
    if (c->hash == search_hash) {
#line 558
      __cil_tmp = strcasecmp((char const   *)(c->id), (char const   *)(search_id));
#line 558
      if (__cil_tmp == 0) {
#line 558
        return (c);
      }
    }
#line 560
    c = (CLIENT *)c->next;
  }
#line 562
  return ((CLIENT *)((void *)0));
}
}
#line 566 "client.c"
CLIENT *Client_GetFromToken(CLIENT *Client , int Token ) 
{ CLIENT *c ;

  {
#line 578
  c = My_Clients;
#line 579
  while (c) {
#line 581
    if ((c->type == 32 && (unsigned int )c->introducer == (unsigned int )Client) && c->token == Token) {
#line 581
      return (c);
    }
#line 582
    c = (CLIENT *)c->next;
  }
#line 584
  return ((CLIENT *)((void *)0));
}
}
#line 588 "client.c"
int Client_Type(CLIENT *Client ) 
{ 

  {
#line 592
  return (Client->type);
}
}
#line 596 "client.c"
CONN_ID Client_Conn(CLIENT *Client ) 
{ 

  {
#line 600
  return (Client->conn_id);
}
}
#line 604 "client.c"
char *Client_ID(CLIENT *Client ) 
{ 

  {
#line 614
  if (Client->id[0]) {
#line 614
    return (Client->id);
  } else {
#line 615
    return ((char *)"*");
  }
}
}
#line 619 "client.c"
char *Client_Info(CLIENT *Client ) 
{ 

  {
#line 623
  return (Client->info);
}
}
#line 627 "client.c"
char *Client_User(CLIENT *Client ) 
{ char const   *__cil_tmp ;

  {
#line 631
  if (Client->user[0]) {
#line 631
    __cil_tmp = (char const   *)(Client->user);
  } else {
#line 631
    __cil_tmp = "~";
  }
#line 631
  return ((char *)__cil_tmp);
}
}
#line 635 "client.c"
char *Client_Hostname(CLIENT *Client ) 
{ 

  {
#line 639
  return (Client->host);
}
}
#line 643 "client.c"
char *Client_Password(CLIENT *Client ) 
{ 

  {
#line 647
  return (Client->pwd);
}
}
#line 651 "client.c"
char *Client_Modes(CLIENT *Client ) 
{ 

  {
#line 655
  return (Client->modes);
}
}
#line 659 "client.c"
char *Client_Flags(CLIENT *Client ) 
{ 

  {
#line 663
  return (Client->flags);
}
}
#line 667 "client.c"
int Client_OperByMe(CLIENT *Client ) 
{ 

  {
#line 671
  return (Client->oper_by_me);
}
}
#line 675 "client.c"
int Client_Hops(CLIENT *Client ) 
{ 

  {
#line 679
  return (Client->hops);
}
}
#line 683 "client.c"
int Client_Token(CLIENT *Client ) 
{ 

  {
#line 687
  return (Client->token);
}
}
#line 691 "client.c"
int Client_MyToken(CLIENT *Client ) 
{ 

  {
#line 695
  return (Client->mytoken);
}
}
#line 699 "client.c"
CLIENT *Client_NextHop(CLIENT *Client ) 
{ CLIENT *c ;

  {
#line 706
  c = Client;
#line 707
  while (((int )c->introducer && (unsigned int )c->introducer != (unsigned int )c) && (unsigned int )c->introducer != (unsigned int )This_Server) {
#line 708
    c = c->introducer;
  }
#line 710
  return (c);
}
}
#line 714 "client.c"
char *Client_Mask(CLIENT *Client ) 
{ 

  {
#line 722
  if (Client->type == 32) {
#line 722
    return (Client->id);
  }
#line 724
  snprintf((char * __restrict  )(GetID_Buffer), 106U, (char const   * __restrict  )"%s!%s@%s",
           Client->id, Client->user, Client->host);
#line 725
  return (GetID_Buffer);
}
}
#line 729 "client.c"
CLIENT *Client_Introducer(CLIENT *Client ) 
{ 

  {
#line 733
  return (Client->introducer);
}
}
#line 737 "client.c"
CLIENT *Client_TopServer(CLIENT *Client ) 
{ 

  {
#line 741
  return (Client->topserver);
}
}
#line 745 "client.c"
int Client_HasMode(CLIENT *Client , char Mode ) 
{ char *__cil_tmp ;

  {
#line 749
  __cil_tmp = strchr((char const   *)(Client->modes), (int )Mode);
#line 749
  return ((unsigned int )__cil_tmp != (unsigned int )((void *)0));
}
}
#line 753 "client.c"
char *Client_Away(CLIENT *Client ) 
{ 

  {
#line 759
  return (Client->away);
}
}
#line 763 "client.c"
int Client_CheckNick(CLIENT *Client , char *Nick ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  CLIENT *__cil_tmp___2 ;

  {
#line 769
  __cil_tmp___0 = Client_IsValidNick((char const   *)Nick);
#line 769
  if (! __cil_tmp___0) {
#line 771
    __cil_tmp = Client_ID(Client);
#line 771
    IRC_WriteStrClient(Client, (char *)"432 %s %s :Erroneous nickname", __cil_tmp,
                       Nick);
#line 772
    return (0);
  }
#line 776
  __cil_tmp___2 = Client_Search(Nick);
#line 776
  if (__cil_tmp___2) {
#line 779
    __cil_tmp___1 = Client_ID(Client);
#line 779
    IRC_WriteStrClient(Client, (char *)"433 %s %s :Nickname already in use", __cil_tmp___1,
                       Nick);
#line 780
    return (0);
  }
#line 783
  return (1);
}
}
#line 787 "client.c"
int Client_CheckID(CLIENT *Client , char *ID ) 
{ char str[513] ;
  CLIENT *c ;
  char *__cil_tmp ;
  size_t __cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 800
  __cil_tmp___0 = strlen((char const   *)ID);
#line 800
  if (__cil_tmp___0 > 64U) {
#line 802
    __cil_tmp = Client_ID(Client);
#line 802
    IRC_WriteStrClient(Client, (char *)"432 %s %s :Erroneous nickname", __cil_tmp,
                       ID);
#line 803
    return (0);
  }
#line 807
  c = My_Clients;
#line 808
  while (c) {
#line 810
    __cil_tmp___1 = strcasecmp((char const   *)(c->id), (char const   *)ID);
#line 810
    if (__cil_tmp___1 == 0) {
#line 813
      snprintf((char * __restrict  )(str), sizeof(str), (char const   * __restrict  )"ID \"%s\" already registered",
               ID);
#line 814
      if (Client->conn_id != c->conn_id) {
#line 814
        Log(3, "%s (on connection %d)!", str, c->conn_id);
      } else {
#line 815
        Log(3, "%s (via network)!", str);
      }
#line 816
      Conn_Close(Client->conn_id, str, str, 1);
#line 817
      return (0);
    }
#line 819
    c = (CLIENT *)c->next;
  }
#line 822
  return (1);
}
}
#line 826 "client.c"
CLIENT *Client_First(void) 
{ 

  {
#line 831
  return (My_Clients);
}
}
#line 835 "client.c"
CLIENT *Client_Next(CLIENT *c ) 
{ 

  {
#line 842
  return ((CLIENT *)c->next);
}
}
#line 846 "client.c"
long Client_UserCount(void) 
{ unsigned long __cil_tmp ;

  {
#line 849
  __cil_tmp = Count(16);
#line 849
  return ((long )__cil_tmp);
}
}
#line 853 "client.c"
long Client_ServiceCount(void) 
{ unsigned long __cil_tmp ;

  {
#line 856
  __cil_tmp = Count(64);
#line 856
  return ((long )__cil_tmp);
}
}
#line 860 "client.c"
long Client_ServerCount(void) 
{ unsigned long __cil_tmp ;

  {
#line 863
  __cil_tmp = Count(32);
#line 863
  return ((long )__cil_tmp);
}
}
#line 867 "client.c"
long Client_MyUserCount(void) 
{ unsigned long __cil_tmp ;

  {
#line 870
  __cil_tmp = MyCount(16);
#line 870
  return ((long )__cil_tmp);
}
}
#line 874 "client.c"
long Client_MyServiceCount(void) 
{ unsigned long __cil_tmp ;

  {
#line 877
  __cil_tmp = MyCount(64);
#line 877
  return ((long )__cil_tmp);
}
}
#line 881 "client.c"
unsigned long Client_MyServerCount(void) 
{ CLIENT *c ;
  unsigned long cnt ;

  {
#line 885
  cnt = 0UL;
#line 887
  c = My_Clients;
#line 888
  while (c) {
#line 890
    if (c->type == 32 && c->hops == 1) {
#line 890
      cnt ++;
    }
#line 891
    c = (CLIENT *)c->next;
  }
#line 893
  return (cnt);
}
}
#line 897 "client.c"
unsigned long Client_OperCount(void) 
{ CLIENT *c ;
  unsigned long cnt ;
  char *__cil_tmp ;

  {
#line 901
  cnt = 0UL;
#line 903
  c = My_Clients;
#line 904
  while (c) {
#line 906
    if ((int )c && c->type == 16) {
#line 906
      __cil_tmp = strchr((char const   *)(c->modes), 'o');
#line 906
      if (__cil_tmp) {
#line 906
        cnt ++;
      } else {
#line 906
        goto _L;
      }
    } else {
      _L: /* CIL Label */ ;
    }
#line 907
    c = (CLIENT *)c->next;
  }
#line 909
  return (cnt);
}
}
#line 913 "client.c"
unsigned long Client_UnknownCount(void) 
{ CLIENT *c ;
  unsigned long cnt ;

  {
#line 917
  cnt = 0UL;
#line 919
  c = My_Clients;
#line 920
  while (c) {
#line 922
    if ((((int )c && c->type != 16) && c->type != 64) && c->type != 32) {
#line 922
      cnt ++;
    }
#line 923
    c = (CLIENT *)c->next;
  }
#line 926
  return (cnt);
}
}
#line 930 "client.c"
long Client_MaxUserCount(void) 
{ 

  {
#line 933
  return (Max_Users);
}
}
#line 937 "client.c"
long Client_MyMaxUserCount(void) 
{ 

  {
#line 940
  return (My_Max_Users);
}
}
#line 948 "client.c"
static char const   goodchars[13]  = 
#line 948
  {      (char const   )';',      (char const   )'0',      (char const   )'1',      (char const   )'2', 
        (char const   )'3',      (char const   )'4',      (char const   )'5',      (char const   )'6', 
        (char const   )'7',      (char const   )'8',      (char const   )'9',      (char const   )'-', 
        (char const   )'\000'};
#line 944 "client.c"
int Client_IsValidNick(char const   *Nick ) 
{ char const   *ptr ;
  char *__cil_tmp ;
  size_t __cil_tmp___0 ;
  char *__cil_tmp___1 ;

  {
#line 952
  if ((int const   )*(Nick + 0) == 35) {
#line 952
    return (0);
  }
#line 953
  __cil_tmp = strchr(goodchars, (int )*(Nick + 0));
#line 953
  if (__cil_tmp) {
#line 953
    return (0);
  }
#line 954
  __cil_tmp___0 = strlen(Nick);
#line 954
  if (__cil_tmp___0 >= Conf_MaxNickLength) {
#line 954
    return (0);
  }
#line 956
  ptr = Nick;
#line 957
  while (*ptr) {
#line 959
    if ((int const   )*ptr < 65) {
#line 959
      __cil_tmp___1 = strchr(goodchars, (int )*ptr);
#line 959
      if (__cil_tmp___1) {
#line 959
        goto _L;
      } else {
#line 959
        return (0);
      }
    } else {
      _L: /* CIL Label */ ;
    }
#line 960
    if ((int const   )*ptr > 125) {
#line 960
      return (0);
    }
#line 961
    ptr ++;
  }
#line 964
  return (1);
}
}
#line 971 "client.c"
WHOWAS *Client_GetWhowas(void) 
{ 

  {
#line 974
  return (My_Whowas);
}
}
#line 980 "client.c"
int Client_GetLastWhowasIndex(void) 
{ 

  {
#line 983
  return (Last_Whowas);
}
}
#line 992 "client.c"
time_t Client_StartTime(CLIENT *Client ) 
{ 

  {
#line 996
  return (Client->starttime);
}
}
#line 1000 "client.c"
static unsigned long Count(int Type ) 
{ CLIENT *c ;
  unsigned long cnt ;

  {
#line 1004
  cnt = 0UL;
#line 1006
  c = My_Clients;
#line 1007
  while (c) {
#line 1009
    if (c->type == Type) {
#line 1009
      cnt ++;
    }
#line 1010
    c = (CLIENT *)c->next;
  }
#line 1012
  return (cnt);
}
}
#line 1016 "client.c"
static unsigned long MyCount(int Type ) 
{ CLIENT *c ;
  unsigned long cnt ;

  {
#line 1020
  cnt = 0UL;
#line 1022
  c = My_Clients;
#line 1023
  while (c) {
#line 1025
    if ((unsigned int )c->introducer == (unsigned int )This_Server && c->type == Type) {
#line 1025
      cnt ++;
    }
#line 1026
    c = (CLIENT *)c->next;
  }
#line 1028
  return (cnt);
}
}
#line 1032 "client.c"
static CLIENT *New_Client_Struct(void) 
{ CLIENT *c ;
  void *__cil_tmp ;

  {
#line 1039
  __cil_tmp = malloc(sizeof(CLIENT ));
#line 1039
  c = (CLIENT *)__cil_tmp;
#line 1040
  if (! c) {
#line 1042
    Log(0, "Can\'t allocate memory! [New_Client_Struct]");
#line 1043
    return ((CLIENT *)((void *)0));
  }
#line 1046
  memset((void *)c, 0, sizeof(CLIENT ));
#line 1048
  c->type = 1;
#line 1049
  c->conn_id = -1;
#line 1050
  c->oper_by_me = 0;
#line 1051
  c->hops = -1;
#line 1052
  c->token = -1;
#line 1053
  c->mytoken = -1;
#line 1055
  return (c);
}
}
#line 1059 "client.c"
static void Generate_MyToken(CLIENT *Client ) 
{ CLIENT *c ;
  int token ;

  {
#line 1065
  c = My_Clients;
#line 1066
  token = 2;
#line 1067
  while (c) {
#line 1069
    if (c->mytoken == token) {
#line 1072
      token ++;
#line 1073
      c = My_Clients;
#line 1074
      continue;
    } else {
#line 1076
      c = (CLIENT *)c->next;
    }
  }
#line 1078
  Client->mytoken = token;
#line 1079
  Log(7, "Assigned token %d to server \"%s\".", token, Client->id);
#line 1080
  return;
}
}
#line 1083 "client.c"
static void Adjust_Counters(CLIENT *Client ) 
{ long count ;

  {
#line 1090
  if (Client->type != 16) {
#line 1090
    return;
  }
#line 1092
  if (Client->conn_id != -1) {
#line 1095
    count = Client_MyUserCount();
#line 1096
    if (count > My_Max_Users) {
#line 1096
      My_Max_Users = count;
    }
  }
#line 1098
  count = Client_UserCount();
#line 1099
  if (count > Max_Users) {
#line 1099
    Max_Users = count;
  }
#line 1100
  return;
}
}
#line 1109 "client.c"
void Client_RegisterWhowas(CLIENT *Client ) 
{ int slot ;
  time_t now ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  CLIENT *__cil_tmp___3 ;
  char *__cil_tmp___4 ;

  {
#line 1117
  now = time((time_t *)((void *)0));
#line 1119
  if (now - Client->starttime < 30L) {
#line 1120
    return;
  }
#line 1122
  slot = Last_Whowas + 1;
#line 1123
  if (slot >= 64 || slot < 0) {
#line 1123
    slot = 0;
  }
#line 1129
  My_Whowas[slot].time = now;
#line 1130
  __cil_tmp = Client_ID(Client);
#line 1130
  strlcpy(My_Whowas[slot].id, (char const   *)__cil_tmp, sizeof(My_Whowas[slot].id));
#line 1132
  __cil_tmp___0 = Client_User(Client);
#line 1132
  strlcpy(My_Whowas[slot].user, (char const   *)__cil_tmp___0, sizeof(My_Whowas[slot].user));
#line 1134
  __cil_tmp___1 = Client_Hostname(Client);
#line 1134
  strlcpy(My_Whowas[slot].host, (char const   *)__cil_tmp___1, sizeof(My_Whowas[slot].host));
#line 1136
  __cil_tmp___2 = Client_Info(Client);
#line 1136
  strlcpy(My_Whowas[slot].info, (char const   *)__cil_tmp___2, sizeof(My_Whowas[slot].info));
#line 1138
  __cil_tmp___3 = Client_Introducer(Client);
#line 1138
  __cil_tmp___4 = Client_ID(__cil_tmp___3);
#line 1138
  strlcpy(My_Whowas[slot].server, (char const   *)__cil_tmp___4, sizeof(My_Whowas[slot].server));
#line 1141
  Last_Whowas = slot;
#line 1142
  return;
}
}
/* compiler builtin: 
   void __builtin_va_end(__builtin_va_list  ) ;  */
/* compiler builtin: 
   void __builtin_va_start(__builtin_va_list  ) ;  */
#line 1 "conf.o"
#pragma merger(0,"/tmp/cil-YjvyzwLc.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 451 "/usr/include/libio.h"
extern  __attribute__((__nothrow__)) int _IO_putc(int __c , _IO_FILE *__fp ) ;
#line 142 "/usr/include/stdio.h"
extern struct _IO_FILE *stdin ;
#line 208
extern int fclose(FILE *__stream ) ;
#line 243
extern FILE *fopen(char const   * __restrict  __filename , char const   * __restrict  __modes ) ;
#line 357
extern  __attribute__((__nothrow__)) int ( /* format attribute */  vsnprintf)(char * __restrict  __s ,
                                                                              size_t __maxlen ,
                                                                              char const   * __restrict  __format ,
                                                                              __gnuc_va_list __arg ) ;
#line 444
extern int getchar(void) ;
#line 528
extern char *fgets(char * __restrict  __s , int __n , FILE * __restrict  __stream ) ;
#line 585
extern int fputs(char const   * __restrict  __s , FILE * __restrict  __stream ) ;
#line 754
extern  __attribute__((__nothrow__)) int fileno(FILE *__stream ) ;
#line 148 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) int atoi(char const   *__nptr )  __attribute__((__pure__,
__nonnull__(1))) ;
#line 151
extern  __attribute__((__nothrow__)) long atol(char const   *__nptr )  __attribute__((__pure__,
__nonnull__(1))) ;
#line 130 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) char *strdup(char const   *__s )  __attribute__((__nonnull__(1),
__malloc__)) ;
#line 199
extern  __attribute__((__nothrow__)) char *strtok(char * __restrict  __s , char const   * __restrict  __delim )  __attribute__((__nonnull__(2))) ;
#line 719 "/usr/include/unistd.h"
extern  __attribute__((__nothrow__)) int isatty(int __fd ) ;
#line 109 "/usr/include/grp.h"
extern struct group *getgrnam(char const   *__name ) ;
#line 131 "/fs/skoll/symexe/trunk/experiments/ngircd/codeCoverageTest/../../../libc/ctype.h"
extern int isdigit(int  ) ;
#line 29 "./../tool/tool.h"
void ngt_TrimStr(char *String ) ;
#line 90 "./../ipaddr/ng_ipaddr.h"
int ng_ipaddr_init(ng_ipaddr_t *addr , char const   *ip_str , UINT16 port ) ;
#line 38 "resolve.h"
void Resolve_Init(RES_STAT *s ) ;
#line 66 "conf.h"
char Conf_ServerName[64]  ;
#line 69 "conf.h"
char Conf_ServerInfo[64]  ;
#line 72 "conf.h"
char Conf_ServerPwd[21]  ;
#line 75 "conf.h"
char Conf_ServerAdmin1[64]  ;
#line 76 "conf.h"
char Conf_ServerAdmin2[64]  ;
#line 77 "conf.h"
char Conf_ServerAdminMail[64]  ;
#line 80 "conf.h"
char Conf_MotdFile[256]  ;
#line 83 "conf.h"
char Conf_MotdPhrase[256]  ;
#line 86 "conf.h"
array Conf_ListenPorts  ;
#line 89 "conf.h"
char Conf_ListenAddress[16]  ;
#line 92 "conf.h"
uid_t Conf_UID  ;
#line 93 "conf.h"
gid_t Conf_GID  ;
#line 96 "conf.h"
char Conf_Chroot[256]  ;
#line 99 "conf.h"
char Conf_PidFile[256]  ;
#line 102 "conf.h"
int Conf_PingTimeout  ;
#line 103 "conf.h"
int Conf_PongTimeout  ;
#line 106 "conf.h"
int Conf_ConnectRetry  ;
#line 109 "conf.h"
CONF_OPER Conf_Oper[16]  ;
#line 110 "conf.h"
unsigned int Conf_Oper_Count  ;
#line 113 "conf.h"
CONF_SERVER Conf_Server[16]  ;
#line 116 "conf.h"
CONF_CHANNEL Conf_Channel[16]  ;
#line 117 "conf.h"
unsigned int Conf_Channel_Count  ;
#line 119 "conf.h"
int Conf_PredefChannelsOnly  ;
#line 122 "conf.h"
int Conf_OperCanMode  ;
#line 125 "conf.h"
int Conf_NoDNS  ;
#line 128 "conf.h"
int Conf_ListenIPv6  ;
#line 131 "conf.h"
int Conf_ListenIPv4  ;
#line 137 "conf.h"
int Conf_ConnectIPv6  ;
#line 140 "conf.h"
int Conf_ConnectIPv4  ;
#line 145 "conf.h"
int Conf_OperServerMode  ;
#line 148 "conf.h"
long Conf_MaxConnections  ;
#line 151 "conf.h"
int Conf_MaxJoins  ;
#line 154 "conf.h"
int Conf_MaxConnectionsIP  ;
#line 157 "conf.h"
unsigned int Conf_MaxNickLength  ;
#line 163
void Conf_UnsetServer(CONN_ID Idx ) ;
#line 164
void Conf_SetServer(int ConfServer , CONN_ID Idx ) ;
#line 165
int Conf_GetServer(CONN_ID Idx ) ;
#line 167
int Conf_EnableServer(char *Name , UINT16 Port ) ;
#line 168
int Conf_EnablePassiveServer(char const   *Name ) ;
#line 169
int Conf_DisableServer(char *Name ) ;
#line 170
int Conf_AddServer(char *Name , UINT16 Port , char *Host , char *MyPwd , char *PeerPwd ) ;
#line 57 "conf.c"
static int Use_Log  =    1;
#line 58 "conf.c"
static CONF_SERVER New_Server  ;
#line 59 "conf.c"
static int New_Server_Idx  ;
#line 62
static void Set_Defaults(int InitServers ) ;
#line 63
static int Read_Config(int ngircd_starting ) ;
#line 64
static void Validate_Config(int Configtest , int Rehash ) ;
#line 66
static void Handle_GLOBAL(int Line , char *Var , char *Arg ) ;
#line 67
static void Handle_OPERATOR(int Line , char *Var , char *Arg ) ;
#line 68
static void Handle_SERVER(int Line , char *Var , char *Arg ) ;
#line 69
static void Handle_CHANNEL(int Line , char *Var , char *Arg ) ;
#line 71
static void Config_Error(int Level , char const   *Format  , ...) ;
#line 73
static void Config_Error_NaN(int Line , char const   *Item ) ;
#line 74
static void Config_Error_TooLong(int Line , char const   *Item ) ;
#line 76
static void Init_Server_Struct(CONF_SERVER *Server ) ;
#line 79 "conf.c"
static char *strdup_warn(char const   *str ) 
{ char *ptr ;
  char *__cil_tmp ;

  {
#line 82
  __cil_tmp = strdup(str);
#line 82
  ptr = __cil_tmp;
#line 83
  if (! ptr) {
#line 84
    Config_Error(3, "Could not allocate mem for string: %s", str);
  }
#line 85
  return (ptr);
}
}
#line 89 "conf.c"
static void ports_puts(array *a ) 
{ size_t len ;
  UINT16 *ports ;
  void *__cil_tmp ;
  size_t __cil_tmp___0 ;
  size_t __cil_tmp___1 ;

  {
#line 94
  len = array_length((array const   *)a, sizeof(UINT16 ));
#line 95
  __cil_tmp___1 = len;
#line 95
  len --;
#line 95
  if (__cil_tmp___1) {
#line 96
    __cil_tmp = array_start((array const   *)a);
#line 96
    ports = (UINT16 *)__cil_tmp;
#line 97
    printf((char const   * __restrict  )"%u", (unsigned int )*ports);
#line 98
    while (1) {
#line 98
      __cil_tmp___0 = len;
#line 98
      len --;
#line 98
      if (! __cil_tmp___0) {
#line 98
        break;
      }
#line 99
      ports ++;
#line 100
      printf((char const   * __restrict  )", %u", (unsigned int )*ports);
    }
  }
#line 103
  _IO_putc('\n', stdout);
#line 104
  return;
}
}
#line 107 "conf.c"
static void ports_parse(array *a , int Line , char *Arg ) 
{ char *ptr ;
  int port ;
  UINT16 port16 ;
  long __cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 114
  array_trunc(a);
#line 118
  ptr = strtok((char * __restrict  )Arg, (char const   * __restrict  )",");
#line 119
  while (ptr) {
#line 120
    ngt_TrimStr(ptr);
#line 121
    __cil_tmp = atol((char const   *)ptr);
#line 121
    port = (int )__cil_tmp;
#line 122
    if (port > 0 && port < 65535) {
#line 123
      port16 = (unsigned short )port;
#line 124
      __cil_tmp___2 = array_catb(a, (char const   *)((char *)(& port16)), sizeof(port16));
#line 124
      if (! __cil_tmp___2) {
#line 125
        __cil_tmp___0 = __errno_location();
#line 125
        __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 125
        Config_Error(3, "%s, line %d Could not add port number %ld: %s", NGIRCd_ConfFile,
                     Line, port, __cil_tmp___1);
      }
    } else {
#line 128
      Config_Error(3, "%s, line %d (section \"Global\"): Illegal port number %ld!",
                   NGIRCd_ConfFile, Line, port);
    }
#line 132
    ptr = strtok((char * __restrict  )((void *)0), (char const   * __restrict  )",");
  }
#line 134
  return;
}
}
#line 137 "conf.c"
void Conf_Init(void) 
{ 

  {
#line 140
  Read_Config(1);
#line 141
  Validate_Config(0, 0);
#line 142
  return;
}
}
#line 145 "conf.c"
int Conf_Rehash(void) 
{ int __cil_tmp ;
  CLIENT *__cil_tmp___0 ;

  {
#line 148
  __cil_tmp = Read_Config(0);
#line 148
  if (! __cil_tmp) {
#line 149
    return (0);
  }
#line 150
  Validate_Config(0, 1);
#line 153
  __cil_tmp___0 = Client_ThisServer();
#line 153
  Client_SetInfo(__cil_tmp___0, Conf_ServerInfo);
#line 154
  return (1);
}
}
#line 158 "conf.c"
static char const   *yesno_to_str(int boolean_value ) 
{ 

  {
#line 161
  if (boolean_value) {
#line 162
    return ("yes");
  }
#line 163
  return ("no");
}
}
#line 167 "conf.c"
int Conf_Test(void) 
{ struct passwd *pwd ;
  struct group *grp ;
  unsigned int i ;
  char *topic ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char const   *__cil_tmp___3 ;
  char const   *__cil_tmp___4 ;
  char const   *__cil_tmp___5 ;
  char const   *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  char const   *__cil_tmp___8 ;
  void *__cil_tmp___9 ;
  char const   *__cil_tmp___10 ;

  {
#line 177
  Use_Log = 0;
#line 179
  Read_Config(1);
#line 180
  Validate_Config(1, 0);
#line 182
  (*symtest_Conf_Init)();
#line 187
  __cil_tmp = fileno(stdin);
#line 187
  __cil_tmp___0 = isatty(__cil_tmp);
#line 187
  if (__cil_tmp___0) {
#line 187
    __cil_tmp___1 = fileno(stdout);
#line 187
    __cil_tmp___2 = isatty(__cil_tmp___1);
#line 187
    if (__cil_tmp___2) {
#line 188
      puts("OK, press enter to see a dump of your service configuration ...");
#line 189
      getchar();
    } else {
#line 187
      goto _L;
    }
  } else {
    _L: /* CIL Label */ 
#line 191
    puts("Ok, dump of your server configuration follows:\n");
  }
#line 194
  puts("[GLOBAL]");
#line 195
  printf((char const   * __restrict  )"  Name = %s\n", Conf_ServerName);
#line 196
  printf((char const   * __restrict  )"  Info = %s\n", Conf_ServerInfo);
#line 197
  printf((char const   * __restrict  )"  Password = %s\n", Conf_ServerPwd);
#line 198
  printf((char const   * __restrict  )"  AdminInfo1 = %s\n", Conf_ServerAdmin1);
#line 199
  printf((char const   * __restrict  )"  AdminInfo2 = %s\n", Conf_ServerAdmin2);
#line 200
  printf((char const   * __restrict  )"  AdminEMail = %s\n", Conf_ServerAdminMail);
#line 201
  printf((char const   * __restrict  )"  MotdFile = %s\n", Conf_MotdFile);
#line 202
  printf((char const   * __restrict  )"  MotdPhrase = %s\n", Conf_MotdPhrase);
#line 203
  printf((char const   * __restrict  )"  ChrootDir = %s\n", Conf_Chroot);
#line 204
  printf((char const   * __restrict  )"  PidFile = %s\n", Conf_PidFile);
#line 205
  fputs((char const   * __restrict  )"  Ports = ", (FILE * __restrict  )stdout);
#line 207
  ports_puts(& Conf_ListenPorts);
#line 209
  printf((char const   * __restrict  )"  Listen = %s\n", Conf_ListenAddress);
#line 210
  pwd = getpwuid(Conf_UID);
#line 211
  if (pwd) {
#line 211
    printf((char const   * __restrict  )"  ServerUID = %s\n", pwd->pw_name);
  } else {
#line 212
    printf((char const   * __restrict  )"  ServerUID = %ld\n", (long )Conf_UID);
  }
#line 213
  grp = getgrgid(Conf_GID);
#line 214
  if (grp) {
#line 214
    printf((char const   * __restrict  )"  ServerGID = %s\n", grp->gr_name);
  } else {
#line 215
    printf((char const   * __restrict  )"  ServerGID = %ld\n", (long )Conf_GID);
  }
#line 216
  printf((char const   * __restrict  )"  PingTimeout = %d\n", Conf_PingTimeout);
#line 217
  printf((char const   * __restrict  )"  PongTimeout = %d\n", Conf_PongTimeout);
#line 218
  printf((char const   * __restrict  )"  ConnectRetry = %d\n", Conf_ConnectRetry);
#line 219
  __cil_tmp___3 = yesno_to_str(Conf_OperCanMode);
#line 219
  printf((char const   * __restrict  )"  OperCanUseMode = %s\n", __cil_tmp___3);
#line 220
  __cil_tmp___4 = yesno_to_str(Conf_OperServerMode);
#line 220
  printf((char const   * __restrict  )"  OperServerMode = %s\n", __cil_tmp___4);
#line 221
  __cil_tmp___5 = yesno_to_str(Conf_PredefChannelsOnly);
#line 221
  printf((char const   * __restrict  )"  PredefChannelsOnly = %s\n", __cil_tmp___5);
#line 222
  __cil_tmp___6 = yesno_to_str(Conf_NoDNS);
#line 222
  printf((char const   * __restrict  )"  NoDNS = %s\n", __cil_tmp___6);
#line 230
  printf((char const   * __restrict  )"  MaxConnections = %ld\n", Conf_MaxConnections);
#line 231
  printf((char const   * __restrict  )"  MaxConnectionsIP = %d\n", Conf_MaxConnectionsIP);
#line 232
  if (Conf_MaxJoins > 0) {
#line 232
    __cil_tmp___7 = Conf_MaxJoins;
  } else {
#line 232
    __cil_tmp___7 = -1;
  }
#line 232
  printf((char const   * __restrict  )"  MaxJoins = %d\n", __cil_tmp___7);
#line 233
  printf((char const   * __restrict  )"  MaxNickLength = %u\n\n", Conf_MaxNickLength - 1U);
#line 235
  i = 0U;
#line 235
  while (i < Conf_Oper_Count) {
#line 236
    if (! Conf_Oper[i].name[0]) {
#line 236
      goto __Cont;
    }
#line 239
    puts("[OPERATOR]");
#line 240
    printf((char const   * __restrict  )"  Name = %s\n", Conf_Oper[i].name);
#line 241
    printf((char const   * __restrict  )"  Password = %s\n", Conf_Oper[i].pwd);
#line 242
    if (Conf_Oper[i].mask) {
#line 242
      printf((char const   * __restrict  )"  Mask = %s\n", Conf_Oper[i].mask);
    }
#line 243
    puts("");
    __Cont: /* CIL Label */ 
#line 235
    i ++;
  }
#line 246
  i = 0U;
#line 246
  while (i < 16U) {
#line 247
    if (! Conf_Server[i].name[0]) {
#line 247
      goto __Cont___0;
    }
#line 250
    puts("[SERVER]");
#line 251
    printf((char const   * __restrict  )"  Name = %s\n", Conf_Server[i].name);
#line 252
    printf((char const   * __restrict  )"  Host = %s\n", Conf_Server[i].host);
#line 253
    printf((char const   * __restrict  )"  Port = %u\n", (unsigned int )Conf_Server[i].port);
#line 254
    printf((char const   * __restrict  )"  MyPassword = %s\n", Conf_Server[i].pwd_in);
#line 255
    printf((char const   * __restrict  )"  PeerPassword = %s\n", Conf_Server[i].pwd_out);
#line 256
    printf((char const   * __restrict  )"  Group = %d\n", Conf_Server[i].group);
#line 257
    if (Conf_Server[i].flags & 2) {
#line 257
      __cil_tmp___8 = "yes";
    } else {
#line 257
      __cil_tmp___8 = "no";
    }
#line 257
    printf((char const   * __restrict  )"  Passive = %s\n\n", __cil_tmp___8);
    __Cont___0: /* CIL Label */ 
#line 246
    i ++;
  }
#line 260
  i = 0U;
#line 260
  while (i < Conf_Channel_Count) {
#line 261
    if (! Conf_Channel[i].name[0]) {
#line 261
      goto __Cont___1;
    }
#line 264
    puts("[CHANNEL]");
#line 265
    printf((char const   * __restrict  )"  Name = %s\n", Conf_Channel[i].name);
#line 266
    printf((char const   * __restrict  )"  Modes = %s\n", Conf_Channel[i].modes);
#line 267
    printf((char const   * __restrict  )"  Key = %s\n", Conf_Channel[i].key);
#line 268
    printf((char const   * __restrict  )"  MaxUsers = %lu\n", Conf_Channel[i].maxusers);
#line 270
    __cil_tmp___9 = array_start((array const   *)(& Conf_Channel[i].topic));
#line 270
    topic = (char *)__cil_tmp___9;
#line 271
    if (topic) {
#line 271
      __cil_tmp___10 = (char const   *)topic;
    } else {
#line 271
      __cil_tmp___10 = "";
    }
#line 271
    printf((char const   * __restrict  )"  Topic = %s\n\n", __cil_tmp___10);
    __Cont___1: /* CIL Label */ 
#line 260
    i ++;
  }
#line 274
  return (0);
}
}
#line 278 "conf.c"
void Conf_UnsetServer(CONN_ID Idx ) 
{ int i ;
  time_t t ;

  {
#line 290
  i = 0;
#line 290
  while (i < 16) {
#line 291
    if (Conf_Server[i].conn_id != Idx) {
#line 291
      goto __Cont;
    }
#line 294
    Conf_Server[i].conn_id = -1;
#line 296
    if (Conf_Server[i].flags & 1) {
#line 298
      Init_Server_Struct(& Conf_Server[i]);
    } else {
#line 301
      t = time((time_t *)((void *)0));
#line 302
      if (Conf_Server[i].lasttry < t - (time_t )Conf_ConnectRetry) {
#line 305
        Conf_Server[i].lasttry = (t - (time_t )Conf_ConnectRetry) + 3L;
      } else {
#line 308
        Conf_Server[i].lasttry = t;
      }
    }
    __Cont: /* CIL Label */ 
#line 290
    i ++;
  }
#line 311
  return;
}
}
#line 314 "conf.c"
void Conf_SetServer(int ConfServer , CONN_ID Idx ) 
{ 

  {
#line 322
  Conf_Server[ConfServer].conn_id = Idx;
#line 323
  return;
}
}
#line 326 "conf.c"
int Conf_GetServer(CONN_ID Idx ) 
{ int i ;

  {
#line 331
  i = 0;
#line 335
  i = 0;
#line 335
  while (i < 16) {
#line 336
    if (Conf_Server[i].conn_id == Idx) {
#line 336
      return (i);
    }
#line 335
    i ++;
  }
#line 338
  return (-1);
}
}
#line 342 "conf.c"
int Conf_EnableServer(char *Name , UINT16 Port ) 
{ int i ;
  int __cil_tmp ;

  {
#line 351
  i = 0;
#line 351
  while (i < 16) {
#line 352
    __cil_tmp = strcasecmp((char const   *)(Conf_Server[i].name), (char const   *)Name);
#line 352
    if (__cil_tmp == 0) {
#line 354
      Conf_Server[i].port = Port;
#line 355
      Conf_Server[i].flags &= -3;
#line 356
      return (1);
    }
#line 351
    i ++;
  }
#line 359
  return (0);
}
}
#line 363 "conf.c"
int Conf_EnablePassiveServer(char const   *Name ) 
{ int i ;
  int __cil_tmp ;

  {
#line 370
  i = 0;
#line 370
  while (i < 16) {
#line 371
    __cil_tmp = strcasecmp((char const   *)(Conf_Server[i].name), Name);
#line 371
    if (__cil_tmp == 0 && (int )Conf_Server[i].port > 0) {
#line 373
      Conf_Server[i].flags &= -3;
#line 374
      return (1);
    }
#line 370
    i ++;
  }
#line 377
  return (0);
}
}
#line 381 "conf.c"
int Conf_DisableServer(char *Name ) 
{ int i ;
  int __cil_tmp ;

  {
#line 390
  i = 0;
#line 390
  while (i < 16) {
#line 391
    __cil_tmp = strcasecmp((char const   *)(Conf_Server[i].name), (char const   *)Name);
#line 391
    if (__cil_tmp == 0) {
#line 393
      Conf_Server[i].flags |= 2;
#line 394
      if (Conf_Server[i].conn_id > -1) {
#line 394
        Conn_Close(Conf_Server[i].conn_id, (char *)((void *)0), (char *)"Server link terminated on operator request",
                   1);
      }
#line 395
      return (1);
    }
#line 390
    i ++;
  }
#line 398
  return (0);
}
}
#line 402 "conf.c"
int Conf_AddServer(char *Name , UINT16 Port , char *Host , char *MyPwd , char *PeerPwd ) 
{ int i ;

  {
#line 415
  i = 0;
#line 415
  while (i < 16) {
#line 417
    if (! Conf_Server[i].name[0]) {
#line 417
      break;
    }
#line 415
    i ++;
  }
#line 419
  if (i >= 16) {
#line 419
    return (0);
  }
#line 421
  Init_Server_Struct(& Conf_Server[i]);
#line 422
  strlcpy(Conf_Server[i].name, (char const   *)Name, sizeof(Conf_Server[i].name));
#line 423
  strlcpy(Conf_Server[i].host, (char const   *)Host, sizeof(Conf_Server[i].host));
#line 424
  strlcpy(Conf_Server[i].pwd_out, (char const   *)MyPwd, sizeof(Conf_Server[i].pwd_out));
#line 425
  strlcpy(Conf_Server[i].pwd_in, (char const   *)PeerPwd, sizeof(Conf_Server[i].pwd_in));
#line 426
  Conf_Server[i].port = Port;
#line 427
  Conf_Server[i].flags = 1;
#line 429
  return (1);
}
}
#line 433 "conf.c"
static void Set_Defaults(int InitServers ) 
{ int i ;
  int __cil_tmp ;

  {
#line 440
  strcpy((char * __restrict  )(Conf_ServerName), (char const   * __restrict  )"");
#line 441
  snprintf((char * __restrict  )(Conf_ServerInfo), sizeof(Conf_ServerInfo), (char const   * __restrict  )"%s %s",
           "ngircd", "0.12.0");
#line 442
  strcpy((char * __restrict  )(Conf_ServerPwd), (char const   * __restrict  )"");
#line 444
  strcpy((char * __restrict  )(Conf_ServerAdmin1), (char const   * __restrict  )"");
#line 445
  strcpy((char * __restrict  )(Conf_ServerAdmin2), (char const   * __restrict  )"");
#line 446
  strcpy((char * __restrict  )(Conf_ServerAdminMail), (char const   * __restrict  )"");
#line 448
  strlcpy(Conf_MotdFile, "/usr/local/etc", sizeof(Conf_MotdFile));
#line 449
  strlcat(Conf_MotdFile, "/ngircd.motd", sizeof(Conf_MotdFile));
#line 451
  strlcpy(Conf_MotdPhrase, "", sizeof(Conf_MotdPhrase));
#line 453
  strlcpy(Conf_Chroot, "", sizeof(Conf_Chroot));
#line 455
  strlcpy(Conf_PidFile, "", sizeof(Conf_PidFile));
#line 457
  strcpy((char * __restrict  )(Conf_ListenAddress), (char const   * __restrict  )"");
#line 459
  Conf_GID = 0U;
#line 459
  Conf_UID = Conf_GID;
#line 461
  Conf_PingTimeout = 120;
#line 462
  Conf_PongTimeout = 20;
#line 464
  Conf_ConnectRetry = 60;
#line 466
  Conf_Oper_Count = 0U;
#line 467
  Conf_Channel_Count = 0U;
#line 469
  Conf_OperCanMode = 0;
#line 470
  Conf_NoDNS = 0;
#line 471
  Conf_PredefChannelsOnly = 0;
#line 472
  Conf_OperServerMode = 0;
#line 474
  Conf_ConnectIPv4 = 1;
#line 475
  Conf_ListenIPv4 = 1;
#line 476
  Conf_ConnectIPv6 = 1;
#line 477
  Conf_ListenIPv6 = 1;
#line 479
  Conf_MaxConnections = 0L;
#line 480
  Conf_MaxConnectionsIP = 5;
#line 481
  Conf_MaxJoins = 10;
#line 482
  Conf_MaxNickLength = 10U;
#line 485
  if (InitServers) {
#line 485
    i = 0;
#line 485
    while (i < 16) {
#line 485
      __cil_tmp = i;
#line 485
      i ++;
#line 485
      Init_Server_Struct(& Conf_Server[__cil_tmp]);
    }
  }
#line 486
  return;
}
}
#line 489 "conf.c"
static int Read_Config(int ngircd_starting ) 
{ char section[256] ;
  char str[256] ;
  char *var ;
  char *arg ;
  char *ptr ;
  UINT16 defaultport ;
  int line ;
  int i ;
  int n ;
  FILE *fd ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  size_t __cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  int __cil_tmp___10 ;
  int *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  size_t __cil_tmp___14 ;

  {
#line 495
  defaultport = (UINT16 )6667;
#line 500
  fd = fopen((char const   * __restrict  )(NGIRCd_ConfFile), (char const   * __restrict  )"r");
#line 501
  if (! fd) {
#line 503
    __cil_tmp = __errno_location();
#line 503
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 503
    Config_Error(1, "Can\'t read configuration \"%s\": %s", NGIRCd_ConfFile, __cil_tmp___0);
#line 505
    if (! ngircd_starting) {
#line 506
      return (0);
    }
#line 507
    Config_Error(1, "%s exiting due to fatal errors!", "ngircd");
#line 508
    exit(1);
  }
#line 511
  Set_Defaults(ngircd_starting);
#line 513
  Config_Error(6, "Reading configuration from \"%s\" ...", NGIRCd_ConfFile);
#line 521
  i = 0;
#line 521
  while (i < 16) {
#line 522
    if (Conf_Server[i].conn_id == -1) {
#line 522
      Init_Server_Struct(& Conf_Server[i]);
    } else {
#line 525
      if (Conf_Server[i].flags & 1) {
#line 527
        n = 0;
#line 527
        while (n < 16) {
#line 528
          if (n == i) {
#line 528
            goto __Cont;
          }
#line 530
          if (Conf_Server[i].conn_id == Conf_Server[n].conn_id) {
#line 531
            Init_Server_Struct(& Conf_Server[n]);
          }
          __Cont: /* CIL Label */ 
#line 527
          n ++;
        }
      } else {
#line 540
        Conf_Server[i].flags |= 1;
#line 541
        Log(7, "Marked server %d as \"once\"", i);
      }
    }
#line 521
    i ++;
  }
#line 547
  line = 0;
#line 548
  strcpy((char * __restrict  )(section), (char const   * __restrict  )"");
#line 549
  Init_Server_Struct(& New_Server);
#line 550
  New_Server_Idx = -1;
#line 553
  while (1) {
#line 554
    __cil_tmp___1 = fgets((char * __restrict  )(str), 256, (FILE * __restrict  )fd);
#line 554
    if (! __cil_tmp___1) {
#line 554
      break;
    }
#line 555
    ngt_TrimStr(str);
#line 556
    line ++;
#line 559
    if (((int )str[0] == 59 || (int )str[0] == 35) || (int )str[0] == 0) {
#line 559
      continue;
    }
#line 562
    if ((int )str[0] == 91) {
#line 562
      __cil_tmp___6 = strlen((char const   *)(str));
#line 562
      if ((int )str[__cil_tmp___6 - 1U] == 93) {
#line 563
        strlcpy(section, (char const   *)(str), sizeof(section));
#line 564
        __cil_tmp___2 = strcasecmp((char const   *)(section), "[GLOBAL]");
#line 564
        if (__cil_tmp___2 == 0) {
#line 565
          continue;
        }
#line 567
        __cil_tmp___3 = strcasecmp((char const   *)(section), "[OPERATOR]");
#line 567
        if (__cil_tmp___3 == 0) {
#line 568
          if (Conf_Oper_Count + 1U > 16U) {
#line 569
            Config_Error(3, "Too many operators configured.");
          } else {
#line 572
            Conf_Oper[Conf_Oper_Count].name[0] = (char )'\000';
#line 573
            Conf_Oper[Conf_Oper_Count].pwd[0] = (char )'\000';
#line 574
            if (Conf_Oper[Conf_Oper_Count].mask) {
#line 575
              free((void *)Conf_Oper[Conf_Oper_Count].mask);
#line 576
              Conf_Oper[Conf_Oper_Count].mask = (char *)((void *)0);
            }
#line 578
            Conf_Oper_Count ++;
          }
#line 580
          continue;
        }
#line 582
        __cil_tmp___4 = strcasecmp((char const   *)(section), "[SERVER]");
#line 582
        if (__cil_tmp___4 == 0) {
#line 584
          if (New_Server.name[0]) {
#line 587
            Conf_Server[New_Server_Idx] = New_Server;
          }
#line 591
          Init_Server_Struct(& New_Server);
#line 594
          i = 0;
#line 594
          while (i < 16) {
#line 596
            if (! Conf_Server[i].name[0]) {
#line 596
              break;
            }
#line 594
            i ++;
          }
#line 598
          if (i >= 16) {
#line 600
            Config_Error(3, "Too many servers configured.");
#line 601
            New_Server_Idx = -1;
          } else {
#line 603
            New_Server_Idx = i;
          }
#line 604
          continue;
        }
#line 606
        __cil_tmp___5 = strcasecmp((char const   *)(section), "[CHANNEL]");
#line 606
        if (__cil_tmp___5 == 0) {
#line 607
          if (Conf_Channel_Count + 1U > 16U) {
#line 608
            Config_Error(3, "Too many pre-defined channels configured.");
          } else {
#line 611
            strcpy((char * __restrict  )(Conf_Channel[Conf_Channel_Count].name), (char const   * __restrict  )"");
#line 612
            strcpy((char * __restrict  )(Conf_Channel[Conf_Channel_Count].modes),
                   (char const   * __restrict  )"");
#line 613
            strcpy((char * __restrict  )(Conf_Channel[Conf_Channel_Count].key), (char const   * __restrict  )"");
#line 614
            Conf_Channel[Conf_Channel_Count].maxusers = 0UL;
#line 615
            array_free(& Conf_Channel[Conf_Channel_Count].topic);
#line 616
            Conf_Channel_Count ++;
          }
#line 618
          continue;
        }
#line 620
        Config_Error(3, "%s, line %d: Unknown section \"%s\"!", NGIRCd_ConfFile, line,
                     section);
#line 621
        section[0] = (char)1;
      } else {
#line 562
        goto _L;
      }
    } else {
      _L: /* CIL Label */ ;
    }
#line 623
    if ((int )section[0] == 1) {
#line 623
      continue;
    }
#line 626
    ptr = strchr((char const   *)(str), '=');
#line 627
    if (! ptr) {
#line 628
      Config_Error(3, "%s, line %d: Syntax error!", NGIRCd_ConfFile, line);
#line 629
      continue;
    }
#line 631
    *ptr = (char )'\000';
#line 632
    var = str;
#line 632
    ngt_TrimStr(var);
#line 633
    arg = ptr + 1;
#line 633
    ngt_TrimStr(arg);
#line 635
    __cil_tmp___10 = strcasecmp((char const   *)(section), "[GLOBAL]");
#line 635
    if (__cil_tmp___10 == 0) {
#line 635
      Handle_GLOBAL(line, var, arg);
    } else {
#line 636
      __cil_tmp___9 = strcasecmp((char const   *)(section), "[OPERATOR]");
#line 636
      if (__cil_tmp___9 == 0) {
#line 636
        Handle_OPERATOR(line, var, arg);
      } else {
#line 637
        __cil_tmp___8 = strcasecmp((char const   *)(section), "[SERVER]");
#line 637
        if (__cil_tmp___8 == 0) {
#line 637
          Handle_SERVER(line, var, arg);
        } else {
#line 638
          __cil_tmp___7 = strcasecmp((char const   *)(section), "[CHANNEL]");
#line 638
          if (__cil_tmp___7 == 0) {
#line 638
            Handle_CHANNEL(line, var, arg);
          } else {
#line 639
            Config_Error(3, "%s, line %d: Variable \"%s\" outside section!", NGIRCd_ConfFile,
                         line, var);
          }
        }
      }
    }
  }
#line 643
  fclose(fd);
#line 646
  if (New_Server.name[0]) {
#line 649
    Conf_Server[New_Server_Idx] = New_Server;
  }
#line 652
  __cil_tmp___14 = array_length((array const   *)(& Conf_ListenPorts), sizeof(UINT16 ));
#line 652
  if (0U == __cil_tmp___14) {
#line 653
    __cil_tmp___13 = array_copyb(& Conf_ListenPorts, (char const   *)((char *)(& defaultport)),
                                 sizeof(defaultport));
#line 653
    if (! __cil_tmp___13) {
#line 654
      __cil_tmp___11 = __errno_location();
#line 654
      __cil_tmp___12 = strerror(*__cil_tmp___11);
#line 654
      Config_Error(1, "Could not add default listening Port %u: %s", (unsigned int )defaultport,
                   __cil_tmp___12);
#line 656
      exit(1);
    }
  }
#line 659
  return (1);
}
}
#line 663 "conf.c"
static int Check_ArgIsTrue(char const   *Arg ) 
{ int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 666
  __cil_tmp = strcasecmp(Arg, "yes");
#line 666
  if (__cil_tmp == 0) {
#line 666
    return (1);
  }
#line 667
  __cil_tmp___0 = strcasecmp(Arg, "true");
#line 667
  if (__cil_tmp___0 == 0) {
#line 667
    return (1);
  }
#line 668
  __cil_tmp___1 = atoi(Arg);
#line 668
  if (__cil_tmp___1 != 0) {
#line 668
    return (1);
  }
#line 670
  return (0);
}
}
#line 674 "conf.c"
static unsigned int Handle_MaxNickLength(int Line , char const   *Arg ) 
{ unsigned int new ;
  int __cil_tmp ;

  {
#line 678
  __cil_tmp = atoi(Arg);
#line 678
  new = (unsigned int )__cil_tmp + 1U;
#line 679
  if (new > 32U) {
#line 680
    Config_Error(4, "%s, line %d: Value of \"MaxNickLength\" exceeds %u!", NGIRCd_ConfFile,
                 Line, 31);
#line 683
    return (32U);
  }
#line 685
  if (new < 2U) {
#line 686
    Config_Error(4, "%s, line %d: Value of \"MaxNickLength\" must be at least 1!",
                 NGIRCd_ConfFile, Line);
#line 689
    return (2U);
  }
#line 691
  return (new);
}
}
#line 695 "conf.c"
static void Handle_GLOBAL(int Line , char *Var , char *Arg ) 
{ struct passwd *pwd ;
  struct group *grp ;
  size_t len ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  int __cil_tmp___10 ;
  int __cil_tmp___11 ;
  int __cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  int __cil_tmp___15 ;
  int __cil_tmp___16 ;
  int __cil_tmp___17 ;
  int __cil_tmp___18 ;
  int __cil_tmp___19 ;
  int __cil_tmp___20 ;
  int __cil_tmp___21 ;
  int __cil_tmp___22 ;
  int __cil_tmp___23 ;
  int __cil_tmp___24 ;
  int __cil_tmp___25 ;
  int __cil_tmp___26 ;
  int __cil_tmp___27 ;
  int __cil_tmp___28 ;
  int __cil_tmp___29 ;
  int __cil_tmp___30 ;

  {
#line 706
  __cil_tmp = strcasecmp((char const   *)Var, "Name");
#line 706
  if (__cil_tmp == 0) {
#line 708
    len = strlcpy(Conf_ServerName, (char const   *)Arg, sizeof(Conf_ServerName));
#line 709
    if (len >= sizeof(Conf_ServerName)) {
#line 710
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 711
    return;
  }
#line 713
  __cil_tmp___0 = strcasecmp((char const   *)Var, "Info");
#line 713
  if (__cil_tmp___0 == 0) {
#line 715
    len = strlcpy(Conf_ServerInfo, (char const   *)Arg, sizeof(Conf_ServerInfo));
#line 716
    if (len >= sizeof(Conf_ServerInfo)) {
#line 717
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 718
    return;
  }
#line 720
  __cil_tmp___1 = strcasecmp((char const   *)Var, "Password");
#line 720
  if (__cil_tmp___1 == 0) {
#line 722
    len = strlcpy(Conf_ServerPwd, (char const   *)Arg, sizeof(Conf_ServerPwd));
#line 723
    if (len >= sizeof(Conf_ServerPwd)) {
#line 724
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 725
    return;
  }
#line 727
  __cil_tmp___2 = strcasecmp((char const   *)Var, "AdminInfo1");
#line 727
  if (__cil_tmp___2 == 0) {
#line 729
    len = strlcpy(Conf_ServerAdmin1, (char const   *)Arg, sizeof(Conf_ServerAdmin1));
#line 730
    if (len >= sizeof(Conf_ServerAdmin1)) {
#line 731
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 732
    return;
  }
#line 734
  __cil_tmp___3 = strcasecmp((char const   *)Var, "AdminInfo2");
#line 734
  if (__cil_tmp___3 == 0) {
#line 736
    len = strlcpy(Conf_ServerAdmin2, (char const   *)Arg, sizeof(Conf_ServerAdmin2));
#line 737
    if (len >= sizeof(Conf_ServerAdmin2)) {
#line 738
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 739
    return;
  }
#line 741
  __cil_tmp___4 = strcasecmp((char const   *)Var, "AdminEMail");
#line 741
  if (__cil_tmp___4 == 0) {
#line 743
    len = strlcpy(Conf_ServerAdminMail, (char const   *)Arg, sizeof(Conf_ServerAdminMail));
#line 744
    if (len >= sizeof(Conf_ServerAdminMail)) {
#line 745
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 746
    return;
  }
#line 749
  __cil_tmp___5 = strcasecmp((char const   *)Var, "Ports");
#line 749
  if (__cil_tmp___5 == 0) {
#line 750
    ports_parse(& Conf_ListenPorts, Line, Arg);
#line 751
    return;
  }
#line 753
  __cil_tmp___6 = strcasecmp((char const   *)Var, "MotdFile");
#line 753
  if (__cil_tmp___6 == 0) {
#line 755
    len = strlcpy(Conf_MotdFile, (char const   *)Arg, sizeof(Conf_MotdFile));
#line 756
    if (len >= sizeof(Conf_MotdFile)) {
#line 757
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 758
    return;
  }
#line 760
  __cil_tmp___7 = strcasecmp((char const   *)Var, "MotdPhrase");
#line 760
  if (__cil_tmp___7 == 0) {
#line 762
    len = strlcpy(Conf_MotdPhrase, (char const   *)Arg, sizeof(Conf_MotdPhrase));
#line 763
    if (len >= sizeof(Conf_MotdPhrase)) {
#line 764
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 765
    return;
  }
#line 767
  __cil_tmp___8 = strcasecmp((char const   *)Var, "ChrootDir");
#line 767
  if (__cil_tmp___8 == 0) {
#line 769
    len = strlcpy(Conf_Chroot, (char const   *)Arg, sizeof(Conf_Chroot));
#line 770
    if (len >= sizeof(Conf_Chroot)) {
#line 771
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 772
    return;
  }
#line 774
  __cil_tmp___9 = strcasecmp((char const   *)Var, "PidFile");
#line 774
  if (__cil_tmp___9 == 0) {
#line 776
    len = strlcpy(Conf_PidFile, (char const   *)Arg, sizeof(Conf_PidFile));
#line 777
    if (len >= sizeof(Conf_PidFile)) {
#line 778
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 779
    return;
  }
#line 781
  __cil_tmp___12 = strcasecmp((char const   *)Var, "ServerUID");
#line 781
  if (__cil_tmp___12 == 0) {
#line 783
    pwd = getpwnam((char const   *)Arg);
#line 784
    if (pwd) {
#line 784
      Conf_UID = pwd->pw_uid;
    } else {
#line 787
      __cil_tmp___11 = isdigit((int )*Arg);
#line 787
      if (__cil_tmp___11) {
#line 790
        __cil_tmp___10 = atoi((char const   *)Arg);
#line 790
        Conf_UID = (unsigned int )__cil_tmp___10;
      } else {
#line 787
        Config_Error_NaN(Line, (char const   *)Var);
      }
    }
#line 792
    return;
  }
#line 794
  __cil_tmp___15 = strcasecmp((char const   *)Var, "ServerGID");
#line 794
  if (__cil_tmp___15 == 0) {
#line 796
    grp = getgrnam((char const   *)Arg);
#line 797
    if (grp) {
#line 797
      Conf_GID = grp->gr_gid;
    } else {
#line 800
      __cil_tmp___14 = isdigit((int )*Arg);
#line 800
      if (__cil_tmp___14) {
#line 803
        __cil_tmp___13 = atoi((char const   *)Arg);
#line 803
        Conf_GID = (unsigned int )__cil_tmp___13;
      } else {
#line 800
        Config_Error_NaN(Line, (char const   *)Var);
      }
    }
#line 805
    return;
  }
#line 807
  __cil_tmp___16 = strcasecmp((char const   *)Var, "PingTimeout");
#line 807
  if (__cil_tmp___16 == 0) {
#line 809
    Conf_PingTimeout = atoi((char const   *)Arg);
#line 810
    if (Conf_PingTimeout < 5) {
#line 811
      Config_Error(4, "%s, line %d: Value of \"PingTimeout\" too low!", NGIRCd_ConfFile,
                   Line);
#line 813
      Conf_PingTimeout = 5;
    }
#line 815
    return;
  }
#line 817
  __cil_tmp___17 = strcasecmp((char const   *)Var, "PongTimeout");
#line 817
  if (__cil_tmp___17 == 0) {
#line 819
    Conf_PongTimeout = atoi((char const   *)Arg);
#line 820
    if (Conf_PongTimeout < 5) {
#line 821
      Config_Error(4, "%s, line %d: Value of \"PongTimeout\" too low!", NGIRCd_ConfFile,
                   Line);
#line 823
      Conf_PongTimeout = 5;
    }
#line 825
    return;
  }
#line 827
  __cil_tmp___18 = strcasecmp((char const   *)Var, "ConnectRetry");
#line 827
  if (__cil_tmp___18 == 0) {
#line 829
    Conf_ConnectRetry = atoi((char const   *)Arg);
#line 830
    if (Conf_ConnectRetry < 5) {
#line 831
      Config_Error(4, "%s, line %d: Value of \"ConnectRetry\" too low!", NGIRCd_ConfFile,
                   Line);
#line 833
      Conf_ConnectRetry = 5;
    }
#line 835
    return;
  }
#line 837
  __cil_tmp___19 = strcasecmp((char const   *)Var, "PredefChannelsOnly");
#line 837
  if (__cil_tmp___19 == 0) {
#line 839
    Conf_PredefChannelsOnly = Check_ArgIsTrue((char const   *)Arg);
#line 840
    return;
  }
#line 842
  __cil_tmp___20 = strcasecmp((char const   *)Var, "NoDNS");
#line 842
  if (__cil_tmp___20 == 0) {
#line 844
    Conf_NoDNS = Check_ArgIsTrue((char const   *)Arg);
#line 845
    return;
  }
#line 874
  __cil_tmp___21 = strcasecmp((char const   *)Var, "OperCanUseMode");
#line 874
  if (__cil_tmp___21 == 0) {
#line 876
    Conf_OperCanMode = Check_ArgIsTrue((char const   *)Arg);
#line 877
    return;
  }
#line 879
  __cil_tmp___22 = strcasecmp((char const   *)Var, "OperServerMode");
#line 879
  if (__cil_tmp___22 == 0) {
#line 881
    Conf_OperServerMode = Check_ArgIsTrue((char const   *)Arg);
#line 882
    return;
  }
#line 884
  __cil_tmp___24 = strcasecmp((char const   *)Var, "MaxConnections");
#line 884
  if (__cil_tmp___24 == 0) {
#line 887
    __cil_tmp___23 = isdigit((int )*Arg);
#line 887
    if (__cil_tmp___23) {
#line 890
      Conf_MaxConnections = atol((char const   *)Arg);
    } else {
#line 887
      Config_Error_NaN(Line, (char const   *)Var);
    }
#line 891
    return;
  }
#line 893
  __cil_tmp___26 = strcasecmp((char const   *)Var, "MaxConnectionsIP");
#line 893
  if (__cil_tmp___26 == 0) {
#line 896
    __cil_tmp___25 = isdigit((int )*Arg);
#line 896
    if (__cil_tmp___25) {
#line 899
      Conf_MaxConnectionsIP = atoi((char const   *)Arg);
    } else {
#line 896
      Config_Error_NaN(Line, (char const   *)Var);
    }
#line 900
    return;
  }
#line 902
  __cil_tmp___28 = strcasecmp((char const   *)Var, "MaxJoins");
#line 902
  if (__cil_tmp___28 == 0) {
#line 905
    __cil_tmp___27 = isdigit((int )*Arg);
#line 905
    if (__cil_tmp___27) {
#line 908
      Conf_MaxJoins = atoi((char const   *)Arg);
    } else {
#line 905
      Config_Error_NaN(Line, (char const   *)Var);
    }
#line 909
    return;
  }
#line 911
  __cil_tmp___29 = strcasecmp((char const   *)Var, "MaxNickLength");
#line 911
  if (__cil_tmp___29 == 0) {
#line 914
    Conf_MaxNickLength = Handle_MaxNickLength(Line, (char const   *)Arg);
#line 915
    return;
  }
#line 918
  __cil_tmp___30 = strcasecmp((char const   *)Var, "Listen");
#line 918
  if (__cil_tmp___30 == 0) {
#line 920
    len = strlcpy(Conf_ListenAddress, (char const   *)Arg, sizeof(Conf_ListenAddress));
#line 921
    if (len >= sizeof(Conf_ListenAddress)) {
#line 922
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 923
    return;
  }
#line 926
  Config_Error(3, "%s, line %d (section \"Global\"): Unknown variable \"%s\"!", NGIRCd_ConfFile,
               Line, Var);
#line 928
  return;
}
}
#line 931 "conf.c"
static void Handle_OPERATOR(int Line , char *Var , char *Arg ) 
{ unsigned int opercount ;
  size_t len ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 941
  if (Conf_Oper_Count == 0U) {
#line 942
    return;
  }
#line 944
  opercount = Conf_Oper_Count - 1U;
#line 946
  __cil_tmp = strcasecmp((char const   *)Var, "Name");
#line 946
  if (__cil_tmp == 0) {
#line 948
    len = strlcpy(Conf_Oper[opercount].name, (char const   *)Arg, sizeof(Conf_Oper[opercount].name));
#line 949
    if (len >= sizeof(Conf_Oper[opercount].name)) {
#line 950
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 951
    return;
  }
#line 953
  __cil_tmp___0 = strcasecmp((char const   *)Var, "Password");
#line 953
  if (__cil_tmp___0 == 0) {
#line 955
    len = strlcpy(Conf_Oper[opercount].pwd, (char const   *)Arg, sizeof(Conf_Oper[opercount].pwd));
#line 956
    if (len >= sizeof(Conf_Oper[opercount].pwd)) {
#line 957
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 958
    return;
  }
#line 960
  __cil_tmp___1 = strcasecmp((char const   *)Var, "Mask");
#line 960
  if (__cil_tmp___1 == 0) {
#line 961
    if (Conf_Oper[opercount].mask) {
#line 961
      return;
    }
#line 963
    Conf_Oper[opercount].mask = strdup_warn((char const   *)Arg);
#line 964
    return;
  }
#line 966
  Config_Error(3, "%s, line %d (section \"Operator\"): Unknown variable \"%s\"!",
               NGIRCd_ConfFile, Line, Var);
#line 968
  return;
}
}
#line 971 "conf.c"
static void Handle_SERVER(int Line , char *Var , char *Arg ) 
{ long port ;
  size_t len ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 982
  if (New_Server_Idx <= -1) {
#line 982
    return;
  }
#line 984
  __cil_tmp = strcasecmp((char const   *)Var, "Host");
#line 984
  if (__cil_tmp == 0) {
#line 986
    len = strlcpy(New_Server.host, (char const   *)Arg, sizeof(New_Server.host));
#line 987
    if (len >= sizeof(New_Server.host)) {
#line 988
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 989
    return;
  }
#line 991
  __cil_tmp___0 = strcasecmp((char const   *)Var, "Name");
#line 991
  if (__cil_tmp___0 == 0) {
#line 993
    len = strlcpy(New_Server.name, (char const   *)Arg, sizeof(New_Server.name));
#line 994
    if (len >= sizeof(New_Server.name)) {
#line 995
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 996
    return;
  }
#line 998
  __cil_tmp___2 = strcasecmp((char const   *)Var, "Bind");
#line 998
  if (__cil_tmp___2 == 0) {
#line 999
    __cil_tmp___1 = ng_ipaddr_init(& New_Server.bind_addr, (char const   *)Arg, (unsigned short)0);
#line 999
    if (__cil_tmp___1) {
#line 1000
      return;
    }
#line 1002
    Config_Error(3, "%s, line %d (section \"Server\"): Can\'t parse IP address \"%s\"",
                 NGIRCd_ConfFile, Line, Arg);
#line 1004
    return;
  }
#line 1006
  __cil_tmp___3 = strcasecmp((char const   *)Var, "MyPassword");
#line 1006
  if (__cil_tmp___3 == 0) {
#line 1008
    if ((int )*Arg == 58) {
#line 1009
      Config_Error(3, "%s, line %d (section \"Server\"): MyPassword must not start with \':\'!",
                   NGIRCd_ConfFile, Line);
    }
#line 1013
    len = strlcpy(New_Server.pwd_in, (char const   *)Arg, sizeof(New_Server.pwd_in));
#line 1014
    if (len >= sizeof(New_Server.pwd_in)) {
#line 1015
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 1016
    return;
  }
#line 1018
  __cil_tmp___4 = strcasecmp((char const   *)Var, "PeerPassword");
#line 1018
  if (__cil_tmp___4 == 0) {
#line 1020
    len = strlcpy(New_Server.pwd_out, (char const   *)Arg, sizeof(New_Server.pwd_out));
#line 1021
    if (len >= sizeof(New_Server.pwd_out)) {
#line 1022
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 1023
    return;
  }
#line 1025
  __cil_tmp___5 = strcasecmp((char const   *)Var, "Port");
#line 1025
  if (__cil_tmp___5 == 0) {
#line 1027
    port = atol((char const   *)Arg);
#line 1028
    if (port > 0L && port < 65535L) {
#line 1029
      New_Server.port = (unsigned short )port;
    } else {
#line 1031
      Config_Error(3, "%s, line %d (section \"Server\"): Illegal port number %ld!",
                   NGIRCd_ConfFile, Line, port);
    }
#line 1033
    return;
  }
#line 1035
  __cil_tmp___7 = strcasecmp((char const   *)Var, "Group");
#line 1035
  if (__cil_tmp___7 == 0) {
#line 1038
    __cil_tmp___6 = isdigit((int )*Arg);
#line 1038
    if (__cil_tmp___6) {
#line 1042
      New_Server.group = atoi((char const   *)Arg);
    } else {
#line 1039
      Config_Error_NaN(Line, (char const   *)Var);
    }
#line 1043
    return;
  }
#line 1045
  __cil_tmp___9 = strcasecmp((char const   *)Var, "Passive");
#line 1045
  if (__cil_tmp___9 == 0) {
#line 1046
    __cil_tmp___8 = Check_ArgIsTrue((char const   *)Arg);
#line 1046
    if (__cil_tmp___8) {
#line 1047
      New_Server.flags |= 2;
    }
#line 1048
    return;
  }
#line 1051
  Config_Error(3, "%s, line %d (section \"Server\"): Unknown variable \"%s\"!", NGIRCd_ConfFile,
               Line, Var);
#line 1053
  return;
}
}
#line 1056 "conf.c"
static int Handle_Channelname(size_t chancount , char const   *name ) 
{ size_t size ;
  char *dest ;
  size_t __cil_tmp ;

  {
#line 1059
  size = sizeof(Conf_Channel[chancount].name);
#line 1060
  dest = Conf_Channel[chancount].name;
#line 1062
  if ((int )*name && (int const   )*name != 35) {
#line 1063
    *dest = (char )'#';
#line 1064
    size --;
#line 1065
    dest ++;
  }
#line 1067
  __cil_tmp = strlcpy(dest, name, size);
#line 1067
  return (size > __cil_tmp);
}
}
#line 1071 "conf.c"
static void Handle_CHANNEL(int Line , char *Var , char *Arg ) 
{ size_t len ;
  size_t chancount ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  long __cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 1075
  chancount = (size_t )0;
#line 1080
  if (Conf_Channel_Count > 0U) {
#line 1081
    chancount = Conf_Channel_Count - 1U;
  }
#line 1083
  __cil_tmp___0 = strcasecmp((char const   *)Var, "Name");
#line 1083
  if (__cil_tmp___0 == 0) {
#line 1084
    __cil_tmp = Handle_Channelname(chancount, (char const   *)Arg);
#line 1084
    if (! __cil_tmp) {
#line 1085
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 1086
    return;
  }
#line 1088
  __cil_tmp___1 = strcasecmp((char const   *)Var, "Modes");
#line 1088
  if (__cil_tmp___1 == 0) {
#line 1090
    len = strlcpy(Conf_Channel[chancount].modes, (char const   *)Arg, sizeof(Conf_Channel[chancount].modes));
#line 1091
    if (len >= sizeof(Conf_Channel[chancount].modes)) {
#line 1092
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 1093
    return;
  }
#line 1095
  __cil_tmp___3 = strcasecmp((char const   *)Var, "Topic");
#line 1095
  if (__cil_tmp___3 == 0) {
#line 1097
    __cil_tmp___2 = array_copys(& Conf_Channel[chancount].topic, (char const   *)Arg);
#line 1097
    if (! __cil_tmp___2) {
#line 1098
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 1099
    return;
  }
#line 1102
  __cil_tmp___4 = strcasecmp((char const   *)Var, "Key");
#line 1102
  if (__cil_tmp___4 == 0) {
#line 1104
    len = strlcpy(Conf_Channel[chancount].key, (char const   *)Arg, sizeof(Conf_Channel[chancount].key));
#line 1105
    if (len >= sizeof(Conf_Channel[chancount].key)) {
#line 1106
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 1107
    return;
  }
#line 1110
  __cil_tmp___6 = strcasecmp((char const   *)Var, "MaxUsers");
#line 1110
  if (__cil_tmp___6 == 0) {
#line 1112
    __cil_tmp___5 = atol((char const   *)Arg);
#line 1112
    Conf_Channel[chancount].maxusers = (unsigned long )__cil_tmp___5;
#line 1113
    if (Conf_Channel[chancount].maxusers == 0UL) {
#line 1114
      Config_Error_NaN(Line, (char const   *)Var);
    }
#line 1115
    return;
  }
#line 1118
  Config_Error(3, "%s, line %d (section \"Channel\"): Unknown variable \"%s\"!", NGIRCd_ConfFile,
               Line, Var);
#line 1120
  return;
}
}
#line 1123 "conf.c"
static void Validate_Config(int Configtest , int Rehash ) 
{ char *ptr ;
  char *__cil_tmp ;

  {
#line 1134
  ptr = Conf_ServerName;
#line 1135
  while (1) {
#line 1136
    if ((int )*ptr >= 97 && (int )*ptr <= 122) {
#line 1136
      goto __Cont;
    }
#line 1137
    if ((int )*ptr >= 65 && (int )*ptr <= 90) {
#line 1137
      goto __Cont;
    }
#line 1138
    if ((int )*ptr >= 48 && (int )*ptr <= 57) {
#line 1138
      goto __Cont;
    }
#line 1139
    if ((unsigned int )ptr > (unsigned int )(Conf_ServerName)) {
#line 1140
      if ((int )*ptr == 46 || (int )*ptr == 45) {
#line 1141
        goto __Cont;
      }
    }
#line 1143
    Conf_ServerName[0] = (char )'\000';
#line 1144
    break;
    __Cont: /* CIL Label */ 
#line 1135
    ptr ++;
#line 1135
    if (! *ptr) {
#line 1135
      break;
    }
  }
#line 1147
  if (! Conf_ServerName[0]) {
#line 1149
    Config_Error(1, "No (valid) server name configured in \"%s\" (section \'Global\': \'Name\')!",
                 NGIRCd_ConfFile);
#line 1152
    if (! Configtest && ! Rehash) {
#line 1153
      Config_Error(1, "%s exiting due to fatal errors!", "ngircd");
#line 1156
      exit(1);
    }
  }
#line 1160
  if (Conf_ServerName[0]) {
#line 1160
    __cil_tmp = strchr((char const   *)(Conf_ServerName), '.');
#line 1160
    if (__cil_tmp) {
#line 1160
      goto _L;
    } else {
#line 1162
      Config_Error(1, "Invalid server name configured in \"%s\" (section \'Global\': \'Name\'): Dot missing!",
                   NGIRCd_ConfFile);
#line 1165
      if (! Configtest) {
#line 1166
        Config_Error(1, "%s exiting due to fatal errors!", "ngircd");
#line 1169
        exit(1);
      }
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 1188
  if ((! Conf_ServerAdmin1[0] && ! Conf_ServerAdmin2[0]) && ! Conf_ServerAdminMail[0]) {
#line 1191
    Config_Error(4, "No administrative information configured but required by RFC!");
  }
#line 1218
  return;
}
}
#line 1221 "conf.c"
static void Config_Error_TooLong(int Line , char const   *Item ) 
{ 

  {
#line 1224
  Config_Error(4, "%s, line %d: Value of \"%s\" too long!", NGIRCd_ConfFile, Line,
               Item);
#line 1225
  return;
}
}
#line 1228 "conf.c"
static void Config_Error_NaN(int Line , char const   *Item ) 
{ 

  {
#line 1231
  Config_Error(4, "%s, line %d: Value of \"%s\" is not a number!", NGIRCd_ConfFile,
               Line, Item);
#line 1233
  return;
}
}
#line 1237 "conf.c"
static void Config_Error(int Level , char const   *Format  , ...) 
{ char msg[256] ;
  va_list ap ;

  {
#line 1253
  __builtin_va_start(ap, Format);
#line 1257
  vsnprintf((char * __restrict  )(msg), 256U, (char const   * __restrict  )Format,
            ap);
#line 1258
  __builtin_va_end(ap);
#line 1263
  if (Use_Log) {
#line 1263
    Log(Level, "%s", msg);
  } else {
#line 1264
    puts((char const   *)(msg));
  }
#line 1265
  return;
}
}
#line 1268 "conf.c"
static void Init_Server_Struct(CONF_SERVER *Server ) 
{ time_t __cil_tmp ;

  {
#line 1275
  memset((void *)Server, 0, sizeof(CONF_SERVER ));
#line 1277
  Server->group = -1;
#line 1278
  __cil_tmp = time((time_t *)((void *)0));
#line 1278
  Server->lasttry = (__cil_tmp - (time_t )Conf_ConnectRetry) + 1L;
#line 1280
  if (NGIRCd_Passive) {
#line 1280
    Server->flags = 2;
  }
#line 1282
  Resolve_Init(& Server->res_stat);
#line 1283
  Server->conn_id = -1;
#line 1284
  memset((void *)(& Server->bind_addr), 0, sizeof(& Server->bind_addr));
#line 1285
  return;
}
}
#line 1 "conn.o"
#pragma merger(0,"/tmp/cil-LfTtH77B.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 25 "io.h"
int io_library_init(unsigned int eventsize ) ;
#line 28
void io_library_shutdown(void) ;
#line 31
int io_event_create(int fd , short what , void (*cbfunc)(int  , short  ) ) ;
#line 34
int io_event_setcb(int fd , void (*cbfunc)(int  , short  ) ) ;
#line 37
int io_event_add(int fd , short what ) ;
#line 40
int io_event_del(int fd , short what ) ;
#line 43
int io_close(int fd ) ;
#line 46
int io_setnonblock(int fd ) ;
#line 49
int io_dispatch(struct timeval *tv ) ;
#line 314 "/usr/include/unistd.h"
extern ssize_t read(int __fd , void *__buf , size_t __nbytes ) ;
#line 194 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) char *strstr(char const   *__haystack , char const   *__needle )  __attribute__((__pure__,
__nonnull__(1,2))) ;
#line 100 "/usr/include/sys/socket.h"
extern  __attribute__((__nothrow__)) int socket(int __domain , int __type , int __protocol ) ;
#line 110
extern  __attribute__((__nothrow__)) int bind(int __fd , struct sockaddr  const  *__addr ,
                                              socklen_t __len ) ;
#line 124
extern int connect(int __fd , struct sockaddr  const  *__addr , socklen_t __len ) ;
#line 185
extern  __attribute__((__nothrow__)) int getsockopt(int __fd , int __level , int __optname ,
                                                    void * __restrict  __optval ,
                                                    socklen_t * __restrict  __optlen ) ;
#line 192
extern  __attribute__((__nothrow__)) int setsockopt(int __fd , int __level , int __optname ,
                                                    void const   *__optval , socklen_t __optlen ) ;
#line 199
extern  __attribute__((__nothrow__)) int listen(int __fd , int __n ) ;
#line 209
extern int accept(int __fd , struct sockaddr * __restrict  __addr , socklen_t * __restrict  __addr_len ) ;
#line 355 "/usr/include/netinet/in.h"
extern  __attribute__((__nothrow__)) uint16_t ntohs(uint16_t __netshort )  __attribute__((__const__)) ;
#line 54 "/usr/include/arpa/inet.h"
extern  __attribute__((__nothrow__)) char *inet_ntoa(struct in_addr __in ) ;
#line 43 "./../ipaddr/ng_ipaddr.h"
__inline static int ng_ipaddr_af(ng_ipaddr_t const   *a ) 
{ 

  {
#line 50
  return ((int )a->sin4.sin_family);
}
}
#line 55 "./../ipaddr/ng_ipaddr.h"
__inline static socklen_t ng_ipaddr_salen(ng_ipaddr_t const   *a ) 
{ 

  {
#line 64
  return (sizeof(a->sin4));
}
}
#line 68 "./../ipaddr/ng_ipaddr.h"
__inline static UINT16 ng_ipaddr_getport(ng_ipaddr_t const   *a ) 
{ uint16_t __cil_tmp ;

  {
#line 80
  __cil_tmp = ntohs((unsigned short )a->sin4.sin_port);
#line 80
  return (__cil_tmp);
}
}
#line 93
void ng_ipaddr_setport(ng_ipaddr_t *a , UINT16 port ) ;
#line 96
int ng_ipaddr_ipequal(ng_ipaddr_t const   *a , ng_ipaddr_t const   *b ) ;
#line 106 "./../ipaddr/ng_ipaddr.h"
__inline static char const   *ng_ipaddr_tostr(ng_ipaddr_t const   *addr ) 
{ char *__cil_tmp ;

  {
#line 107
  __cil_tmp = inet_ntoa((struct in_addr )addr->sin4.sin_addr);
#line 107
  return ((char const   *)__cil_tmp);
}
}
#line 109 "./../ipaddr/ng_ipaddr.h"
__inline static int ng_ipaddr_tostr_r(ng_ipaddr_t const   *addr , char *d ) 
{ char *__cil_tmp ;

  {
#line 112
  __cil_tmp = inet_ntoa((struct in_addr )addr->sin4.sin_addr);
#line 112
  strlcpy(d, (char const   *)__cil_tmp, 16U);
#line 113
  return (1);
}
}
#line 35 "resolve.h"
int Resolve_Addr(RES_STAT *s , ng_ipaddr_t const   *Addr , int identsock , void (*cbfunc)(int  ,
                                                                                          short  ) ) ;
#line 36
int Resolve_Name(RES_STAT *s , char const   *Host , void (*cbfunc)(int  , short  ) ) ;
#line 37
size_t Resolve_Read(RES_STAT *s , void *readbuf , size_t buflen ) ;
#line 39
int Resolve_Shutdown(RES_STAT *s ) ;
#line 79 "conn.h"
CONNECTION *My_Connections  ;
#line 80 "conn.h"
CONN_ID Pool_Size  ;
#line 81 "conn.h"
long WCounter  ;
#line 94
int Conn_WriteStr(CONN_ID Idx , char *Format  , ...) ;
#line 100
CLIENT *Conn_GetClient(CONN_ID Idx ) ;
#line 41 "conn-func.h"
void Conn_SetPenalty(CONN_ID Idx , time_t Seconds ) ;
#line 42
void Conn_ResetPenalty(CONN_ID Idx ) ;
#line 41 "parse.h"
int Parse_Request(CONN_ID Idx , char *Request ) ;
#line 79 "conn.c"
static int Handle_Write(CONN_ID Idx ) ;
#line 80
static int Conn_Write(CONN_ID Idx , char *Data , size_t Len ) ;
#line 81
static int New_Connection(int Sock ) ;
#line 82
static CONN_ID Socket2Index(int Sock ) ;
#line 83
static void Read_Request(CONN_ID Idx ) ;
#line 84
static int Handle_Buffer(CONN_ID Idx ) ;
#line 85
static void Check_Connections(void) ;
#line 86
static void Check_Servers(void) ;
#line 87
static void Init_Conn_Struct(CONN_ID Idx ) ;
#line 88
static int Init_Socket(int Sock ) ;
#line 89
static void New_Server___0(int Server , ng_ipaddr_t *dest ) ;
#line 90
static void Simple_Message(int Sock , char const   *Msg ) ;
#line 91
static int NewListener(int af , UINT16 Port ) ;
#line 93 "conn.c"
static array My_Listeners  ;
#line 94 "conn.c"
static array My_ConnArray  ;
#line 101
static void server_login(CONN_ID idx ) ;
#line 103
static void cb_Read_Resolver_Result(int r_fd , short events  __attribute__((__unused__)) ) ;
#line 104
static void cb_Connect_to_Server(int fd , short events  __attribute__((__unused__)) ) ;
#line 105
static void cb_clientserver(int sock , short what ) ;
#line 107 "conn.c"
static void cb_listen(int sock , short irrelevant ) 
{ 

  {
#line 111
  New_Connection(sock);
#line 112
  return;
}
}
#line 115 "conn.c"
static void cb_connserver(int sock , short what  __attribute__((__unused__)) ) 
{ int res ;
  int err ;
  socklen_t sock_len ;
  CONN_ID idx ;
  CONN_ID __cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;

  {
#line 120
  __cil_tmp = Socket2Index(sock);
#line 120
  idx = __cil_tmp;
#line 121
  if (idx <= -1) {
#line 122
    LogDebug("cb_connserver wants to write on unknown socket?!");
#line 123
    io_close(sock);
#line 124
    return;
  }
#line 130
  sock_len = sizeof(err);
#line 131
  res = getsockopt((My_Connections + idx)->sock, 1, 4, (void * __restrict  )(& err),
                   (socklen_t * __restrict  )(& sock_len));
#line 135
  if (res != 0 || err != 0) {
#line 136
    if (res != 0) {
#line 137
      __cil_tmp___0 = __errno_location();
#line 137
      __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 137
      Log(2, "getsockopt (connection %d): %s!", idx, __cil_tmp___1);
    } else {
#line 140
      __cil_tmp___2 = strerror(err);
#line 140
      __cil_tmp___3 = Conf_GetServer(idx);
#line 140
      Log(2, "Can\'t connect socket to \"%s:%d\" (connection %d): %s!", (My_Connections + idx)->host,
          Conf_Server[__cil_tmp___3].port, idx, __cil_tmp___2);
    }
#line 146
    res = Conf_GetServer(idx);
#line 149
    Conn_Close(idx, (char *)"Can\'t connect!", (char *)((void *)0), 0);
#line 151
    if (res < 0) {
#line 152
      return;
    }
#line 153
    __cil_tmp___4 = ng_ipaddr_af((ng_ipaddr_t const   *)(& Conf_Server[res].dst_addr[0]));
#line 153
    if (__cil_tmp___4) {
#line 155
      New_Server___0(res, & Conf_Server[res].dst_addr[0]);
#line 157
      Conf_Server[res].dst_addr[0] = Conf_Server[res].dst_addr[1];
#line 159
      memset((void *)(& Conf_Server[res].dst_addr[1]), 0, sizeof(& Conf_Server[res].dst_addr[1]));
    }
#line 161
    return;
  }
#line 164
  res = Conf_GetServer(idx);
#line 166
  if (res >= 0) {
#line 167
    memset((void *)(& Conf_Server[res].dst_addr), 0, sizeof(& Conf_Server[res].dst_addr));
  }
#line 168
  (My_Connections + idx)->options = (unsigned short )((int )(My_Connections + idx)->options & -3);
#line 169
  server_login(idx);
#line 170
  return;
}
}
#line 173 "conn.c"
static void server_login(CONN_ID idx ) 
{ int __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 176
  __cil_tmp = Conf_GetServer(idx);
#line 176
  Log(6, "Connection %d with \"%s:%d\" established. Now logging in ...", idx, (My_Connections + idx)->host,
      Conf_Server[__cil_tmp].port);
#line 179
  io_event_setcb((My_Connections + idx)->sock, & cb_clientserver);
#line 180
  io_event_add((My_Connections + idx)->sock, (short)3);
#line 183
  __cil_tmp___0 = Conf_GetServer(idx);
#line 183
  Conn_WriteStr(idx, (char *)"PASS %s %s", Conf_Server[__cil_tmp___0].pwd_out, NGIRCd_ProtoID);
#line 184
  Conn_WriteStr(idx, (char *)"SERVER %s :%s", Conf_ServerName, Conf_ServerInfo);
#line 185
  return;
}
}
#line 188 "conn.c"
static void cb_clientserver(int sock , short what ) 
{ CONN_ID idx ;
  CONN_ID __cil_tmp ;

  {
#line 191
  __cil_tmp = Socket2Index(sock);
#line 191
  idx = __cil_tmp;
#line 192
  if (idx <= -1) {
#line 196
    io_close(sock);
#line 197
    return;
  }
#line 200
  if ((int )what & 1) {
#line 201
    Read_Request(idx);
  }
#line 203
  if ((int )what & 2) {
#line 204
    Handle_Write(idx);
  }
#line 205
  return;
}
}
#line 208 "conn.c"
void Conn_Init(void) 
{ CONN_ID i ;
  void *__cil_tmp ;
  void *__cil_tmp___0 ;
  size_t __cil_tmp___1 ;

  {
#line 216
  Pool_Size = 100;
#line 217
  if (Conf_MaxConnections > 0L) {
#line 220
    if ((long )Pool_Size > Conf_MaxConnections) {
#line 220
      Pool_Size = (int )Conf_MaxConnections;
    }
  }
#line 223
  __cil_tmp = array_alloc(& My_ConnArray, sizeof(CONNECTION ), (unsigned int )Pool_Size);
#line 223
  if (! __cil_tmp) {
#line 224
    Log(0, "Can\'t allocate memory! [Conn_Init]");
#line 225
    exit(1);
  }
#line 230
  __cil_tmp___0 = array_start((array const   *)(& My_ConnArray));
#line 230
  My_Connections = (CONNECTION *)__cil_tmp___0;
#line 232
  __cil_tmp___1 = array_length((array const   *)(& My_ConnArray), sizeof(CONNECTION ));
#line 232
  LogDebug("Allocated connection pool for %d items (%ld bytes).", __cil_tmp___1, My_ConnArray.used);
#line 237
  array_free(& My_Listeners);
#line 240
  i = 0;
#line 240
  while (i < Pool_Size) {
#line 240
    Init_Conn_Struct(i);
#line 240
    i ++;
  }
#line 243
  WCounter = 0L;
#line 244
  return;
}
}
#line 247 "conn.c"
void Conn_Exit(void) 
{ CONN_ID idx ;
  char const   *__cil_tmp ;

  {
#line 255
  LogDebug("Shutting down all connections ...");
#line 257
  Conn_ExitListeners();
#line 260
  idx = 0;
#line 260
  while (idx < Pool_Size) {
#line 261
    if ((My_Connections + idx)->sock > -1) {
#line 262
      if (NGIRCd_SignalRestart) {
#line 262
        __cil_tmp = "Server going down (restarting)";
      } else {
#line 262
        __cil_tmp = "Server going down";
      }
#line 262
      Conn_Close(idx, (char *)((void *)0), (char *)__cil_tmp, 1);
    }
#line 260
    idx ++;
  }
#line 267
  array_free(& My_ConnArray);
#line 268
  My_Connections = (CONNECTION *)((void *)0);
#line 269
  Pool_Size = 0;
#line 270
  io_library_shutdown();
#line 271
  return;
}
}
#line 274 "conn.c"
static unsigned int ports_initlisteners(array *a , int af , void (*func)(int  , short  ) ) 
{ unsigned int created ;
  size_t len ;
  int fd ;
  UINT16 *port ;
  void *__cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  size_t __cil_tmp___3 ;

  {
#line 277
  created = 0U;
#line 282
  len = array_length((array const   *)a, sizeof(UINT16 ));
#line 283
  __cil_tmp = array_start((array const   *)a);
#line 283
  port = (UINT16 *)__cil_tmp;
#line 284
  while (1) {
#line 284
    __cil_tmp___3 = len;
#line 284
    len --;
#line 284
    if (! __cil_tmp___3) {
#line 284
      break;
    }
#line 285
    fd = NewListener(af, *port);
#line 286
    if (fd < 0) {
#line 287
      port ++;
#line 288
      continue;
    }
#line 290
    __cil_tmp___2 = io_event_create(fd, (short)1, func);
#line 290
    if (! __cil_tmp___2) {
#line 291
      __cil_tmp___0 = __errno_location();
#line 291
      __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 291
      Log(3, "io_event_create(): Could not add listening fd %d (port %u): %s!", fd,
          (unsigned int )*port, __cil_tmp___1);
#line 293
      close(fd);
#line 294
      port ++;
#line 295
      continue;
    }
#line 297
    created ++;
#line 298
    port ++;
  }
#line 301
  return (created);
}
}
#line 305 "conn.c"
unsigned int Conn_InitListeners(void) 
{ unsigned int created ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  unsigned int __cil_tmp___2 ;

  {
#line 310
  created = 0U;
#line 312
  __cil_tmp___1 = io_library_init(100U);
#line 312
  if (! __cil_tmp___1) {
#line 313
    __cil_tmp = __errno_location();
#line 313
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 313
    Log(0, "Cannot initialize IO routines: %s", __cil_tmp___0);
#line 314
    return (4294967295U);
  }
#line 321
  if (Conf_ListenIPv4) {
#line 322
    __cil_tmp___2 = ports_initlisteners(& Conf_ListenPorts, 2, & cb_listen);
#line 322
    created += __cil_tmp___2;
  }
#line 324
  return (created);
}
}
#line 328 "conn.c"
void Conn_ExitListeners(void) 
{ int *fd ;
  size_t arraylen ;
  void *__cil_tmp ;
  size_t __cil_tmp___0 ;

  {
#line 338
  arraylen = array_length((array const   *)(& My_Listeners), sizeof(int ));
#line 339
  Log(6, "Shutting down all listening sockets (%d total)...", arraylen);
#line 340
  __cil_tmp = array_start((array const   *)(& My_Listeners));
#line 340
  fd = (int *)__cil_tmp;
#line 341
  while (1) {
#line 341
    __cil_tmp___0 = arraylen;
#line 341
    arraylen --;
#line 341
    if (! __cil_tmp___0) {
#line 341
      break;
    }
#line 344
    io_close(*fd);
#line 345
    LogDebug("Listening socket %d closed.", *fd);
#line 346
    fd ++;
  }
#line 348
  array_free(& My_Listeners);
#line 349
  return;
}
}
#line 352 "conn.c"
static int InitSinaddrListenAddr(int af , ng_ipaddr_t *addr , UINT16 Port ) 
{ int ret ;
  char const   *listen_addrstr ;

  {
#line 356
  listen_addrstr = (char const   *)((void *)0);
#line 363
  if (Conf_ListenAddress[0]) {
#line 364
    listen_addrstr = (char const   *)(Conf_ListenAddress);
  }
#line 366
  ret = ng_ipaddr_init(addr, listen_addrstr, Port);
#line 367
  if (! ret) {
#line 368
    if (! listen_addrstr) {
#line 369
      listen_addrstr = "";
    }
#line 370
    Log(2, "Can\'t bind to %s:%u: can\'t convert ip address \"%s\"", listen_addrstr,
        Port, listen_addrstr);
  }
#line 373
  return (ret);
}
}
#line 377 "conn.c"
static void set_v6_only(int af , int sock ) 
{ 

  {
#line 392
  return;
}
}
#line 396 "conn.c"
static int NewListener(int af , UINT16 Port ) 
{ ng_ipaddr_t addr ;
  int sock ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  int *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char const   *__cil_tmp___6 ;
  socklen_t __cil_tmp___7 ;
  int __cil_tmp___8 ;
  int *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  int *__cil_tmp___12 ;
  char *__cil_tmp___13 ;
  int __cil_tmp___14 ;
  char const   *__cil_tmp___15 ;

  {
#line 405
  __cil_tmp = InitSinaddrListenAddr(af, & addr, Port);
#line 405
  if (! __cil_tmp) {
#line 406
    return (-1);
  }
#line 408
  __cil_tmp___0 = ng_ipaddr_af((ng_ipaddr_t const   *)(& addr));
#line 408
  sock = socket(__cil_tmp___0, 1, 0);
#line 409
  if (sock < 0) {
#line 410
    __cil_tmp___1 = __errno_location();
#line 410
    __cil_tmp___2 = strerror(*__cil_tmp___1);
#line 410
    Log(2, "Can\'t create socket: %s!", __cil_tmp___2);
#line 411
    return (-1);
  }
#line 414
  af = ng_ipaddr_af((ng_ipaddr_t const   *)(& addr));
#line 416
  set_v6_only(af, sock);
#line 418
  __cil_tmp___3 = Init_Socket(sock);
#line 418
  if (! __cil_tmp___3) {
#line 419
    return (-1);
  }
#line 421
  __cil_tmp___7 = ng_ipaddr_salen((ng_ipaddr_t const   *)(& addr));
#line 421
  __cil_tmp___8 = bind(sock, (struct sockaddr  const  *)((struct sockaddr *)(& addr)),
                       __cil_tmp___7);
#line 421
  if (__cil_tmp___8 != 0) {
#line 422
    __cil_tmp___4 = __errno_location();
#line 422
    __cil_tmp___5 = strerror(*__cil_tmp___4);
#line 422
    __cil_tmp___6 = ng_ipaddr_tostr((ng_ipaddr_t const   *)(& addr));
#line 422
    Log(2, "Can\'t bind socket to address %s:%d - %s", __cil_tmp___6, Port, __cil_tmp___5);
#line 424
    close(sock);
#line 425
    return (-1);
  }
#line 428
  __cil_tmp___11 = listen(sock, 10);
#line 428
  if (__cil_tmp___11 != 0) {
#line 429
    __cil_tmp___9 = __errno_location();
#line 429
    __cil_tmp___10 = strerror(*__cil_tmp___9);
#line 429
    Log(2, "Can\'t listen on socket: %s!", __cil_tmp___10);
#line 430
    close(sock);
#line 431
    return (-1);
  }
#line 435
  __cil_tmp___14 = array_catb(& My_Listeners, (char const   *)((char *)(& sock)),
                              sizeof(int ));
#line 435
  if (! __cil_tmp___14) {
#line 436
    __cil_tmp___12 = __errno_location();
#line 436
    __cil_tmp___13 = strerror(*__cil_tmp___12);
#line 436
    Log(2, "Can\'t add socket to My_Listeners array: %s!", __cil_tmp___13);
#line 437
    close(sock);
#line 438
    return (-1);
  }
#line 446
  __cil_tmp___15 = ng_ipaddr_tostr((ng_ipaddr_t const   *)(& addr));
#line 446
  Log(6, "Now listening on %s:%d (socket %d).", __cil_tmp___15, Port, sock);
#line 478
  return (sock);
}
}
#line 482 "conn.c"
void Conn_Handler(void) 
{ int i ;
  unsigned int wdatalen ;
  struct timeval tv ;
  time_t t ;
  int timeout ;
  int __cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int *__cil_tmp___2 ;

  {
#line 497
  while (! NGIRCd_SignalQuit && ! NGIRCd_SignalRestart) {
#line 498
    timeout = 1;
#line 505
    if (NGIRCd_SignalRehash) {
#line 506
      NGIRCd_Rehash();
    }
#line 510
    Check_Servers();
#line 511
    Check_Connections();
#line 513
    t = time((time_t *)((void *)0));
#line 516
    i = 0;
#line 516
    while (i < Pool_Size) {
#line 517
      if (((My_Connections + i)->sock > -1 && (My_Connections + i)->rbuf.used > 0U) && (My_Connections + i)->delaytime < t) {
#line 521
        __cil_tmp = Handle_Buffer(i);
#line 521
        if (__cil_tmp) {
#line 521
          timeout = 0;
        }
      }
#line 516
      i ++;
    }
#line 526
    i = 0;
#line 526
    while (i < Pool_Size) {
#line 527
      if ((My_Connections + i)->sock <= -1) {
#line 528
        goto __Cont;
      }
#line 530
      wdatalen = (My_Connections + i)->wbuf.used;
#line 535
      if (wdatalen > 0U) {
#line 539
        io_event_add((My_Connections + i)->sock, (short)2);
      }
      __Cont: /* CIL Label */ 
#line 526
      i ++;
    }
#line 544
    i = 0;
#line 544
    while (i < Pool_Size) {
#line 545
      if ((My_Connections + i)->sock <= -1) {
#line 546
        goto __Cont___0;
      }
#line 548
      if ((My_Connections + i)->res_stat.resolver_fd >= 0) {
#line 550
        io_event_del((My_Connections + i)->sock, (short)1);
#line 551
        goto __Cont___0;
      }
#line 554
      if (((int )(My_Connections + i)->options & 2) != 0) {
#line 555
        goto __Cont___0;
      }
#line 557
      if ((My_Connections + i)->delaytime > t) {
#line 559
        io_event_del((My_Connections + i)->sock, (short)1);
#line 560
        goto __Cont___0;
      }
#line 562
      io_event_add((My_Connections + i)->sock, (short)1);
      __Cont___0: /* CIL Label */ 
#line 544
      i ++;
    }
#line 566
    tv.tv_usec = 0L;
#line 567
    if (timeout) {
#line 567
      tv.tv_sec = 1L;
    } else {
#line 567
      tv.tv_sec = 0L;
    }
#line 570
    i = io_dispatch(& tv);
#line 571
    if (i == -1) {
#line 571
      __cil_tmp___2 = __errno_location();
#line 571
      if (*__cil_tmp___2 != 4) {
#line 572
        __cil_tmp___0 = __errno_location();
#line 572
        __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 572
        Log(0, "Conn_Handler(): io_dispatch(): %s!", __cil_tmp___1);
#line 573
        Log(1, "%s exiting due to fatal errors!", "ngircd");
#line 574
        exit(1);
      } else {
#line 571
        goto _L;
      }
    } else {
      _L: /* CIL Label */ ;
    }
  }
#line 578
  if (NGIRCd_SignalQuit) {
#line 578
    Log(1029, "Server going down NOW!");
  } else {
#line 579
    if (NGIRCd_SignalRestart) {
#line 579
      Log(1029, "Server restarting NOW!");
    }
  }
#line 580
  return;
}
}
#line 593 "conn.c"
int Conn_WriteStr(CONN_ID Idx , char *Format  , ...) 
{ char buffer[513] ;
  size_t len ;
  int ok ;
  va_list ap ;
  size_t __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 612
  __builtin_va_start(ap, Format);
#line 616
  __cil_tmp___0 = vsnprintf((char * __restrict  )(buffer), 511U, (char const   * __restrict  )Format,
                            ap);
#line 616
  if (__cil_tmp___0 >= 511) {
#line 640
    __cil_tmp = strlen("[CUT]");
#line 640
    strcpy((char * __restrict  )((((buffer + sizeof(buffer)) - __cil_tmp) - 2) - 1),
           (char const   * __restrict  )"[CUT]");
  }
#line 649
  len = strlcat(buffer, "\r\n", sizeof(buffer));
#line 650
  ok = Conn_Write(Idx, buffer, len);
#line 651
  ((My_Connections + Idx)->msg_out) ++;
#line 653
  __builtin_va_end(ap);
#line 654
  return (ok);
}
}
#line 665 "conn.c"
static int Conn_Write(CONN_ID Idx , char *Data , size_t Len ) 
{ CLIENT *c ;
  size_t writebuf_limit ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 669
  writebuf_limit = (size_t )4096;
#line 674
  c = Conn_GetClient(Idx);
#line 679
  __cil_tmp = Client_Type(c);
#line 679
  if (__cil_tmp == 32) {
#line 680
    writebuf_limit = 51200U;
  }
#line 685
  if ((My_Connections + Idx)->sock <= -1) {
#line 686
    LogDebug("Skipped write on closed socket (connection %d).", Idx);
#line 687
    return (0);
  }
#line 704
  if ((My_Connections + Idx)->wbuf.used + Len >= writebuf_limit) {
#line 708
    __cil_tmp___0 = Handle_Write(Idx);
#line 708
    if (! __cil_tmp___0) {
#line 709
      return (0);
    }
  }
#line 714
  if ((My_Connections + Idx)->wbuf.used + Len >= writebuf_limit) {
#line 716
    Log(5, "Write buffer overflow (connection %d, size %lu byte)!", Idx, (unsigned long )(My_Connections + Idx)->wbuf.used);
#line 720
    Conn_Close(Idx, (char *)"Write buffer overflow!", (char *)((void *)0), 0);
#line 721
    return (0);
  }
#line 725
  __cil_tmp___1 = array_catb(& (My_Connections + Idx)->wbuf, (char const   *)Data,
                             Len);
#line 725
  if (! __cil_tmp___1) {
#line 726
    return (0);
  }
#line 728
  (My_Connections + Idx)->bytes_out = (long )((unsigned long )(My_Connections + Idx)->bytes_out + (unsigned long )Len);
#line 732
  WCounter = (long )((unsigned long )WCounter + (unsigned long )Len);
#line 734
  return (1);
}
}
#line 738 "conn.c"
void Conn_Close(CONN_ID Idx , char *LogMsg , char *FwdMsg , int InformClient ) 
{ CLIENT *c ;
  char *txt ;
  double in_k ;
  double out_k ;
  UINT16 port ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  CLIENT *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  int *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 756
  if (((int )(My_Connections + Idx)->options & 1) != 0) {
#line 759
    LogDebug("Recursive request to close connection: %d", Idx);
#line 760
    return;
  }
#line 766
  (My_Connections + Idx)->options = (unsigned short )((int )(My_Connections + Idx)->options | 1);
#line 768
  if (LogMsg) {
#line 769
    txt = LogMsg;
  } else {
#line 771
    txt = FwdMsg;
  }
#line 772
  if (! txt) {
#line 773
    txt = (char *)"Reason unknown";
  }
#line 775
  port = ng_ipaddr_getport((ng_ipaddr_t const   *)(& (My_Connections + Idx)->addr));
#line 776
  if (LogMsg) {
#line 776
    __cil_tmp = LogMsg;
  } else {
#line 776
    __cil_tmp = FwdMsg;
  }
#line 776
  Log(6, "Shutting down connection %d (%s) with %s:%d ...", Idx, __cil_tmp, (My_Connections + Idx)->host,
      port);
#line 780
  c = Conn_GetClient(Idx);
#line 783
  if (InformClient) {
#line 786
    if ((unsigned int )c != (unsigned int )((void *)0)) {
#line 786
      __cil_tmp___3 = Client_Type(c);
#line 786
      if (__cil_tmp___3 == 16) {
#line 787
        __cil_tmp___0 = Client_ID(c);
#line 787
        __cil_tmp___1 = Client_ThisServer();
#line 787
        __cil_tmp___2 = Client_ID(__cil_tmp___1);
#line 787
        Conn_WriteStr(Idx, (char *)":%s NOTICE %s :%sConnection statistics: client %.1f kb, server %.1f kb.",
                      __cil_tmp___2, __cil_tmp___0, "", (double )(My_Connections + Idx)->bytes_in / (double )1024,
                      (double )(My_Connections + Idx)->bytes_out / (double )1024);
      } else {
#line 786
        goto _L;
      }
    } else {
      _L: /* CIL Label */ ;
    }
#line 796
    if (FwdMsg) {
#line 797
      Conn_WriteStr(Idx, (char *)"ERROR :%s", FwdMsg);
    } else {
#line 799
      Conn_WriteStr(Idx, (char *)"ERROR :Closing connection.");
    }
  }
#line 806
  Handle_Write(Idx);
#line 809
  c = Conn_GetClient(Idx);
#line 812
  __cil_tmp___6 = io_close((My_Connections + Idx)->sock);
#line 812
  if (! __cil_tmp___6) {
#line 814
    __cil_tmp___4 = __errno_location();
#line 814
    __cil_tmp___5 = strerror(*__cil_tmp___4);
#line 814
    Log(2, "Error closing connection %d (socket %d) with %s:%d - %s! (ignored)", Idx,
        (My_Connections + Idx)->sock, (My_Connections + Idx)->host, port, __cil_tmp___5);
  }
#line 821
  (My_Connections + Idx)->sock = -1;
#line 824
  if (c) {
#line 825
    Client_Destroy(c, LogMsg, FwdMsg, 1);
  }
#line 828
  in_k = (double )(My_Connections + Idx)->bytes_in / (double )1024;
#line 829
  out_k = (double )(My_Connections + Idx)->bytes_out / (double )1024;
#line 852
  Log(6, "Connection %d with %s:%d closed (in: %.1fk, out: %.1fk).", Idx, (My_Connections + Idx)->host,
      port, in_k, out_k);
#line 859
  if ((My_Connections + Idx)->res_stat.resolver_fd >= 0) {
#line 860
    Resolve_Shutdown(& (My_Connections + Idx)->res_stat);
  }
#line 863
  Conf_UnsetServer(Idx);
#line 875
  array_free(& (My_Connections + Idx)->rbuf);
#line 876
  array_free(& (My_Connections + Idx)->wbuf);
#line 879
  Init_Conn_Struct(Idx);
#line 881
  LogDebug("Shutdown of connection %d completed.", Idx);
#line 882
  return;
}
}
#line 885 "conn.c"
void Conn_SyncServerStruct(void) 
{ CLIENT *client ;
  CONN_ID i ;
  int c ;
  int __cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 895
  i = 0;
#line 895
  while (i < Pool_Size) {
#line 897
    if ((My_Connections + i)->sock < 0) {
#line 898
      goto __Cont;
    }
#line 901
    client = Conn_GetClient(i);
#line 902
    if (! client) {
#line 902
      goto _L;
    } else {
#line 902
      __cil_tmp = Client_Type(client);
#line 902
      if (__cil_tmp != 32) {
        _L: /* CIL Label */ 
#line 902
        goto __Cont;
      }
    }
#line 904
    c = 0;
#line 904
    while (c < 16) {
#line 907
      if (! Conf_Server[c].host[0]) {
#line 907
        goto __Cont___0;
      }
#line 910
      __cil_tmp___0 = Client_ID(client);
#line 910
      __cil_tmp___1 = strcmp((char const   *)(Conf_Server[c].name), (char const   *)__cil_tmp___0);
#line 910
      if (__cil_tmp___1 == 0) {
#line 911
        Conf_Server[c].conn_id = i;
      }
      __Cont___0: /* CIL Label */ 
#line 904
      c ++;
    }
    __Cont: /* CIL Label */ 
#line 895
    i ++;
  }
#line 914
  return;
}
}
#line 920 "conn.c"
static int Handle_Write(CONN_ID Idx ) 
{ ssize_t len ;
  size_t wdatalen ;
  void *__cil_tmp ;
  int *__cil_tmp___0 ;
  int *__cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;

  {
#line 927
  if ((My_Connections + Idx)->sock < 0) {
#line 928
    LogDebug("Handle_Write() on closed socket, connection %d", Idx);
#line 929
    return (0);
  }
#line 933
  wdatalen = (My_Connections + Idx)->wbuf.used;
#line 947
  if (wdatalen == 0U) {
#line 949
    io_event_del((My_Connections + Idx)->sock, (short)2);
#line 950
    return (1);
  }
#line 953
  LogDebug("Handle_Write() called for connection %d, %ld bytes pending ...", Idx,
           wdatalen);
#line 957
  __cil_tmp = array_start((array const   *)(& (My_Connections + Idx)->wbuf));
#line 957
  len = write((My_Connections + Idx)->sock, (void const   *)__cil_tmp, wdatalen);
#line 960
  if (len < 0) {
#line 961
    __cil_tmp___0 = __errno_location();
#line 961
    if (*__cil_tmp___0 == 11) {
#line 961
      goto _L;
    } else {
#line 961
      __cil_tmp___1 = __errno_location();
#line 961
      if (*__cil_tmp___1 == 4) {
        _L: /* CIL Label */ 
#line 962
        return (1);
      }
    }
#line 964
    __cil_tmp___2 = __errno_location();
#line 964
    __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 964
    Log(3, "Write error on connection %d (socket %d): %s!", Idx, (My_Connections + Idx)->sock,
        __cil_tmp___3);
#line 966
    Conn_Close(Idx, (char *)"Write error!", (char *)((void *)0), 0);
#line 967
    return (0);
  }
#line 971
  array_moveleft(& (My_Connections + Idx)->wbuf, 1U, (unsigned int )len);
#line 973
  return (1);
}
}
#line 977 "conn.c"
static int Count_Connections(ng_ipaddr_t *a ) 
{ int i ;
  int cnt ;
  int __cil_tmp ;

  {
#line 982
  cnt = 0;
#line 983
  i = 0;
#line 983
  while (i < Pool_Size) {
#line 984
    if ((My_Connections + i)->sock <= -1) {
#line 985
      goto __Cont;
    }
#line 986
    __cil_tmp = ng_ipaddr_ipequal((ng_ipaddr_t const   *)(& (My_Connections + i)->addr),
                                  (ng_ipaddr_t const   *)a);
#line 986
    if (__cil_tmp) {
#line 987
      cnt ++;
    }
    __Cont: /* CIL Label */ 
#line 983
    i ++;
  }
#line 989
  return (cnt);
}
}
#line 993 "conn.c"
static int New_Connection(int Sock ) 
{ ng_ipaddr_t new_addr ;
  char ip_str[16] ;
  int new_sock ;
  int new_sock_len ;
  int new_Pool_Size ;
  CLIENT *c ;
  long cnt ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  void *__cil_tmp___4 ;
  size_t __cil_tmp___5 ;
  void *__cil_tmp___6 ;
  CONN_ID __cil_tmp___7 ;
  int __cil_tmp___8 ;
  UINT16 __cil_tmp___9 ;

  {
#line 1010
  new_sock_len = (int )sizeof(new_addr);
#line 1012
  new_sock = accept(Sock, (struct sockaddr * __restrict  )((struct sockaddr *)(& new_addr)),
                    (socklen_t * __restrict  )((socklen_t *)(& new_sock_len)));
#line 1014
  if (new_sock < 0) {
#line 1015
    __cil_tmp = __errno_location();
#line 1015
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 1015
    Log(2, "Can\'t accept connection: %s!", __cil_tmp___0);
#line 1016
    return (-1);
  }
#line 1019
  __cil_tmp___1 = ng_ipaddr_tostr_r((ng_ipaddr_t const   *)(& new_addr), ip_str);
#line 1019
  if (! __cil_tmp___1) {
#line 1020
    Log(2, "fd %d: Can\'t convert IP address!", new_sock);
#line 1021
    Simple_Message(new_sock, "ERROR :Internal Server Error");
#line 1022
    close(new_sock);
  }
#line 1038
  __cil_tmp___2 = Init_Socket(new_sock);
#line 1038
  if (! __cil_tmp___2) {
#line 1039
    return (-1);
  }
#line 1042
  __cil_tmp___3 = Count_Connections(& new_addr);
#line 1042
  cnt = (long )__cil_tmp___3;
#line 1043
  if (Conf_MaxConnectionsIP > 0 && cnt >= (long )Conf_MaxConnectionsIP) {
#line 1045
    Log(3, "Refused connection from %s: too may connections (%ld) from this IP address!",
        ip_str, cnt);
#line 1046
    Simple_Message(new_sock, "ERROR :Connection refused, too many connections from your IP address!");
#line 1047
    close(new_sock);
#line 1048
    return (-1);
  }
#line 1051
  if (new_sock >= Pool_Size) {
#line 1052
    new_Pool_Size = new_sock + 1;
#line 1054
    if ((Conf_MaxConnections > 0L && (long )Pool_Size >= Conf_MaxConnections) || new_Pool_Size < Pool_Size) {
#line 1057
      Log(1, "Can\'t accept connection: limit (%d) reached!", Pool_Size);
#line 1058
      Simple_Message(new_sock, "ERROR :Connection limit reached");
#line 1059
      close(new_sock);
#line 1060
      return (-1);
    }
#line 1063
    __cil_tmp___4 = array_alloc(& My_ConnArray, sizeof(CONNECTION ), (unsigned int )new_sock);
#line 1063
    if (! __cil_tmp___4) {
#line 1065
      Log(0, "Can\'t allocate memory! [New_Connection]");
#line 1066
      Simple_Message(new_sock, "ERROR: Internal error");
#line 1067
      close(new_sock);
#line 1068
      return (-1);
    }
#line 1070
    __cil_tmp___5 = array_length((array const   *)(& My_ConnArray), sizeof(CONNECTION ));
#line 1070
    LogDebug("Bumped connection pool to %ld items (internal: %ld items, %ld bytes)",
             new_sock, __cil_tmp___5, My_ConnArray.used);
#line 1074
    __cil_tmp___6 = array_start((array const   *)(& My_ConnArray));
#line 1074
    My_Connections = (CONNECTION *)__cil_tmp___6;
#line 1075
    while (Pool_Size < new_Pool_Size) {
#line 1076
      __cil_tmp___7 = Pool_Size;
#line 1076
      Pool_Size ++;
#line 1076
      Init_Conn_Struct(__cil_tmp___7);
    }
  }
#line 1080
  __cil_tmp___8 = io_event_create(new_sock, (short)1, & cb_clientserver);
#line 1080
  if (! __cil_tmp___8) {
#line 1081
    Log(1, "Can\'t accept connection: io_event_create failed!");
#line 1082
    Simple_Message(new_sock, "ERROR :Internal error");
#line 1083
    close(new_sock);
#line 1084
    return (-1);
  }
#line 1087
  c = Client_NewLocal(new_sock, ip_str, 1, 0);
#line 1088
  if (! c) {
#line 1089
    Log(1, "Can\'t accept connection: can\'t create client structure!");
#line 1090
    Simple_Message(new_sock, "ERROR :Internal error");
#line 1091
    io_close(new_sock);
#line 1092
    return (-1);
  }
#line 1095
  Init_Conn_Struct(new_sock);
#line 1096
  (My_Connections + new_sock)->sock = new_sock;
#line 1097
  (My_Connections + new_sock)->addr = new_addr;
#line 1098
  (My_Connections + new_sock)->client = c;
#line 1100
  __cil_tmp___9 = ng_ipaddr_getport((ng_ipaddr_t const   *)(& new_addr));
#line 1100
  Log(6, "Accepted connection %d from %s:%d on socket %d.", new_sock, ip_str, __cil_tmp___9,
      Sock);
#line 1104
  strlcpy((My_Connections + new_sock)->host, (char const   *)(ip_str), sizeof((My_Connections + new_sock)->host));
#line 1106
  Client_SetHostname(c, (My_Connections + new_sock)->host);
#line 1108
  if (! Conf_NoDNS) {
#line 1109
    Resolve_Addr(& (My_Connections + new_sock)->res_stat, (ng_ipaddr_t const   *)(& new_addr),
                 (My_Connections + new_sock)->sock, & cb_Read_Resolver_Result);
  }
#line 1112
  Conn_SetPenalty(new_sock, 4L);
#line 1113
  return (new_sock);
}
}
#line 1117 "conn.c"
static CONN_ID Socket2Index(int Sock ) 
{ 

  {
#line 1124
  if (Sock >= Pool_Size || (My_Connections + Sock)->sock != Sock) {
#line 1127
    LogDebug("Socket2Index: can\'t get connection for socket %d!", Sock);
#line 1128
    return (-1);
  }
#line 1130
  return (Sock);
}
}
#line 1138 "conn.c"
static void Read_Request(CONN_ID Idx ) 
{ ssize_t len ;
  char readbuf[2048] ;
  CLIENT *c ;
  char const   *__cil_tmp ;
  UINT16 __cil_tmp___0 ;
  int *__cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;

  {
#line 1151
  if ((My_Connections + Idx)->rbuf.used >= 2048U) {
#line 1155
    Log(3, "Receive buffer overflow (connection %d): %d bytes!", Idx, (My_Connections + Idx)->rbuf.used);
#line 1158
    Conn_Close(Idx, (char *)"Receive buffer overflow!", (char *)((void *)0), 0);
#line 1159
    return;
  }
#line 1162
  len = read((My_Connections + Idx)->sock, (void *)(readbuf), sizeof(readbuf));
#line 1163
  if (len == 0) {
#line 1164
    __cil_tmp = ng_ipaddr_tostr((ng_ipaddr_t const   *)(& (My_Connections + Idx)->addr));
#line 1164
    __cil_tmp___0 = ng_ipaddr_getport((ng_ipaddr_t const   *)(& (My_Connections + Idx)->addr));
#line 1164
    Log(6, "%s:%u (%s) is closing the connection ...", (My_Connections + Idx)->host,
        (unsigned int )__cil_tmp___0, __cil_tmp);
#line 1168
    Conn_Close(Idx, (char *)"Socket closed!", (char *)"Client closed connection",
               0);
#line 1171
    return;
  }
#line 1174
  if (len < 0) {
#line 1175
    __cil_tmp___1 = __errno_location();
#line 1175
    if (*__cil_tmp___1 == 11) {
#line 1175
      return;
    }
#line 1176
    __cil_tmp___2 = __errno_location();
#line 1176
    __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 1176
    Log(3, "Read error on connection %d (socket %d): %s!", Idx, (My_Connections + Idx)->sock,
        __cil_tmp___3);
#line 1178
    Conn_Close(Idx, (char *)"Read error!", (char *)"Client closed connection", 0);
#line 1180
    return;
  }
#line 1196
  __cil_tmp___4 = array_catb(& (My_Connections + Idx)->rbuf, (char const   *)(readbuf),
                             (unsigned int )len);
#line 1196
  if (! __cil_tmp___4) {
#line 1197
    Log(3, "Could not append recieved data to input buffer (connn %d): %d bytes!",
        Idx, len);
#line 1198
    Conn_Close(Idx, (char *)"Receive buffer overflow!", (char *)((void *)0), 0);
  }
#line 1203
  (My_Connections + Idx)->bytes_in += (long )len;
#line 1210
  c = Conn_GetClient(Idx);
#line 1211
  if (c) {
#line 1211
    __cil_tmp___5 = Client_Type(c);
#line 1211
    if (__cil_tmp___5 == 16) {
#line 1211
      goto _L___1;
    } else {
#line 1211
      __cil_tmp___6 = Client_Type(c);
#line 1211
      if (__cil_tmp___6 == 32) {
        _L___1: /* CIL Label */ 
#line 1211
        goto _L___0;
      } else {
#line 1211
        __cil_tmp___7 = Client_Type(c);
#line 1211
        if (__cil_tmp___7 == 64) {
          _L___0: /* CIL Label */ 
#line 1214
          (My_Connections + Idx)->lastdata = time((time_t *)((void *)0));
#line 1215
          (My_Connections + Idx)->lastping = (My_Connections + Idx)->lastdata;
        } else {
#line 1211
          goto _L;
        }
      }
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 1219
  Handle_Buffer(Idx);
#line 1220
  return;
}
}
#line 1223 "conn.c"
static int Handle_Buffer(CONN_ID Idx ) 
{ char *ptr1 ;
  char *ptr2 ;
  char *ptr ;
  size_t len ;
  size_t delta ;
  int result ;
  time_t starttime ;
  int __cil_tmp ;
  void *__cil_tmp___0 ;
  void *__cil_tmp___1 ;
  void *__cil_tmp___2 ;
  void *__cil_tmp___3 ;
  void *__cil_tmp___4 ;
  int __cil_tmp___5 ;

  {
#line 1239
  starttime = time((time_t *)((void *)0));
#line 1240
  result = 0;
#line 1241
  while (1) {
#line 1243
    if ((My_Connections + Idx)->delaytime > starttime) {
#line 1243
      return (result);
    }
#line 1250
    if (0U == (My_Connections + Idx)->rbuf.used) {
#line 1251
      break;
    }
#line 1253
    __cil_tmp = array_cat0_temporary(& (My_Connections + Idx)->rbuf);
#line 1253
    if (! __cil_tmp) {
#line 1254
      return (0);
    }
#line 1257
    __cil_tmp___0 = array_start((array const   *)(& (My_Connections + Idx)->rbuf));
#line 1257
    ptr = strstr((char const   *)__cil_tmp___0, "\r\n");
#line 1259
    if (ptr) {
#line 1259
      delta = 2U;
    } else {
#line 1264
      __cil_tmp___1 = array_start((array const   *)(& (My_Connections + Idx)->rbuf));
#line 1264
      ptr1 = strchr((char const   *)__cil_tmp___1, '\r');
#line 1265
      __cil_tmp___2 = array_start((array const   *)(& (My_Connections + Idx)->rbuf));
#line 1265
      ptr2 = strchr((char const   *)__cil_tmp___2, '\n');
#line 1266
      delta = 1U;
#line 1267
      if ((int )ptr1 && (int )ptr2) {
#line 1267
        if ((unsigned int )ptr1 > (unsigned int )ptr2) {
#line 1267
          ptr = ptr2;
        } else {
#line 1267
          ptr = ptr1;
        }
      } else {
#line 1268
        if (ptr1) {
#line 1268
          ptr = ptr1;
        } else {
#line 1269
          if (ptr2) {
#line 1269
            ptr = ptr2;
          }
        }
      }
    }
#line 1273
    if (! ptr) {
#line 1274
      break;
    }
#line 1277
    *ptr = (char )'\000';
#line 1279
    __cil_tmp___3 = array_start((array const   *)(& (My_Connections + Idx)->rbuf));
#line 1279
    len = (size_t )(ptr - (char *)__cil_tmp___3) + delta;
#line 1281
    if (len > 512U) {
#line 1284
      Log(3, "Request too long (connection %d): %d bytes (max. %d expected)!", Idx,
          (My_Connections + Idx)->rbuf.used, 512);
#line 1286
      Conn_Close(Idx, (char *)((void *)0), (char *)"Request too long", 1);
#line 1287
      return (0);
    }
#line 1290
    if (len <= 2U) {
#line 1291
      array_moveleft(& (My_Connections + Idx)->rbuf, 1U, delta);
#line 1292
      break;
    }
#line 1299
    ((My_Connections + Idx)->msg_in) ++;
#line 1300
    __cil_tmp___4 = array_start((array const   *)(& (My_Connections + Idx)->rbuf));
#line 1300
    __cil_tmp___5 = Parse_Request(Idx, (char *)__cil_tmp___4);
#line 1300
    if (! __cil_tmp___5) {
#line 1301
      return (0);
    }
#line 1303
    result = 1;
#line 1305
    array_moveleft(& (My_Connections + Idx)->rbuf, 1U, len);
#line 1306
    LogDebug("Connection %d: %d bytes left in read buffer.", Idx, (My_Connections + Idx)->rbuf.used);
  }
#line 1324
  return (result);
}
}
#line 1328 "conn.c"
static void Check_Connections(void) 
{ CLIENT *c ;
  CONN_ID i ;
  time_t __cil_tmp ;
  CLIENT *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  time_t __cil_tmp___2 ;
  time_t __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 1336
  i = 0;
#line 1336
  while (i < Pool_Size) {
#line 1337
    if ((My_Connections + i)->sock < 0) {
#line 1338
      goto __Cont;
    }
#line 1340
    c = Conn_GetClient(i);
#line 1341
    if (c) {
#line 1341
      __cil_tmp___4 = Client_Type(c);
#line 1341
      if (__cil_tmp___4 == 16) {
#line 1341
        goto _L___1;
      } else {
#line 1341
        __cil_tmp___5 = Client_Type(c);
#line 1341
        if (__cil_tmp___5 == 32) {
          _L___1: /* CIL Label */ 
#line 1341
          goto _L___0;
        } else {
#line 1341
          __cil_tmp___6 = Client_Type(c);
#line 1341
          if (__cil_tmp___6 == 64) {
            _L___0: /* CIL Label */ 
#line 1345
            if ((My_Connections + i)->lastping > (My_Connections + i)->lastdata) {
#line 1348
              __cil_tmp = time((time_t *)((void *)0));
#line 1348
              if ((My_Connections + i)->lastping < __cil_tmp - (time_t )Conf_PongTimeout) {
#line 1351
                LogDebug("Connection %d: Ping timeout: %d seconds.", i, Conf_PongTimeout);
#line 1354
                Conn_Close(i, (char *)((void *)0), (char *)"Ping timeout", 1);
              }
            } else {
#line 1357
              __cil_tmp___2 = time((time_t *)((void *)0));
#line 1357
              if ((My_Connections + i)->lastdata < __cil_tmp___2 - (time_t )Conf_PingTimeout) {
#line 1360
                LogDebug("Connection %d: sending PING ...", i);
#line 1361
                (My_Connections + i)->lastping = time((time_t *)((void *)0));
#line 1362
                __cil_tmp___0 = Client_ThisServer();
#line 1362
                __cil_tmp___1 = Client_ID(__cil_tmp___0);
#line 1362
                Conn_WriteStr(i, (char *)"PING :%s", __cil_tmp___1);
              }
            }
          } else {
#line 1341
            goto _L;
          }
        }
      }
    } else {
      _L: /* CIL Label */ 
#line 1371
      __cil_tmp___3 = time((time_t *)((void *)0));
#line 1371
      if ((My_Connections + i)->lastdata < __cil_tmp___3 - (time_t )Conf_PongTimeout) {
#line 1373
        LogDebug("Unregistered connection %d timed out ...", i);
#line 1376
        Conn_Close(i, (char *)((void *)0), (char *)"Timeout", 0);
      }
    }
    __Cont: /* CIL Label */ 
#line 1336
    i ++;
  }
#line 1380
  return;
}
}
#line 1383 "conn.c"
static void Check_Servers(void) 
{ int i ;
  int n ;
  time_t time_now ;

  {
#line 1392
  i = 0;
#line 1392
  while (i < 16) {
#line 1394
    if (((! Conf_Server[i].host[0] || ! Conf_Server[i].port > 0) || Conf_Server[i].conn_id > -1) || Conf_Server[i].flags & 2) {
#line 1396
      goto __Cont;
    }
#line 1399
    if (Conf_Server[i].group > -1) {
#line 1400
      n = 0;
#line 1400
      while (n < 16) {
#line 1401
        if (n == i) {
#line 1401
          goto __Cont___0;
        }
#line 1402
        if (Conf_Server[n].conn_id != -1 && Conf_Server[n].group == Conf_Server[i].group) {
#line 1404
          break;
        }
        __Cont___0: /* CIL Label */ 
#line 1400
        n ++;
      }
#line 1406
      if (n < 16) {
#line 1406
        goto __Cont;
      }
    }
#line 1410
    time_now = time((time_t *)((void *)0));
#line 1411
    if (Conf_Server[i].lasttry > time_now - (time_t )Conf_ConnectRetry) {
#line 1412
      goto __Cont;
    }
#line 1415
    Conf_Server[i].lasttry = time_now;
#line 1416
    Conf_Server[i].conn_id = -2;
#line 1418
    Resolve_Name(& Conf_Server[i].res_stat, (char const   *)(Conf_Server[i].host),
                 & cb_Connect_to_Server);
    __Cont: /* CIL Label */ 
#line 1392
    i ++;
  }
#line 1420
  return;
}
}
#line 1423 "conn.c"
static void New_Server___0(int Server , ng_ipaddr_t *dest ) 
{ char ip_str[16] ;
  int af_dest ;
  int res ;
  int new_sock ;
  CLIENT *c ;
  int __cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  socklen_t __cil_tmp___5 ;
  int __cil_tmp___6 ;
  socklen_t __cil_tmp___7 ;
  int *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int *__cil_tmp___10 ;
  void *__cil_tmp___11 ;
  void *__cil_tmp___12 ;
  int *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;

  {
#line 1433
  __cil_tmp = ng_ipaddr_tostr_r((ng_ipaddr_t const   *)dest, ip_str);
#line 1433
  if (! __cil_tmp) {
#line 1434
    Log(4, "New_Server: Could not convert IP to string");
#line 1435
    return;
  }
#line 1438
  Log(6, "Establishing connection to \"%s\", %s, port %d ... ", Conf_Server[Server].host,
      ip_str, Conf_Server[Server].port);
#line 1441
  af_dest = ng_ipaddr_af((ng_ipaddr_t const   *)dest);
#line 1442
  new_sock = socket(af_dest, 1, 0);
#line 1443
  if (new_sock < 0) {
#line 1444
    __cil_tmp___0 = __errno_location();
#line 1444
    __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 1444
    Log(2, "Can\'t create socket: %s!", __cil_tmp___1);
#line 1445
    return;
  }
#line 1448
  __cil_tmp___2 = Init_Socket(new_sock);
#line 1448
  if (! __cil_tmp___2) {
#line 1449
    return;
  }
#line 1452
  res = ng_ipaddr_af((ng_ipaddr_t const   *)(& Conf_Server[Server].bind_addr));
#line 1454
  if (res) {
#line 1454
    __cil_tmp___5 = ng_ipaddr_salen((ng_ipaddr_t const   *)(& Conf_Server[Server].bind_addr));
#line 1454
    __cil_tmp___6 = bind(new_sock, (struct sockaddr  const  *)((struct sockaddr *)(& Conf_Server[Server].bind_addr)),
                         __cil_tmp___5);
#line 1454
    if (__cil_tmp___6) {
#line 1457
      ng_ipaddr_tostr_r((ng_ipaddr_t const   *)(& Conf_Server[Server].bind_addr),
                        ip_str);
#line 1458
      __cil_tmp___3 = __errno_location();
#line 1458
      __cil_tmp___4 = strerror(*__cil_tmp___3);
#line 1458
      Log(4, "Can\'t bind socket to %s: %s!", ip_str, __cil_tmp___4);
    } else {
#line 1454
      goto _L;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 1460
  ng_ipaddr_setport(dest, Conf_Server[Server].port);
#line 1461
  __cil_tmp___7 = ng_ipaddr_salen((ng_ipaddr_t const   *)dest);
#line 1461
  res = connect(new_sock, (struct sockaddr  const  *)((struct sockaddr *)dest), __cil_tmp___7);
#line 1462
  if (res != 0) {
#line 1462
    __cil_tmp___10 = __errno_location();
#line 1462
    if (*__cil_tmp___10 != 115) {
#line 1463
      __cil_tmp___8 = __errno_location();
#line 1463
      __cil_tmp___9 = strerror(*__cil_tmp___8);
#line 1463
      Log(2, "Can\'t connect socket: %s!", __cil_tmp___9);
#line 1464
      close(new_sock);
#line 1465
      return;
    } else {
#line 1462
      goto _L___0;
    }
  } else {
    _L___0: /* CIL Label */ ;
  }
#line 1468
  __cil_tmp___11 = array_alloc(& My_ConnArray, sizeof(CONNECTION ), (unsigned int )new_sock);
#line 1468
  if (! __cil_tmp___11) {
#line 1469
    Log(1, "Cannot allocate memory for server connection (socket %d)", new_sock);
#line 1472
    close(new_sock);
#line 1473
    return;
  }
#line 1476
  __cil_tmp___12 = array_start((array const   *)(& My_ConnArray));
#line 1476
  My_Connections = (CONNECTION *)__cil_tmp___12;
#line 1480
  Init_Conn_Struct(new_sock);
#line 1482
  ng_ipaddr_tostr_r((ng_ipaddr_t const   *)dest, ip_str);
#line 1483
  c = Client_NewLocal(new_sock, ip_str, 128, 0);
#line 1484
  if (! c) {
#line 1485
    Log(1, "Can\'t establish connection: can\'t create client structure!");
#line 1486
    close(new_sock);
#line 1487
    return;
  }
#line 1490
  Client_SetIntroducer(c, c);
#line 1491
  Client_SetToken(c, -2);
#line 1494
  Conf_Server[Server].conn_id = new_sock;
#line 1495
  (My_Connections + new_sock)->sock = new_sock;
#line 1496
  (My_Connections + new_sock)->addr = *dest;
#line 1497
  (My_Connections + new_sock)->client = c;
#line 1498
  strlcpy((My_Connections + new_sock)->host, (char const   *)(Conf_Server[Server].host),
          sizeof((My_Connections + new_sock)->host));
#line 1502
  __cil_tmp___15 = io_event_create(new_sock, (short)2, & cb_connserver);
#line 1502
  if (! __cil_tmp___15) {
#line 1503
    __cil_tmp___13 = __errno_location();
#line 1503
    __cil_tmp___14 = strerror(*__cil_tmp___13);
#line 1503
    Log(1, "io_event_create(): could not add fd %d", __cil_tmp___14);
#line 1504
    Conn_Close(new_sock, (char *)"io_event_create() failed", (char *)((void *)0),
               0);
#line 1505
    Init_Conn_Struct(new_sock);
#line 1506
    Conf_Server[Server].conn_id = -1;
  }
#line 1509
  LogDebug("Registered new connection %d on socket %d.", new_sock, (My_Connections + new_sock)->sock);
#line 1511
  (My_Connections + new_sock)->options = (unsigned short )((int )(My_Connections + new_sock)->options | 2);
#line 1512
  return;
}
}
#line 1518 "conn.c"
static void Init_Conn_Struct(CONN_ID Idx ) 
{ time_t now ;
  time_t __cil_tmp ;

  {
#line 1521
  __cil_tmp = time((time_t *)((void *)0));
#line 1521
  now = __cil_tmp;
#line 1523
  memset((void *)(My_Connections + Idx), 0, sizeof(CONNECTION ));
#line 1524
  (My_Connections + Idx)->sock = -1;
#line 1525
  (My_Connections + Idx)->signon = now;
#line 1526
  (My_Connections + Idx)->lastdata = now;
#line 1527
  (My_Connections + Idx)->lastprivmsg = now;
#line 1528
  Resolve_Init(& (My_Connections + Idx)->res_stat);
#line 1529
  return;
}
}
#line 1532 "conn.c"
static int Init_Socket(int Sock ) 
{ int value ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;

  {
#line 1539
  __cil_tmp___1 = io_setnonblock(Sock);
#line 1539
  if (! __cil_tmp___1) {
#line 1540
    __cil_tmp = __errno_location();
#line 1540
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 1540
    Log(2, "Can\'t enable non-blocking mode for socket: %s!", __cil_tmp___0);
#line 1541
    close(Sock);
#line 1542
    return (0);
  }
#line 1546
  value = 1;
#line 1547
  __cil_tmp___4 = setsockopt(Sock, 1, 2, (void const   *)(& value), sizeof(value));
#line 1547
  if (__cil_tmp___4 != 0) {
#line 1549
    __cil_tmp___2 = __errno_location();
#line 1549
    __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 1549
    Log(3, "Can\'t set socket option SO_REUSEADDR: %s!", __cil_tmp___3);
  }
#line 1564
  return (1);
}
}
#line 1569 "conn.c"
static void cb_Connect_to_Server(int fd , short events  __attribute__((__unused__)) ) 
{ int i ;
  size_t len ;
  ng_ipaddr_t dest_addrs[4] ;

  {
#line 1579
  LogDebug("Resolver: Got forward lookup callback on fd %d, events %d", fd, events);
#line 1581
  i = 0;
#line 1581
  while (i < 16) {
#line 1582
    if (Conf_Server[i].res_stat.resolver_fd == fd) {
#line 1583
      break;
    }
#line 1581
    i ++;
  }
#line 1586
  if (i >= 16) {
#line 1588
    io_close(fd);
#line 1589
    LogDebug("Resolver: Got Forward Lookup callback for unknown server!?");
#line 1590
    return;
  }
#line 1594
  len = Resolve_Read(& Conf_Server[i].res_stat, (void *)(dest_addrs), sizeof(dest_addrs));
#line 1595
  if (len == 0U) {
#line 1596
    return;
  }
#line 1600
  LogDebug("Got result from resolver: %u structs (%u bytes).", len / sizeof(ng_ipaddr_t ),
           len);
#line 1602
  memset((void *)(& Conf_Server[i].dst_addr), 0, sizeof(& Conf_Server[i].dst_addr));
#line 1603
  if (len > sizeof(ng_ipaddr_t )) {
#line 1606
    len -= sizeof(ng_ipaddr_t );
#line 1607
    if (len > sizeof(& Conf_Server[i].dst_addr)) {
#line 1608
      len = sizeof(& Conf_Server[i].dst_addr);
#line 1609
      Log(5, "Notice: Resolver returned more IP Addresses for host than we can handle, additional addresses dropped");
    }
#line 1612
    memcpy((void * __restrict  )(& Conf_Server[i].dst_addr), (void const   * __restrict  )(& dest_addrs[1]),
           len);
  }
#line 1615
  New_Server___0(i, dest_addrs);
#line 1616
  return;
}
}
#line 1619 "conn.c"
static void cb_Read_Resolver_Result(int r_fd , short events  __attribute__((__unused__)) ) 
{ CLIENT *c ;
  int i ;
  size_t len ;
  char *identptr ;
  char readbuf[257] ;
  int __cil_tmp ;

  {
#line 1636
  LogDebug("Resolver: Got callback on fd %d, events %d", r_fd, events);
#line 1639
  i = 0;
#line 1639
  while (i < Pool_Size) {
#line 1640
    if ((My_Connections + i)->sock != -1 && (My_Connections + i)->res_stat.resolver_fd == r_fd) {
#line 1642
      break;
    }
#line 1639
    i ++;
  }
#line 1644
  if (i >= Pool_Size) {
#line 1647
    io_close(r_fd);
#line 1648
    LogDebug("Resolver: Got callback for unknown connection!?");
#line 1649
    return;
  }
#line 1653
  len = Resolve_Read(& (My_Connections + i)->res_stat, (void *)(readbuf), sizeof(readbuf) - 1U);
#line 1654
  if (len == 0U) {
#line 1655
    return;
  }
#line 1657
  readbuf[len] = (char )'\000';
#line 1658
  identptr = strchr((char const   *)(readbuf), '\n');
#line 1660
  if (! identptr) {
#line 1661
    Log(2, "Resolver: Got malformed result!");
#line 1662
    return;
  }
#line 1665
  *identptr = (char )'\000';
#line 1666
  LogDebug("Got result from resolver: \"%s\" (%u bytes read).", readbuf, len);
#line 1672
  c = Conn_GetClient(i);
#line 1676
  __cil_tmp = Client_Type(c);
#line 1676
  if (__cil_tmp == 1) {
#line 1677
    strlcpy((My_Connections + i)->host, (char const   *)(readbuf), sizeof((My_Connections + i)->host));
#line 1678
    Client_SetHostname(c, readbuf);
  }
#line 1693
  Conn_ResetPenalty(i);
#line 1694
  return;
}
}
#line 1697 "conn.c"
static void Simple_Message(int Sock , char const   *Msg ) 
{ char buf[513] ;
  size_t len ;

  {
#line 1708
  strlcpy(buf, Msg, sizeof(buf) - 2U);
#line 1709
  len = strlcat(buf, "\r\n", sizeof(buf));
#line 1710
  write(Sock, (void const   *)(buf), len);
#line 1711
  return;
}
}
#line 1714 "conn.c"
CLIENT *Conn_GetClient(CONN_ID Idx ) 
{ CONNECTION *c ;
  void *__cil_tmp ;
  CLIENT *__cil_tmp___0 ;

  {
#line 1723
  __cil_tmp = array_get(& My_ConnArray, sizeof(CONNECTION ), (unsigned int )Idx);
#line 1723
  c = (CONNECTION *)__cil_tmp;
#line 1727
  if (c) {
#line 1727
    __cil_tmp___0 = c->client;
  } else {
#line 1727
    __cil_tmp___0 = (CLIENT *)((void *)0);
  }
#line 1727
  return (__cil_tmp___0);
}
}
#line 1 "conn-func.o"
#pragma merger(0,"/tmp/cil-jFrWhK7D.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 30 "conn-func.h"
time_t Conn_GetSignon(CONN_ID Idx ) ;
#line 31
time_t Conn_GetIdle(CONN_ID Idx ) ;
#line 32
time_t Conn_LastPing(CONN_ID Idx ) ;
#line 33
time_t Conn_StartTime(CONN_ID Idx ) ;
#line 34
size_t Conn_SendQ(CONN_ID Idx ) ;
#line 35
size_t Conn_RecvQ(CONN_ID Idx ) ;
#line 36
long Conn_SendMsg(CONN_ID Idx ) ;
#line 37
long Conn_RecvMsg(CONN_ID Idx ) ;
#line 38
long Conn_SendBytes(CONN_ID Idx ) ;
#line 39
long Conn_RecvBytes(CONN_ID Idx ) ;
#line 44
void Conn_ClearFlags(void) ;
#line 45
int Conn_Flag(CONN_ID Idx ) ;
#line 46
void Conn_SetFlag(CONN_ID Idx , int Flag ) ;
#line 48
CONN_ID Conn_First(void) ;
#line 49
CONN_ID Conn_Next(CONN_ID Idx ) ;
#line 51
UINT16 Conn_Options(CONN_ID Idx ) ;
#line 53
void Conn_ResetWCounter(void) ;
#line 54
long Conn_WCounter(void) ;
#line 33 "conn-func.c"
void Conn_UpdateIdle(CONN_ID Idx ) 
{ 

  {
#line 39
  (My_Connections + Idx)->lastprivmsg = time((time_t *)((void *)0));
#line 40
  return;
}
}
#line 46 "conn-func.c"
time_t Conn_GetSignon(CONN_ID Idx ) 
{ 

  {
#line 50
  return ((My_Connections + Idx)->signon);
}
}
#line 53 "conn-func.c"
time_t Conn_GetIdle(CONN_ID Idx ) 
{ time_t __cil_tmp ;

  {
#line 59
  __cil_tmp = time((time_t *)((void *)0));
#line 59
  return (__cil_tmp - (My_Connections + Idx)->lastprivmsg);
}
}
#line 63 "conn-func.c"
time_t Conn_LastPing(CONN_ID Idx ) 
{ 

  {
#line 69
  return ((My_Connections + Idx)->lastping);
}
}
#line 73 "conn-func.c"
void Conn_SetPenalty(CONN_ID Idx , time_t Seconds ) 
{ time_t t ;
  time_t __cil_tmp ;

  {
#line 86
  __cil_tmp = time((time_t *)((void *)0));
#line 86
  t = __cil_tmp + Seconds;
#line 87
  if (t > (My_Connections + Idx)->delaytime) {
#line 88
    (My_Connections + Idx)->delaytime = t;
  }
#line 94
  return;
}
}
#line 97 "conn-func.c"
void Conn_ResetPenalty(CONN_ID Idx ) 
{ 

  {
#line 101
  (My_Connections + Idx)->delaytime = 0L;
#line 102
  return;
}
}
#line 105 "conn-func.c"
void Conn_ClearFlags(void) 
{ CONN_ID i ;

  {
#line 112
  i = 0;
#line 112
  while (i < Pool_Size) {
#line 112
    (My_Connections + i)->flag = 0;
#line 112
    i ++;
  }
#line 113
  return;
}
}
#line 116 "conn-func.c"
int Conn_Flag(CONN_ID Idx ) 
{ 

  {
#line 122
  return ((My_Connections + Idx)->flag);
}
}
#line 126 "conn-func.c"
void Conn_SetFlag(CONN_ID Idx , int Flag ) 
{ 

  {
#line 132
  (My_Connections + Idx)->flag = Flag;
#line 133
  return;
}
}
#line 136 "conn-func.c"
CONN_ID Conn_First(void) 
{ CONN_ID i ;

  {
#line 144
  i = 0;
#line 144
  while (i < Pool_Size) {
#line 146
    if ((My_Connections + i)->sock != -1) {
#line 146
      return (i);
    }
#line 144
    i ++;
  }
#line 148
  return (-1);
}
}
#line 152 "conn-func.c"
CONN_ID Conn_Next(CONN_ID Idx ) 
{ CONN_ID i ;

  {
#line 158
  i = -1;
#line 162
  i = Idx + 1;
#line 162
  while (i < Pool_Size) {
#line 164
    if ((My_Connections + i)->sock != -1) {
#line 164
      return (i);
    }
#line 162
    i ++;
  }
#line 166
  return (-1);
}
}
#line 170 "conn-func.c"
UINT16 Conn_Options(CONN_ID Idx ) 
{ 

  {
#line 174
  return ((My_Connections + Idx)->options);
}
}
#line 183 "conn-func.c"
time_t Conn_StartTime(CONN_ID Idx ) 
{ CLIENT *c ;
  time_t __cil_tmp ;

  {
#line 191
  c = Conn_GetClient(Idx);
#line 192
  if ((unsigned int )c != (unsigned int )((void *)0)) {
#line 193
    __cil_tmp = Client_StartTime(c);
#line 193
    return (__cil_tmp);
  }
#line 195
  return (0L);
}
}
#line 199 "conn-func.c"
size_t Conn_SendQ(CONN_ID Idx ) 
{ 

  {
#line 210
  return ((My_Connections + Idx)->wbuf.used);
}
}
#line 214 "conn-func.c"
long Conn_SendMsg(CONN_ID Idx ) 
{ 

  {
#line 220
  return ((My_Connections + Idx)->msg_out);
}
}
#line 224 "conn-func.c"
long Conn_SendBytes(CONN_ID Idx ) 
{ 

  {
#line 230
  return ((My_Connections + Idx)->bytes_out);
}
}
#line 234 "conn-func.c"
size_t Conn_RecvQ(CONN_ID Idx ) 
{ 

  {
#line 245
  return ((My_Connections + Idx)->rbuf.used);
}
}
#line 249 "conn-func.c"
long Conn_RecvMsg(CONN_ID Idx ) 
{ 

  {
#line 255
  return ((My_Connections + Idx)->msg_in);
}
}
#line 259 "conn-func.c"
long Conn_RecvBytes(CONN_ID Idx ) 
{ 

  {
#line 265
  return ((My_Connections + Idx)->bytes_in);
}
}
#line 269 "conn-func.c"
void Conn_ResetWCounter(void) 
{ 

  {
#line 272
  WCounter = 0L;
#line 273
  return;
}
}
#line 276 "conn-func.c"
long Conn_WCounter(void) 
{ 

  {
#line 279
  return (WCounter);
}
}
#line 1 "conn-zip.o"
#pragma merger(0,"/tmp/cil-XRktTWPY.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 1 "hash.o"
#pragma merger(0,"/tmp/cil-meTlh4Gv.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 33 "hash.c"
UINT32 Hash(char const   *String ) 
{ 

  {
#line 44
  return (0U);
}
}
#line 1 "io.o"
#pragma merger(0,"/tmp/cil-BbuzpXiR.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 63 "/usr/include/fcntl.h"
extern int fcntl(int __fd , int __cmd  , ...) ;
#line 69 "io.c"
static int library_initialized  =    0;
#line 48 "/usr/include/sys/poll.h"
extern int poll(struct pollfd *__fds , nfds_t __nfds , int __timeout ) ;
#line 92 "io.c"
static array pollfds  ;
#line 93 "io.c"
static int poll_maxfd  ;
#line 95
static int io_event_change_poll(int fd , short what ) ;
#line 125 "io.c"
static array io_events  ;
#line 127
static void io_docallback(int fd , short what ) ;
#line 135 "io.c"
__inline static void io_debug(char const   *s  __attribute__((__unused__)) , int a  __attribute__((__unused__)) ,
                              int b  __attribute__((__unused__)) ) 
{ 

  {
#line 135
  return;
}
}
#line 138 "io.c"
static io_event *io_event_get(int fd ) 
{ io_event *i ;
  void *__cil_tmp ;

  {
#line 145
  __cil_tmp = array_get(& io_events, sizeof(io_event ), (unsigned int )fd);
#line 145
  i = (io_event *)__cil_tmp;
#line 149
  return (i);
}
}
#line 230 "io.c"
__inline static void io_close_devpoll(int x  __attribute__((__unused__)) ) 
{ 

  {
#line 230
  return;
}
}
#line 231 "io.c"
__inline static void io_library_init_devpoll(unsigned int ev  __attribute__((__unused__)) ) 
{ 

  {
#line 231
  return;
}
}
#line 236 "io.c"
static int io_dispatch_poll(struct timeval *tv ) 
{ time_t sec ;
  int i ;
  int ret ;
  int timeout ;
  int fds_ready ;
  short what ;
  struct pollfd *p ;
  void *__cil_tmp ;

  {
#line 239
  sec = tv->tv_sec * 1000L;
#line 240
  timeout = (int )(tv->tv_usec + sec);
#line 243
  __cil_tmp = array_start((array const   *)(& pollfds));
#line 243
  p = (struct pollfd *)__cil_tmp;
#line 245
  if (timeout < 0) {
#line 246
    timeout = 1000;
  }
#line 248
  ret = poll(p, (unsigned long )(poll_maxfd + 1), timeout);
#line 249
  if (ret <= 0) {
#line 250
    return (ret);
  }
#line 252
  fds_ready = ret;
#line 253
  i = 0;
#line 253
  while (i <= poll_maxfd) {
#line 254
    what = (short)0;
#line 255
    if ((int )(p + i)->revents & 3) {
#line 256
      what = (short)1;
    }
#line 258
    if ((int )(p + i)->revents & 4) {
#line 259
      what = (short )((int )what | 2);
    }
#line 261
    if ((int )(p + i)->revents && ! what) {
#line 263
      what = (short)4;
    }
#line 265
    if (what) {
#line 266
      fds_ready --;
#line 267
      io_docallback(i, what);
    }
#line 269
    if (fds_ready <= 0) {
#line 270
      break;
    }
#line 253
    i ++;
  }
#line 273
  return (ret);
}
}
#line 276 "io.c"
static int io_event_change_poll(int fd , short what ) 
{ struct pollfd *p ;
  short events ;
  void *__cil_tmp ;

  {
#line 280
  events = (short)0;
#line 282
  if ((int )what & 1) {
#line 283
    events = (short)3;
  }
#line 284
  if ((int )what & 2) {
#line 285
    events = (short )((int )events | 4);
  }
#line 287
  __cil_tmp = array_alloc(& pollfds, sizeof(*p), (unsigned int )fd);
#line 287
  p = (struct pollfd *)__cil_tmp;
#line 288
  if (p) {
#line 289
    p->events = events;
#line 290
    p->fd = fd;
#line 291
    if (fd > poll_maxfd) {
#line 292
      poll_maxfd = fd;
    }
  }
#line 294
  return ((unsigned int )p != (unsigned int )((void *)0));
}
}
#line 297 "io.c"
static void io_close_poll(int fd ) 
{ struct pollfd *p ;
  void *__cil_tmp ;
  void *__cil_tmp___0 ;

  {
#line 301
  __cil_tmp = array_get(& pollfds, sizeof(*p), (unsigned int )fd);
#line 301
  p = (struct pollfd *)__cil_tmp;
#line 302
  if (! p) {
#line 302
    return;
  }
#line 304
  p->fd = -1;
#line 305
  if (fd == poll_maxfd) {
#line 306
    while (poll_maxfd > 0) {
#line 307
      poll_maxfd --;
#line 308
      __cil_tmp___0 = array_get(& pollfds, sizeof(*p), (unsigned int )poll_maxfd);
#line 308
      p = (struct pollfd *)__cil_tmp___0;
#line 309
      if ((int )p && p->fd >= 0) {
#line 310
        break;
      }
    }
  }
#line 313
  return;
}
}
#line 315 "io.c"
static void io_library_init_poll(unsigned int eventsize ) 
{ struct pollfd *p ;
  void *__cil_tmp ;
  unsigned int i ;
  void *__cil_tmp___0 ;

  {
#line 319
  array_init(& pollfds);
#line 320
  poll_maxfd = 0;
#line 321
  Log(6, "IO subsystem: poll (initial maxfd %u).", eventsize);
#line 323
  __cil_tmp = array_alloc(& pollfds, sizeof(struct pollfd ), eventsize);
#line 323
  p = (struct pollfd *)__cil_tmp;
#line 324
  if (p) {
#line 326
    __cil_tmp___0 = array_start((array const   *)(& pollfds));
#line 326
    p = (struct pollfd *)__cil_tmp___0;
#line 327
    i = 0U;
#line 327
    while (i < eventsize) {
#line 328
      (p + i)->fd = -1;
#line 327
      i ++;
    }
#line 330
    library_initialized = 1;
  }
#line 332
  return;
}
}
#line 627 "io.c"
int io_library_init(unsigned int eventsize ) 
{ void *__cil_tmp ;

  {
#line 630
  if (library_initialized) {
#line 631
    return (1);
  }
#line 633
  if (eventsize > 0U) {
#line 633
    __cil_tmp = array_alloc(& io_events, sizeof(io_event ), eventsize);
#line 633
    if (__cil_tmp) {
#line 633
      goto _L;
    } else {
#line 634
      eventsize = 0U;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 636
  io_library_init_devpoll(eventsize);
#line 637
  io_library_init_devpoll(eventsize);
#line 638
  io_library_init_devpoll(eventsize);
#line 639
  io_library_init_poll(eventsize);
#line 640
  io_close_devpoll((int )eventsize);
#line 642
  return (library_initialized);
}
}
#line 646 "io.c"
void io_library_shutdown(void) 
{ 

  {
#line 661
  library_initialized = 0;
#line 662
  return;
}
}
#line 665 "io.c"
int io_event_setcb(int fd , void (*cbfunc)(int  , short  ) ) 
{ io_event *i ;
  io_event *__cil_tmp ;

  {
#line 668
  __cil_tmp = io_event_get(fd);
#line 668
  i = __cil_tmp;
#line 669
  if (! i) {
#line 670
    return (0);
  }
#line 672
  i->callback = cbfunc;
#line 673
  return (1);
}
}
#line 677 "io.c"
static int backend_create_ev(int fd , short what ) 
{ int ret ;

  {
#line 685
  ret = io_event_change_poll(fd, what);
#line 697
  return (ret);
}
}
#line 701 "io.c"
int io_event_create(int fd , short what , void (*cbfunc)(int  , short  ) ) 
{ int ret ;
  io_event *i ;
  void *__cil_tmp ;

  {
#line 716
  __cil_tmp = array_alloc(& io_events, sizeof(io_event ), (unsigned int )fd);
#line 716
  i = (io_event *)__cil_tmp;
#line 717
  if (! i) {
#line 718
    Log(4, "array_alloc failed: could not allocate space for %d io_event structures",
        fd);
#line 721
    return (0);
  }
#line 724
  i->callback = cbfunc;
#line 725
  i->what = (short)0;
#line 726
  ret = backend_create_ev(fd, what);
#line 727
  if (ret) {
#line 728
    i->what = what;
  }
#line 729
  return (ret);
}
}
#line 733 "io.c"
int io_event_add(int fd , short what ) 
{ io_event *i ;
  io_event *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 736
  __cil_tmp = io_event_get(fd);
#line 736
  i = __cil_tmp;
#line 738
  if (! i) {
#line 738
    return (0);
  }
#line 740
  if (((int )i->what & (int )what) == (int )what) {
#line 741
    return (1);
  }
#line 743
  io_debug("io_event_add: fd, what", fd, (int )what);
#line 745
  i->what = (short )((int )i->what | (int )what);
#line 757
  __cil_tmp___0 = io_event_change_poll(fd, i->what);
#line 757
  return (__cil_tmp___0);
#line 770
  return (0);
}
}
#line 774 "io.c"
int io_setnonblock(int fd ) 
{ int flags ;
  int __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 777
  __cil_tmp = fcntl(fd, 3);
#line 777
  flags = __cil_tmp;
#line 778
  if (flags == -1) {
#line 779
    return (0);
  }
#line 783
  flags |= 2048;
#line 785
  __cil_tmp___0 = fcntl(fd, 4, flags);
#line 785
  return (__cil_tmp___0 == 0);
}
}
#line 789 "io.c"
int io_close(int fd ) 
{ io_event *i ;
  int __cil_tmp ;

  {
#line 794
  i = io_event_get(fd);
#line 807
  io_close_devpoll(fd);
#line 808
  io_close_poll(fd);
#line 809
  io_close_devpoll(fd);
#line 813
  if (i) {
#line 814
    i->callback = (void (*)(int  , short  ))((void *)0);
#line 815
    i->what = (short)0;
  }
#line 817
  __cil_tmp = close(fd);
#line 817
  return (__cil_tmp == 0);
}
}
#line 821 "io.c"
int io_event_del(int fd , short what ) 
{ io_event *i ;
  io_event *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 824
  __cil_tmp = io_event_get(fd);
#line 824
  i = __cil_tmp;
#line 826
  io_debug("io_event_del: trying to delete eventtype; fd, what", fd, (int )what);
#line 827
  if (! i) {
#line 827
    return (0);
  }
#line 829
  if (! ((int )i->what & (int )what)) {
#line 830
    return (1);
  }
#line 832
  i->what = (short )((int )i->what & ~ ((int )what));
#line 837
  __cil_tmp___0 = io_event_change_poll(fd, i->what);
#line 837
  return (__cil_tmp___0);
#line 854
  return (0);
}
}
#line 858 "io.c"
int io_dispatch(struct timeval *tv ) 
{ int __cil_tmp ;

  {
#line 875
  __cil_tmp = io_dispatch_poll(tv);
#line 875
  return (__cil_tmp);
#line 877
  return (-1);
}
}
#line 882 "io.c"
static void io_docallback(int fd , short what ) 
{ io_event *i ;
  io_event *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 885
  __cil_tmp = io_event_get(fd);
#line 885
  i = __cil_tmp;
#line 887
  io_debug("io_docallback; fd, what", fd, (int )what);
#line 889
  if (i->callback) {
#line 891
    if ((int )what & 4) {
#line 891
      __cil_tmp___0 = (int )i->what;
    } else {
#line 891
      __cil_tmp___0 = (int )what;
    }
#line 891
    (*(i->callback))(fd, (short )__cil_tmp___0);
  }
#line 894
  return;
}
}
#line 1 "irc.o"
#pragma merger(0,"/tmp/cil-Tjr85nbE.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 33 "irc-write.h"
void IRC_SetPenalty(CLIENT *Client , time_t Seconds ) ;
#line 43 "parse.h"
COMMAND *Parse_GetCommandStruct(void) ;
#line 21 "irc.h"
int IRC_ERROR(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_KILL(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_NOTICE(CLIENT *Client , REQUEST *Req ) ;
#line 24
int IRC_PRIVMSG(CLIENT *Client , REQUEST *Req ) ;
#line 25
int IRC_TRACE(CLIENT *Client , REQUEST *Req ) ;
#line 26
int IRC_HELP(CLIENT *Client , REQUEST *Req ) ;
#line 40 "irc.c"
static char *Option_String(CONN_ID Idx ) ;
#line 43 "irc.c"
int IRC_ERROR(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  char *__cil_tmp___0 ;

  {
#line 49
  if (Req->argc < 1) {
#line 49
    __cil_tmp = Client_Mask(Client);
#line 49
    Log(5, "Got ERROR from \"%s\"!", __cil_tmp);
  } else {
#line 50
    __cil_tmp___0 = Client_Mask(Client);
#line 50
    Log(5, "Got ERROR from \"%s\": %s!", __cil_tmp___0, Req->argv[0]);
  }
#line 52
  return (1);
}
}
#line 64 "irc.c"
int IRC_KILL(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *prefix ;
  CLIENT *c ;
  char reason[513] ;
  char *msg ;
  CONN_ID my_conn ;
  CONN_ID conn ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  CLIENT *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  CLIENT *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  int __cil_tmp___15 ;
  CLIENT *__cil_tmp___16 ;

  {
#line 74
  __cil_tmp___1 = Client_Type(Client);
#line 74
  if (__cil_tmp___1 != 32) {
#line 74
    __cil_tmp___2 = Client_OperByMe(Client);
#line 74
    if (__cil_tmp___2) {
#line 74
      goto _L;
    } else {
#line 79
      __cil_tmp = Client_ID(Client);
#line 79
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 79
      return (__cil_tmp___0);
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 83
  if (Req->argc != 2) {
#line 86
    __cil_tmp___3 = Client_ID(Client);
#line 86
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 86
    return (__cil_tmp___4);
  }
#line 90
  if (Req->prefix) {
#line 90
    prefix = Client_Search(Req->prefix);
  } else {
#line 91
    prefix = Client;
  }
#line 92
  if (! prefix) {
#line 94
    Log(4, "Got KILL with invalid prefix: \"%s\"!", Req->prefix);
#line 96
    prefix = Client_ThisServer();
  }
#line 99
  __cil_tmp___6 = Client_ThisServer();
#line 99
  if ((unsigned int )Client != (unsigned int )__cil_tmp___6) {
#line 102
    __cil_tmp___5 = Client_Mask(prefix);
#line 102
    Log(1029, "Got KILL command from \"%s\" for \"%s\": %s", __cil_tmp___5, Req->argv[0],
        Req->argv[1]);
  }
#line 107
  __cil_tmp___8 = Client_Type(Client);
#line 107
  if (__cil_tmp___8 == 16) {
#line 111
    __cil_tmp___7 = Client_ID(Client);
#line 111
    snprintf((char * __restrict  )(reason), sizeof(reason), (char const   * __restrict  )"KILLed by %s: %s",
             __cil_tmp___7, Req->argv[1]);
  } else {
#line 115
    strlcpy(reason, (char const   *)Req->argv[1], sizeof(reason));
  }
#line 118
  IRC_WriteStrServersPrefix(Client, prefix, (char *)"KILL %s :%s", Req->argv[0], reason);
#line 122
  my_conn = Client_Conn(Client);
#line 125
  c = Client_Search(Req->argv[0]);
#line 126
  if (c) {
#line 128
    __cil_tmp___14 = Client_Type(c);
#line 128
    if (__cil_tmp___14 != 16) {
#line 128
      __cil_tmp___15 = Client_Type(c);
#line 128
      if (__cil_tmp___15 != 4) {
#line 137
        __cil_tmp___12 = Client_ThisServer();
#line 137
        if ((unsigned int )Client != (unsigned int )__cil_tmp___12) {
#line 140
          __cil_tmp___9 = Client_Type(c);
#line 140
          if (__cil_tmp___9 == 32) {
#line 141
            msg = (char *)"483 %s :You can\'t kill a server!";
          } else {
#line 143
            msg = (char *)"481 %s :Permission denied";
          }
#line 144
          __cil_tmp___10 = Client_ID(Client);
#line 144
          __cil_tmp___11 = IRC_WriteStrClient(Client, msg, __cil_tmp___10);
#line 144
          return (__cil_tmp___11);
        }
#line 148
        __cil_tmp___13 = Client_Type(c);
#line 148
        Log(3, "Got KILL for invalid client type: %d, \"%s\"!", __cil_tmp___13, Req->argv[0]);
      } else {
#line 128
        goto _L___0;
      }
    } else {
      _L___0: /* CIL Label */ ;
    }
#line 153
    conn = Client_Conn(c);
#line 154
    Client_Destroy(c, (char *)((void *)0), reason, 0);
#line 155
    if (conn > -1) {
#line 156
      Conn_Close(conn, (char *)((void *)0), reason, 1);
    }
  } else {
#line 159
    Log(5, "Client with nick \"%s\" is unknown here.", Req->argv[0]);
  }
#line 162
  if (my_conn > -1) {
#line 162
    __cil_tmp___16 = Conn_GetClient(my_conn);
#line 162
    if (__cil_tmp___16) {
#line 163
      return (1);
    } else {
#line 162
      goto _L___1;
    }
  } else {
    _L___1: /* CIL Label */ 
#line 165
    return (0);
  }
}
}
#line 169 "irc.c"
int IRC_NOTICE(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *to ;
  CLIENT *from ;
  CHANNEL *chan ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;

  {
#line 178
  __cil_tmp = Client_Type(Client);
#line 178
  if (__cil_tmp != 16) {
#line 178
    __cil_tmp___0 = Client_Type(Client);
#line 178
    if (__cil_tmp___0 != 32) {
#line 178
      return (1);
    } else {
#line 178
      goto _L;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 181
  if (Req->argc != 2) {
#line 181
    return (1);
  }
#line 183
  __cil_tmp___1 = Client_Type(Client);
#line 183
  if (__cil_tmp___1 == 32) {
#line 183
    from = Client_Search(Req->prefix);
  } else {
#line 184
    from = Client;
  }
#line 185
  if (! from) {
#line 185
    __cil_tmp___2 = Client_ID(Client);
#line 185
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 185
    return (__cil_tmp___3);
  }
#line 187
  to = Client_Search(Req->argv[0]);
#line 188
  if (to) {
#line 188
    __cil_tmp___7 = Client_Type(to);
#line 188
    if (__cil_tmp___7 == 16) {
#line 191
      __cil_tmp___4 = Client_ID(to);
#line 191
      __cil_tmp___5 = IRC_WriteStrClientPrefix(to, from, (char *)"NOTICE %s :%s",
                                               __cil_tmp___4, Req->argv[1]);
#line 191
      return (__cil_tmp___5);
    } else {
#line 188
      goto _L___0;
    }
  } else {
    _L___0: /* CIL Label */ 
#line 195
    chan = Channel_Search((char const   *)Req->argv[0]);
#line 196
    if (chan) {
#line 197
      __cil_tmp___6 = Channel_Notice(chan, from, Client, (char const   *)Req->argv[1]);
#line 197
      return (__cil_tmp___6);
    }
  }
#line 200
  return (1);
}
}
#line 204 "irc.c"
int IRC_PRIVMSG(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *cl ;
  CLIENT *from ;
  CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  int __cil_tmp___10 ;
  char *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  char *__cil_tmp___13 ;
  int __cil_tmp___14 ;
  int __cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  CONN_ID __cil_tmp___18 ;
  CONN_ID __cil_tmp___19 ;
  char *__cil_tmp___20 ;
  int __cil_tmp___21 ;
  int __cil_tmp___22 ;
  char *__cil_tmp___23 ;
  int __cil_tmp___24 ;

  {
#line 214
  if (Req->argc == 0) {
#line 214
    __cil_tmp = Client_ID(Client);
#line 214
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"411 %s :No receipient given (%s)",
                                       __cil_tmp, Req->command);
#line 214
    return (__cil_tmp___0);
  }
#line 215
  if (Req->argc == 1) {
#line 215
    __cil_tmp___1 = Client_ID(Client);
#line 215
    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"412 %s :No text to send",
                                       __cil_tmp___1);
#line 215
    return (__cil_tmp___2);
  }
#line 216
  if (Req->argc > 2) {
#line 216
    __cil_tmp___3 = Client_ID(Client);
#line 216
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 216
    return (__cil_tmp___4);
  }
#line 218
  __cil_tmp___5 = Client_Type(Client);
#line 218
  if (__cil_tmp___5 == 32) {
#line 218
    from = Client_Search(Req->prefix);
  } else {
#line 219
    from = Client;
  }
#line 220
  if (! from) {
#line 220
    __cil_tmp___6 = Client_ID(Client);
#line 220
    __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___6, Req->prefix);
#line 220
    return (__cil_tmp___7);
  }
#line 222
  cl = Client_Search(Req->argv[0]);
#line 223
  if (cl) {
#line 226
    __cil_tmp___10 = Client_Type(cl);
#line 226
    if (__cil_tmp___10 != 16) {
#line 226
      __cil_tmp___8 = Client_ID(from);
#line 226
      __cil_tmp___9 = IRC_WriteStrClient(from, (char *)"401 %s %s :No such nick or channel name",
                                         __cil_tmp___8, Req->argv[0]);
#line 226
      return (__cil_tmp___9);
    }
#line 229
    __cil_tmp___15 = Client_Type(Client);
#line 229
    if (__cil_tmp___15 != 32) {
#line 229
      __cil_tmp___16 = Client_Modes(cl);
#line 229
      __cil_tmp___17 = strchr((char const   *)__cil_tmp___16, 'a');
#line 229
      if (__cil_tmp___17) {
#line 232
        __cil_tmp___11 = Client_Away(cl);
#line 232
        __cil_tmp___12 = Client_ID(cl);
#line 232
        __cil_tmp___13 = Client_ID(from);
#line 232
        __cil_tmp___14 = IRC_WriteStrClient(from, (char *)"301 %s %s :%s", __cil_tmp___13,
                                            __cil_tmp___12, __cil_tmp___11);
#line 232
        if (! __cil_tmp___14) {
#line 232
          return (0);
        }
      } else {
#line 229
        goto _L;
      }
    } else {
      _L: /* CIL Label */ ;
    }
#line 236
    __cil_tmp___19 = Client_Conn(from);
#line 236
    if (__cil_tmp___19 > -1) {
#line 236
      __cil_tmp___18 = Client_Conn(from);
#line 236
      Conn_UpdateIdle(__cil_tmp___18);
    }
#line 237
    __cil_tmp___20 = Client_ID(cl);
#line 237
    __cil_tmp___21 = IRC_WriteStrClientPrefix(cl, from, (char *)"PRIVMSG %s :%s",
                                              __cil_tmp___20, Req->argv[1]);
#line 237
    return (__cil_tmp___21);
  }
#line 240
  chan = Channel_Search((char const   *)Req->argv[0]);
#line 241
  if (chan) {
#line 241
    __cil_tmp___22 = Channel_Write(chan, from, Client, (char const   *)Req->argv[1]);
#line 241
    return (__cil_tmp___22);
  }
#line 243
  __cil_tmp___23 = Client_ID(from);
#line 243
  __cil_tmp___24 = IRC_WriteStrClient(from, (char *)"401 %s %s :No such nick or channel name",
                                      __cil_tmp___23, Req->argv[0]);
#line 243
  return (__cil_tmp___24);
}
}
#line 247 "irc.c"
int IRC_TRACE(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *from ;
  CLIENT *target ;
  CLIENT *c ;
  CONN_ID idx ;
  CONN_ID idx2 ;
  char user[10] ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  size_t __cil_tmp___8 ;
  size_t __cil_tmp___9 ;
  time_t __cil_tmp___10 ;
  time_t __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  CLIENT *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  CLIENT *__cil_tmp___18 ;
  char *__cil_tmp___19 ;
  CONN_ID __cil_tmp___20 ;
  char *__cil_tmp___21 ;
  CLIENT *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  char *__cil_tmp___24 ;
  char *__cil_tmp___25 ;
  char *__cil_tmp___26 ;
  int __cil_tmp___27 ;
  int __cil_tmp___28 ;
  char *__cil_tmp___29 ;
  char *__cil_tmp___30 ;
  int __cil_tmp___31 ;
  int __cil_tmp___32 ;
  char *__cil_tmp___33 ;
  char *__cil_tmp___34 ;
  CONN_ID __cil_tmp___35 ;
  char *__cil_tmp___36 ;
  int __cil_tmp___37 ;

  {
#line 258
  if (Req->argc > 1) {
#line 258
    __cil_tmp = Client_ID(Client);
#line 258
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"411 %s :No receipient given (%s)",
                                       __cil_tmp, Req->command);
#line 258
    return (__cil_tmp___0);
  }
#line 261
  __cil_tmp___1 = Client_Type(Client);
#line 261
  if (__cil_tmp___1 == 32) {
#line 261
    from = Client_Search(Req->prefix);
  } else {
#line 262
    from = Client;
  }
#line 263
  if (! from) {
#line 263
    __cil_tmp___2 = Client_ID(Client);
#line 263
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 263
    return (__cil_tmp___3);
  }
#line 266
  if (Req->argc == 1) {
#line 266
    target = Client_Search(Req->argv[0]);
  } else {
#line 267
    target = Client_ThisServer();
  }
#line 270
  __cil_tmp___18 = Client_ThisServer();
#line 270
  if ((unsigned int )target != (unsigned int )__cil_tmp___18) {
#line 272
    if (! target) {
#line 272
      goto _L;
    } else {
#line 272
      __cil_tmp___6 = Client_Type(target);
#line 272
      if (__cil_tmp___6 != 32) {
        _L: /* CIL Label */ 
#line 272
        __cil_tmp___4 = Client_ID(from);
#line 272
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 272
        return (__cil_tmp___5);
      }
    }
#line 275
    idx = Client_Conn(Client);
#line 276
    __cil_tmp___7 = Client_NextHop(target);
#line 276
    idx2 = Client_Conn(__cil_tmp___7);
#line 277
    __cil_tmp___8 = Conn_SendQ(idx2);
#line 277
    __cil_tmp___9 = Conn_SendQ(idx);
#line 277
    __cil_tmp___10 = time((time_t *)((void *)0));
#line 277
    __cil_tmp___11 = Conn_StartTime(idx2);
#line 277
    __cil_tmp___12 = Option_String(idx2);
#line 277
    __cil_tmp___13 = Client_NextHop(target);
#line 277
    __cil_tmp___14 = Client_ID(__cil_tmp___13);
#line 277
    __cil_tmp___15 = Client_ID(target);
#line 277
    __cil_tmp___16 = Client_ID(from);
#line 277
    __cil_tmp___17 = IRC_WriteStrClient(from, (char *)"200 %s Link %s-%s %s %s V%s %ld %d %d",
                                        __cil_tmp___16, "ngircd", "0.12.0", __cil_tmp___15,
                                        __cil_tmp___14, __cil_tmp___12, __cil_tmp___10 - __cil_tmp___11,
                                        __cil_tmp___9, __cil_tmp___8);
#line 277
    if (! __cil_tmp___17) {
#line 277
      return (0);
    }
#line 280
    IRC_WriteStrClientPrefix(target, from, (char *)"TRACE %s", Req->argv[0]);
#line 281
    return (1);
  }
#line 285
  c = Client_First();
#line 286
  while (c) {
#line 288
    __cil_tmp___35 = Client_Conn(c);
#line 288
    if (__cil_tmp___35 > -1) {
#line 291
      __cil_tmp___28 = Client_Type(c);
#line 291
      if (__cil_tmp___28 == 32) {
#line 294
        __cil_tmp___19 = Client_User(c);
#line 294
        strlcpy(user, (char const   *)__cil_tmp___19, sizeof(user));
#line 295
        if ((int )user[0] == 126) {
#line 295
          strlcpy(user, "unknown", sizeof(user));
        }
#line 296
        __cil_tmp___20 = Client_Conn(c);
#line 296
        __cil_tmp___21 = Option_String(__cil_tmp___20);
#line 296
        __cil_tmp___22 = Client_ThisServer();
#line 296
        __cil_tmp___23 = Client_Mask(__cil_tmp___22);
#line 296
        __cil_tmp___24 = Client_Hostname(c);
#line 296
        __cil_tmp___25 = Client_ID(c);
#line 296
        __cil_tmp___26 = Client_ID(from);
#line 296
        __cil_tmp___27 = IRC_WriteStrClient(from, (char *)"206 %s Serv 1 0S 0C %s[%s@%s] *!*@%s :V%s",
                                            __cil_tmp___26, __cil_tmp___25, user,
                                            __cil_tmp___24, __cil_tmp___23, __cil_tmp___21);
#line 296
        if (! __cil_tmp___27) {
#line 296
          return (0);
        }
      }
#line 298
      __cil_tmp___32 = Client_Type(c);
#line 298
      if (__cil_tmp___32 == 16) {
#line 298
        __cil_tmp___33 = Client_Modes(c);
#line 298
        __cil_tmp___34 = strchr((char const   *)__cil_tmp___33, 'o');
#line 298
        if (__cil_tmp___34) {
#line 301
          __cil_tmp___29 = Client_ID(c);
#line 301
          __cil_tmp___30 = Client_ID(from);
#line 301
          __cil_tmp___31 = IRC_WriteStrClient(from, (char *)"204 %s Oper 2 :%s", __cil_tmp___30,
                                              __cil_tmp___29);
#line 301
          if (! __cil_tmp___31) {
#line 301
            return (0);
          }
        } else {
#line 298
          goto _L___0;
        }
      } else {
        _L___0: /* CIL Label */ ;
      }
    }
#line 304
    c = Client_Next(c);
  }
#line 307
  IRC_SetPenalty(Client, 3L);
#line 308
  __cil_tmp___36 = Client_ID(from);
#line 308
  __cil_tmp___37 = IRC_WriteStrClient(from, (char *)"262 %s %s %s-%s.%s :End of TRACE",
                                      __cil_tmp___36, Conf_ServerName, "ngircd", "0.12.0",
                                      NGIRCd_DebugLevel);
#line 308
  return (__cil_tmp___37);
}
}
#line 312 "irc.c"
int IRC_HELP(CLIENT *Client , REQUEST *Req ) 
{ COMMAND *cmd ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 321
  if (Req->argc > 0) {
#line 321
    __cil_tmp = Client_ID(Client);
#line 321
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"411 %s :No receipient given (%s)",
                                       __cil_tmp, Req->command);
#line 321
    return (__cil_tmp___0);
  }
#line 323
  cmd = Parse_GetCommandStruct();
#line 324
  while (cmd->name) {
#line 326
    __cil_tmp___1 = Client_ID(Client);
#line 326
    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"NOTICE %s :%s", __cil_tmp___1,
                                       cmd->name);
#line 326
    if (! __cil_tmp___2) {
#line 326
      return (0);
    }
#line 327
    cmd ++;
  }
#line 330
  IRC_SetPenalty(Client, 2L);
#line 331
  return (1);
}
}
#line 338 "irc.c"
static char option_txt[8]  ;
#line 335 "irc.c"
static char *Option_String(CONN_ID Idx ) 
{ UINT16 options ;

  {
#line 341
  options = Conn_Options(Idx);
#line 343
  strcpy((char * __restrict  )(option_txt), (char const   * __restrict  )"F");
#line 350
  return (option_txt);
}
}
#line 1 "irc-channel.o"
#pragma merger(0,"/tmp/cil-B1yOTfTQ.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 102 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) int strncmp(char const   *__s1 , char const   *__s2 ,
                                                 size_t __n )  __attribute__((__pure__,
__nonnull__(1,2))) ;
#line 21 "match.h"
int Match(char const   *Pattern , char const   *String ) ;
#line 39 "irc-info.h"
int IRC_Send_NAMES(CLIENT *Client , CHANNEL *Chan ) ;
#line 29 "irc-write.h"
void IRC_WriteStrServersPrefixFlag(CLIENT *ExceptOf , CLIENT *Prefix , char Flag ,
                                   char *Format  , ...) ;
#line 21 "irc-channel.h"
int IRC_JOIN(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_PART(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_TOPIC(CLIENT *Client , REQUEST *Req ) ;
#line 25
int IRC_LIST(CLIENT *Client , REQUEST *Req ) ;
#line 27
int IRC_CHANINFO(CLIENT *Client , REQUEST *Req ) ;
#line 51 "irc-channel.c"
static int part_from_all_channels(CLIENT *client , CLIENT *target ) 
{ CL2CHAN *cl2chan ;
  CHANNEL *chan ;
  char *__cil_tmp ;
  char const   *__cil_tmp___0 ;

  {
#line 57
  while (1) {
#line 57
    cl2chan = Channel_FirstChannelOf(target);
#line 57
    if (! cl2chan) {
#line 57
      break;
    }
#line 58
    chan = Channel_GetChannel(cl2chan);
#line 60
    __cil_tmp = Client_ID(target);
#line 60
    __cil_tmp___0 = Channel_Name((CHANNEL const   *)chan);
#line 60
    Channel_Part(target, client, __cil_tmp___0, (char const   *)__cil_tmp);
  }
#line 62
  return (1);
}
}
#line 66 "irc-channel.c"
static int join_allowed(CLIENT *Client , CLIENT *target , CHANNEL *chan , char const   *channame ,
                        char const   *key ) 
{ int is_invited ;
  int is_banned ;
  char const   *channel_modes ;
  struct list_head *__cil_tmp ;
  struct list_head *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char const   *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  unsigned long __cil_tmp___12 ;
  unsigned long __cil_tmp___13 ;

  {
#line 73
  __cil_tmp = Channel_GetListBans(chan);
#line 73
  is_banned = Lists_Check(__cil_tmp, target);
#line 74
  __cil_tmp___0 = Channel_GetListInvites(chan);
#line 74
  is_invited = Lists_Check(__cil_tmp___0, target);
#line 76
  if (is_banned && ! is_invited) {
#line 77
    __cil_tmp___1 = Client_ID(Client);
#line 77
    IRC_WriteStrClient(Client, (char *)"474 %s %s :Cannot join channel (+b)", __cil_tmp___1,
                       channame);
#line 78
    return (0);
  }
#line 81
  __cil_tmp___2 = Channel_Modes(chan);
#line 81
  channel_modes = (char const   *)__cil_tmp___2;
#line 82
  __cil_tmp___4 = strchr(channel_modes, 'i');
#line 82
  if ((int )__cil_tmp___4 && ! is_invited) {
#line 84
    __cil_tmp___3 = Client_ID(Client);
#line 84
    IRC_WriteStrClient(Client, (char *)"473 %s %s :Cannot join channel (+i)", __cil_tmp___3,
                       channame);
#line 85
    return (0);
  }
#line 89
  __cil_tmp___6 = strchr(channel_modes, 'k');
#line 89
  if (__cil_tmp___6) {
#line 89
    if (key) {
#line 89
      __cil_tmp___7 = key;
    } else {
#line 89
      __cil_tmp___7 = "";
    }
#line 89
    __cil_tmp___8 = Channel_Key(chan);
#line 89
    __cil_tmp___9 = strcmp((char const   *)__cil_tmp___8, __cil_tmp___7);
#line 89
    if (__cil_tmp___9) {
#line 92
      __cil_tmp___5 = Client_ID(Client);
#line 92
      IRC_WriteStrClient(Client, (char *)"475 %s %s :Cannot join channel (+k)", __cil_tmp___5,
                         channame);
#line 93
      return (0);
    } else {
#line 89
      goto _L;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 96
  __cil_tmp___11 = strchr(channel_modes, 'l');
#line 96
  if (__cil_tmp___11) {
#line 96
    __cil_tmp___12 = Channel_MaxUsers(chan);
#line 96
    __cil_tmp___13 = Channel_MemberCount(chan);
#line 96
    if (__cil_tmp___12 <= __cil_tmp___13) {
#line 97
      __cil_tmp___10 = Client_ID(Client);
#line 97
      IRC_WriteStrClient(Client, (char *)"471 %s %s :Cannot join channel (+l)", __cil_tmp___10,
                         channame);
#line 98
      return (0);
    } else {
#line 96
      goto _L___0;
    }
  } else {
    _L___0: /* CIL Label */ ;
  }
#line 100
  return (1);
}
}
#line 104 "irc-channel.c"
static void join_set_channelmodes(CHANNEL *chan , CLIENT *target , char const   *flags ) 
{ char *__cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;

  {
#line 107
  if (flags) {
#line 108
    while (*flags) {
#line 109
      Channel_UserModeAdd(chan, target, (char )*flags);
#line 110
      flags ++;
    }
  }
#line 115
  __cil_tmp = Channel_Modes(chan);
#line 115
  __cil_tmp___0 = strchr((char const   *)__cil_tmp, 'P');
#line 115
  if (__cil_tmp___0) {
#line 115
    __cil_tmp___1 = Client_Modes(target);
#line 115
    __cil_tmp___2 = strchr((char const   *)__cil_tmp___1, 'o');
#line 115
    if (__cil_tmp___2) {
#line 116
      Channel_UserModeAdd(chan, target, (char )'o');
    } else {
#line 115
      goto _L;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 117
  return;
}
}
#line 120 "irc-channel.c"
static void join_forward(CLIENT *Client , CLIENT *target , CHANNEL *chan , char const   *channame ) 
{ char modes[8] ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;

  {
#line 126
  __cil_tmp = Channel_UserModes(chan, target);
#line 126
  strlcpy(& modes[1], (char const   *)__cil_tmp, sizeof(modes) - 1U);
#line 128
  if (modes[1]) {
#line 129
    modes[0] = (char)7;
  } else {
#line 131
    modes[0] = (char )'\000';
  }
#line 133
  IRC_WriteStrServersPrefix(Client, target, (char *)"JOIN :%s%s", channame, modes);
#line 136
  IRC_WriteStrChannelPrefix(Client, chan, target, 0, (char *)"JOIN :%s", channame);
#line 137
  if (modes[1]) {
#line 138
    __cil_tmp___0 = Client_ID(target);
#line 138
    IRC_WriteStrChannelPrefix(Client, chan, target, 0, (char *)"MODE %s +%s %s", channame,
                              & modes[1], __cil_tmp___0);
  }
#line 140
  return;
}
}
#line 143 "irc-channel.c"
static int join_send_topic(CLIENT *Client , CLIENT *target , CHANNEL *chan , char const   *channame ) 
{ char const   *topic ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  unsigned int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  char const   *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;

  {
#line 149
  __cil_tmp = Client_Type(Client);
#line 149
  if (__cil_tmp != 16) {
#line 150
    return (1);
  }
#line 152
  __cil_tmp___0 = IRC_WriteStrClientPrefix(Client, target, (char *)"JOIN :%s", channame);
#line 152
  if (! __cil_tmp___0) {
#line 153
    return (0);
  }
#line 156
  __cil_tmp___1 = Channel_Topic(chan);
#line 156
  topic = (char const   *)__cil_tmp___1;
#line 158
  if (*topic) {
#line 159
    __cil_tmp___2 = Client_ID(Client);
#line 159
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"332 %s %s :%s", __cil_tmp___2,
                                       channame, topic);
#line 159
    if (! __cil_tmp___3) {
#line 161
      return (0);
    }
#line 163
    __cil_tmp___4 = Channel_TopicTime(chan);
#line 163
    __cil_tmp___5 = Channel_TopicWho(chan);
#line 163
    __cil_tmp___6 = Client_ID(Client);
#line 163
    __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"333 %s %s %s %u", __cil_tmp___6,
                                       channame, __cil_tmp___5, __cil_tmp___4);
#line 163
    if (! __cil_tmp___7) {
#line 167
      return (0);
    }
  }
#line 171
  __cil_tmp___8 = IRC_Send_NAMES(Client, chan);
#line 171
  if (! __cil_tmp___8) {
#line 172
    return (0);
  }
#line 173
  __cil_tmp___9 = Channel_Name((CHANNEL const   *)chan);
#line 173
  __cil_tmp___10 = Client_ID(Client);
#line 173
  __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"366 %s %s :End of NAMES list",
                                      __cil_tmp___10, __cil_tmp___9);
#line 173
  return (__cil_tmp___11);
}
}
#line 177 "irc-channel.c"
int IRC_JOIN(CLIENT *Client , REQUEST *Req ) 
{ char *channame ;
  char *channame_ptr ;
  char *key ;
  char *key_ptr ;
  char *flags ;
  CLIENT *target ;
  CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  int __cil_tmp___10 ;
  int __cil_tmp___11 ;
  struct list_head *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  int __cil_tmp___15 ;

  {
#line 188
  if (Req->argc < 1 || Req->argc > 2) {
#line 189
    __cil_tmp = Client_ID(Client);
#line 189
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 189
    return (__cil_tmp___0);
  }
#line 193
  __cil_tmp___1 = Client_Type(Client);
#line 193
  if (__cil_tmp___1 == 32) {
#line 194
    target = Client_Search(Req->prefix);
  } else {
#line 196
    target = Client;
  }
#line 198
  if (! target) {
#line 199
    __cil_tmp___2 = Client_ID(Client);
#line 199
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 199
    return (__cil_tmp___3);
  }
#line 202
  if (Req->argc == 1) {
#line 202
    __cil_tmp___5 = strncmp("0", (char const   *)Req->argv[0], 2U);
#line 202
    if (__cil_tmp___5) {
#line 202
      goto _L;
    } else {
#line 203
      __cil_tmp___4 = part_from_all_channels(Client, target);
#line 203
      return (__cil_tmp___4);
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 206
  if (Req->argc > 1) {
#line 207
    key = Req->argv[1];
#line 208
    key_ptr = strchr((char const   *)key, ',');
#line 209
    if (key_ptr) {
#line 209
      *key_ptr = (char )'\000';
    }
  } else {
#line 211
    key_ptr = (char *)((void *)0);
#line 211
    key = key_ptr;
  }
#line 213
  channame = Req->argv[0];
#line 214
  channame_ptr = strchr((char const   *)channame, ',');
#line 215
  if (channame_ptr) {
#line 215
    *channame_ptr = (char )'\000';
  }
#line 217
  while (channame) {
#line 218
    flags = (char *)((void *)0);
#line 221
    __cil_tmp___6 = Client_Type(Client);
#line 221
    if (__cil_tmp___6 == 32) {
#line 222
      flags = strchr((char const   *)channame, 7);
#line 223
      if (flags) {
#line 224
        *flags = (char )'\000';
#line 225
        flags ++;
      }
    }
#line 229
    chan = Channel_Search((char const   *)channame);
#line 230
    if (! chan && Conf_PredefChannelsOnly) {
#line 232
      __cil_tmp___7 = Client_ID(Client);
#line 232
      IRC_WriteStrClient(Client, (char *)"474 %s %s :Cannot join channel (+b)", __cil_tmp___7,
                         channame);
#line 233
      break;
    }
#line 237
    __cil_tmp___13 = Client_Type(Client);
#line 237
    if (__cil_tmp___13 == 16) {
#line 239
      if (Conf_MaxJoins > 0) {
#line 239
        __cil_tmp___10 = Channel_CountForUser(Client);
#line 239
        if (__cil_tmp___10 >= Conf_MaxJoins) {
#line 240
          __cil_tmp___8 = Client_ID(Client);
#line 240
          __cil_tmp___9 = IRC_WriteStrClient(Client, (char *)"405 %s %s :You have joined too many channels",
                                             __cil_tmp___8, channame);
#line 240
          return (__cil_tmp___9);
        } else {
#line 239
          goto _L___0;
        }
      } else {
        _L___0: /* CIL Label */ ;
      }
#line 242
      if (! chan) {
#line 243
        flags = (char *)"o";
      } else {
#line 245
        __cil_tmp___11 = join_allowed(Client, target, chan, (char const   *)channame,
                                      (char const   *)key);
#line 245
        if (! __cil_tmp___11) {
#line 246
          break;
        }
      }
    } else {
#line 253
      if (chan) {
#line 253
        __cil_tmp___12 = Channel_GetListInvites(chan);
#line 253
        Lists_Check(__cil_tmp___12, target);
      }
    }
#line 257
    __cil_tmp___14 = Channel_Join(target, channame);
#line 257
    if (! __cil_tmp___14) {
#line 258
      break;
    }
#line 260
    if (! chan) {
#line 261
      chan = Channel_Search((char const   *)channame);
    }
#line 264
    join_set_channelmodes(chan, target, (char const   *)flags);
#line 266
    join_forward(Client, target, chan, (char const   *)channame);
#line 268
    __cil_tmp___15 = join_send_topic(Client, target, chan, (char const   *)channame);
#line 268
    if (! __cil_tmp___15) {
#line 269
      break;
    }
#line 272
    channame = channame_ptr;
#line 273
    if (channame) {
#line 274
      channame ++;
#line 275
      channame_ptr = strchr((char const   *)channame, ',');
#line 276
      if (channame_ptr) {
#line 276
        *channame_ptr = (char )'\000';
      }
#line 278
      if (key_ptr) {
#line 279
        key_ptr ++;
#line 279
        key = key_ptr;
#line 280
        key_ptr = strchr((char const   *)key, ',');
#line 281
        if (key_ptr) {
#line 281
          *key_ptr = (char )'\000';
        }
      }
    }
  }
#line 285
  return (1);
}
}
#line 292 "irc-channel.c"
int IRC_PART(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  char *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___5 ;

  {
#line 301
  if (Req->argc < 1 || Req->argc > 2) {
#line 302
    __cil_tmp = Client_ID(Client);
#line 302
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 302
    return (__cil_tmp___0);
  }
#line 306
  __cil_tmp___1 = Client_Type(Client);
#line 306
  if (__cil_tmp___1 == 32) {
#line 307
    target = Client_Search(Req->prefix);
  } else {
#line 309
    target = Client;
  }
#line 310
  if (! target) {
#line 311
    __cil_tmp___2 = Client_ID(Client);
#line 311
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 311
    return (__cil_tmp___3);
  }
#line 315
  chan = strtok((char * __restrict  )Req->argv[0], (char const   * __restrict  )",");
#line 316
  while (chan) {
#line 317
    if (Req->argc > 1) {
#line 317
      __cil_tmp___5 = Req->argv[1];
    } else {
#line 317
      __cil_tmp___5 = Client_ID(target);
    }
#line 317
    Channel_Part(target, Client, (char const   *)chan, (char const   *)__cil_tmp___5);
#line 319
    chan = strtok((char * __restrict  )((void *)0), (char const   * __restrict  )",");
  }
#line 321
  return (1);
}
}
#line 325 "irc-channel.c"
int IRC_TOPIC(CLIENT *Client , REQUEST *Req ) 
{ CHANNEL *chan ;
  CLIENT *from ;
  char *topic ;
  int r ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  char const   *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  unsigned int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  char const   *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char const   *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  char const   *__cil_tmp___18 ;
  char *__cil_tmp___19 ;
  int __cil_tmp___20 ;
  char *__cil_tmp___21 ;
  char *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  char *__cil_tmp___24 ;
  char const   *__cil_tmp___25 ;
  char const   *__cil_tmp___26 ;
  char *__cil_tmp___27 ;
  int __cil_tmp___28 ;
  int __cil_tmp___29 ;

  {
#line 337
  if (Req->argc < 1 || Req->argc > 2) {
#line 337
    __cil_tmp = Client_ID(Client);
#line 337
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 337
    return (__cil_tmp___0);
  }
#line 339
  __cil_tmp___1 = Client_Type(Client);
#line 339
  if (__cil_tmp___1 == 32) {
#line 339
    from = Client_Search(Req->prefix);
  } else {
#line 340
    from = Client;
  }
#line 341
  if (! from) {
#line 341
    __cil_tmp___2 = Client_ID(Client);
#line 341
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 341
    return (__cil_tmp___3);
  }
#line 344
  chan = Channel_Search((char const   *)Req->argv[0]);
#line 345
  if (! chan) {
#line 345
    __cil_tmp___4 = Client_ID(from);
#line 345
    __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"403 %s %s :No such channel",
                                       __cil_tmp___4, Req->argv[0]);
#line 345
    return (__cil_tmp___5);
  }
#line 348
  __cil_tmp___8 = Channel_IsMemberOf(chan, from);
#line 348
  if (! __cil_tmp___8) {
#line 348
    __cil_tmp___6 = Client_ID(from);
#line 348
    __cil_tmp___7 = IRC_WriteStrClient(from, (char *)"442 %s %s :You are not on that channel",
                                       __cil_tmp___6, Req->argv[0]);
#line 348
    return (__cil_tmp___7);
  }
#line 350
  if (Req->argc == 1) {
#line 353
    topic = Channel_Topic(chan);
#line 354
    if (*topic) {
#line 355
      __cil_tmp___9 = Channel_Name((CHANNEL const   *)chan);
#line 355
      __cil_tmp___10 = Client_ID(Client);
#line 355
      r = IRC_WriteStrClient(from, (char *)"332 %s %s :%s", __cil_tmp___10, __cil_tmp___9,
                             topic);
#line 358
      __cil_tmp___11 = Channel_TopicTime(chan);
#line 358
      __cil_tmp___12 = Channel_TopicWho(chan);
#line 358
      __cil_tmp___13 = Channel_Name((CHANNEL const   *)chan);
#line 358
      __cil_tmp___14 = Client_ID(Client);
#line 358
      r = IRC_WriteStrClient(from, (char *)"333 %s %s %s %u", __cil_tmp___14, __cil_tmp___13,
                             __cil_tmp___12, __cil_tmp___11);
#line 363
      return (r);
    } else {
#line 366
      __cil_tmp___15 = Channel_Name((CHANNEL const   *)chan);
#line 366
      __cil_tmp___16 = Client_ID(from);
#line 366
      __cil_tmp___17 = IRC_WriteStrClient(from, (char *)"331 %s %s :No topic is set",
                                          __cil_tmp___16, __cil_tmp___15);
#line 366
      return (__cil_tmp___17);
    }
  }
#line 370
  __cil_tmp___23 = Channel_Modes(chan);
#line 370
  __cil_tmp___24 = strchr((char const   *)__cil_tmp___23, 't');
#line 370
  if (__cil_tmp___24) {
#line 373
    __cil_tmp___21 = Channel_UserModes(chan, from);
#line 373
    __cil_tmp___22 = strchr((char const   *)__cil_tmp___21, 'o');
#line 373
    if (! __cil_tmp___22) {
#line 373
      __cil_tmp___18 = Channel_Name((CHANNEL const   *)chan);
#line 373
      __cil_tmp___19 = Client_ID(from);
#line 373
      __cil_tmp___20 = IRC_WriteStrClient(from, (char *)"482 %s %s :You are not channel operator",
                                          __cil_tmp___19, __cil_tmp___18);
#line 373
      return (__cil_tmp___20);
    }
  }
#line 377
  Channel_SetTopic(chan, from, Req->argv[1]);
#line 378
  if (*(Req->argv[1] + 0)) {
#line 378
    __cil_tmp___25 = (char const   *)Req->argv[1];
  } else {
#line 378
    __cil_tmp___25 = "<none>";
  }
#line 378
  __cil_tmp___26 = Channel_Name((CHANNEL const   *)chan);
#line 378
  __cil_tmp___27 = Client_Mask(from);
#line 378
  Log(7, "User \"%s\" set topic on \"%s\": %s", __cil_tmp___27, __cil_tmp___26, __cil_tmp___25);
#line 383
  IRC_WriteStrServersPrefix(Client, from, (char *)"TOPIC %s :%s", Req->argv[0], Req->argv[1]);
#line 384
  IRC_WriteStrChannelPrefix(Client, chan, from, 0, (char *)"TOPIC %s :%s", Req->argv[0],
                            Req->argv[1]);
#line 386
  __cil_tmp___29 = Client_Type(Client);
#line 386
  if (__cil_tmp___29 == 16) {
#line 386
    __cil_tmp___28 = IRC_WriteStrClientPrefix(Client, Client, (char *)"TOPIC %s :%s",
                                              Req->argv[0], Req->argv[1]);
#line 386
    return (__cil_tmp___28);
  } else {
#line 387
    return (1);
  }
}
}
#line 396 "irc-channel.c"
int IRC_LIST(CLIENT *Client , REQUEST *Req ) 
{ char *pattern ;
  CHANNEL *chan ;
  CLIENT *from ;
  CLIENT *target ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  CLIENT *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  unsigned long __cil_tmp___11 ;
  char const   *__cil_tmp___12 ;
  char *__cil_tmp___13 ;
  int __cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  char const   *__cil_tmp___18 ;
  int __cil_tmp___19 ;
  char *__cil_tmp___20 ;
  int __cil_tmp___21 ;

  {
#line 407
  if (Req->argc > 2) {
#line 408
    __cil_tmp = Client_ID(Client);
#line 408
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 408
    return (__cil_tmp___0);
  }
#line 411
  if (Req->argc > 0) {
#line 412
    pattern = strtok((char * __restrict  )Req->argv[0], (char const   * __restrict  )",");
  } else {
#line 414
    pattern = (char *)"*";
  }
#line 417
  __cil_tmp___1 = Client_Type(Client);
#line 417
  if (__cil_tmp___1 == 32) {
#line 418
    from = Client_Search(Req->prefix);
  } else {
#line 420
    from = Client;
  }
#line 422
  if (! from) {
#line 423
    __cil_tmp___2 = Client_ID(Client);
#line 423
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                       __cil_tmp___2, Req->prefix);
#line 423
    return (__cil_tmp___3);
  }
#line 426
  if (Req->argc == 2) {
#line 429
    target = Client_Search(Req->argv[1]);
#line 430
    if (! target) {
#line 430
      goto _L;
    } else {
#line 430
      __cil_tmp___6 = Client_Type(target);
#line 430
      if (__cil_tmp___6 != 32) {
        _L: /* CIL Label */ 
#line 431
        __cil_tmp___4 = Client_ID(Client);
#line 431
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[1]);
#line 431
        return (__cil_tmp___5);
      }
    }
#line 434
    __cil_tmp___9 = Client_ThisServer();
#line 434
    if ((unsigned int )target != (unsigned int )__cil_tmp___9) {
#line 437
      __cil_tmp___7 = Client_ID(from);
#line 437
      __cil_tmp___8 = IRC_WriteStrClientPrefix(target, from, (char *)"LIST %s :%s",
                                               __cil_tmp___7, Req->argv[1]);
#line 437
      return (__cil_tmp___8);
    }
  }
#line 443
  while (pattern) {
#line 446
    chan = Channel_First();
#line 447
    while (chan) {
#line 450
      __cil_tmp___18 = Channel_Name((CHANNEL const   *)chan);
#line 450
      __cil_tmp___19 = Match((char const   *)pattern, __cil_tmp___18);
#line 450
      if (__cil_tmp___19) {
#line 453
        __cil_tmp___15 = Channel_Modes(chan);
#line 453
        __cil_tmp___16 = strchr((char const   *)__cil_tmp___15, 's');
#line 453
        if (__cil_tmp___16) {
#line 453
          __cil_tmp___17 = Channel_IsMemberOf(chan, from);
#line 453
          if (__cil_tmp___17) {
            _L___0: /* CIL Label */ 
#line 456
            __cil_tmp___10 = Channel_Topic(chan);
#line 456
            __cil_tmp___11 = Channel_MemberCount(chan);
#line 456
            __cil_tmp___12 = Channel_Name((CHANNEL const   *)chan);
#line 456
            __cil_tmp___13 = Client_ID(from);
#line 456
            __cil_tmp___14 = IRC_WriteStrClient(from, (char *)"322 %s %s %ld :%s",
                                                __cil_tmp___13, __cil_tmp___12, __cil_tmp___11,
                                                __cil_tmp___10);
#line 456
            if (! __cil_tmp___14) {
#line 461
              return (0);
            }
          }
        } else {
#line 453
          goto _L___0;
        }
      }
#line 464
      chan = Channel_Next(chan);
    }
#line 468
    if (Req->argc > 0) {
#line 469
      pattern = strtok((char * __restrict  )((void *)0), (char const   * __restrict  )",");
    } else {
#line 471
      pattern = (char *)((void *)0);
    }
  }
#line 474
  __cil_tmp___20 = Client_ID(from);
#line 474
  __cil_tmp___21 = IRC_WriteStrClient(from, (char *)"323 %s :End of LIST", __cil_tmp___20);
#line 474
  return (__cil_tmp___21);
}
}
#line 478 "irc-channel.c"
int IRC_CHANINFO(CLIENT *Client , REQUEST *Req ) 
{ char modes_add[513] ;
  char l[16] ;
  char *ptr ;
  CLIENT *from ;
  CHANNEL *chan ;
  int arg_topic ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  long __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  unsigned long __cil_tmp___8 ;
  char *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  char *__cil_tmp___11 ;

  {
#line 490
  if ((Req->argc < 2 || Req->argc == 4) || Req->argc > 5) {
#line 490
    __cil_tmp = Client_ID(Client);
#line 490
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 490
    return (__cil_tmp___0);
  }
#line 493
  if (Req->argc == 5) {
#line 493
    arg_topic = 4;
  } else {
#line 494
    if (Req->argc == 3) {
#line 494
      arg_topic = 2;
    } else {
#line 495
      arg_topic = -1;
    }
  }
#line 498
  from = Client_Search(Req->prefix);
#line 499
  if (! from) {
#line 499
    __cil_tmp___1 = Client_ID(Client);
#line 499
    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___1, Req->prefix);
#line 499
    return (__cil_tmp___2);
  }
#line 502
  chan = Channel_Search((char const   *)Req->argv[0]);
#line 503
  if (! chan) {
#line 503
    chan = Channel_Create(Req->argv[0]);
  }
#line 504
  if (! chan) {
#line 504
    return (1);
  }
#line 506
  if ((int )*(Req->argv[1] + 0) == 43) {
#line 508
    ptr = Channel_Modes(chan);
#line 509
    if (! *ptr) {
#line 512
      Channel_SetModes(chan, Req->argv[1] + 1);
#line 514
      if (Req->argc == 5) {
#line 516
        __cil_tmp___3 = Channel_Modes(chan);
#line 516
        __cil_tmp___4 = strchr((char const   *)__cil_tmp___3, 'k');
#line 516
        if (__cil_tmp___4) {
#line 516
          Channel_SetKey(chan, Req->argv[2]);
        }
#line 517
        __cil_tmp___6 = Channel_Modes(chan);
#line 517
        __cil_tmp___7 = strchr((char const   *)__cil_tmp___6, 'l');
#line 517
        if (__cil_tmp___7) {
#line 517
          __cil_tmp___5 = atol((char const   *)Req->argv[3]);
#line 517
          Channel_SetMaxUsers(chan, (unsigned long )__cil_tmp___5);
        }
      } else {
#line 522
        Channel_ModeDel(chan, (char )'l');
#line 523
        Channel_ModeDel(chan, (char )'k');
      }
#line 526
      strcpy((char * __restrict  )(modes_add), (char const   * __restrict  )"");
#line 527
      ptr = Channel_Modes(chan);
#line 528
      while (*ptr) {
#line 530
        if ((int )*ptr == 108) {
#line 532
          __cil_tmp___8 = Channel_MaxUsers(chan);
#line 532
          snprintf((char * __restrict  )(l), sizeof(l), (char const   * __restrict  )" %lu",
                   __cil_tmp___8);
#line 533
          strlcat(modes_add, (char const   *)(l), sizeof(modes_add));
        }
#line 535
        if ((int )*ptr == 107) {
#line 537
          strlcat(modes_add, " ", sizeof(modes_add));
#line 538
          __cil_tmp___9 = Channel_Key(chan);
#line 538
          strlcat(modes_add, (char const   *)__cil_tmp___9, sizeof(modes_add));
        }
#line 540
        ptr ++;
      }
#line 544
      __cil_tmp___10 = Channel_Modes(chan);
#line 544
      IRC_WriteStrChannelPrefix(Client, chan, from, 0, (char *)"MODE %s +%s%s", Req->argv[0],
                                __cil_tmp___10, modes_add);
    }
  } else {
#line 547
    Log(4, "CHANINFO: invalid MODE format ignored!");
  }
#line 549
  if (arg_topic > 0) {
#line 552
    ptr = Channel_Topic(chan);
#line 553
    if (! *ptr && (int )*(Req->argv[arg_topic] + 0)) {
#line 556
      Channel_SetTopic(chan, Client, Req->argv[arg_topic]);
#line 557
      __cil_tmp___11 = Channel_Topic(chan);
#line 557
      IRC_WriteStrChannelPrefix(Client, chan, from, 0, (char *)"TOPIC %s :%s", Req->argv[0],
                                __cil_tmp___11);
    }
  }
#line 563
  if (Req->argc == 5) {
#line 563
    IRC_WriteStrServersPrefixFlag(Client, from, (char )'C', (char *)"CHANINFO %s %s %s %s :%s",
                                  Req->argv[0], Req->argv[1], Req->argv[2], Req->argv[3],
                                  Req->argv[4]);
  } else {
#line 564
    if (Req->argc == 3) {
#line 564
      IRC_WriteStrServersPrefixFlag(Client, from, (char )'C', (char *)"CHANINFO %s %s :%s",
                                    Req->argv[0], Req->argv[1], Req->argv[2]);
    } else {
#line 565
      IRC_WriteStrServersPrefixFlag(Client, from, (char )'C', (char *)"CHANINFO %s %s",
                                    Req->argv[0], Req->argv[1]);
    }
  }
#line 567
  return (1);
}
}
#line 1 "irc-info.o"
#pragma merger(0,"/tmp/cil-cpgNBfZ9.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 27 "./../tool/tool.h"
void ngt_TrimLastChr(char *String , char Chr ) ;
#line 31
char *ngt_LowerStr(char *String ) ;
#line 21 "irc-info.h"
int IRC_ADMIN(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_INFO(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_ISON(CLIENT *Client , REQUEST *Req ) ;
#line 24
int IRC_LINKS(CLIENT *Client , REQUEST *Req ) ;
#line 25
int IRC_LUSERS(CLIENT *Client , REQUEST *Req ) ;
#line 26
int IRC_MOTD(CLIENT *Client , REQUEST *Req ) ;
#line 27
int IRC_NAMES(CLIENT *Client , REQUEST *Req ) ;
#line 28
int IRC_STATS(CLIENT *Client , REQUEST *Req ) ;
#line 29
int IRC_SUMMON(CLIENT *Client , REQUEST *Req ) ;
#line 30
int IRC_TIME(CLIENT *Client , REQUEST *Req ) ;
#line 31
int IRC_USERHOST(CLIENT *Client , REQUEST *Req ) ;
#line 32
int IRC_USERS(CLIENT *Client , REQUEST *Req ) ;
#line 33
int IRC_VERSION(CLIENT *Client , REQUEST *Req ) ;
#line 34
int IRC_WHO(CLIENT *Client , REQUEST *Req ) ;
#line 35
int IRC_WHOIS(CLIENT *Client , REQUEST *Req ) ;
#line 36
int IRC_WHOWAS(CLIENT *Client , REQUEST *Req ) ;
#line 38
int IRC_Send_LUSERS(CLIENT *Client ) ;
#line 40
int IRC_Show_MOTD(CLIENT *Client ) ;
#line 41
int IRC_Send_ISUPPORT(CLIENT *Client ) ;
#line 44 "irc-info.c"
int IRC_ADMIN(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *prefix ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;

  {
#line 53
  if (Req->argc > 1) {
#line 53
    __cil_tmp = Client_ID(Client);
#line 53
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 53
    return (__cil_tmp___0);
  }
#line 56
  if (Req->argc == 1) {
#line 56
    target = Client_Search(Req->argv[0]);
  } else {
#line 57
    target = Client_ThisServer();
  }
#line 60
  __cil_tmp___1 = Client_Type(Client);
#line 60
  if (__cil_tmp___1 == 32) {
#line 60
    prefix = Client_Search(Req->prefix);
  } else {
#line 61
    prefix = Client;
  }
#line 62
  if (! prefix) {
#line 62
    __cil_tmp___2 = Client_ID(Client);
#line 62
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 62
    return (__cil_tmp___3);
  }
#line 65
  __cil_tmp___7 = Client_ThisServer();
#line 65
  if ((unsigned int )target != (unsigned int )__cil_tmp___7) {
#line 67
    if (! target) {
#line 67
      goto _L;
    } else {
#line 67
      __cil_tmp___6 = Client_Type(target);
#line 67
      if (__cil_tmp___6 != 32) {
        _L: /* CIL Label */ 
#line 67
        __cil_tmp___4 = Client_ID(prefix);
#line 67
        __cil_tmp___5 = IRC_WriteStrClient(prefix, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 67
        return (__cil_tmp___5);
      }
    }
#line 70
    IRC_WriteStrClientPrefix(target, prefix, (char *)"ADMIN %s", Req->argv[0]);
#line 71
    return (1);
  }
#line 75
  __cil_tmp___8 = Client_ID(prefix);
#line 75
  __cil_tmp___9 = IRC_WriteStrClient(Client, (char *)"256 %s %s :Administrative info",
                                     __cil_tmp___8, Conf_ServerName);
#line 75
  if (! __cil_tmp___9) {
#line 75
    return (0);
  }
#line 76
  __cil_tmp___10 = Client_ID(prefix);
#line 76
  __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"257 %s :%s", __cil_tmp___10,
                                      Conf_ServerAdmin1);
#line 76
  if (! __cil_tmp___11) {
#line 76
    return (0);
  }
#line 77
  __cil_tmp___12 = Client_ID(prefix);
#line 77
  __cil_tmp___13 = IRC_WriteStrClient(Client, (char *)"258 %s :%s", __cil_tmp___12,
                                      Conf_ServerAdmin2);
#line 77
  if (! __cil_tmp___13) {
#line 77
    return (0);
  }
#line 78
  __cil_tmp___14 = Client_ID(prefix);
#line 78
  __cil_tmp___15 = IRC_WriteStrClient(Client, (char *)"259 %s :%s", __cil_tmp___14,
                                      Conf_ServerAdminMail);
#line 78
  if (! __cil_tmp___15) {
#line 78
    return (0);
  }
#line 80
  IRC_SetPenalty(Client, 1L);
#line 81
  return (1);
}
}
#line 89 "irc-info.c"
int IRC_INFO(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *prefix ;
  char msg[510] ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;

  {
#line 99
  if (Req->argc > 1) {
#line 100
    __cil_tmp = Client_ID(Client);
#line 100
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 100
    return (__cil_tmp___0);
  }
#line 104
  __cil_tmp___1 = Client_Type(Client);
#line 104
  if (__cil_tmp___1 == 32) {
#line 105
    prefix = Client_Search(Req->prefix);
  } else {
#line 107
    prefix = Client;
  }
#line 108
  if (! prefix) {
#line 109
    __cil_tmp___2 = Client_ID(Client);
#line 109
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 109
    return (__cil_tmp___3);
  }
#line 113
  if (Req->argc > 0) {
#line 114
    target = Client_Search(Req->argv[0]);
  } else {
#line 116
    target = Client_ThisServer();
  }
#line 119
  if (target) {
#line 119
    __cil_tmp___4 = Client_Type(target);
#line 119
    if (__cil_tmp___4 != 32) {
#line 120
      target = Client_Introducer(target);
    } else {
#line 119
      goto _L;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 122
  if (! target) {
#line 123
    __cil_tmp___5 = Client_ID(prefix);
#line 123
    __cil_tmp___6 = IRC_WriteStrClient(prefix, (char *)"402 %s %s :No such server",
                                       __cil_tmp___5, Req->argv[0]);
#line 123
    return (__cil_tmp___6);
  }
#line 127
  __cil_tmp___7 = Client_ThisServer();
#line 127
  if ((unsigned int )target != (unsigned int )__cil_tmp___7) {
#line 128
    IRC_WriteStrClientPrefix(target, prefix, (char *)"INFO %s", Req->argv[0]);
#line 130
    return (1);
  }
#line 133
  __cil_tmp___8 = Client_ID(prefix);
#line 133
  __cil_tmp___9 = IRC_WriteStrClient(Client, (char *)"371 %s :%s", __cil_tmp___8,
                                     NGIRCd_Version);
#line 133
  if (! __cil_tmp___9) {
#line 135
    return (0);
  }
#line 137
  strlcpy(msg, "Server has been started ", sizeof(msg));
#line 138
  strlcat(msg, (char const   *)(NGIRCd_StartStr), sizeof(msg));
#line 139
  __cil_tmp___10 = Client_ID(prefix);
#line 139
  __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"371 %s :%s", __cil_tmp___10,
                                      msg);
#line 139
  if (! __cil_tmp___11) {
#line 140
    return (0);
  }
#line 142
  __cil_tmp___12 = Client_ID(prefix);
#line 142
  __cil_tmp___13 = IRC_WriteStrClient(Client, (char *)"374 %s :End of INFO list",
                                      __cil_tmp___12);
#line 142
  if (! __cil_tmp___13) {
#line 143
    return (0);
  }
#line 145
  IRC_SetPenalty(Client, 2L);
#line 146
  return (1);
}
}
#line 150 "irc-info.c"
int IRC_ISON(CLIENT *Client , REQUEST *Req ) 
{ char rpl[513] ;
  CLIENT *c ;
  char *ptr ;
  int i ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 162
  if (Req->argc < 1) {
#line 162
    __cil_tmp = Client_ID(Client);
#line 162
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 162
    return (__cil_tmp___0);
  }
#line 164
  strlcpy(rpl, "303 %s :", sizeof(rpl));
#line 165
  i = 0;
#line 165
  while (i < Req->argc) {
#line 167
    ptr = strtok((char * __restrict  )Req->argv[i], (char const   * __restrict  )" ");
#line 168
    while (ptr) {
#line 170
      ngt_TrimStr(ptr);
#line 171
      c = Client_Search(ptr);
#line 172
      if (c) {
#line 172
        __cil_tmp___1 = Client_Type(c);
#line 172
        if (__cil_tmp___1 == 16) {
#line 175
          strlcat(rpl, (char const   *)ptr, sizeof(rpl));
#line 176
          strlcat(rpl, " ", sizeof(rpl));
        } else {
#line 172
          goto _L;
        }
      } else {
        _L: /* CIL Label */ ;
      }
#line 178
      ptr = strtok((char * __restrict  )((void *)0), (char const   * __restrict  )" ");
    }
#line 165
    i ++;
  }
#line 181
  ngt_TrimLastChr(rpl, (char )' ');
#line 183
  __cil_tmp___2 = Client_ID(Client);
#line 183
  __cil_tmp___3 = IRC_WriteStrClient(Client, rpl, __cil_tmp___2);
#line 183
  return (__cil_tmp___3);
}
}
#line 187 "irc-info.c"
int IRC_LINKS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *from ;
  CLIENT *c ;
  char *mask ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  CLIENT *__cil_tmp___17 ;
  CLIENT *__cil_tmp___18 ;
  char *__cil_tmp___19 ;
  char *__cil_tmp___20 ;
  char *__cil_tmp___21 ;
  int __cil_tmp___22 ;
  int __cil_tmp___23 ;
  char *__cil_tmp___24 ;
  int __cil_tmp___25 ;

  {
#line 197
  if (Req->argc > 2) {
#line 197
    __cil_tmp = Client_ID(Client);
#line 197
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 197
    return (__cil_tmp___0);
  }
#line 200
  if (Req->argc > 0) {
#line 200
    mask = Req->argv[Req->argc - 1];
  } else {
#line 201
    mask = (char *)"*";
  }
#line 204
  __cil_tmp___1 = Client_Type(Client);
#line 204
  if (__cil_tmp___1 == 32) {
#line 204
    from = Client_Search(Req->prefix);
  } else {
#line 205
    from = Client;
  }
#line 206
  if (! from) {
#line 206
    __cil_tmp___2 = Client_ID(Client);
#line 206
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 206
    return (__cil_tmp___3);
  }
#line 209
  if (Req->argc == 2) {
#line 211
    target = Client_Search(Req->argv[0]);
#line 212
    if (! target) {
#line 212
      goto _L;
    } else {
#line 212
      __cil_tmp___8 = Client_Type(target);
#line 212
      if (__cil_tmp___8 != 32) {
        _L: /* CIL Label */ 
#line 212
        __cil_tmp___4 = Client_ID(from);
#line 212
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 212
        return (__cil_tmp___5);
      } else {
#line 213
        __cil_tmp___7 = Client_ThisServer();
#line 213
        if ((unsigned int )target != (unsigned int )__cil_tmp___7) {
#line 213
          __cil_tmp___6 = IRC_WriteStrClientPrefix(target, from, (char *)"LINKS %s %s",
                                                   Req->argv[0], Req->argv[1]);
#line 213
          return (__cil_tmp___6);
        }
      }
    }
  }
#line 217
  __cil_tmp___9 = Client_Type(Client);
#line 217
  if (__cil_tmp___9 == 32) {
#line 217
    target = Client_Search(Req->prefix);
  } else {
#line 218
    target = Client;
  }
#line 219
  if (! target) {
#line 219
    __cil_tmp___10 = Client_ID(Client);
#line 219
    __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                        __cil_tmp___10, Req->prefix);
#line 219
    return (__cil_tmp___11);
  }
#line 221
  c = Client_First();
#line 222
  while (c) {
#line 224
    __cil_tmp___23 = Client_Type(c);
#line 224
    if (__cil_tmp___23 == 32) {
#line 226
      __cil_tmp___12 = Client_Info(c);
#line 226
      __cil_tmp___13 = Client_Hops(c);
#line 226
      __cil_tmp___18 = Client_TopServer(c);
#line 226
      if (__cil_tmp___18) {
#line 226
        __cil_tmp___17 = Client_TopServer(c);
      } else {
#line 226
        __cil_tmp___17 = Client_ThisServer();
      }
#line 226
      __cil_tmp___19 = Client_ID(__cil_tmp___17);
#line 226
      __cil_tmp___20 = Client_ID(c);
#line 226
      __cil_tmp___21 = Client_ID(target);
#line 226
      __cil_tmp___22 = IRC_WriteStrClient(target, (char *)"364 %s %s %s :%d %s", __cil_tmp___21,
                                          __cil_tmp___20, __cil_tmp___19, __cil_tmp___13,
                                          __cil_tmp___12);
#line 226
      if (! __cil_tmp___22) {
#line 226
        return (0);
      }
    }
#line 228
    c = Client_Next(c);
  }
#line 231
  IRC_SetPenalty(target, 1L);
#line 232
  __cil_tmp___24 = Client_ID(target);
#line 232
  __cil_tmp___25 = IRC_WriteStrClient(target, (char *)"365 %s %s :End of LINKS list",
                                      __cil_tmp___24, mask);
#line 232
  return (__cil_tmp___25);
}
}
#line 236 "irc-info.c"
int IRC_LUSERS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *from ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;

  {
#line 245
  if (Req->argc > 2) {
#line 245
    __cil_tmp = Client_ID(Client);
#line 245
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 245
    return (__cil_tmp___0);
  }
#line 248
  __cil_tmp___1 = Client_Type(Client);
#line 248
  if (__cil_tmp___1 == 32) {
#line 248
    from = Client_Search(Req->prefix);
  } else {
#line 249
    from = Client;
  }
#line 250
  if (! from) {
#line 250
    __cil_tmp___2 = Client_ID(Client);
#line 250
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 250
    return (__cil_tmp___3);
  }
#line 253
  if (Req->argc == 2) {
#line 255
    target = Client_Search(Req->argv[1]);
#line 256
    if (! target) {
#line 256
      goto _L;
    } else {
#line 256
      __cil_tmp___8 = Client_Type(target);
#line 256
      if (__cil_tmp___8 != 32) {
        _L: /* CIL Label */ 
#line 256
        __cil_tmp___4 = Client_ID(from);
#line 256
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[1]);
#line 256
        return (__cil_tmp___5);
      } else {
#line 257
        __cil_tmp___7 = Client_ThisServer();
#line 257
        if ((unsigned int )target != (unsigned int )__cil_tmp___7) {
#line 257
          __cil_tmp___6 = IRC_WriteStrClientPrefix(target, from, (char *)"LUSERS %s %s",
                                                   Req->argv[0], Req->argv[1]);
#line 257
          return (__cil_tmp___6);
        }
      }
    }
  }
#line 261
  __cil_tmp___9 = Client_Type(Client);
#line 261
  if (__cil_tmp___9 == 32) {
#line 261
    target = Client_Search(Req->prefix);
  } else {
#line 262
    target = Client;
  }
#line 263
  if (! target) {
#line 263
    __cil_tmp___10 = Client_ID(Client);
#line 263
    __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                        __cil_tmp___10, Req->prefix);
#line 263
    return (__cil_tmp___11);
  }
#line 265
  IRC_Send_LUSERS(target);
#line 267
  IRC_SetPenalty(target, 1L);
#line 268
  return (1);
}
}
#line 272 "irc-info.c"
int IRC_MOTD(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *from ;
  CLIENT *target ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  CLIENT *__cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 281
  if (Req->argc > 1) {
#line 281
    __cil_tmp = Client_ID(Client);
#line 281
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 281
    return (__cil_tmp___0);
  }
#line 284
  __cil_tmp___1 = Client_Type(Client);
#line 284
  if (__cil_tmp___1 == 32) {
#line 284
    from = Client_Search(Req->prefix);
  } else {
#line 285
    from = Client;
  }
#line 286
  if (! from) {
#line 286
    __cil_tmp___2 = Client_ID(Client);
#line 286
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 286
    return (__cil_tmp___3);
  }
#line 288
  if (Req->argc == 1) {
#line 291
    target = Client_Search(Req->argv[0]);
#line 292
    if (! target) {
#line 292
      goto _L;
    } else {
#line 292
      __cil_tmp___6 = Client_Type(target);
#line 292
      if (__cil_tmp___6 != 32) {
        _L: /* CIL Label */ 
#line 292
        __cil_tmp___4 = Client_ID(from);
#line 292
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 292
        return (__cil_tmp___5);
      }
    }
#line 294
    __cil_tmp___8 = Client_ThisServer();
#line 294
    if ((unsigned int )target != (unsigned int )__cil_tmp___8) {
#line 297
      __cil_tmp___7 = IRC_WriteStrClientPrefix(target, from, (char *)"MOTD %s", Req->argv[0]);
#line 297
      return (__cil_tmp___7);
    }
  }
#line 301
  IRC_SetPenalty(from, 3L);
#line 302
  __cil_tmp___9 = IRC_Show_MOTD(from);
#line 302
  return (__cil_tmp___9);
}
}
#line 306 "irc-info.c"
int IRC_NAMES(CLIENT *Client , REQUEST *Req ) 
{ char rpl[513] ;
  char *ptr ;
  CLIENT *target ;
  CLIENT *from ;
  CLIENT *c ;
  CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  CLIENT *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  int __cil_tmp___12 ;
  char *__cil_tmp___13 ;
  size_t __cil_tmp___14 ;
  char *__cil_tmp___15 ;
  int __cil_tmp___16 ;
  char *__cil_tmp___17 ;
  size_t __cil_tmp___18 ;
  int __cil_tmp___19 ;
  CL2CHAN *__cil_tmp___20 ;
  char *__cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;
  size_t __cil_tmp___24 ;
  char *__cil_tmp___25 ;
  int __cil_tmp___26 ;

  {
#line 317
  if (Req->argc > 2) {
#line 317
    __cil_tmp = Client_ID(Client);
#line 317
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 317
    return (__cil_tmp___0);
  }
#line 320
  __cil_tmp___1 = Client_Type(Client);
#line 320
  if (__cil_tmp___1 == 32) {
#line 320
    from = Client_Search(Req->prefix);
  } else {
#line 321
    from = Client;
  }
#line 322
  if (! from) {
#line 322
    __cil_tmp___2 = Client_ID(Client);
#line 322
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 322
    return (__cil_tmp___3);
  }
#line 324
  if (Req->argc == 2) {
#line 327
    target = Client_Search(Req->argv[1]);
#line 328
    if (! target) {
#line 328
      goto _L;
    } else {
#line 328
      __cil_tmp___6 = Client_Type(target);
#line 328
      if (__cil_tmp___6 != 32) {
        _L: /* CIL Label */ 
#line 328
        __cil_tmp___4 = Client_ID(from);
#line 328
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[1]);
#line 328
        return (__cil_tmp___5);
      }
    }
#line 330
    __cil_tmp___8 = Client_ThisServer();
#line 330
    if ((unsigned int )target != (unsigned int )__cil_tmp___8) {
#line 333
      __cil_tmp___7 = IRC_WriteStrClientPrefix(target, from, (char *)"NAMES %s :%s",
                                               Req->argv[0], Req->argv[1]);
#line 333
      return (__cil_tmp___7);
    }
  }
#line 337
  if (Req->argc > 0) {
#line 340
    ptr = strtok((char * __restrict  )Req->argv[0], (char const   * __restrict  )",");
#line 341
    while (ptr) {
#line 343
      chan = Channel_Search((char const   *)ptr);
#line 344
      if (chan) {
#line 347
        __cil_tmp___9 = IRC_Send_NAMES(from, chan);
#line 347
        if (! __cil_tmp___9) {
#line 347
          return (0);
        }
      }
#line 349
      __cil_tmp___10 = Client_ID(from);
#line 349
      __cil_tmp___11 = IRC_WriteStrClient(from, (char *)"366 %s %s :End of NAMES list",
                                          __cil_tmp___10, ptr);
#line 349
      if (! __cil_tmp___11) {
#line 349
        return (0);
      }
#line 352
      ptr = strtok((char * __restrict  )((void *)0), (char const   * __restrict  )",");
    }
#line 354
    return (1);
  }
#line 358
  chan = Channel_First();
#line 359
  while (chan) {
#line 362
    __cil_tmp___12 = IRC_Send_NAMES(from, chan);
#line 362
    if (! __cil_tmp___12) {
#line 362
      return (0);
    }
#line 365
    chan = Channel_Next(chan);
  }
#line 369
  c = Client_First();
#line 370
  __cil_tmp___13 = Client_ID(from);
#line 370
  snprintf((char * __restrict  )(rpl), sizeof(rpl), (char const   * __restrict  )"353 %s %s %s :",
           __cil_tmp___13, "*", "*");
#line 371
  while (c) {
#line 373
    __cil_tmp___19 = Client_Type(c);
#line 373
    if (__cil_tmp___19 == 16) {
#line 373
      __cil_tmp___20 = Channel_FirstChannelOf(c);
#line 373
      if ((unsigned int )__cil_tmp___20 == (unsigned int )((void *)0)) {
#line 373
        __cil_tmp___21 = Client_Modes(c);
#line 373
        __cil_tmp___22 = strchr((char const   *)__cil_tmp___21, 'i');
#line 373
        if (__cil_tmp___22) {
#line 373
          goto _L___1;
        } else {
#line 376
          __cil_tmp___14 = strlen((char const   *)(rpl));
#line 376
          if ((int )rpl[__cil_tmp___14 - 1U] != 58) {
#line 376
            strlcat(rpl, " ", sizeof(rpl));
          }
#line 377
          __cil_tmp___15 = Client_ID(c);
#line 377
          strlcat(rpl, (char const   *)__cil_tmp___15, sizeof(rpl));
#line 379
          __cil_tmp___18 = strlen((char const   *)(rpl));
#line 379
          if (__cil_tmp___18 > 220U) {
#line 382
            __cil_tmp___16 = IRC_WriteStrClient(from, (char *)"%s", rpl);
#line 382
            if (! __cil_tmp___16) {
#line 382
              return (0);
            }
#line 383
            __cil_tmp___17 = Client_ID(from);
#line 383
            snprintf((char * __restrict  )(rpl), sizeof(rpl), (char const   * __restrict  )"353 %s %s %s :",
                     __cil_tmp___17, "*", "*");
          }
        }
      } else {
#line 373
        goto _L___1;
      }
    } else {
      _L___1: /* CIL Label */ ;
    }
#line 388
    c = Client_Next(c);
  }
#line 390
  __cil_tmp___24 = strlen((char const   *)(rpl));
#line 390
  if ((int )rpl[__cil_tmp___24 - 1U] != 58) {
#line 393
    __cil_tmp___23 = IRC_WriteStrClient(from, (char *)"%s", rpl);
#line 393
    if (! __cil_tmp___23) {
#line 393
      return (0);
    }
  }
#line 396
  IRC_SetPenalty(from, 1L);
#line 397
  __cil_tmp___25 = Client_ID(from);
#line 397
  __cil_tmp___26 = IRC_WriteStrClient(from, (char *)"366 %s %s :End of NAMES list",
                                      __cil_tmp___25, "*");
#line 397
  return (__cil_tmp___26);
}
}
#line 401 "irc-info.c"
static unsigned int t_diff(time_t *t , time_t div___0 ) 
{ time_t diff ;
  time_t remain ;

  {
#line 406
  diff = *t / div___0;
#line 408
  remain = diff * div___0;
#line 409
  *t -= remain;
#line 411
  return ((unsigned int )diff);
}
}
#line 415 "irc-info.c"
static unsigned int uptime_days(time_t *now ) 
{ unsigned int __cil_tmp ;

  {
#line 418
  __cil_tmp = t_diff(now, 86400L);
#line 418
  return (__cil_tmp);
}
}
#line 422 "irc-info.c"
static unsigned int uptime_hrs(time_t *now ) 
{ unsigned int __cil_tmp ;

  {
#line 425
  __cil_tmp = t_diff(now, 3600L);
#line 425
  return (__cil_tmp);
}
}
#line 429 "irc-info.c"
static unsigned int uptime_mins(time_t *now ) 
{ unsigned int __cil_tmp ;

  {
#line 432
  __cil_tmp = t_diff(now, 60L);
#line 432
  return (__cil_tmp);
}
}
#line 436 "irc-info.c"
int IRC_STATS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *from ;
  CLIENT *target ;
  CLIENT *cl ;
  CONN_ID con ;
  char query ;
  COMMAND *cmd ;
  time_t time_now ;
  unsigned int days ;
  unsigned int hrs ;
  unsigned int mins ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  CLIENT *__cil_tmp___8 ;
  time_t __cil_tmp___9 ;
  long __cil_tmp___10 ;
  long __cil_tmp___11 ;
  long __cil_tmp___12 ;
  long __cil_tmp___13 ;
  size_t __cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  int __cil_tmp___18 ;
  char *__cil_tmp___19 ;
  int __cil_tmp___20 ;
  time_t __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;
  char *__cil_tmp___24 ;
  int __cil_tmp___25 ;

  {
#line 450
  if (Req->argc > 2) {
#line 451
    __cil_tmp = Client_ID(Client);
#line 451
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 451
    return (__cil_tmp___0);
  }
#line 454
  __cil_tmp___1 = Client_Type(Client);
#line 454
  if (__cil_tmp___1 == 32) {
#line 455
    from = Client_Search(Req->prefix);
  } else {
#line 457
    from = Client;
  }
#line 459
  if (! from) {
#line 460
    __cil_tmp___2 = Client_ID(Client);
#line 460
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 460
    return (__cil_tmp___3);
  }
#line 462
  if (Req->argc == 2) {
#line 464
    target = Client_Search(Req->argv[1]);
#line 465
    if (! target) {
#line 465
      goto _L;
    } else {
#line 465
      __cil_tmp___6 = Client_Type(target);
#line 465
      if (__cil_tmp___6 != 32) {
        _L: /* CIL Label */ 
#line 466
        __cil_tmp___4 = Client_ID(from);
#line 466
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[1]);
#line 466
        return (__cil_tmp___5);
      }
    }
#line 468
    __cil_tmp___8 = Client_ThisServer();
#line 468
    if ((unsigned int )target != (unsigned int )__cil_tmp___8) {
#line 470
      __cil_tmp___7 = IRC_WriteStrClientPrefix(target, from, (char *)"STATS %s %s",
                                               Req->argv[0], Req->argv[1]);
#line 470
      return (__cil_tmp___7);
    }
  }
#line 474
  if (Req->argc > 0) {
#line 475
    if (*(Req->argv[0] + 0)) {
#line 475
      query = *(Req->argv[0] + 0);
    } else {
#line 475
      query = (char )'*';
    }
  } else {
#line 477
    query = (char )'*';
  }
#line 479
  switch ((int )query) {
  case 108: 
  case 76: 
#line 482
  time_now = time((time_t *)((void *)0));
#line 483
  con = Conn_First();
#line 483
  while (con != -1) {
#line 484
    cl = Conn_GetClient(con);
#line 485
    if (! cl) {
#line 486
      goto __Cont;
    }
#line 487
    __cil_tmp___18 = Client_Type(cl);
#line 487
    if (__cil_tmp___18 == 32 || (unsigned int )cl == (unsigned int )Client) {
#line 499
      __cil_tmp___9 = Conn_StartTime(con);
#line 499
      __cil_tmp___10 = Conn_RecvBytes(con);
#line 499
      __cil_tmp___11 = Conn_RecvMsg(con);
#line 499
      __cil_tmp___12 = Conn_SendBytes(con);
#line 499
      __cil_tmp___13 = Conn_SendMsg(con);
#line 499
      __cil_tmp___14 = Conn_SendQ(con);
#line 499
      __cil_tmp___15 = Client_Mask(cl);
#line 499
      __cil_tmp___16 = Client_ID(from);
#line 499
      __cil_tmp___17 = IRC_WriteStrClient(from, (char *)"211 %s %s %d %ld %ld %ld %ld :%ld",
                                          __cil_tmp___16, __cil_tmp___15, __cil_tmp___14,
                                          __cil_tmp___13, __cil_tmp___12, __cil_tmp___11,
                                          __cil_tmp___10, time_now - __cil_tmp___9);
#line 499
      if (! __cil_tmp___17) {
#line 502
        return (0);
      }
    }
    __Cont: /* CIL Label */ 
#line 483
    con = Conn_Next(con);
  }
#line 505
  break;
  case 109: 
  case 77: 
#line 508
  cmd = Parse_GetCommandStruct();
#line 509
  while (cmd->name) {
#line 510
    if (cmd->lcount == 0L && cmd->rcount == 0L) {
#line 511
      goto __Cont___0;
    }
#line 512
    __cil_tmp___19 = Client_ID(from);
#line 512
    __cil_tmp___20 = IRC_WriteStrClient(from, (char *)"212 %s %s %ld %ld %ld", __cil_tmp___19,
                                        cmd->name, cmd->lcount, cmd->bytes, cmd->rcount);
#line 512
    if (! __cil_tmp___20) {
#line 514
      return (0);
    }
    __Cont___0: /* CIL Label */ 
#line 509
    cmd ++;
  }
#line 516
  break;
  case 117: 
  case 85: 
#line 519
  __cil_tmp___21 = time((time_t *)((void *)0));
#line 519
  time_now = __cil_tmp___21 - NGIRCd_Start;
#line 520
  days = uptime_days(& time_now);
#line 521
  hrs = uptime_hrs(& time_now);
#line 522
  mins = uptime_mins(& time_now);
#line 523
  __cil_tmp___22 = Client_ID(from);
#line 523
  __cil_tmp___23 = IRC_WriteStrClient(from, (char *)"242 %s :Server Up %u days %u:%02u:%02u",
                                      __cil_tmp___22, days, hrs, mins, (unsigned int )time_now);
#line 523
  if (! __cil_tmp___23) {
#line 525
    return (0);
  }
#line 526
  break;
  }
#line 529
  IRC_SetPenalty(from, 2L);
#line 530
  __cil_tmp___24 = Client_ID(from);
#line 530
  __cil_tmp___25 = IRC_WriteStrClient(from, (char *)"219 %s %c :End of STATS report",
                                      __cil_tmp___24, query);
#line 530
  return (__cil_tmp___25);
}
}
#line 539 "irc-info.c"
int IRC_SUMMON(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 542
  __cil_tmp = Client_ID(Client);
#line 542
  __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"445 %s %s :SUMMON has been disabled",
                                     __cil_tmp, Req->command);
#line 542
  return (__cil_tmp___0);
}
}
#line 547 "irc-info.c"
int IRC_TIME(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *from ;
  CLIENT *target ;
  char t_str[64] ;
  time_t t ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  CLIENT *__cil_tmp___8 ;
  struct tm *__cil_tmp___9 ;
  CLIENT *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;

  {
#line 558
  if (Req->argc > 1) {
#line 558
    __cil_tmp = Client_ID(Client);
#line 558
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 558
    return (__cil_tmp___0);
  }
#line 561
  __cil_tmp___1 = Client_Type(Client);
#line 561
  if (__cil_tmp___1 == 32) {
#line 561
    from = Client_Search(Req->prefix);
  } else {
#line 562
    from = Client;
  }
#line 563
  if (! from) {
#line 563
    __cil_tmp___2 = Client_ID(Client);
#line 563
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 563
    return (__cil_tmp___3);
  }
#line 565
  if (Req->argc == 1) {
#line 568
    target = Client_Search(Req->argv[0]);
#line 569
    if (! target) {
#line 569
      goto _L;
    } else {
#line 569
      __cil_tmp___6 = Client_Type(target);
#line 569
      if (__cil_tmp___6 != 32) {
        _L: /* CIL Label */ 
#line 569
        __cil_tmp___4 = Client_ID(Client);
#line 569
        __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 569
        return (__cil_tmp___5);
      }
    }
#line 571
    __cil_tmp___8 = Client_ThisServer();
#line 571
    if ((unsigned int )target != (unsigned int )__cil_tmp___8) {
#line 574
      __cil_tmp___7 = IRC_WriteStrClientPrefix(target, from, (char *)"TIME %s", Req->argv[0]);
#line 574
      return (__cil_tmp___7);
    }
  }
#line 578
  t = time((time_t *)((void *)0));
#line 579
  __cil_tmp___9 = localtime((time_t const   *)(& t));
#line 579
  strftime((char * __restrict  )(t_str), 60U, (char const   * __restrict  )"%A %B %d %Y -- %H:%M %Z",
           (struct tm  const  * __restrict  )__cil_tmp___9);
#line 580
  __cil_tmp___10 = Client_ThisServer();
#line 580
  __cil_tmp___11 = Client_ID(__cil_tmp___10);
#line 580
  __cil_tmp___12 = Client_ID(from);
#line 580
  __cil_tmp___13 = IRC_WriteStrClient(from, (char *)"391 %s %s :%s", __cil_tmp___12,
                                      __cil_tmp___11, t_str);
#line 580
  return (__cil_tmp___13);
}
}
#line 584 "irc-info.c"
int IRC_USERHOST(CLIENT *Client , REQUEST *Req ) 
{ char rpl[513] ;
  CLIENT *c ;
  int max ;
  int i ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;

  {
#line 595
  if (Req->argc < 1) {
#line 595
    __cil_tmp = Client_ID(Client);
#line 595
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 595
    return (__cil_tmp___0);
  }
#line 597
  if (Req->argc > 5) {
#line 597
    max = 5;
  } else {
#line 598
    max = Req->argc;
  }
#line 600
  strlcpy(rpl, "302 %s :", sizeof(rpl));
#line 601
  i = 0;
#line 601
  while (i < max) {
#line 603
    c = Client_Search(Req->argv[i]);
#line 604
    if (c) {
#line 604
      __cil_tmp___6 = Client_Type(c);
#line 604
      if (__cil_tmp___6 == 16) {
#line 607
        __cil_tmp___1 = Client_ID(c);
#line 607
        strlcat(rpl, (char const   *)__cil_tmp___1, sizeof(rpl));
#line 608
        __cil_tmp___2 = Client_HasMode(c, (char )'o');
#line 608
        if (__cil_tmp___2) {
#line 608
          strlcat(rpl, "*", sizeof(rpl));
        }
#line 609
        strlcat(rpl, "=", sizeof(rpl));
#line 610
        __cil_tmp___3 = Client_HasMode(c, (char )'a');
#line 610
        if (__cil_tmp___3) {
#line 610
          strlcat(rpl, "-", sizeof(rpl));
        } else {
#line 611
          strlcat(rpl, "+", sizeof(rpl));
        }
#line 612
        __cil_tmp___4 = Client_User(c);
#line 612
        strlcat(rpl, (char const   *)__cil_tmp___4, sizeof(rpl));
#line 613
        strlcat(rpl, "@", sizeof(rpl));
#line 614
        __cil_tmp___5 = Client_Hostname(c);
#line 614
        strlcat(rpl, (char const   *)__cil_tmp___5, sizeof(rpl));
#line 615
        strlcat(rpl, " ", sizeof(rpl));
      } else {
#line 604
        goto _L;
      }
    } else {
      _L: /* CIL Label */ ;
    }
#line 601
    i ++;
  }
#line 618
  ngt_TrimLastChr(rpl, (char )' ');
#line 620
  __cil_tmp___7 = Client_ID(Client);
#line 620
  __cil_tmp___8 = IRC_WriteStrClient(Client, rpl, __cil_tmp___7);
#line 620
  return (__cil_tmp___8);
}
}
#line 628 "irc-info.c"
int IRC_USERS(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 631
  __cil_tmp = Client_ID(Client);
#line 631
  __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"446 %s %s :USERS has been disabled",
                                     __cil_tmp, Req->command);
#line 631
  return (__cil_tmp___0);
}
}
#line 636 "irc-info.c"
int IRC_VERSION(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *prefix ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 645
  if (Req->argc > 1) {
#line 645
    __cil_tmp = Client_ID(Client);
#line 645
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 645
    return (__cil_tmp___0);
  }
#line 648
  if (Req->argc == 1) {
#line 648
    target = Client_Search(Req->argv[0]);
  } else {
#line 649
    target = Client_ThisServer();
  }
#line 652
  __cil_tmp___1 = Client_Type(Client);
#line 652
  if (__cil_tmp___1 == 32) {
#line 652
    prefix = Client_Search(Req->prefix);
  } else {
#line 653
    prefix = Client;
  }
#line 654
  if (! prefix) {
#line 654
    __cil_tmp___2 = Client_ID(Client);
#line 654
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 654
    return (__cil_tmp___3);
  }
#line 657
  __cil_tmp___7 = Client_ThisServer();
#line 657
  if ((unsigned int )target != (unsigned int )__cil_tmp___7) {
#line 659
    if (! target) {
#line 659
      goto _L;
    } else {
#line 659
      __cil_tmp___6 = Client_Type(target);
#line 659
      if (__cil_tmp___6 != 32) {
        _L: /* CIL Label */ 
#line 659
        __cil_tmp___4 = Client_ID(prefix);
#line 659
        __cil_tmp___5 = IRC_WriteStrClient(prefix, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 659
        return (__cil_tmp___5);
      }
    }
#line 662
    IRC_WriteStrClientPrefix(target, prefix, (char *)"VERSION %s", Req->argv[0]);
#line 663
    return (1);
  }
#line 667
  IRC_SetPenalty(Client, 1L);
#line 668
  __cil_tmp___8 = Client_ID(prefix);
#line 668
  __cil_tmp___9 = IRC_WriteStrClient(Client, (char *)"351 %s %s-%s.%s %s :%s", __cil_tmp___8,
                                     "ngircd", "0.12.0", NGIRCd_DebugLevel, Conf_ServerName,
                                     NGIRCd_VersionAddition);
#line 668
  return (__cil_tmp___9);
}
}
#line 675 "irc-info.c"
static int write_whoreply(CLIENT *Client , CLIENT *c , char const   *channelname ,
                          char const   *flags ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  CLIENT *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;

  {
#line 678
  __cil_tmp = Client_Info(c);
#line 678
  __cil_tmp___0 = Client_Hops(c);
#line 678
  __cil_tmp___1 = Client_ID(c);
#line 678
  __cil_tmp___2 = Client_Introducer(c);
#line 678
  __cil_tmp___3 = Client_ID(__cil_tmp___2);
#line 678
  __cil_tmp___4 = Client_Hostname(c);
#line 678
  __cil_tmp___5 = Client_User(c);
#line 678
  __cil_tmp___6 = Client_ID(Client);
#line 678
  __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"352 %s %s %s %s %s %s %s :%d %s",
                                     __cil_tmp___6, channelname, __cil_tmp___5, __cil_tmp___4,
                                     __cil_tmp___3, __cil_tmp___1, flags, __cil_tmp___0,
                                     __cil_tmp);
#line 678
  return (__cil_tmp___7);
}
}
#line 684 "irc-info.c"
static char const   *who_flags_status(char const   *client_modes ) 
{ char *__cil_tmp ;

  {
#line 687
  __cil_tmp = strchr(client_modes, 'a');
#line 687
  if (__cil_tmp) {
#line 688
    return ("G");
  }
#line 689
  return ("H");
}
}
#line 693 "irc-info.c"
static char const   *who_flags_qualifier(char const   *chan_user_modes ) 
{ char *__cil_tmp ;
  char *__cil_tmp___0 ;

  {
#line 696
  __cil_tmp___0 = strchr(chan_user_modes, 'o');
#line 696
  if (__cil_tmp___0) {
#line 697
    return ("@");
  } else {
#line 698
    __cil_tmp = strchr(chan_user_modes, 'v');
#line 698
    if (__cil_tmp) {
#line 699
      return ("+");
    }
  }
#line 700
  return ("");
}
}
#line 704 "irc-info.c"
static int IRC_Send_WHO(CLIENT *Client , CHANNEL *Chan , int OnlyOps ) 
{ int is_visible ;
  int is_member ;
  int is_ircop ;
  CL2CHAN *cl2chan ;
  char const   *client_modes ;
  char const   *chan_user_modes ;
  char flags[8] ;
  CLIENT *c ;
  char const   *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char const   *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  char const   *__cil_tmp___9 ;
  char const   *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  char const   *__cil_tmp___12 ;
  char *__cil_tmp___13 ;
  int __cil_tmp___14 ;

  {
#line 717
  is_member = Channel_IsMemberOf(Chan, Client);
#line 720
  if (! is_member) {
#line 720
    __cil_tmp___2 = Channel_Modes(Chan);
#line 720
    __cil_tmp___3 = strchr((char const   *)__cil_tmp___2, 's');
#line 720
    if (__cil_tmp___3) {
#line 721
      __cil_tmp = Channel_Name((CHANNEL const   *)Chan);
#line 721
      __cil_tmp___0 = Client_ID(Client);
#line 721
      __cil_tmp___1 = IRC_WriteStrClient(Client, (char *)"315 %s %s :End of WHO list",
                                         __cil_tmp___0, __cil_tmp);
#line 721
      return (__cil_tmp___1);
    } else {
#line 720
      goto _L;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 723
  cl2chan = Channel_FirstMember(Chan);
#line 724
  while (cl2chan) {
#line 725
    c = Channel_GetClient(cl2chan);
#line 727
    __cil_tmp___4 = Client_Modes(c);
#line 727
    client_modes = (char const   *)__cil_tmp___4;
#line 728
    __cil_tmp___5 = strchr(client_modes, 'o');
#line 728
    is_ircop = (unsigned int )__cil_tmp___5 != (unsigned int )((void *)0);
#line 729
    if (OnlyOps && ! is_ircop) {
#line 730
      goto __Cont;
    }
#line 732
    __cil_tmp___6 = strchr(client_modes, 'i');
#line 732
    is_visible = (unsigned int )__cil_tmp___6 == (unsigned int )((void *)0);
#line 733
    if (is_member || is_visible) {
#line 734
      __cil_tmp___7 = who_flags_status(client_modes);
#line 734
      strcpy((char * __restrict  )(flags), (char const   * __restrict  )__cil_tmp___7);
#line 735
      if (is_ircop) {
#line 736
        strlcat(flags, "*", sizeof(flags));
      }
#line 738
      __cil_tmp___8 = Channel_UserModes(Chan, c);
#line 738
      chan_user_modes = (char const   *)__cil_tmp___8;
#line 739
      __cil_tmp___9 = who_flags_qualifier(chan_user_modes);
#line 739
      strlcat(flags, __cil_tmp___9, sizeof(flags));
#line 741
      __cil_tmp___10 = Channel_Name((CHANNEL const   *)Chan);
#line 741
      __cil_tmp___11 = write_whoreply(Client, c, __cil_tmp___10, (char const   *)(flags));
#line 741
      if (! __cil_tmp___11) {
#line 742
        return (0);
      }
    }
    __Cont: /* CIL Label */ 
#line 724
    cl2chan = Channel_NextMember(Chan, cl2chan);
  }
#line 745
  __cil_tmp___12 = Channel_Name((CHANNEL const   *)Chan);
#line 745
  __cil_tmp___13 = Client_ID(Client);
#line 745
  __cil_tmp___14 = IRC_WriteStrClient(Client, (char *)"315 %s %s :End of WHO list",
                                      __cil_tmp___13, __cil_tmp___12);
#line 745
  return (__cil_tmp___14);
}
}
#line 750 "irc-info.c"
static int MatchCaseInsensitive(char const   *pattern , char const   *searchme ) 
{ char haystack[513] ;
  int __cil_tmp ;

  {
#line 755
  strlcpy(haystack, searchme, sizeof(haystack));
#line 757
  ngt_LowerStr(haystack);
#line 759
  __cil_tmp = Match(pattern, (char const   *)(haystack));
#line 759
  return (__cil_tmp);
}
}
#line 763 "irc-info.c"
int IRC_WHO(CLIENT *Client , REQUEST *Req ) 
{ int only_ops ;
  int have_arg ;
  int client_match ;
  char const   *channelname ;
  char const   *client_modes ;
  char const   *chan_user_modes ;
  char pattern[513] ;
  char flags[4] ;
  CL2CHAN *cl2chan ;
  CHANNEL *chan ;
  CHANNEL *cn ;
  CLIENT *c ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  CLIENT *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  char const   *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  char *__cil_tmp___18 ;
  char const   *__cil_tmp___19 ;
  int __cil_tmp___20 ;
  char *__cil_tmp___21 ;
  int __cil_tmp___22 ;

  {
#line 777
  if (Req->argc > 2) {
#line 778
    __cil_tmp = Client_ID(Client);
#line 778
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 778
    return (__cil_tmp___0);
  }
#line 780
  only_ops = 0;
#line 781
  have_arg = 0;
#line 783
  if (Req->argc == 2) {
#line 784
    __cil_tmp___1 = strcmp((char const   *)Req->argv[1], "o");
#line 784
    if (__cil_tmp___1 == 0) {
#line 785
      only_ops = 1;
    }
  }
#line 791
  IRC_SetPenalty(Client, 1L);
#line 792
  if (Req->argc >= 1) {
#line 793
    chan = Channel_Search((char const   *)Req->argv[0]);
#line 794
    if (chan) {
#line 795
      __cil_tmp___2 = IRC_Send_WHO(Client, chan, only_ops);
#line 795
      return (__cil_tmp___2);
    }
#line 796
    __cil_tmp___3 = strcmp((char const   *)Req->argv[0], "0");
#line 796
    if (__cil_tmp___3 != 0) {
#line 797
      have_arg = 1;
#line 798
      strlcpy(pattern, (char const   *)Req->argv[0], sizeof(pattern));
#line 799
      ngt_LowerStr(pattern);
#line 800
      IRC_SetPenalty(Client, 3L);
    }
  }
#line 804
  c = Client_First();
#line 804
  while ((unsigned int )c != (unsigned int )((void *)0)) {
#line 805
    __cil_tmp___4 = Client_Type(c);
#line 805
    if (__cil_tmp___4 != 16) {
#line 806
      goto __Cont;
    }
#line 819
    __cil_tmp___5 = Client_Modes(c);
#line 819
    client_modes = (char const   *)__cil_tmp___5;
#line 820
    __cil_tmp___6 = strchr(client_modes, 'i');
#line 820
    if (__cil_tmp___6) {
#line 821
      goto __Cont;
    }
#line 823
    if (only_ops) {
#line 823
      __cil_tmp___7 = strchr(client_modes, 'o');
#line 823
      if (__cil_tmp___7) {
#line 823
        goto _L;
      } else {
#line 824
        goto __Cont;
      }
    } else {
      _L: /* CIL Label */ ;
    }
#line 826
    if (have_arg) {
#line 827
      __cil_tmp___8 = Client_Hostname(c);
#line 827
      client_match = MatchCaseInsensitive((char const   *)(pattern), (char const   *)__cil_tmp___8);
#line 828
      if (! client_match) {
#line 829
        __cil_tmp___9 = Client_Introducer(c);
#line 829
        __cil_tmp___10 = Client_ID(__cil_tmp___9);
#line 829
        client_match = MatchCaseInsensitive((char const   *)(pattern), (char const   *)__cil_tmp___10);
      }
#line 830
      if (! client_match) {
#line 831
        __cil_tmp___11 = Client_Info(c);
#line 831
        client_match = Match((char const   *)Req->argv[0], (char const   *)__cil_tmp___11);
      }
#line 832
      if (! client_match) {
#line 833
        __cil_tmp___12 = Client_ID(c);
#line 833
        client_match = MatchCaseInsensitive((char const   *)(pattern), (char const   *)__cil_tmp___12);
      }
#line 835
      if (! client_match) {
#line 836
        goto __Cont;
      }
    }
#line 839
    __cil_tmp___13 = who_flags_status(client_modes);
#line 839
    strcpy((char * __restrict  )(flags), (char const   * __restrict  )__cil_tmp___13);
#line 841
    __cil_tmp___14 = strchr(client_modes, 'o');
#line 841
    if (__cil_tmp___14) {
#line 842
      strlcat(flags, "*", sizeof(flags));
    }
#line 845
    cl2chan = Channel_FirstChannelOf(c);
#line 846
    while (cl2chan) {
#line 847
      cn = Channel_GetChannel(cl2chan);
#line 848
      __cil_tmp___15 = Channel_IsMemberOf(cn, Client);
#line 848
      if (__cil_tmp___15) {
#line 848
        goto _L___0;
      } else {
#line 848
        __cil_tmp___16 = Channel_Modes(cn);
#line 848
        __cil_tmp___17 = strchr((char const   *)__cil_tmp___16, 's');
#line 848
        if (! __cil_tmp___17) {
          _L___0: /* CIL Label */ 
#line 851
          channelname = Channel_Name((CHANNEL const   *)cn);
#line 852
          break;
        }
      }
#line 854
      cl2chan = Channel_NextChannelOf(c, cl2chan);
    }
#line 856
    if (cl2chan) {
#line 857
      chan = Channel_GetChannel(cl2chan);
#line 858
      __cil_tmp___18 = Channel_UserModes(chan, c);
#line 858
      chan_user_modes = (char const   *)__cil_tmp___18;
#line 859
      __cil_tmp___19 = who_flags_qualifier(chan_user_modes);
#line 859
      strlcat(flags, __cil_tmp___19, sizeof(flags));
    } else {
#line 861
      channelname = "*";
    }
#line 863
    __cil_tmp___20 = write_whoreply(Client, c, channelname, (char const   *)(flags));
#line 863
    if (! __cil_tmp___20) {
#line 864
      return (0);
    }
    __Cont: /* CIL Label */ 
#line 804
    c = Client_Next(c);
  }
#line 867
  if (Req->argc > 0) {
#line 868
    channelname = (char const   *)Req->argv[0];
  } else {
#line 870
    channelname = "*";
  }
#line 872
  __cil_tmp___21 = Client_ID(Client);
#line 872
  __cil_tmp___22 = IRC_WriteStrClient(Client, (char *)"315 %s %s :End of WHO list",
                                      __cil_tmp___21, channelname);
#line 872
  return (__cil_tmp___22);
}
}
#line 876 "irc-info.c"
int IRC_WHOIS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *from ;
  CLIENT *target ;
  CLIENT *c ;
  char str[257] ;
  CL2CHAN *cl2chan ;
  CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  CLIENT *__cil_tmp___10 ;
  CLIENT *__cil_tmp___11 ;
  CLIENT *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  char *__cil_tmp___18 ;
  int __cil_tmp___19 ;
  CLIENT *__cil_tmp___20 ;
  char *__cil_tmp___21 ;
  CLIENT *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  char *__cil_tmp___24 ;
  char *__cil_tmp___25 ;
  int __cil_tmp___26 ;
  char *__cil_tmp___27 ;
  char *__cil_tmp___28 ;
  char *__cil_tmp___29 ;
  char *__cil_tmp___30 ;
  int __cil_tmp___31 ;
  size_t __cil_tmp___32 ;
  char *__cil_tmp___33 ;
  char *__cil_tmp___34 ;
  char *__cil_tmp___35 ;
  char *__cil_tmp___36 ;
  char const   *__cil_tmp___37 ;
  int __cil_tmp___38 ;
  char *__cil_tmp___39 ;
  char *__cil_tmp___40 ;
  size_t __cil_tmp___41 ;
  int __cil_tmp___42 ;
  size_t __cil_tmp___43 ;
  char *__cil_tmp___44 ;
  char *__cil_tmp___45 ;
  int __cil_tmp___46 ;
  int __cil_tmp___47 ;
  CONN_ID __cil_tmp___48 ;
  time_t __cil_tmp___49 ;
  CONN_ID __cil_tmp___50 ;
  time_t __cil_tmp___51 ;
  char *__cil_tmp___52 ;
  char *__cil_tmp___53 ;
  int __cil_tmp___54 ;
  CONN_ID __cil_tmp___55 ;
  char *__cil_tmp___56 ;
  char *__cil_tmp___57 ;
  char *__cil_tmp___58 ;
  int __cil_tmp___59 ;
  int __cil_tmp___60 ;
  char *__cil_tmp___61 ;
  char *__cil_tmp___62 ;
  int __cil_tmp___63 ;

  {
#line 888
  if (Req->argc < 1 || Req->argc > 2) {
#line 888
    __cil_tmp = Client_ID(Client);
#line 888
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 888
    return (__cil_tmp___0);
  }
#line 891
  c = Client_Search(Req->argv[Req->argc - 1]);
#line 892
  if (! c) {
#line 892
    goto _L;
  } else {
#line 892
    __cil_tmp___3 = Client_Type(c);
#line 892
    if (__cil_tmp___3 != 16) {
      _L: /* CIL Label */ 
#line 892
      __cil_tmp___1 = Client_ID(Client);
#line 892
      __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                         __cil_tmp___1, Req->argv[Req->argc - 1]);
#line 892
      return (__cil_tmp___2);
    }
  }
#line 895
  __cil_tmp___4 = Client_Type(Client);
#line 895
  if (__cil_tmp___4 == 32) {
#line 895
    from = Client_Search(Req->prefix);
  } else {
#line 896
    from = Client;
  }
#line 897
  if (! from) {
#line 897
    __cil_tmp___5 = Client_ID(Client);
#line 897
    __cil_tmp___6 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___5, Req->prefix);
#line 897
    return (__cil_tmp___6);
  }
#line 900
  if (Req->argc > 1) {
#line 903
    target = Client_Search(Req->argv[0]);
#line 904
    if (! target) {
#line 904
      __cil_tmp___7 = Client_ID(from);
#line 904
      __cil_tmp___8 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                         __cil_tmp___7, Req->argv[0]);
#line 904
      return (__cil_tmp___8);
    }
  } else {
#line 906
    target = Client_ThisServer();
  }
#line 910
  __cil_tmp___10 = Client_NextHop(target);
#line 910
  __cil_tmp___11 = Client_ThisServer();
#line 910
  if ((unsigned int )__cil_tmp___10 != (unsigned int )__cil_tmp___11) {
#line 910
    __cil_tmp___12 = Client_NextHop(target);
#line 910
    __cil_tmp___13 = Client_Type(__cil_tmp___12);
#line 910
    if (__cil_tmp___13 == 32) {
#line 910
      __cil_tmp___9 = IRC_WriteStrClientPrefix(target, from, (char *)"WHOIS %s :%s",
                                               Req->argv[0], Req->argv[1]);
#line 910
      return (__cil_tmp___9);
    } else {
#line 910
      goto _L___0;
    }
  } else {
    _L___0: /* CIL Label */ ;
  }
#line 913
  __cil_tmp___14 = Client_Info(c);
#line 913
  __cil_tmp___15 = Client_Hostname(c);
#line 913
  __cil_tmp___16 = Client_User(c);
#line 913
  __cil_tmp___17 = Client_ID(c);
#line 913
  __cil_tmp___18 = Client_ID(from);
#line 913
  __cil_tmp___19 = IRC_WriteStrClient(from, (char *)"311 %s %s %s %s * :%s", __cil_tmp___18,
                                      __cil_tmp___17, __cil_tmp___16, __cil_tmp___15,
                                      __cil_tmp___14);
#line 913
  if (! __cil_tmp___19) {
#line 913
    return (0);
  }
#line 916
  __cil_tmp___20 = Client_Introducer(c);
#line 916
  __cil_tmp___21 = Client_Info(__cil_tmp___20);
#line 916
  __cil_tmp___22 = Client_Introducer(c);
#line 916
  __cil_tmp___23 = Client_ID(__cil_tmp___22);
#line 916
  __cil_tmp___24 = Client_ID(c);
#line 916
  __cil_tmp___25 = Client_ID(from);
#line 916
  __cil_tmp___26 = IRC_WriteStrClient(from, (char *)"312 %s %s %s :%s", __cil_tmp___25,
                                      __cil_tmp___24, __cil_tmp___23, __cil_tmp___21);
#line 916
  if (! __cil_tmp___26) {
#line 916
    return (0);
  }
#line 919
  __cil_tmp___27 = Client_ID(c);
#line 919
  __cil_tmp___28 = Client_ID(from);
#line 919
  snprintf((char * __restrict  )(str), sizeof(str), (char const   * __restrict  )"319 %s %s :",
           __cil_tmp___28, __cil_tmp___27);
#line 920
  cl2chan = Channel_FirstChannelOf(c);
#line 921
  while (cl2chan) {
#line 923
    chan = Channel_GetChannel(cl2chan);
#line 927
    cl2chan = Channel_NextChannelOf(c, cl2chan);
#line 930
    __cil_tmp___29 = Channel_Modes(chan);
#line 930
    __cil_tmp___30 = strchr((char const   *)__cil_tmp___29, 's');
#line 930
    if (__cil_tmp___30) {
#line 930
      __cil_tmp___31 = Channel_IsMemberOf(chan, Client);
#line 930
      if (__cil_tmp___31) {
#line 930
        goto _L___1;
      } else {
#line 930
        continue;
      }
    } else {
      _L___1: /* CIL Label */ ;
    }
#line 933
    __cil_tmp___32 = strlen((char const   *)(str));
#line 933
    if ((int )str[__cil_tmp___32 - 1U] != 58) {
#line 933
      strlcat(str, " ", sizeof(str));
    }
#line 934
    __cil_tmp___35 = Channel_UserModes(chan, c);
#line 934
    __cil_tmp___36 = strchr((char const   *)__cil_tmp___35, 'o');
#line 934
    if (__cil_tmp___36) {
#line 934
      strlcat(str, "@", sizeof(str));
    } else {
#line 935
      __cil_tmp___33 = Channel_UserModes(chan, c);
#line 935
      __cil_tmp___34 = strchr((char const   *)__cil_tmp___33, 'v');
#line 935
      if (__cil_tmp___34) {
#line 935
        strlcat(str, "+", sizeof(str));
      }
    }
#line 936
    __cil_tmp___37 = Channel_Name((CHANNEL const   *)chan);
#line 936
    strlcat(str, __cil_tmp___37, sizeof(str));
#line 938
    __cil_tmp___41 = strlen((char const   *)(str));
#line 938
    if (__cil_tmp___41 > 201U) {
#line 941
      __cil_tmp___38 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 941
      if (! __cil_tmp___38) {
#line 941
        return (0);
      }
#line 942
      __cil_tmp___39 = Client_ID(c);
#line 942
      __cil_tmp___40 = Client_ID(from);
#line 942
      snprintf((char * __restrict  )(str), sizeof(str), (char const   * __restrict  )"319 %s %s :",
               __cil_tmp___40, __cil_tmp___39);
    }
  }
#line 945
  __cil_tmp___43 = strlen((char const   *)(str));
#line 945
  if ((int )str[__cil_tmp___43 - 1U] != 58) {
#line 948
    __cil_tmp___42 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 948
    if (! __cil_tmp___42) {
#line 948
      return (0);
    }
  }
#line 952
  __cil_tmp___47 = Client_HasMode(c, (char )'o');
#line 952
  if (__cil_tmp___47) {
#line 954
    __cil_tmp___44 = Client_ID(c);
#line 954
    __cil_tmp___45 = Client_ID(from);
#line 954
    __cil_tmp___46 = IRC_WriteStrClient(from, (char *)"313 %s %s :is an IRC operator",
                                        __cil_tmp___45, __cil_tmp___44);
#line 954
    if (! __cil_tmp___46) {
#line 954
      return (0);
    }
  }
#line 958
  __cil_tmp___55 = Client_Conn(c);
#line 958
  if (__cil_tmp___55 > -1) {
#line 959
    __cil_tmp___48 = Client_Conn(c);
#line 959
    __cil_tmp___49 = Conn_GetSignon(__cil_tmp___48);
#line 959
    __cil_tmp___50 = Client_Conn(c);
#line 959
    __cil_tmp___51 = Conn_GetIdle(__cil_tmp___50);
#line 959
    __cil_tmp___52 = Client_ID(c);
#line 959
    __cil_tmp___53 = Client_ID(from);
#line 959
    __cil_tmp___54 = IRC_WriteStrClient(from, (char *)"317 %s %s %lu %lu :seconds idle, signon time",
                                        __cil_tmp___53, __cil_tmp___52, (unsigned long )__cil_tmp___51,
                                        (unsigned long )__cil_tmp___49);
#line 959
    if (! __cil_tmp___54) {
#line 963
      return (0);
    }
  }
#line 967
  __cil_tmp___60 = Client_HasMode(c, (char )'a');
#line 967
  if (__cil_tmp___60) {
#line 969
    __cil_tmp___56 = Client_Away(c);
#line 969
    __cil_tmp___57 = Client_ID(c);
#line 969
    __cil_tmp___58 = Client_ID(from);
#line 969
    __cil_tmp___59 = IRC_WriteStrClient(from, (char *)"301 %s %s :%s", __cil_tmp___58,
                                        __cil_tmp___57, __cil_tmp___56);
#line 969
    if (! __cil_tmp___59) {
#line 969
      return (0);
    }
  }
#line 973
  __cil_tmp___61 = Client_ID(c);
#line 973
  __cil_tmp___62 = Client_ID(from);
#line 973
  __cil_tmp___63 = IRC_WriteStrClient(from, (char *)"318 %s %s :End of WHOIS list",
                                      __cil_tmp___62, __cil_tmp___61);
#line 973
  return (__cil_tmp___63);
}
}
#line 982 "irc-info.c"
int IRC_WHOWAS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *prefix ;
  WHOWAS *whowas ;
  int max ;
  int last ;
  int count ;
  int i ;
  char t_str[60] ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  struct tm *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int __cil_tmp___10 ;
  char *__cil_tmp___11 ;
  int __cil_tmp___12 ;
  int __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;

  {
#line 994
  if (Req->argc < 1 || Req->argc > 3) {
#line 995
    __cil_tmp = Client_ID(Client);
#line 995
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 995
    return (__cil_tmp___0);
  }
#line 999
  if (Req->argc == 3) {
#line 1000
    target = Client_Search(Req->argv[2]);
  } else {
#line 1002
    target = Client_ThisServer();
  }
#line 1005
  __cil_tmp___1 = Client_Type(Client);
#line 1005
  if (__cil_tmp___1 == 32) {
#line 1006
    prefix = Client_Search(Req->prefix);
  } else {
#line 1008
    prefix = Client;
  }
#line 1010
  if (! prefix) {
#line 1011
    __cil_tmp___2 = Client_ID(Client);
#line 1011
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 1011
    return (__cil_tmp___3);
  }
#line 1015
  __cil_tmp___7 = Client_ThisServer();
#line 1015
  if ((unsigned int )target != (unsigned int )__cil_tmp___7) {
#line 1017
    if (! target) {
#line 1017
      goto _L;
    } else {
#line 1017
      __cil_tmp___6 = Client_Type(target);
#line 1017
      if (__cil_tmp___6 != 32) {
        _L: /* CIL Label */ 
#line 1018
        __cil_tmp___4 = Client_ID(prefix);
#line 1018
        __cil_tmp___5 = IRC_WriteStrClient(prefix, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[2]);
#line 1018
        return (__cil_tmp___5);
      }
    }
#line 1023
    IRC_WriteStrClientPrefix(target, prefix, (char *)"WHOWAS %s %s %s", Req->argv[0],
                             Req->argv[1], Req->argv[2]);
#line 1026
    return (1);
  }
#line 1029
  whowas = Client_GetWhowas();
#line 1030
  last = Client_GetLastWhowasIndex();
#line 1031
  if (last < 0) {
#line 1031
    last = 0;
  }
#line 1033
  if (Req->argc > 1) {
#line 1035
    max = atoi((char const   *)Req->argv[1]);
#line 1036
    if (max < 1) {
#line 1036
      max = 64;
    }
  } else {
#line 1039
    max = 5;
  }
#line 1041
  i = last;
#line 1042
  count = 0;
#line 1043
  while (1) {
#line 1046
    if ((whowas + i)->time > 0L) {
#line 1046
      __cil_tmp___13 = strcasecmp((char const   *)Req->argv[0], (char const   *)((whowas + i)->id));
#line 1046
      if (__cil_tmp___13 == 0) {
#line 1049
        __cil_tmp___8 = localtime((time_t const   *)(& (whowas + i)->time));
#line 1049
        strftime((char * __restrict  )(t_str), sizeof(t_str), (char const   * __restrict  )"%a %b %d %H:%M:%S %Y",
                 (struct tm  const  * __restrict  )__cil_tmp___8);
#line 1053
        __cil_tmp___9 = Client_ID(prefix);
#line 1053
        __cil_tmp___10 = IRC_WriteStrClient(prefix, (char *)"314 %s %s %s %s * :%s",
                                            __cil_tmp___9, (whowas + i)->id, (whowas + i)->user,
                                            (whowas + i)->host, (whowas + i)->info);
#line 1053
        if (! __cil_tmp___10) {
#line 1059
          return (0);
        }
#line 1061
        __cil_tmp___11 = Client_ID(prefix);
#line 1061
        __cil_tmp___12 = IRC_WriteStrClient(prefix, (char *)"312 %s %s %s :%s", __cil_tmp___11,
                                            (whowas + i)->id, (whowas + i)->server,
                                            t_str);
#line 1061
        if (! __cil_tmp___12) {
#line 1065
          return (0);
        }
#line 1067
        count ++;
#line 1068
        if (count >= max) {
#line 1068
          break;
        }
      } else {
#line 1046
        goto _L___0;
      }
    } else {
      _L___0: /* CIL Label */ ;
    }
#line 1072
    i --;
#line 1075
    if (i < 0) {
#line 1075
      i = 63;
    }
#line 1043
    if (! (i != last)) {
#line 1043
      break;
    }
  }
#line 1078
  __cil_tmp___14 = Client_ID(prefix);
#line 1078
  __cil_tmp___15 = IRC_WriteStrClient(prefix, (char *)"369 %s %s :End of WHOWAS list",
                                      __cil_tmp___14, Req->argv[0]);
#line 1078
  return (__cil_tmp___15);
}
}
#line 1083 "irc-info.c"
int IRC_Send_LUSERS(CLIENT *Client ) 
{ unsigned long cnt ;
  unsigned long max ;
  long __cil_tmp ;
  long __cil_tmp___0 ;
  long __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  unsigned long __cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int __cil_tmp___10 ;
  unsigned long __cil_tmp___11 ;
  long __cil_tmp___12 ;
  long __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;
  long __cil_tmp___16 ;
  long __cil_tmp___17 ;
  char *__cil_tmp___18 ;
  int __cil_tmp___19 ;
  long __cil_tmp___20 ;
  long __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;

  {
#line 1094
  __cil_tmp = Client_ServerCount();
#line 1094
  __cil_tmp___0 = Client_ServiceCount();
#line 1094
  __cil_tmp___1 = Client_UserCount();
#line 1094
  __cil_tmp___2 = Client_ID(Client);
#line 1094
  __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"251 %s :There are %ld users and %ld services on %ld servers",
                                     __cil_tmp___2, __cil_tmp___1, __cil_tmp___0,
                                     __cil_tmp);
#line 1094
  if (! __cil_tmp___3) {
#line 1094
    return (0);
  }
#line 1097
  cnt = Client_OperCount();
#line 1098
  if (cnt > 0UL) {
#line 1100
    __cil_tmp___4 = Client_ID(Client);
#line 1100
    __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"252 %s %lu :operator(s) online",
                                       __cil_tmp___4, cnt);
#line 1100
    if (! __cil_tmp___5) {
#line 1100
      return (0);
    }
  }
#line 1104
  cnt = Client_UnknownCount();
#line 1105
  if (cnt > 0UL) {
#line 1107
    __cil_tmp___6 = Client_ID(Client);
#line 1107
    __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"253 %s %lu :unknown connection(s)",
                                       __cil_tmp___6, cnt);
#line 1107
    if (! __cil_tmp___7) {
#line 1107
      return (0);
    }
  }
#line 1111
  __cil_tmp___8 = Channel_Count();
#line 1111
  __cil_tmp___9 = Client_ID(Client);
#line 1111
  __cil_tmp___10 = IRC_WriteStrClient(Client, (char *)"254 %s %lu :channels formed",
                                      __cil_tmp___9, __cil_tmp___8);
#line 1111
  if (! __cil_tmp___10) {
#line 1111
    return (0);
  }
#line 1114
  __cil_tmp___11 = Client_MyServerCount();
#line 1114
  __cil_tmp___12 = Client_MyServiceCount();
#line 1114
  __cil_tmp___13 = Client_MyUserCount();
#line 1114
  __cil_tmp___14 = Client_ID(Client);
#line 1114
  __cil_tmp___15 = IRC_WriteStrClient(Client, (char *)"255 %s :I have %lu users, %lu services and %lu servers",
                                      __cil_tmp___14, __cil_tmp___13, __cil_tmp___12,
                                      __cil_tmp___11);
#line 1114
  if (! __cil_tmp___15) {
#line 1114
    return (0);
  }
#line 1118
  __cil_tmp___16 = Client_MyUserCount();
#line 1118
  cnt = (unsigned long )__cil_tmp___16;
#line 1119
  __cil_tmp___17 = Client_MyMaxUserCount();
#line 1119
  max = (unsigned long )__cil_tmp___17;
#line 1120
  __cil_tmp___18 = Client_ID(Client);
#line 1120
  __cil_tmp___19 = IRC_WriteStrClient(Client, (char *)"265 %s %lu %lu :Current local users: %lu, Max: %lu",
                                      __cil_tmp___18, cnt, max, cnt, max);
#line 1120
  if (! __cil_tmp___19) {
#line 1122
    return (0);
  }
#line 1124
  __cil_tmp___20 = Client_UserCount();
#line 1124
  cnt = (unsigned long )__cil_tmp___20;
#line 1125
  __cil_tmp___21 = Client_MaxUserCount();
#line 1125
  max = (unsigned long )__cil_tmp___21;
#line 1126
  __cil_tmp___22 = Client_ID(Client);
#line 1126
  __cil_tmp___23 = IRC_WriteStrClient(Client, (char *)"266 %s %lu %lu :Current global users: %lu, Max: %lu",
                                      __cil_tmp___22, cnt, max, cnt, max);
#line 1126
  if (! __cil_tmp___23) {
#line 1128
    return (0);
  }
#line 1131
  return (1);
}
}
#line 1135 "irc-info.c"
static int Show_MOTD_Start(CLIENT *Client ) 
{ CLIENT *__cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 1138
  __cil_tmp = Client_ThisServer();
#line 1138
  __cil_tmp___0 = Client_ID(__cil_tmp);
#line 1138
  __cil_tmp___1 = Client_ID(Client);
#line 1138
  __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"375 %s :- %s message of the day",
                                     __cil_tmp___1, __cil_tmp___0);
#line 1138
  return (__cil_tmp___2);
}
}
#line 1142 "irc-info.c"
static int Show_MOTD_Sendline(CLIENT *Client , char const   *msg ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 1145
  __cil_tmp = Client_ID(Client);
#line 1145
  __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"372 %s :- %s", __cil_tmp, msg);
#line 1145
  return (__cil_tmp___0);
}
}
#line 1148 "irc-info.c"
static int Show_MOTD_End(CLIENT *Client ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 1151
  __cil_tmp = Client_ID(Client);
#line 1151
  __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"376 %s :End of MOTD command",
                                     __cil_tmp);
#line 1151
  return (__cil_tmp___0);
}
}
#line 1155 "irc-info.c"
int IRC_Show_MOTD(CLIENT *Client ) 
{ char line[127] ;
  FILE *fd ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 1163
  if (Conf_MotdPhrase[0]) {
#line 1164
    __cil_tmp = Show_MOTD_Start(Client);
#line 1164
    if (! __cil_tmp) {
#line 1165
      return (0);
    }
#line 1166
    __cil_tmp___0 = Show_MOTD_Sendline(Client, (char const   *)(Conf_MotdPhrase));
#line 1166
    if (! __cil_tmp___0) {
#line 1167
      return (0);
    }
#line 1169
    __cil_tmp___1 = Show_MOTD_End(Client);
#line 1169
    return (__cil_tmp___1);
  }
#line 1172
  fd = fopen((char const   * __restrict  )(Conf_MotdFile), (char const   * __restrict  )"r");
#line 1173
  if (! fd) {
#line 1174
    __cil_tmp___2 = __errno_location();
#line 1174
    __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 1174
    Log(4, "Can\'t read MOTD file \"%s\": %s", Conf_MotdFile, __cil_tmp___3);
#line 1175
    __cil_tmp___4 = Client_ID(Client);
#line 1175
    __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"422 %s :MOTD file is missing",
                                       __cil_tmp___4);
#line 1175
    return (__cil_tmp___5);
  }
#line 1178
  __cil_tmp___6 = Show_MOTD_Start(Client);
#line 1178
  if (! __cil_tmp___6) {
#line 1179
    fclose(fd);
#line 1180
    return (0);
  }
#line 1183
  while (1) {
#line 1183
    __cil_tmp___8 = fgets((char * __restrict  )(line), (int )sizeof(line), (FILE * __restrict  )fd);
#line 1183
    if (! __cil_tmp___8) {
#line 1183
      break;
    }
#line 1184
    ngt_TrimLastChr(line, (char )'\n');
#line 1186
    __cil_tmp___7 = Show_MOTD_Sendline(Client, (char const   *)(line));
#line 1186
    if (! __cil_tmp___7) {
#line 1187
      fclose(fd);
#line 1188
      return (0);
    }
  }
#line 1191
  fclose(fd);
#line 1192
  __cil_tmp___9 = Show_MOTD_End(Client);
#line 1192
  return (__cil_tmp___9);
}
}
#line 1196 "irc-info.c"
int IRC_Send_NAMES(CLIENT *Client , CHANNEL *Chan ) 
{ int is_visible ;
  int is_member ;
  char str[257] ;
  CL2CHAN *cl2chan ;
  CLIENT *cl ;
  int __cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char const   *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  size_t __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  int __cil_tmp___12 ;
  char const   *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  size_t __cil_tmp___15 ;
  int __cil_tmp___16 ;
  size_t __cil_tmp___17 ;

  {
#line 1207
  __cil_tmp = Channel_IsMemberOf(Chan, Client);
#line 1207
  if (__cil_tmp) {
#line 1207
    is_member = 1;
  } else {
#line 1208
    is_member = 0;
  }
#line 1211
  if (! is_member) {
#line 1211
    __cil_tmp___0 = Channel_Modes(Chan);
#line 1211
    __cil_tmp___1 = strchr((char const   *)__cil_tmp___0, 's');
#line 1211
    if (__cil_tmp___1) {
#line 1211
      return (1);
    } else {
#line 1211
      goto _L;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 1214
  __cil_tmp___2 = Channel_Name((CHANNEL const   *)Chan);
#line 1214
  __cil_tmp___3 = Client_ID(Client);
#line 1214
  snprintf((char * __restrict  )(str), sizeof(str), (char const   * __restrict  )"353 %s %s %s :",
           __cil_tmp___3, "=", __cil_tmp___2);
#line 1215
  cl2chan = Channel_FirstMember(Chan);
#line 1216
  while (cl2chan) {
#line 1218
    cl = Channel_GetClient(cl2chan);
#line 1220
    __cil_tmp___4 = Client_Modes(cl);
#line 1220
    __cil_tmp___5 = strchr((char const   *)__cil_tmp___4, 'i');
#line 1220
    if (__cil_tmp___5) {
#line 1220
      is_visible = 0;
    } else {
#line 1221
      is_visible = 1;
    }
#line 1223
    if (is_member || is_visible) {
#line 1226
      __cil_tmp___6 = strlen((char const   *)(str));
#line 1226
      if ((int )str[__cil_tmp___6 - 1U] != 58) {
#line 1226
        strlcat(str, " ", sizeof(str));
      }
#line 1227
      __cil_tmp___9 = Channel_UserModes(Chan, cl);
#line 1227
      __cil_tmp___10 = strchr((char const   *)__cil_tmp___9, 'o');
#line 1227
      if (__cil_tmp___10) {
#line 1227
        strlcat(str, "@", sizeof(str));
      } else {
#line 1228
        __cil_tmp___7 = Channel_UserModes(Chan, cl);
#line 1228
        __cil_tmp___8 = strchr((char const   *)__cil_tmp___7, 'v');
#line 1228
        if (__cil_tmp___8) {
#line 1228
          strlcat(str, "+", sizeof(str));
        }
      }
#line 1229
      __cil_tmp___11 = Client_ID(cl);
#line 1229
      strlcat(str, (char const   *)__cil_tmp___11, sizeof(str));
#line 1231
      __cil_tmp___15 = strlen((char const   *)(str));
#line 1231
      if (__cil_tmp___15 > 220U) {
#line 1234
        __cil_tmp___12 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 1234
        if (! __cil_tmp___12) {
#line 1234
          return (0);
        }
#line 1235
        __cil_tmp___13 = Channel_Name((CHANNEL const   *)Chan);
#line 1235
        __cil_tmp___14 = Client_ID(Client);
#line 1235
        snprintf((char * __restrict  )(str), sizeof(str), (char const   * __restrict  )"353 %s %s %s :",
                 __cil_tmp___14, "=", __cil_tmp___13);
      }
    }
#line 1240
    cl2chan = Channel_NextMember(Chan, cl2chan);
  }
#line 1242
  __cil_tmp___17 = strlen((char const   *)(str));
#line 1242
  if ((int )str[__cil_tmp___17 - 1U] != 58) {
#line 1245
    __cil_tmp___16 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 1245
    if (! __cil_tmp___16) {
#line 1245
      return (0);
    }
  }
#line 1248
  return (1);
}
}
#line 1258 "irc-info.c"
int IRC_Send_ISUPPORT(CLIENT *Client ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 1261
  __cil_tmp = Client_ID(Client);
#line 1261
  __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"005 %s RFC2812 CASEMAPPING=ascii PREFIX=(ov)@+ CHANTYPES=# CHANMODES=bI,k,l,imnPst CHANLIMIT=#:%d :are supported on this server",
                                     __cil_tmp, Conf_MaxJoins);
#line 1261
  if (! __cil_tmp___0) {
#line 1263
    return (0);
  }
#line 1264
  __cil_tmp___1 = Client_ID(Client);
#line 1264
  __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"005 %s CHANNELLEN=%d NICKLEN=%d TOPICLEN=%d AWAYLEN=%d KICKLEN=%d PENALTY :are supported on this server",
                                     __cil_tmp___1, 50, Conf_MaxNickLength - 1U, 490,
                                     127, 400);
#line 1264
  return (__cil_tmp___2);
}
}
#line 1 "irc-login.o"
#pragma merger(0,"/tmp/cil-4xhAHmfB.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 27 "irc-write.h"
void IRC_WriteStrServers(CLIENT *ExceptOf , char *Format  , ...) ;
#line 21 "irc-login.h"
int IRC_PASS(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_NICK(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_USER(CLIENT *Client , REQUEST *Req ) ;
#line 24
int IRC_PING(CLIENT *Client , REQUEST *Req ) ;
#line 25
int IRC_PONG(CLIENT *Client , REQUEST *Req ) ;
#line 26
int IRC_QUIT(CLIENT *Client , REQUEST *Req ) ;
#line 41 "irc-login.c"
static int Hello_User(CLIENT *Client ) ;
#line 42
static void Kill_Nick(char *Nick , char *Reason ) ;
#line 49 "irc-login.c"
int IRC_PASS(CLIENT *Client , REQUEST *Req ) 
{ char *type ;
  char *orig_flags ;
  int protohigh ;
  int protolow ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  CONN_ID __cil_tmp___1 ;
  CONN_ID __cil_tmp___2 ;
  CONN_ID __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  int __cil_tmp___10 ;
  int __cil_tmp___11 ;
  int __cil_tmp___12 ;
  int c2 ;
  int c4 ;
  size_t __cil_tmp___13 ;
  size_t __cil_tmp___14 ;
  char *impl ;
  char *ptr ;
  char *serverver ;
  char *flags ;
  char *__cil_tmp___15 ;
  int __cil_tmp___16 ;

  {
#line 59
  __cil_tmp___1 = Client_Conn(Client);
#line 59
  if (__cil_tmp___1 <= -1) {
#line 60
    __cil_tmp = Client_ID(Client);
#line 60
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"421 %s %s :Unknown command",
                                       __cil_tmp, Req->command);
#line 60
    return (__cil_tmp___0);
  }
#line 63
  __cil_tmp___12 = Client_Type(Client);
#line 63
  if (__cil_tmp___12 == 1 && Req->argc == 1) {
#line 67
    __cil_tmp___2 = Client_Conn(Client);
#line 67
    LogDebug("Connection %d: got PASS command ...", __cil_tmp___2);
  } else {
#line 69
    __cil_tmp___10 = Client_Type(Client);
#line 69
    if (__cil_tmp___10 == 1) {
#line 69
      goto _L___1;
    } else {
#line 69
      __cil_tmp___11 = Client_Type(Client);
#line 69
      if (__cil_tmp___11 == 128) {
        _L___1: /* CIL Label */ 
#line 69
        if (Req->argc == 3 || Req->argc == 4) {
#line 75
          __cil_tmp___3 = Client_Conn(Client);
#line 75
          LogDebug("Connection %d: got PASS command (new server link) ...", __cil_tmp___3);
        } else {
#line 69
          goto _L___0;
        }
      } else {
        _L___0: /* CIL Label */ 
#line 77
        __cil_tmp___8 = Client_Type(Client);
#line 77
        if (__cil_tmp___8 == 1) {
#line 77
          goto _L;
        } else {
#line 77
          __cil_tmp___9 = Client_Type(Client);
#line 77
          if (__cil_tmp___9 == 128) {
            _L: /* CIL Label */ 
#line 80
            __cil_tmp___4 = Client_ID(Client);
#line 80
            __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                               __cil_tmp___4, Req->command);
#line 80
            return (__cil_tmp___5);
          } else {
#line 84
            __cil_tmp___6 = Client_ID(Client);
#line 84
            __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"462 %s :Connection already registered",
                                               __cil_tmp___6);
#line 84
            return (__cil_tmp___7);
          }
        }
      }
    }
  }
#line 88
  Client_SetPassword(Client, Req->argv[0]);
#line 89
  Client_SetType(Client, 2);
#line 92
  if (Req->argc >= 2) {
#line 92
    __cil_tmp___13 = strlen((char const   *)Req->argv[1]);
#line 92
    if (__cil_tmp___13 >= 4U) {
#line 95
      c2 = (int )*(Req->argv[1] + 2);
#line 96
      c4 = (int )*(Req->argv[1] + 4);
#line 98
      *(Req->argv[1] + 4) = (char )'\000';
#line 99
      protolow = atoi((char const   *)(Req->argv[1] + 2));
#line 100
      *(Req->argv[1] + 2) = (char )'\000';
#line 101
      protohigh = atoi((char const   *)Req->argv[1]);
#line 103
      *(Req->argv[1] + 2) = (char )c2;
#line 104
      *(Req->argv[1] + 4) = (char )c4;
    } else {
#line 92
      goto _L___2;
    }
  } else {
    _L___2: /* CIL Label */ 
#line 106
    protolow = 0;
#line 106
    protohigh = protolow;
  }
#line 109
  if (Req->argc >= 2) {
#line 109
    __cil_tmp___14 = strlen((char const   *)Req->argv[1]);
#line 109
    if (__cil_tmp___14 > 4U) {
#line 110
      type = Req->argv[1] + 4;
    } else {
#line 109
      goto _L___3;
    }
  } else {
    _L___3: /* CIL Label */ 
#line 112
    type = (char *)((void *)0);
  }
#line 115
  if (Req->argc >= 4) {
#line 116
    orig_flags = Req->argv[3];
  } else {
#line 118
    orig_flags = (char *)"";
  }
#line 121
  if (Req->argc >= 3) {
#line 124
    impl = Req->argv[2];
#line 125
    ptr = strchr((char const   *)impl, '|');
#line 126
    if (ptr) {
#line 127
      *ptr = (char )'\000';
    }
#line 129
    if (type) {
#line 129
      __cil_tmp___16 = strcmp((char const   *)type, "-IRC+");
#line 129
      if (__cil_tmp___16 == 0) {
#line 132
        serverver = ptr + 1;
#line 133
        flags = strchr((char const   *)serverver, ':');
#line 134
        if (flags) {
#line 135
          *flags = (char )'\000';
#line 136
          flags ++;
        } else {
#line 138
          flags = (char *)"";
        }
#line 139
        Log(6, "Peer announces itself as %s-%s using protocol %d.%d/IRC+ (flags: \"%s\").",
            impl, serverver, protohigh, protolow, flags);
      } else {
#line 129
        goto _L___4;
      }
    } else {
      _L___4: /* CIL Label */ 
#line 145
      serverver = (char *)"";
#line 146
      __cil_tmp___15 = strchr((char const   *)orig_flags, 'Z');
#line 146
      if (__cil_tmp___15) {
#line 147
        flags = (char *)"Z";
      } else {
#line 149
        flags = (char *)"";
      }
#line 150
      Log(6, "Peer announces itself as \"%s\" using protocol %d.%d (flags: \"%s\").",
          impl, protohigh, protolow, flags);
    }
#line 154
    Client_SetFlags(Client, flags);
  }
#line 157
  return (1);
}
}
#line 167 "irc-login.c"
int IRC_NICK(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *intr_c ;
  CLIENT *target ;
  CLIENT *c ;
  char *modes ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  CONN_ID __cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  char *__cil_tmp___15 ;
  CONN_ID __cil_tmp___16 ;
  char *__cil_tmp___17 ;
  char *__cil_tmp___18 ;
  char *__cil_tmp___19 ;
  CONN_ID __cil_tmp___20 ;
  int __cil_tmp___21 ;
  int __cil_tmp___22 ;
  int __cil_tmp___23 ;
  char *__cil_tmp___24 ;
  int __cil_tmp___25 ;
  char *__cil_tmp___26 ;
  int __cil_tmp___27 ;
  char *__cil_tmp___28 ;
  int __cil_tmp___29 ;
  int __cil_tmp___30 ;
  CONN_ID __cil_tmp___31 ;
  char const   *__cil_tmp___33 ;
  int __cil_tmp___34 ;
  int __cil_tmp___35 ;
  char *__cil_tmp___36 ;
  char *__cil_tmp___37 ;
  char *__cil_tmp___38 ;
  char const   *__cil_tmp___40 ;
  int __cil_tmp___41 ;
  int __cil_tmp___42 ;
  char *__cil_tmp___43 ;
  char *__cil_tmp___44 ;
  char *__cil_tmp___45 ;
  int __cil_tmp___46 ;
  int __cil_tmp___47 ;
  char *__cil_tmp___48 ;
  int __cil_tmp___49 ;
  int __cil_tmp___50 ;
  int __cil_tmp___51 ;
  int __cil_tmp___52 ;
  int __cil_tmp___53 ;
  int __cil_tmp___54 ;
  int __cil_tmp___55 ;
  int __cil_tmp___56 ;

  {
#line 179
  __cil_tmp___51 = Client_Type(Client);
#line 179
  if (__cil_tmp___51 == 1) {
#line 179
    goto _L___4;
  } else {
#line 179
    __cil_tmp___52 = Client_Type(Client);
#line 179
    if (__cil_tmp___52 == 2) {
      _L___4: /* CIL Label */ 
#line 179
      goto _L___3;
    } else {
#line 179
      __cil_tmp___53 = Client_Type(Client);
#line 179
      if (__cil_tmp___53 == 4) {
        _L___3: /* CIL Label */ 
#line 179
        goto _L___2;
      } else {
#line 179
        __cil_tmp___54 = Client_Type(Client);
#line 179
        if (__cil_tmp___54 == 8) {
          _L___2: /* CIL Label */ 
#line 179
          goto _L___1;
        } else {
#line 179
          __cil_tmp___55 = Client_Type(Client);
#line 179
          if (__cil_tmp___55 == 16) {
            _L___1: /* CIL Label */ 
#line 179
            goto _L___0;
          } else {
#line 179
            __cil_tmp___56 = Client_Type(Client);
#line 179
            if (__cil_tmp___56 == 32 && Req->argc == 1) {
              _L___0: /* CIL Label */ 
#line 196
              if (Req->argc != 1) {
#line 197
                __cil_tmp = Client_ID(Client);
#line 197
                __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                                   __cil_tmp, Req->command);
#line 197
                return (__cil_tmp___0);
              }
#line 202
              __cil_tmp___6 = Client_Type(Client);
#line 202
              if (__cil_tmp___6 == 32) {
#line 204
                target = Client_Search(Req->prefix);
#line 205
                if (! target) {
#line 206
                  __cil_tmp___1 = Client_ID(Client);
#line 206
                  __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                                     __cil_tmp___1, Req->argv[0]);
#line 206
                  return (__cil_tmp___2);
                }
              } else {
#line 214
                __cil_tmp___5 = Client_HasMode(Client, (char )'r');
#line 214
                if (__cil_tmp___5) {
#line 215
                  __cil_tmp___3 = Client_ID(Client);
#line 215
                  __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"484 %s :Your connection is restricted",
                                                     __cil_tmp___3);
#line 215
                  return (__cil_tmp___4);
                }
#line 219
                target = Client;
              }
#line 227
              __cil_tmp___7 = Client_ID(target);
#line 227
              __cil_tmp___8 = strcmp((char const   *)__cil_tmp___7, (char const   *)Req->argv[0]);
#line 227
              if (__cil_tmp___8 == 0) {
#line 228
                return (1);
              }
#line 233
              __cil_tmp___10 = Client_ID(target);
#line 233
              __cil_tmp___11 = strcasecmp((char const   *)__cil_tmp___10, (char const   *)Req->argv[0]);
#line 233
              if (__cil_tmp___11 != 0) {
#line 235
                __cil_tmp___9 = Client_CheckNick(target, Req->argv[0]);
#line 235
                if (! __cil_tmp___9) {
#line 236
                  return (1);
                }
              }
#line 239
              __cil_tmp___22 = Client_Type(target);
#line 239
              if (__cil_tmp___22 != 16) {
#line 239
                __cil_tmp___23 = Client_Type(target);
#line 239
                if (__cil_tmp___23 != 32) {
#line 243
                  __cil_tmp___12 = Client_Conn(Client);
#line 243
                  Log(7, "Connection %d: got valid NICK command ...", __cil_tmp___12);
#line 247
                  Client_SetID(target, Req->argv[0]);
#line 251
                  __cil_tmp___14 = Client_Type(Client);
#line 251
                  if (__cil_tmp___14 == 8) {
#line 252
                    __cil_tmp___13 = Hello_User(Client);
#line 252
                    return (__cil_tmp___13);
                  } else {
#line 254
                    Client_SetType(Client, 4);
                  }
                } else {
#line 239
                  goto _L;
                }
              } else {
                _L: /* CIL Label */ 
#line 259
                __cil_tmp___20 = Client_Conn(target);
#line 259
                if (__cil_tmp___20 > -1) {
#line 262
                  __cil_tmp___15 = Client_ID(target);
#line 262
                  __cil_tmp___16 = Client_Conn(target);
#line 262
                  __cil_tmp___17 = Client_Mask(target);
#line 262
                  Log(6, "User \"%s\" changed nick (connection %d): \"%s\" -> \"%s\".",
                      __cil_tmp___17, __cil_tmp___16, __cil_tmp___15, Req->argv[0]);
                } else {
#line 270
                  __cil_tmp___18 = Client_ID(target);
#line 270
                  __cil_tmp___19 = Client_Mask(target);
#line 270
                  Log(7, "User \"%s\" changed nick: \"%s\" -> \"%s\".", __cil_tmp___19,
                      __cil_tmp___18, Req->argv[0]);
                }
#line 278
                __cil_tmp___21 = Client_Type(Client);
#line 278
                if (__cil_tmp___21 == 16) {
#line 279
                  IRC_WriteStrClientPrefix(Client, Client, (char *)"NICK :%s", Req->argv[0]);
                }
#line 282
                IRC_WriteStrServersPrefix(Client, target, (char *)"NICK :%s", Req->argv[0]);
#line 284
                IRC_WriteStrRelatedPrefix(target, target, 0, (char *)"NICK :%s", Req->argv[0]);
#line 288
                Client_RegisterWhowas(target);
#line 291
                Client_SetID(target, Req->argv[0]);
#line 293
                IRC_SetPenalty(target, 2L);
              }
#line 296
              return (1);
            } else {
#line 298
              __cil_tmp___50 = Client_Type(Client);
#line 298
              if (__cil_tmp___50 == 32) {
#line 303
                if (Req->argc != 7) {
#line 303
                  __cil_tmp___24 = Client_ID(Client);
#line 303
                  __cil_tmp___25 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                                      __cil_tmp___24, Req->command);
#line 303
                  return (__cil_tmp___25);
                }
#line 306
                c = Client_Search(Req->argv[0]);
#line 307
                if (c) {
#line 312
                  __cil_tmp___26 = Client_ID(Client);
#line 312
                  Log(3, "Server %s introduces already registered nick \"%s\"!", __cil_tmp___26,
                      Req->argv[0]);
#line 313
                  Kill_Nick(Req->argv[0], (char *)"Nick collision");
#line 314
                  return (1);
                }
#line 318
                __cil_tmp___27 = atoi((char const   *)Req->argv[4]);
#line 318
                intr_c = Client_GetFromToken(Client, __cil_tmp___27);
#line 319
                if (! intr_c) {
#line 321
                  __cil_tmp___28 = Client_ID(Client);
#line 321
                  Log(3, "Server %s introduces nick \"%s\" on unknown server!?", __cil_tmp___28,
                      Req->argv[0]);
#line 322
                  Kill_Nick(Req->argv[0], (char *)"Unknown server");
#line 323
                  return (1);
                }
#line 327
                __cil_tmp___29 = atoi((char const   *)Req->argv[4]);
#line 327
                __cil_tmp___30 = atoi((char const   *)Req->argv[1]);
#line 327
                c = Client_NewRemoteUser(intr_c, Req->argv[0], __cil_tmp___30, Req->argv[2],
                                         Req->argv[3], __cil_tmp___29, Req->argv[5] + 1,
                                         Req->argv[6], 1);
#line 328
                if (! c) {
#line 333
                  __cil_tmp___31 = Client_Conn(Client);
#line 333
                  Log(1, "Can\'t create client structure! (on connection %d)", __cil_tmp___31);
#line 334
                  Kill_Nick(Req->argv[0], (char *)"Server error");
#line 335
                  return (1);
                }
#line 338
                modes = Client_Modes(c);
#line 339
                if (*modes) {
#line 339
                  __cil_tmp___34 = Client_Hops(c);
#line 339
                  if (__cil_tmp___34 > 1) {
#line 339
                    __cil_tmp___33 = "s";
                  } else {
#line 339
                    __cil_tmp___33 = "";
                  }
#line 339
                  __cil_tmp___35 = Client_Hops(c);
#line 339
                  __cil_tmp___36 = Client_ID(intr_c);
#line 339
                  __cil_tmp___37 = Client_ID(Client);
#line 339
                  __cil_tmp___38 = Client_Mask(c);
#line 339
                  Log(7, "User \"%s\" (+%s) registered (via %s, on %s, %d hop%s).",
                      __cil_tmp___38, modes, __cil_tmp___37, __cil_tmp___36, __cil_tmp___35,
                      __cil_tmp___33);
                } else {
#line 340
                  __cil_tmp___41 = Client_Hops(c);
#line 340
                  if (__cil_tmp___41 > 1) {
#line 340
                    __cil_tmp___40 = "s";
                  } else {
#line 340
                    __cil_tmp___40 = "";
                  }
#line 340
                  __cil_tmp___42 = Client_Hops(c);
#line 340
                  __cil_tmp___43 = Client_ID(intr_c);
#line 340
                  __cil_tmp___44 = Client_ID(Client);
#line 340
                  __cil_tmp___45 = Client_Mask(c);
#line 340
                  Log(7, "User \"%s\" registered (via %s, on %s, %d hop%s).", __cil_tmp___45,
                      __cil_tmp___44, __cil_tmp___43, __cil_tmp___42, __cil_tmp___40);
                }
#line 343
                __cil_tmp___46 = Client_MyToken(intr_c);
#line 343
                __cil_tmp___47 = atoi((char const   *)Req->argv[1]);
#line 343
                IRC_WriteStrServersPrefix(Client, Client, (char *)"NICK %s %d %s %s %d %s :%s",
                                          Req->argv[0], __cil_tmp___47 + 1, Req->argv[2],
                                          Req->argv[3], __cil_tmp___46, Req->argv[5],
                                          Req->argv[6]);
#line 345
                return (1);
              } else {
#line 347
                __cil_tmp___48 = Client_ID(Client);
#line 347
                __cil_tmp___49 = IRC_WriteStrClient(Client, (char *)"462 %s :Connection already registered",
                                                    __cil_tmp___48);
#line 347
                return (__cil_tmp___49);
              }
            }
          }
        }
      }
    }
  }
}
}
#line 351 "irc-login.c"
int IRC_USER(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  CONN_ID __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  int __cil_tmp___10 ;
  int __cil_tmp___11 ;
  int __cil_tmp___12 ;
  int __cil_tmp___13 ;

  {
#line 362
  __cil_tmp___11 = Client_Type(Client);
#line 362
  if (__cil_tmp___11 == 4) {
#line 362
    goto _L___2;
  } else {
#line 362
    __cil_tmp___12 = Client_Type(Client);
#line 362
    if (__cil_tmp___12 == 2) {
      _L___2: /* CIL Label */ 
#line 362
      goto _L___1;
    } else {
#line 362
      __cil_tmp___13 = Client_Type(Client);
#line 362
      if (__cil_tmp___13 == 1) {
        _L___1: /* CIL Label */ 
#line 368
        if (Req->argc != 4) {
#line 368
          __cil_tmp = Client_ID(Client);
#line 368
          __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                             __cil_tmp, Req->command);
#line 368
          return (__cil_tmp___0);
        }
#line 375
        Client_SetUser(Client, Req->argv[0], 0);
#line 380
        if (*(Req->argv[3])) {
#line 380
          Client_SetInfo(Client, Req->argv[3]);
        } else {
#line 381
          Client_SetInfo(Client, (char *)"-");
        }
#line 383
        __cil_tmp___1 = Client_Conn(Client);
#line 383
        Log(7, "Connection %d: got valid USER command ...", __cil_tmp___1);
#line 384
        __cil_tmp___3 = Client_Type(Client);
#line 384
        if (__cil_tmp___3 == 4) {
#line 384
          __cil_tmp___2 = Hello_User(Client);
#line 384
          return (__cil_tmp___2);
        } else {
#line 385
          Client_SetType(Client, 8);
        }
#line 386
        return (1);
      } else {
#line 388
        __cil_tmp___8 = Client_Type(Client);
#line 388
        if (__cil_tmp___8 == 16) {
#line 388
          goto _L___0;
        } else {
#line 388
          __cil_tmp___9 = Client_Type(Client);
#line 388
          if (__cil_tmp___9 == 32) {
            _L___0: /* CIL Label */ 
#line 388
            goto _L;
          } else {
#line 388
            __cil_tmp___10 = Client_Type(Client);
#line 388
            if (__cil_tmp___10 == 64) {
              _L: /* CIL Label */ 
#line 390
              __cil_tmp___4 = Client_ID(Client);
#line 390
              __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"462 %s :Connection already registered",
                                                 __cil_tmp___4);
#line 390
              return (__cil_tmp___5);
            } else {
#line 392
              __cil_tmp___6 = Client_ID(Client);
#line 392
              __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"451 %s :Connection not registered",
                                                 __cil_tmp___6);
#line 392
              return (__cil_tmp___7);
            }
          }
        }
      }
    }
  }
}
}
#line 396 "irc-login.c"
int IRC_QUIT(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  char quitmsg[256] ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  CONN_ID __cil_tmp___4 ;
  int __cil_tmp___5 ;

  {
#line 406
  if (Req->argc > 1) {
#line 407
    __cil_tmp = Client_ID(Client);
#line 407
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 407
    return (__cil_tmp___0);
  }
#line 409
  if (Req->argc == 1) {
#line 410
    strlcpy(quitmsg, (char const   *)Req->argv[0], sizeof(quitmsg));
  }
#line 412
  __cil_tmp___5 = Client_Type(Client);
#line 412
  if (__cil_tmp___5 == 32) {
#line 415
    target = Client_Search(Req->prefix);
#line 416
    if (! target) {
#line 419
      __cil_tmp___1 = Client_ID(Client);
#line 419
      Log(4, "Got QUIT from %s for unknown client!?", __cil_tmp___1);
#line 420
      return (1);
    }
#line 423
    if (Req->argc == 1) {
#line 423
      __cil_tmp___2 = quitmsg;
    } else {
#line 423
      __cil_tmp___2 = (char *)((void *)0);
    }
#line 423
    Client_Destroy(target, (char *)"Got QUIT command.", __cil_tmp___2, 1);
#line 425
    return (1);
  } else {
#line 429
    if (Req->argc == 1 && (int )quitmsg[0] != 34) {
#line 431
      strlcpy(quitmsg, "\"", sizeof(quitmsg));
#line 432
      strlcat(quitmsg, (char const   *)Req->argv[0], sizeof(quitmsg) - 1U);
#line 433
      strlcat(quitmsg, "\"", sizeof(quitmsg));
    }
#line 437
    if (Req->argc == 1) {
#line 437
      __cil_tmp___3 = quitmsg;
    } else {
#line 437
      __cil_tmp___3 = (char *)((void *)0);
    }
#line 437
    __cil_tmp___4 = Client_Conn(Client);
#line 437
    Conn_Close(__cil_tmp___4, (char *)"Got QUIT command.", __cil_tmp___3, 1);
#line 439
    return (0);
  }
}
}
#line 444 "irc-login.c"
int IRC_PING(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *from ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  CLIENT *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  CONN_ID __cil_tmp___12 ;
  char *__cil_tmp___13 ;
  int __cil_tmp___14 ;

  {
#line 453
  if (Req->argc < 1) {
#line 454
    __cil_tmp = Client_ID(Client);
#line 454
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"409 %s :No origin specified",
                                       __cil_tmp);
#line 454
    return (__cil_tmp___0);
  }
#line 463
  if (Req->argc > 1) {
#line 465
    target = Client_Search(Req->argv[1]);
#line 467
    if (! target) {
#line 467
      goto _L;
    } else {
#line 467
      __cil_tmp___3 = Client_Type(target);
#line 467
      if (__cil_tmp___3 != 32) {
        _L: /* CIL Label */ 
#line 468
        __cil_tmp___1 = Client_ID(Client);
#line 468
        __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                           __cil_tmp___1, Req->argv[1]);
#line 468
        return (__cil_tmp___2);
      }
    }
#line 471
    __cil_tmp___8 = Client_ThisServer();
#line 471
    if ((unsigned int )target != (unsigned int )__cil_tmp___8) {
#line 473
      __cil_tmp___4 = Client_Type(Client);
#line 473
      if (__cil_tmp___4 == 32) {
#line 474
        from = Client_Search(Req->prefix);
      } else {
#line 476
        from = Client;
      }
#line 477
      if (! from) {
#line 478
        __cil_tmp___5 = Client_ID(Client);
#line 478
        __cil_tmp___6 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                           __cil_tmp___5, Req->prefix);
#line 478
        return (__cil_tmp___6);
      }
#line 482
      __cil_tmp___7 = IRC_WriteStrClientPrefix(target, from, (char *)"PING %s :%s",
                                               Req->argv[0], Req->argv[1]);
#line 482
      return (__cil_tmp___7);
    }
  }
#line 488
  __cil_tmp___9 = Client_Type(Client);
#line 488
  if (__cil_tmp___9 == 32) {
#line 489
    if (Req->prefix) {
#line 490
      from = Client_Search(Req->prefix);
    } else {
#line 492
      from = Client;
    }
  } else {
#line 494
    from = Client_ThisServer();
  }
#line 495
  if (! from) {
#line 496
    __cil_tmp___10 = Client_ID(Client);
#line 496
    __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                        __cil_tmp___10, Req->prefix);
#line 496
    return (__cil_tmp___11);
  }
#line 499
  __cil_tmp___12 = Client_Conn(Client);
#line 499
  Log(7, "Connection %d: got PING, sending PONG ...", __cil_tmp___12);
#line 508
  __cil_tmp___13 = Client_ID(from);
#line 508
  __cil_tmp___14 = IRC_WriteStrClient(Client, (char *)"PONG %s :%s", __cil_tmp___13,
                                      Req->argv[0]);
#line 508
  return (__cil_tmp___14);
}
}
#line 514 "irc-login.c"
int IRC_PONG(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *from ;
  char *s ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  CLIENT *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  time_t __cil_tmp___12 ;
  CONN_ID __cil_tmp___13 ;
  time_t __cil_tmp___14 ;
  CONN_ID __cil_tmp___15 ;
  CONN_ID __cil_tmp___16 ;
  CONN_ID __cil_tmp___17 ;

  {
#line 524
  if (Req->argc < 1) {
#line 525
    __cil_tmp = Client_ID(Client);
#line 525
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"409 %s :No origin specified",
                                       __cil_tmp);
#line 525
    return (__cil_tmp___0);
  }
#line 527
  if (Req->argc > 2) {
#line 528
    __cil_tmp___1 = Client_ID(Client);
#line 528
    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___1, Req->command);
#line 528
    return (__cil_tmp___2);
  }
#line 532
  if (Req->argc == 2) {
#line 532
    __cil_tmp___11 = Client_Type(Client);
#line 532
    if (__cil_tmp___11 == 32) {
#line 533
      target = Client_Search(Req->argv[0]);
#line 534
      if (! target) {
#line 535
        __cil_tmp___3 = Client_ID(Client);
#line 535
        __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                           __cil_tmp___3, Req->argv[0]);
#line 535
        return (__cil_tmp___4);
      }
#line 538
      from = Client_Search(Req->prefix);
#line 540
      __cil_tmp___10 = Client_ThisServer();
#line 540
      if ((unsigned int )target != (unsigned int )__cil_tmp___10 && (unsigned int )target != (unsigned int )from) {
#line 542
        if (! from) {
#line 543
          __cil_tmp___5 = Client_ID(Client);
#line 543
          __cil_tmp___6 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                             __cil_tmp___5, Req->prefix);
#line 543
          return (__cil_tmp___6);
        }
#line 547
        __cil_tmp___7 = Client_NextHop(target);
#line 547
        __cil_tmp___8 = Client_Type(__cil_tmp___7);
#line 547
        if (__cil_tmp___8 != 32) {
#line 548
          s = Client_ID(from);
        } else {
#line 550
          s = Req->argv[0];
        }
#line 551
        __cil_tmp___9 = IRC_WriteStrClientPrefix(target, from, (char *)"PONG %s :%s",
                                                 s, Req->argv[1]);
#line 551
        return (__cil_tmp___9);
      }
    } else {
#line 532
      goto _L;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 559
  __cil_tmp___17 = Client_Conn(Client);
#line 559
  if (__cil_tmp___17 > -1) {
#line 560
    __cil_tmp___12 = time((time_t *)((void *)0));
#line 560
    __cil_tmp___13 = Client_Conn(Client);
#line 560
    __cil_tmp___14 = Conn_LastPing(__cil_tmp___13);
#line 560
    __cil_tmp___15 = Client_Conn(Client);
#line 560
    Log(7, "Connection %d: received PONG. Lag: %ld seconds.", __cil_tmp___15, __cil_tmp___12 - __cil_tmp___14);
  } else {
#line 565
    __cil_tmp___16 = Client_Conn(Client);
#line 565
    Log(7, "Connection %d: received PONG.", __cil_tmp___16);
  }
#line 568
  return (1);
}
}
#line 572 "irc-login.c"
static int Hello_User(CLIENT *Client ) 
{ CONN_ID __cil_tmp ;
  char *__cil_tmp___0 ;
  CONN_ID __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  CONN_ID __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  CLIENT *__cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  char *__cil_tmp___18 ;
  int __cil_tmp___19 ;
  CLIENT *__cil_tmp___20 ;
  char *__cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;
  int __cil_tmp___24 ;
  int __cil_tmp___25 ;
  int __cil_tmp___26 ;

  {
#line 578
  __cil_tmp___2 = Client_Password(Client);
#line 578
  __cil_tmp___3 = strcmp((char const   *)__cil_tmp___2, (char const   *)(Conf_ServerPwd));
#line 578
  if (__cil_tmp___3 != 0) {
#line 580
    __cil_tmp = Client_Conn(Client);
#line 580
    __cil_tmp___0 = Client_Mask(Client);
#line 580
    Log(3, "User \"%s\" rejected (connection %d): Bad password!", __cil_tmp___0, __cil_tmp);
#line 583
    __cil_tmp___1 = Client_Conn(Client);
#line 583
    Conn_Close(__cil_tmp___1, (char *)((void *)0), (char *)"Bad password", 1);
#line 584
    return (0);
  }
#line 587
  __cil_tmp___4 = Client_Conn(Client);
#line 587
  __cil_tmp___5 = Client_Mask(Client);
#line 587
  Log(5, "User \"%s\" registered (connection %d).", __cil_tmp___5, __cil_tmp___4);
#line 591
  __cil_tmp___6 = Client_Info(Client);
#line 591
  __cil_tmp___7 = Client_Modes(Client);
#line 591
  __cil_tmp___8 = Client_Hostname(Client);
#line 591
  __cil_tmp___9 = Client_User(Client);
#line 591
  __cil_tmp___10 = Client_ID(Client);
#line 591
  IRC_WriteStrServers((CLIENT *)((void *)0), (char *)"NICK %s 1 %s %s 1 +%s :%s",
                      __cil_tmp___10, __cil_tmp___9, __cil_tmp___8, __cil_tmp___7,
                      __cil_tmp___6);
#line 596
  __cil_tmp___11 = Client_Mask(Client);
#line 596
  __cil_tmp___12 = Client_ID(Client);
#line 596
  __cil_tmp___13 = IRC_WriteStrClient(Client, (char *)"001 %s :Welcome to the Internet Relay Network %s",
                                      __cil_tmp___12, __cil_tmp___11);
#line 596
  if (! __cil_tmp___13) {
#line 598
    return (0);
  }
#line 599
  __cil_tmp___14 = Client_ThisServer();
#line 599
  __cil_tmp___15 = Client_ID(__cil_tmp___14);
#line 599
  __cil_tmp___16 = Client_ID(Client);
#line 599
  __cil_tmp___17 = IRC_WriteStrClient(Client, (char *)"002 %s :Your host is %s, running version ngircd-%s (%s/%s/%s)",
                                      __cil_tmp___16, __cil_tmp___15, "0.12.0", "i686",
                                      "pc", "linux-gnu");
#line 599
  if (! __cil_tmp___17) {
#line 603
    return (0);
  }
#line 604
  __cil_tmp___18 = Client_ID(Client);
#line 604
  __cil_tmp___19 = IRC_WriteStrClient(Client, (char *)"003 %s :This server has been started %s",
                                      __cil_tmp___18, NGIRCd_StartStr);
#line 604
  if (! __cil_tmp___19) {
#line 606
    return (0);
  }
#line 607
  __cil_tmp___20 = Client_ThisServer();
#line 607
  __cil_tmp___21 = Client_ID(__cil_tmp___20);
#line 607
  __cil_tmp___22 = Client_ID(Client);
#line 607
  __cil_tmp___23 = IRC_WriteStrClient(Client, (char *)"004 %s %s ngircd-%s %s %s",
                                      __cil_tmp___22, __cil_tmp___21, "0.12.0", "aios",
                                      "biIklmnoPstv");
#line 607
  if (! __cil_tmp___23) {
#line 611
    return (0);
  }
#line 615
  __cil_tmp___24 = IRC_Send_ISUPPORT(Client);
#line 615
  if (! __cil_tmp___24) {
#line 616
    return (0);
  }
#line 618
  Client_SetType(Client, 16);
#line 620
  __cil_tmp___25 = IRC_Send_LUSERS(Client);
#line 620
  if (! __cil_tmp___25) {
#line 621
    return (0);
  }
#line 622
  __cil_tmp___26 = IRC_Show_MOTD(Client);
#line 622
  if (! __cil_tmp___26) {
#line 623
    return (0);
  }
#line 626
  IRC_SetPenalty(Client, 1L);
#line 628
  return (1);
}
}
#line 632 "irc-login.c"
static void Kill_Nick(char *Nick , char *Reason ) 
{ REQUEST r ;
  CLIENT *__cil_tmp ;
  CLIENT *__cil_tmp___0 ;

  {
#line 640
  __cil_tmp = Client_ThisServer();
#line 640
  r.prefix = (char *)__cil_tmp;
#line 641
  r.argv[0] = Nick;
#line 642
  r.argv[1] = Reason;
#line 643
  r.argc = 2;
#line 645
  Log(3, "User(s) with nick \"%s\" will be disconnected: %s", Nick, Reason);
#line 646
  __cil_tmp___0 = Client_ThisServer();
#line 646
  IRC_KILL(__cil_tmp___0, & r);
#line 647
  return;
}
}
#line 1 "irc-mode.o"
#pragma merger(0,"/tmp/cil-g48Tr88s.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 31 "lists.h"
int Lists_CheckDupeMask(struct list_head  const  *h , char const   *Mask ) ;
#line 34
void Lists_Del(struct list_head *header , char const   *Mask ) ;
#line 40
char const   *Lists_MakeMask(char const   *Pattern ) ;
#line 21 "irc-mode.h"
int IRC_MODE(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_AWAY(CLIENT *Client , REQUEST *Req ) ;
#line 39 "irc-mode.c"
static int Client_Mode(CLIENT *Client , REQUEST *Req , CLIENT *Origin , CLIENT *Target ) ;
#line 40
static int Channel_Mode(CLIENT *Client , REQUEST *Req , CLIENT *Origin , CHANNEL *Channel ) ;
#line 42
static int Add_Ban_Invite(int what , CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel ,
                          char const   *Pattern ) ;
#line 43
static int Del_Ban_Invite(int what , CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel ,
                          char const   *Pattern ) ;
#line 45
static int Send_ListChange(char *Mode , CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel ,
                           char const   *Mask ) ;
#line 48 "irc-mode.c"
int IRC_MODE(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *cl ;
  CLIENT *origin ;
  CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 58
  if (Req->argc < 1) {
#line 58
    __cil_tmp = Client_ID(Client);
#line 58
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 58
    return (__cil_tmp___0);
  }
#line 61
  __cil_tmp___3 = Client_Type(Client);
#line 61
  if (__cil_tmp___3 == 32) {
#line 63
    origin = Client_Search(Req->prefix);
#line 64
    if (! origin) {
#line 64
      __cil_tmp___1 = Client_ID(Client);
#line 64
      __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                         __cil_tmp___1, Req->prefix);
#line 64
      return (__cil_tmp___2);
    }
  } else {
#line 66
    origin = Client;
  }
#line 69
  cl = (CLIENT *)((void *)0);
#line 69
  chan = (CHANNEL *)((void *)0);
#line 70
  __cil_tmp___4 = Client_IsValidNick((char const   *)Req->argv[0]);
#line 70
  if (__cil_tmp___4) {
#line 71
    cl = Client_Search(Req->argv[0]);
  }
#line 72
  __cil_tmp___5 = Channel_IsValidName((char const   *)Req->argv[0]);
#line 72
  if (__cil_tmp___5) {
#line 73
    chan = Channel_Search((char const   *)Req->argv[0]);
  }
#line 75
  if (cl) {
#line 76
    __cil_tmp___6 = Client_Mode(Client, Req, origin, cl);
#line 76
    return (__cil_tmp___6);
  }
#line 77
  if (chan) {
#line 78
    __cil_tmp___7 = Channel_Mode(Client, Req, origin, chan);
#line 78
    return (__cil_tmp___7);
  }
#line 81
  __cil_tmp___8 = Client_ID(Client);
#line 81
  __cil_tmp___9 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                     __cil_tmp___8, Req->argv[0]);
#line 81
  return (__cil_tmp___9);
}
}
#line 86 "irc-mode.c"
static int Client_Mode(CLIENT *Client , REQUEST *Req , CLIENT *Origin , CLIENT *Target ) 
{ char the_modes[513] ;
  char x[2] ;
  char *mode_ptr ;
  int ok ;
  int set ;
  int mode_arg ;
  size_t len ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  size_t __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;
  int __cil_tmp___16 ;
  char *__cil_tmp___17 ;
  int __cil_tmp___18 ;
  int __cil_tmp___19 ;
  int __cil_tmp___20 ;
  size_t __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  char *__cil_tmp___24 ;
  int __cil_tmp___25 ;
  char *__cil_tmp___26 ;
  char *__cil_tmp___27 ;

  {
#line 97
  __cil_tmp___1 = Client_Type(Client);
#line 97
  if (__cil_tmp___1 == 16) {
#line 100
    if ((unsigned int )Target != (unsigned int )Client) {
#line 100
      __cil_tmp = Client_ID(Client);
#line 100
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"502 %s :Can\'t set/get mode for other users",
                                         __cil_tmp);
#line 100
      return (__cil_tmp___0);
    }
  }
#line 104
  if (Req->argc == 1) {
#line 104
    __cil_tmp___2 = Client_Modes(Target);
#line 104
    __cil_tmp___3 = Client_ID(Origin);
#line 104
    __cil_tmp___4 = IRC_WriteStrClient(Origin, (char *)"221 %s +%s", __cil_tmp___3,
                                       __cil_tmp___2);
#line 104
    return (__cil_tmp___4);
  }
#line 106
  mode_arg = 1;
#line 107
  mode_ptr = Req->argv[mode_arg];
#line 110
  if ((int )*mode_ptr == 43) {
#line 110
    set = 1;
  } else {
#line 111
    if ((int )*mode_ptr == 45) {
#line 111
      set = 0;
    } else {
#line 112
      __cil_tmp___5 = Client_ID(Origin);
#line 112
      __cil_tmp___6 = IRC_WriteStrClient(Origin, (char *)"501 %s :Unknown mode", __cil_tmp___5);
#line 112
      return (__cil_tmp___6);
    }
  }
#line 115
  if (set) {
#line 115
    strcpy((char * __restrict  )(the_modes), (char const   * __restrict  )"+");
  } else {
#line 116
    strcpy((char * __restrict  )(the_modes), (char const   * __restrict  )"-");
  }
#line 118
  x[1] = (char )'\000';
#line 119
  ok = 1;
#line 120
  while (mode_ptr) {
#line 122
    mode_ptr ++;
#line 123
    if (! *mode_ptr) {
#line 126
      mode_arg ++;
#line 127
      if (mode_arg < Req->argc) {
#line 127
        mode_ptr = Req->argv[mode_arg];
      } else {
#line 128
        break;
      }
    }
#line 131
    switch ((int )*mode_ptr) {
    case 43: 
    case 45: 
#line 135
    if (((int )*mode_ptr == 43 && ! set) || ((int )*mode_ptr == 45 && set)) {
#line 138
      __cil_tmp___7 = strlen((char const   *)(the_modes));
#line 138
      len = __cil_tmp___7 - 1U;
#line 139
      if ((int )the_modes[len] == 43 || (int )the_modes[len] == 45) {
#line 142
        the_modes[len] = *mode_ptr;
      } else {
#line 147
        x[0] = *mode_ptr;
#line 148
        strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
      }
#line 150
      if ((int )*mode_ptr == 43) {
#line 150
        set = 1;
      } else {
#line 151
        set = 0;
      }
    }
#line 153
    continue;
    }
#line 157
    x[0] = (char )'\000';
#line 158
    switch ((int )*mode_ptr) {
    case 105: 
    case 115: 
    case 119: 
#line 163
    x[0] = *mode_ptr;
#line 164
    break;
    case 97: 
#line 167
    __cil_tmp___9 = Client_Type(Client);
#line 167
    if (__cil_tmp___9 == 32) {
#line 169
      x[0] = (char )'a';
#line 170
      Client_SetAway(Origin, (char *)"Away");
    } else {
#line 172
      __cil_tmp___8 = Client_ID(Origin);
#line 172
      ok = IRC_WriteStrClient(Origin, (char *)"481 %s :Permission denied", __cil_tmp___8);
    }
#line 173
    break;
    case 111: 
#line 176
    if (! set) {
#line 176
      goto _L;
    } else {
#line 176
      __cil_tmp___11 = Client_Type(Client);
#line 176
      if (__cil_tmp___11 == 32) {
        _L: /* CIL Label */ 
#line 178
        Client_SetOperByMe(Target, 0);
#line 179
        x[0] = (char )'o';
      } else {
#line 181
        __cil_tmp___10 = Client_ID(Origin);
#line 181
        ok = IRC_WriteStrClient(Origin, (char *)"481 %s :Permission denied", __cil_tmp___10);
      }
    }
#line 182
    break;
    case 114: 
#line 185
    if (set) {
#line 185
      goto _L___0;
    } else {
#line 185
      __cil_tmp___13 = Client_Type(Client);
#line 185
      if (__cil_tmp___13 == 32) {
        _L___0: /* CIL Label */ 
#line 185
        x[0] = (char )'r';
      } else {
#line 186
        __cil_tmp___12 = Client_ID(Origin);
#line 186
        ok = IRC_WriteStrClient(Origin, (char *)"484 %s :Your connection is restricted",
                                __cil_tmp___12);
      }
    }
#line 187
    break;
    default: 
#line 190
    __cil_tmp___14 = Client_ID(Origin);
#line 190
    if (set) {
#line 190
      __cil_tmp___15 = '+';
    } else {
#line 190
      __cil_tmp___15 = '-';
    }
#line 190
    Log(7, "Unknown mode \"%c%c\" from \"%s\"!?", __cil_tmp___15, *mode_ptr, __cil_tmp___14);
#line 191
    __cil_tmp___18 = Client_Type(Client);
#line 191
    if (__cil_tmp___18 != 32) {
#line 191
      if (set) {
#line 191
        __cil_tmp___16 = '+';
      } else {
#line 191
        __cil_tmp___16 = '-';
      }
#line 191
      __cil_tmp___17 = Client_ID(Origin);
#line 191
      ok = IRC_WriteStrClient(Origin, (char *)"501 %s :Unknown mode \"%c%c\"", __cil_tmp___17,
                              __cil_tmp___16, *mode_ptr);
    }
#line 192
    x[0] = (char )'\000';
#line 193
    goto client_exit;
    }
#line 195
    if (! ok) {
#line 195
      break;
    }
#line 198
    if (! x[0]) {
#line 198
      continue;
    }
#line 200
    if (set) {
#line 203
      __cil_tmp___19 = Client_ModeAdd(Target, x[0]);
#line 203
      if (__cil_tmp___19) {
#line 203
        strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
      }
    } else {
#line 209
      __cil_tmp___20 = Client_ModeDel(Target, x[0]);
#line 209
      if (__cil_tmp___20) {
#line 209
        strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
      }
    }
  }
  client_exit: 
#line 215
  if (the_modes[1]) {
#line 218
    __cil_tmp___21 = strlen((char const   *)(the_modes));
#line 218
    len = __cil_tmp___21 - 1U;
#line 219
    if ((int )the_modes[len] == 43 || (int )the_modes[len] == 45) {
#line 219
      the_modes[len] = (char )'\000';
    }
#line 221
    __cil_tmp___25 = Client_Type(Client);
#line 221
    if (__cil_tmp___25 == 32) {
#line 224
      __cil_tmp___22 = Client_ID(Target);
#line 224
      IRC_WriteStrServersPrefix(Client, Origin, (char *)"MODE %s :%s", __cil_tmp___22,
                                the_modes);
    } else {
#line 229
      __cil_tmp___23 = Client_ID(Target);
#line 229
      ok = IRC_WriteStrClientPrefix(Client, Origin, (char *)"MODE %s :%s", __cil_tmp___23,
                                    the_modes);
#line 230
      __cil_tmp___24 = Client_ID(Target);
#line 230
      IRC_WriteStrServersPrefix(Client, Origin, (char *)"MODE %s :%s", __cil_tmp___24,
                                the_modes);
    }
#line 232
    __cil_tmp___26 = Client_Modes(Target);
#line 232
    __cil_tmp___27 = Client_Mask(Target);
#line 232
    Log(7, "User \"%s\": Mode change, now \"%s\".", __cil_tmp___27, __cil_tmp___26);
  }
#line 235
  IRC_SetPenalty(Client, 1L);
#line 236
  return (ok);
}
}
#line 240 "irc-mode.c"
static int Channel_Mode_Answer_Request(CLIENT *Origin , CHANNEL *Channel ) 
{ char the_modes[513] ;
  char the_args[513] ;
  char argadd[21] ;
  char const   *mode_ptr ;
  char *__cil_tmp ;
  char const   *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  unsigned long __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char const   *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 247
  __cil_tmp___3 = Channel_IsMemberOf(Channel, Origin);
#line 247
  if (! __cil_tmp___3) {
#line 248
    __cil_tmp = Channel_Modes(Channel);
#line 248
    __cil_tmp___0 = Channel_Name((CHANNEL const   *)Channel);
#line 248
    __cil_tmp___1 = Client_ID(Origin);
#line 248
    __cil_tmp___2 = IRC_WriteStrClient(Origin, (char *)"324 %s %s +%s", __cil_tmp___1,
                                       __cil_tmp___0, __cil_tmp);
#line 248
    return (__cil_tmp___2);
  }
#line 252
  __cil_tmp___4 = Channel_Modes(Channel);
#line 252
  strlcpy(the_modes, (char const   *)__cil_tmp___4, sizeof(the_modes));
#line 253
  mode_ptr = (char const   *)(the_modes);
#line 254
  the_args[0] = (char )'\000';
#line 256
  while (*mode_ptr) {
#line 257
    switch ((int )*mode_ptr) {
    case 108: 
#line 259
    __cil_tmp___5 = Channel_MaxUsers(Channel);
#line 259
    snprintf((char * __restrict  )(argadd), sizeof(argadd), (char const   * __restrict  )" %lu",
             __cil_tmp___5);
#line 260
    strlcat(the_args, (char const   *)(argadd), sizeof(the_args));
#line 261
    break;
    case 107: 
#line 263
    strlcat(the_args, " ", sizeof(the_args));
#line 264
    __cil_tmp___6 = Channel_Key(Channel);
#line 264
    strlcat(the_args, (char const   *)__cil_tmp___6, sizeof(the_args));
#line 265
    break;
    }
#line 267
    mode_ptr ++;
  }
#line 269
  if (the_args[0]) {
#line 270
    strlcat(the_modes, (char const   *)(the_args), sizeof(the_modes));
  }
#line 272
  __cil_tmp___7 = Channel_Name((CHANNEL const   *)Channel);
#line 272
  __cil_tmp___8 = Client_ID(Origin);
#line 272
  __cil_tmp___9 = IRC_WriteStrClient(Origin, (char *)"324 %s %s +%s", __cil_tmp___8,
                                     __cil_tmp___7, the_modes);
#line 272
  return (__cil_tmp___9);
}
}
#line 277 "irc-mode.c"
static int Channel_Mode(CLIENT *Client , REQUEST *Req , CLIENT *Origin , CHANNEL *Channel ) 
{ char the_modes[513] ;
  char the_args[513] ;
  char x[2] ;
  char argadd[21] ;
  char *mode_ptr ;
  int ok ;
  int set ;
  int modeok ;
  int skiponce ;
  int use_servermode ;
  int retval ;
  int mode_arg ;
  int arg_arg ;
  CLIENT *client ;
  long l ;
  size_t len ;
  int __cil_tmp ;
  char const   *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  char const   *__cil_tmp___8 ;
  size_t __cil_tmp___9 ;
  char const   *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  char const   *__cil_tmp___12 ;
  char *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char const   *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  char const   *__cil_tmp___18 ;
  char *__cil_tmp___19 ;
  char const   *__cil_tmp___20 ;
  char *__cil_tmp___21 ;
  char *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  int __cil_tmp___24 ;
  int __cil_tmp___25 ;
  char const   *__cil_tmp___26 ;
  char *__cil_tmp___27 ;
  char *__cil_tmp___28 ;
  char const   *__cil_tmp___29 ;
  char *__cil_tmp___30 ;
  char *__cil_tmp___31 ;
  char const   *__cil_tmp___34 ;
  char *__cil_tmp___35 ;
  char const   *__cil_tmp___36 ;
  char *__cil_tmp___37 ;
  int __cil_tmp___38 ;
  int __cil_tmp___39 ;
  char *__cil_tmp___40 ;
  int __cil_tmp___41 ;
  char const   *__cil_tmp___42 ;
  char *__cil_tmp___43 ;
  char *__cil_tmp___44 ;
  int __cil_tmp___45 ;
  int __cil_tmp___46 ;
  char *__cil_tmp___49 ;
  char *__cil_tmp___50 ;
  char const   *__cil_tmp___51 ;
  char *__cil_tmp___52 ;
  char *__cil_tmp___55 ;
  char const   *__cil_tmp___56 ;
  size_t __cil_tmp___57 ;
  char const   *__cil_tmp___58 ;
  char const   *__cil_tmp___59 ;
  char const   *__cil_tmp___60 ;
  char const   *__cil_tmp___61 ;
  char const   *__cil_tmp___62 ;
  int __cil_tmp___63 ;

  {
#line 283
  modeok = 1;
#line 283
  use_servermode = 0;
#line 290
  if (Req->argc <= 1) {
#line 291
    __cil_tmp = Channel_Mode_Answer_Request(Origin, Channel);
#line 291
    return (__cil_tmp);
  }
#line 294
  __cil_tmp___7 = Client_Type(Client);
#line 294
  if (__cil_tmp___7 == 16) {
#line 296
    __cil_tmp___3 = Channel_IsMemberOf(Channel, Origin);
#line 296
    if (! __cil_tmp___3) {
#line 297
      __cil_tmp___0 = Channel_Name((CHANNEL const   *)Channel);
#line 297
      __cil_tmp___1 = Client_ID(Origin);
#line 297
      __cil_tmp___2 = IRC_WriteStrClient(Origin, (char *)"442 %s %s :You are not on that channel",
                                         __cil_tmp___1, __cil_tmp___0);
#line 297
      return (__cil_tmp___2);
    }
#line 299
    modeok = 0;
#line 301
    __cil_tmp___5 = Channel_UserModes(Channel, Origin);
#line 301
    __cil_tmp___6 = strchr((char const   *)__cil_tmp___5, 'o');
#line 301
    if (__cil_tmp___6) {
#line 302
      modeok = 1;
    } else {
#line 303
      if (Conf_OperCanMode) {
#line 305
        __cil_tmp___4 = Client_OperByMe(Origin);
#line 305
        if (__cil_tmp___4) {
#line 306
          modeok = 1;
#line 307
          if (Conf_OperServerMode) {
#line 308
            use_servermode = 1;
          }
        }
      }
    }
  }
#line 313
  mode_arg = 1;
#line 314
  mode_ptr = Req->argv[mode_arg];
#line 315
  if (Req->argc > mode_arg + 1) {
#line 316
    arg_arg = mode_arg + 1;
  } else {
#line 318
    arg_arg = -1;
  }
#line 321
  skiponce = 0;
#line 322
  switch ((int )*mode_ptr) {
  case 45: 
#line 323
  set = 0;
#line 323
  break;
  case 43: 
#line 324
  set = 1;
#line 324
  break;
  default: 
#line 326
  set = 1;
#line 327
  skiponce = 1;
  }
#line 331
  if (set) {
#line 331
    __cil_tmp___8 = "+";
  } else {
#line 331
    __cil_tmp___8 = "-";
  }
#line 331
  strcpy((char * __restrict  )(the_modes), (char const   * __restrict  )__cil_tmp___8);
#line 332
  the_args[0] = (char )'\000';
#line 334
  x[1] = (char )'\000';
#line 335
  ok = 1;
#line 336
  while (mode_ptr) {
#line 337
    if (! skiponce) {
#line 338
      mode_ptr ++;
    }
#line 339
    if (! *mode_ptr) {
#line 341
      if (arg_arg > mode_arg) {
#line 342
        mode_arg = arg_arg;
      } else {
#line 344
        mode_arg ++;
      }
#line 346
      if (mode_arg >= Req->argc) {
#line 347
        break;
      }
#line 348
      mode_ptr = Req->argv[mode_arg];
#line 350
      if (Req->argc > mode_arg + 1) {
#line 351
        arg_arg = mode_arg + 1;
      } else {
#line 353
        arg_arg = -1;
      }
    }
#line 355
    skiponce = 0;
#line 357
    switch ((int )*mode_ptr) {
    case 43: 
    case 45: 
#line 360
    if (((int )*mode_ptr == 43 && ! set) || ((int )*mode_ptr == 45 && set)) {
#line 362
      __cil_tmp___9 = strlen((char const   *)(the_modes));
#line 362
      len = __cil_tmp___9 - 1U;
#line 363
      if ((int )the_modes[len] == 43 || (int )the_modes[len] == 45) {
#line 365
        the_modes[len] = *mode_ptr;
      } else {
#line 368
        x[0] = *mode_ptr;
#line 369
        strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
      }
#line 371
      set = (int )*mode_ptr == 43;
    }
#line 373
    continue;
    }
#line 377
    if (arg_arg >= Req->argc) {
#line 377
      arg_arg = -1;
    }
#line 380
    x[0] = (char )'\000';
#line 381
    argadd[0] = (char )'\000';
#line 382
    client = (CLIENT *)((void *)0);
#line 383
    switch ((int )*mode_ptr) {
    case 105: 
    case 109: 
    case 110: 
    case 115: 
    case 116: 
#line 390
    if (modeok) {
#line 391
      x[0] = *mode_ptr;
    } else {
#line 393
      __cil_tmp___10 = Channel_Name((CHANNEL const   *)Channel);
#line 393
      __cil_tmp___11 = Client_ID(Origin);
#line 393
      ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                              __cil_tmp___11, __cil_tmp___10);
    }
#line 394
    break;
    case 107: 
#line 396
    if (! set) {
#line 397
      if (modeok) {
#line 398
        x[0] = *mode_ptr;
      } else {
#line 400
        __cil_tmp___12 = Channel_Name((CHANNEL const   *)Channel);
#line 400
        __cil_tmp___13 = Client_ID(Origin);
#line 400
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___13, __cil_tmp___12);
      }
#line 401
      break;
    }
#line 403
    if (arg_arg > mode_arg) {
#line 404
      if (modeok) {
#line 405
        Channel_ModeDel(Channel, (char )'k');
#line 406
        Channel_SetKey(Channel, Req->argv[arg_arg]);
#line 407
        __cil_tmp___14 = Channel_Key(Channel);
#line 407
        strlcpy(argadd, (char const   *)__cil_tmp___14, sizeof(argadd));
#line 408
        x[0] = *mode_ptr;
      } else {
#line 410
        __cil_tmp___15 = Channel_Name((CHANNEL const   *)Channel);
#line 410
        __cil_tmp___16 = Client_ID(Origin);
#line 410
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___16, __cil_tmp___15);
      }
#line 412
      *(Req->argv[arg_arg] + 0) = (char )'\000';
#line 413
      arg_arg ++;
    } else {
#line 415
      __cil_tmp___17 = Client_ID(Origin);
#line 415
      ok = IRC_WriteStrClient(Origin, (char *)"461 %s %s :Syntax error", __cil_tmp___17,
                              Req->command);
    }
#line 417
    break;
    case 108: 
#line 419
    if (! set) {
#line 420
      if (modeok) {
#line 421
        x[0] = *mode_ptr;
      } else {
#line 423
        __cil_tmp___18 = Channel_Name((CHANNEL const   *)Channel);
#line 423
        __cil_tmp___19 = Client_ID(Origin);
#line 423
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___19, __cil_tmp___18);
      }
#line 424
      break;
    }
#line 426
    if (arg_arg > mode_arg) {
#line 427
      if (modeok) {
#line 428
        l = atol((char const   *)Req->argv[arg_arg]);
#line 429
        if (l > 0L && l < 65535L) {
#line 430
          Channel_ModeDel(Channel, (char )'l');
#line 431
          Channel_SetMaxUsers(Channel, (unsigned long )l);
#line 432
          snprintf((char * __restrict  )(argadd), sizeof(argadd), (char const   * __restrict  )"%ld",
                   l);
#line 433
          x[0] = *mode_ptr;
        }
      } else {
#line 436
        __cil_tmp___20 = Channel_Name((CHANNEL const   *)Channel);
#line 436
        __cil_tmp___21 = Client_ID(Origin);
#line 436
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___21, __cil_tmp___20);
      }
#line 438
      *(Req->argv[arg_arg] + 0) = (char )'\000';
#line 439
      arg_arg ++;
    } else {
#line 441
      __cil_tmp___22 = Client_ID(Origin);
#line 441
      ok = IRC_WriteStrClient(Origin, (char *)"461 %s %s :Syntax error", __cil_tmp___22,
                              Req->command);
    }
#line 443
    break;
    case 80: 
#line 445
    if (modeok) {
#line 448
      if (set) {
#line 448
        __cil_tmp___24 = Client_OperByMe(Client);
#line 448
        if (__cil_tmp___24) {
#line 448
          goto _L___0;
        } else {
#line 448
          __cil_tmp___25 = Client_Type(Client);
#line 448
          if (__cil_tmp___25 == 32) {
            _L___0: /* CIL Label */ 
#line 448
            goto _L;
          } else {
#line 449
            __cil_tmp___23 = Client_ID(Origin);
#line 449
            ok = IRC_WriteStrClient(Origin, (char *)"481 %s :Permission denied", __cil_tmp___23);
          }
        }
      } else {
        _L: /* CIL Label */ 
#line 451
        x[0] = (char )'P';
      }
    } else {
#line 453
      __cil_tmp___26 = Channel_Name((CHANNEL const   *)Channel);
#line 453
      __cil_tmp___27 = Client_ID(Origin);
#line 453
      ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                              __cil_tmp___27, __cil_tmp___26);
    }
#line 454
    break;
    case 111: 
    case 118: 
#line 458
    if (arg_arg > mode_arg) {
#line 459
      if (modeok) {
#line 460
        client = Client_Search(Req->argv[arg_arg]);
#line 461
        if (client) {
#line 462
          x[0] = *mode_ptr;
        } else {
#line 464
          __cil_tmp___28 = Client_ID(Client);
#line 464
          ok = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                  __cil_tmp___28, Req->argv[arg_arg]);
        }
      } else {
#line 466
        __cil_tmp___29 = Channel_Name((CHANNEL const   *)Channel);
#line 466
        __cil_tmp___30 = Client_ID(Origin);
#line 466
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___30, __cil_tmp___29);
      }
#line 468
      *(Req->argv[arg_arg] + 0) = (char )'\000';
#line 469
      arg_arg ++;
    } else {
#line 471
      __cil_tmp___31 = Client_ID(Origin);
#line 471
      ok = IRC_WriteStrClient(Origin, (char *)"461 %s %s :Syntax error", __cil_tmp___31,
                              Req->command);
    }
#line 473
    break;
    case 73: 
    case 98: 
#line 477
    if (arg_arg > mode_arg) {
#line 479
      if (modeok) {
#line 480
        if (set) {
#line 480
          ok = Add_Ban_Invite((int )*mode_ptr, Origin, Client, Channel, (char const   *)Req->argv[arg_arg]);
        } else {
#line 480
          ok = Del_Ban_Invite((int )*mode_ptr, Origin, Client, Channel, (char const   *)Req->argv[arg_arg]);
        }
      } else {
#line 483
        __cil_tmp___34 = Channel_Name((CHANNEL const   *)Channel);
#line 483
        __cil_tmp___35 = Client_ID(Origin);
#line 483
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___35, __cil_tmp___34);
      }
#line 486
      *(Req->argv[arg_arg] + 0) = (char )'\000';
#line 487
      arg_arg ++;
    } else {
#line 489
      if ((int )*mode_ptr == 73) {
#line 490
        Channel_ShowInvites(Origin, Channel);
      } else {
#line 492
        Channel_ShowBans(Origin, Channel);
      }
    }
#line 494
    break;
    default: 
#line 496
    __cil_tmp___36 = Channel_Name((CHANNEL const   *)Channel);
#line 496
    __cil_tmp___37 = Client_ID(Origin);
#line 496
    if (set) {
#line 496
      __cil_tmp___38 = '+';
    } else {
#line 496
      __cil_tmp___38 = '-';
    }
#line 496
    Log(7, "Unknown mode \"%c%c\" from \"%s\" on %s!?", __cil_tmp___38, *mode_ptr,
        __cil_tmp___37, __cil_tmp___36);
#line 498
    __cil_tmp___41 = Client_Type(Client);
#line 498
    if (__cil_tmp___41 != 32) {
#line 499
      if (set) {
#line 499
        __cil_tmp___39 = '+';
      } else {
#line 499
        __cil_tmp___39 = '-';
      }
#line 499
      __cil_tmp___40 = Client_ID(Origin);
#line 499
      ok = IRC_WriteStrClient(Origin, (char *)"501 %s :Unknown mode \"%c%c\"", __cil_tmp___40,
                              __cil_tmp___39, *mode_ptr);
    }
#line 500
    x[0] = (char )'\000';
#line 501
    goto chan_exit;
    }
#line 504
    if (! ok) {
#line 505
      break;
    }
#line 508
    if (! x[0]) {
#line 509
      continue;
    }
#line 512
    if (client) {
#line 512
      __cil_tmp___46 = Channel_IsMemberOf(Channel, client);
#line 512
      if (__cil_tmp___46) {
#line 512
        goto _L___1;
      } else {
#line 513
        __cil_tmp___42 = Channel_Name((CHANNEL const   *)Channel);
#line 513
        __cil_tmp___43 = Client_ID(client);
#line 513
        __cil_tmp___44 = Client_ID(Origin);
#line 513
        __cil_tmp___45 = IRC_WriteStrClient(Origin, (char *)"441 %s %s %s :They aren\'t on that channel",
                                            __cil_tmp___44, __cil_tmp___43, __cil_tmp___42);
#line 513
        if (! __cil_tmp___45) {
#line 515
          break;
        }
#line 517
        continue;
      }
    } else {
      _L___1: /* CIL Label */ ;
    }
#line 520
    if (client) {
#line 522
      if (set) {
#line 522
        retval = Channel_UserModeAdd(Channel, client, x[0]);
      } else {
#line 522
        retval = Channel_UserModeDel(Channel, client, x[0]);
      }
#line 523
      if (retval) {
#line 524
        strlcat(the_args, " ", sizeof(the_args));
#line 525
        __cil_tmp___49 = Client_ID(client);
#line 525
        strlcat(the_args, (char const   *)__cil_tmp___49, sizeof(the_args));
#line 526
        strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
#line 527
        __cil_tmp___50 = Channel_UserModes(Channel, client);
#line 527
        __cil_tmp___51 = Channel_Name((CHANNEL const   *)Channel);
#line 527
        __cil_tmp___52 = Client_Mask(client);
#line 527
        Log(7, "User \"%s\": Mode change on %s, now \"%s\"", __cil_tmp___52, __cil_tmp___51,
            __cil_tmp___50);
      }
    } else {
#line 532
      if (set) {
#line 532
        retval = Channel_ModeAdd(Channel, x[0]);
      } else {
#line 532
        retval = Channel_ModeDel(Channel, x[0]);
      }
#line 533
      if (retval) {
#line 534
        strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
#line 535
        __cil_tmp___55 = Channel_Modes(Channel);
#line 535
        __cil_tmp___56 = Channel_Name((CHANNEL const   *)Channel);
#line 535
        Log(7, "Channel %s: Mode change, now \"%s\".", __cil_tmp___56, __cil_tmp___55);
      }
    }
#line 540
    if (argadd[0]) {
#line 541
      strlcat(the_args, " ", sizeof(the_args));
#line 542
      strlcat(the_args, (char const   *)(argadd), sizeof(the_args));
    }
  }
  chan_exit: 
#line 547
  if (the_modes[1]) {
#line 549
    __cil_tmp___57 = strlen((char const   *)(the_modes));
#line 549
    len = __cil_tmp___57 - 1U;
#line 550
    if ((int )the_modes[len] == 43 || (int )the_modes[len] == 45) {
#line 551
      the_modes[len] = (char )'\000';
    }
#line 553
    __cil_tmp___63 = Client_Type(Client);
#line 553
    if (__cil_tmp___63 == 32) {
#line 555
      __cil_tmp___58 = Channel_Name((CHANNEL const   *)Channel);
#line 555
      IRC_WriteStrServersPrefix(Client, Origin, (char *)"MODE %s %s%s", __cil_tmp___58,
                                the_modes, the_args);
#line 556
      __cil_tmp___59 = Channel_Name((CHANNEL const   *)Channel);
#line 556
      IRC_WriteStrChannelPrefix(Client, Channel, Origin, 0, (char *)"MODE %s %s%s",
                                __cil_tmp___59, the_modes, the_args);
    } else {
#line 558
      if (use_servermode) {
#line 559
        Origin = Client_ThisServer();
      }
#line 561
      __cil_tmp___60 = Channel_Name((CHANNEL const   *)Channel);
#line 561
      ok = IRC_WriteStrClientPrefix(Client, Origin, (char *)"MODE %s %s%s", __cil_tmp___60,
                                    the_modes, the_args);
#line 563
      __cil_tmp___61 = Channel_Name((CHANNEL const   *)Channel);
#line 563
      IRC_WriteStrServersPrefix(Client, Origin, (char *)"MODE %s %s%s", __cil_tmp___61,
                                the_modes, the_args);
#line 565
      __cil_tmp___62 = Channel_Name((CHANNEL const   *)Channel);
#line 565
      IRC_WriteStrChannelPrefix(Client, Channel, Origin, 0, (char *)"MODE %s %s%s",
                                __cil_tmp___62, the_modes, the_args);
    }
  }
#line 570
  IRC_SetPenalty(Client, 1L);
#line 571
  return (1);
}
}
#line 575 "irc-mode.c"
int IRC_AWAY(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 582
  if (Req->argc > 1) {
#line 582
    __cil_tmp = Client_ID(Client);
#line 582
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 582
    return (__cil_tmp___0);
  }
#line 584
  if (Req->argc == 1 && (int )*(Req->argv[0] + 0)) {
#line 587
    Client_SetAway(Client, Req->argv[0]);
#line 588
    Client_ModeAdd(Client, (char )'a');
#line 589
    __cil_tmp___1 = Client_ID(Client);
#line 589
    IRC_WriteStrServersPrefix(Client, Client, (char *)"MODE %s :+a", __cil_tmp___1);
#line 590
    __cil_tmp___2 = Client_ID(Client);
#line 590
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"306 %s :You have been marked as being away",
                                       __cil_tmp___2);
#line 590
    return (__cil_tmp___3);
  } else {
#line 595
    Client_ModeDel(Client, (char )'a');
#line 596
    __cil_tmp___4 = Client_ID(Client);
#line 596
    IRC_WriteStrServersPrefix(Client, Client, (char *)"MODE %s :-a", __cil_tmp___4);
#line 597
    __cil_tmp___5 = Client_ID(Client);
#line 597
    __cil_tmp___6 = IRC_WriteStrClient(Client, (char *)"305 %s :You are no longer marked as being away",
                                       __cil_tmp___5);
#line 597
    return (__cil_tmp___6);
  }
}
}
#line 602 "irc-mode.c"
static int Add_Ban_Invite(int what , CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel ,
                          char const   *Pattern ) 
{ char const   *mask ;
  int already ;
  int ret ;
  struct list_head *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 614
  mask = Lists_MakeMask(Pattern);
#line 616
  __cil_tmp = Channel_GetListInvites(Channel);
#line 616
  already = Lists_CheckDupeMask((struct list_head  const  *)__cil_tmp, mask);
#line 617
  if (! already) {
#line 618
    if (what == 73) {
#line 619
      ret = Channel_AddInvite(Channel, mask, 0);
    } else {
#line 621
      ret = Channel_AddBan(Channel, mask);
    }
#line 622
    if (! ret) {
#line 623
      return (1);
    }
  }
#line 625
  if (already) {
#line 625
    __cil_tmp___0 = Client_Type(Prefix);
#line 625
    if (__cil_tmp___0 == 32) {
#line 626
      return (1);
    } else {
#line 625
      goto _L;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 628
  if (what == 73) {
#line 629
    __cil_tmp___1 = Send_ListChange((char *)"+I", Prefix, Client, Channel, mask);
#line 629
    return (__cil_tmp___1);
  }
#line 630
  __cil_tmp___2 = Send_ListChange((char *)"+b", Prefix, Client, Channel, mask);
#line 630
  return (__cil_tmp___2);
}
}
#line 634 "irc-mode.c"
static int Del_Ban_Invite(int what , CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel ,
                          char const   *Pattern ) 
{ char const   *mask ;
  struct list_head *list ;
  int __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 645
  mask = Lists_MakeMask(Pattern);
#line 647
  if (what == 73) {
#line 648
    list = Channel_GetListInvites(Channel);
  } else {
#line 650
    list = Channel_GetListBans(Channel);
  }
#line 652
  Lists_Del(list, mask);
#line 653
  if (what == 73) {
#line 654
    __cil_tmp = Send_ListChange((char *)"-I", Prefix, Client, Channel, mask);
#line 654
    return (__cil_tmp);
  }
#line 655
  __cil_tmp___0 = Send_ListChange((char *)"-b", Prefix, Client, Channel, mask);
#line 655
  return (__cil_tmp___0);
}
}
#line 659 "irc-mode.c"
static int Send_ListChange(char *Mode , CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel ,
                           char const   *Mask ) 
{ int ok ;
  char const   *__cil_tmp ;
  int __cil_tmp___0 ;
  char const   *__cil_tmp___1 ;
  char const   *__cil_tmp___2 ;

  {
#line 666
  __cil_tmp___0 = Client_Type(Client);
#line 666
  if (__cil_tmp___0 == 16) {
#line 669
    __cil_tmp = Channel_Name((CHANNEL const   *)Channel);
#line 669
    ok = IRC_WriteStrClientPrefix(Client, Prefix, (char *)"MODE %s %s %s", __cil_tmp,
                                  Mode, Mask);
  } else {
#line 671
    ok = 1;
  }
#line 674
  __cil_tmp___1 = Channel_Name((CHANNEL const   *)Channel);
#line 674
  IRC_WriteStrServersPrefix(Client, Prefix, (char *)"MODE %s %s %s", __cil_tmp___1,
                            Mode, Mask);
#line 677
  __cil_tmp___2 = Channel_Name((CHANNEL const   *)Channel);
#line 677
  IRC_WriteStrChannelPrefix(Client, Channel, Prefix, 0, (char *)"MODE %s %s %s", __cil_tmp___2,
                            Mode, Mask);
#line 679
  return (ok);
}
}
#line 1 "irc-op.o"
#pragma merger(0,"/tmp/cil-GJhxMO5o.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 21 "irc-op.h"
int IRC_KICK(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_INVITE(CLIENT *Client , REQUEST *Req ) ;
#line 38 "irc-op.c"
int IRC_KICK(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *from ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___7 ;

  {
#line 47
  if (Req->argc < 2 || Req->argc > 3) {
#line 47
    __cil_tmp = Client_ID(Client);
#line 47
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 47
    return (__cil_tmp___0);
  }
#line 49
  __cil_tmp___1 = Client_Type(Client);
#line 49
  if (__cil_tmp___1 == 32) {
#line 49
    from = Client_Search(Req->prefix);
  } else {
#line 50
    from = Client;
  }
#line 51
  if (! from) {
#line 51
    __cil_tmp___2 = Client_ID(Client);
#line 51
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 51
    return (__cil_tmp___3);
  }
#line 54
  target = Client_Search(Req->argv[1]);
#line 55
  if (! target) {
#line 55
    __cil_tmp___4 = Client_ID(from);
#line 55
    __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___4, Req->argv[1]);
#line 55
    return (__cil_tmp___5);
  }
#line 57
  if (Req->argc == 3) {
#line 57
    __cil_tmp___7 = Req->argv[2];
  } else {
#line 57
    __cil_tmp___7 = Client_ID(from);
  }
#line 57
  Channel_Kick(target, from, Req->argv[0], __cil_tmp___7);
#line 58
  return (1);
}
}
#line 62 "irc-op.c"
int IRC_INVITE(CLIENT *Client , REQUEST *Req ) 
{ CHANNEL *chan ;
  CLIENT *target ;
  CLIENT *from ;
  int remember ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  char const   *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  int __cil_tmp___12 ;
  char *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  int __cil_tmp___18 ;
  int __cil_tmp___19 ;
  struct list_head *__cil_tmp___20 ;
  int __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;
  char *__cil_tmp___24 ;
  char *__cil_tmp___25 ;
  int __cil_tmp___26 ;
  CONN_ID __cil_tmp___27 ;

  {
#line 67
  remember = 0;
#line 73
  if (Req->argc != 2) {
#line 73
    __cil_tmp = Client_ID(Client);
#line 73
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 73
    return (__cil_tmp___0);
  }
#line 75
  __cil_tmp___1 = Client_Type(Client);
#line 75
  if (__cil_tmp___1 == 32) {
#line 75
    from = Client_Search(Req->prefix);
  } else {
#line 76
    from = Client;
  }
#line 77
  if (! from) {
#line 77
    __cil_tmp___2 = Client_ID(Client);
#line 77
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 77
    return (__cil_tmp___3);
  }
#line 80
  target = Client_Search(Req->argv[0]);
#line 81
  if (! target) {
#line 81
    goto _L;
  } else {
#line 81
    __cil_tmp___6 = Client_Type(target);
#line 81
    if (__cil_tmp___6 != 16) {
      _L: /* CIL Label */ 
#line 81
      __cil_tmp___4 = Client_ID(Client);
#line 81
      __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"401 %s %s :No such nick or channel name",
                                         __cil_tmp___4, Req->argv[0]);
#line 81
      return (__cil_tmp___5);
    }
  }
#line 83
  chan = Channel_Search((char const   *)Req->argv[1]);
#line 85
  if (chan) {
#line 88
    __cil_tmp___9 = Channel_IsMemberOf(chan, from);
#line 88
    if (! __cil_tmp___9) {
#line 88
      __cil_tmp___7 = Client_ID(Client);
#line 88
      __cil_tmp___8 = IRC_WriteStrClient(from, (char *)"442 %s %s :You are not on that channel",
                                         __cil_tmp___7, Req->argv[1]);
#line 88
      return (__cil_tmp___8);
    }
#line 91
    __cil_tmp___15 = Channel_Modes(chan);
#line 91
    __cil_tmp___16 = strchr((char const   *)__cil_tmp___15, 'i');
#line 91
    if (__cil_tmp___16) {
#line 94
      __cil_tmp___13 = Channel_UserModes(chan, from);
#line 94
      __cil_tmp___14 = strchr((char const   *)__cil_tmp___13, 'o');
#line 94
      if (! __cil_tmp___14) {
#line 94
        __cil_tmp___10 = Channel_Name((CHANNEL const   *)chan);
#line 94
        __cil_tmp___11 = Client_ID(from);
#line 94
        __cil_tmp___12 = IRC_WriteStrClient(from, (char *)"482 %s %s :You are not channel operator",
                                            __cil_tmp___11, __cil_tmp___10);
#line 94
        return (__cil_tmp___12);
      }
#line 95
      remember = 1;
    }
#line 99
    __cil_tmp___19 = Channel_IsMemberOf(chan, target);
#line 99
    if (__cil_tmp___19) {
#line 99
      __cil_tmp___17 = Client_ID(from);
#line 99
      __cil_tmp___18 = IRC_WriteStrClient(from, (char *)"443 %s %s %s :is already on channel",
                                          __cil_tmp___17, Req->argv[0], Req->argv[1]);
#line 99
      return (__cil_tmp___18);
    }
#line 102
    __cil_tmp___20 = Channel_GetListBans(chan);
#line 102
    __cil_tmp___21 = Lists_Check(__cil_tmp___20, target);
#line 102
    if (__cil_tmp___21) {
#line 102
      remember = 1;
    }
#line 104
    if (remember) {
#line 106
      __cil_tmp___22 = Client_Mask(target);
#line 106
      __cil_tmp___23 = Channel_AddInvite(chan, (char const   *)__cil_tmp___22, 1);
#line 106
      if (! __cil_tmp___23) {
#line 107
        return (1);
      }
    }
  }
#line 111
  __cil_tmp___24 = Client_Mask(from);
#line 111
  LogDebug("User \"%s\" invites \"%s\" to \"%s\" ...", __cil_tmp___24, Req->argv[0],
           Req->argv[1]);
#line 114
  IRC_WriteStrClientPrefix(target, from, (char *)"INVITE %s %s", Req->argv[0], Req->argv[1]);
#line 116
  __cil_tmp___27 = Client_Conn(target);
#line 116
  if (__cil_tmp___27 > -1) {
#line 119
    __cil_tmp___25 = Client_ID(from);
#line 119
    __cil_tmp___26 = IRC_WriteStrClientPrefix(from, target, (char *)"341 %s %s %s",
                                              __cil_tmp___25, Req->argv[0], Req->argv[1]);
#line 119
    if (! __cil_tmp___26) {
#line 119
      return (0);
    }
  }
#line 122
  return (1);
}
}
#line 1 "irc-oper.o"
#pragma merger(0,"/tmp/cil-iHw27hjp.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 21 "irc-oper.h"
int IRC_OPER(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_DIE(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_REHASH(CLIENT *Client , REQUEST *Req ) ;
#line 24
int IRC_RESTART(CLIENT *Client , REQUEST *Req ) ;
#line 25
int IRC_CONNECT(CLIENT *Client , REQUEST *Req ) ;
#line 26
int IRC_DISCONNECT(CLIENT *Client , REQUEST *Req ) ;
#line 27
int IRC_WALLOPS(CLIENT *Client , REQUEST *Req ) ;
#line 40 "irc-oper.c"
static int Bad_OperPass(CLIENT *Client , char *errtoken , char *errmsg ) 
{ char *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 43
  __cil_tmp = Client_Mask(Client);
#line 43
  Log(4, "Got invalid OPER from \"%s\": \"%s\" -- %s", __cil_tmp, errtoken, errmsg);
#line 45
  IRC_SetPenalty(Client, 3L);
#line 46
  __cil_tmp___0 = Client_ID(Client);
#line 46
  __cil_tmp___1 = IRC_WriteStrClient(Client, (char *)"464 %s :Invalid password", __cil_tmp___0);
#line 46
  return (__cil_tmp___1);
}
}
#line 50 "irc-oper.c"
int IRC_OPER(CLIENT *Client , REQUEST *Req ) 
{ unsigned int i ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;

  {
#line 59
  if (Req->argc != 2) {
#line 59
    __cil_tmp = Client_ID(Client);
#line 59
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 59
    return (__cil_tmp___0);
  }
#line 62
  i = 0U;
#line 62
  while (i < Conf_Oper_Count) {
#line 64
    if ((int )Conf_Oper[i].name[0] && (int )Conf_Oper[i].pwd[0]) {
#line 64
      __cil_tmp___1 = strcmp((char const   *)(Conf_Oper[i].name), (char const   *)Req->argv[0]);
#line 64
      if (__cil_tmp___1 == 0) {
#line 64
        break;
      } else {
#line 64
        goto _L;
      }
    } else {
      _L: /* CIL Label */ ;
    }
#line 62
    i ++;
  }
#line 66
  if (i >= Conf_Oper_Count) {
#line 67
    __cil_tmp___2 = Bad_OperPass(Client, Req->argv[0], (char *)"not configured");
#line 67
    return (__cil_tmp___2);
  }
#line 70
  __cil_tmp___4 = strcmp((char const   *)(Conf_Oper[i].pwd), (char const   *)Req->argv[1]);
#line 70
  if (__cil_tmp___4 != 0) {
#line 71
    __cil_tmp___3 = Bad_OperPass(Client, Conf_Oper[i].name, (char *)"Bad password");
#line 71
    return (__cil_tmp___3);
  }
#line 74
  if (Conf_Oper[i].mask) {
#line 74
    __cil_tmp___6 = Client_Mask(Client);
#line 74
    __cil_tmp___7 = Match((char const   *)Conf_Oper[i].mask, (char const   *)__cil_tmp___6);
#line 74
    if (__cil_tmp___7) {
#line 74
      goto _L___0;
    } else {
#line 75
      __cil_tmp___5 = Bad_OperPass(Client, Conf_Oper[i].mask, (char *)"hostmask check failed");
#line 75
      return (__cil_tmp___5);
    }
  } else {
    _L___0: /* CIL Label */ ;
  }
#line 77
  __cil_tmp___11 = Client_HasMode(Client, (char )'o');
#line 77
  if (! __cil_tmp___11) {
#line 80
    Client_ModeAdd(Client, (char )'o');
#line 81
    __cil_tmp___8 = Client_ID(Client);
#line 81
    __cil_tmp___9 = IRC_WriteStrClient(Client, (char *)"MODE %s :+o", __cil_tmp___8);
#line 81
    if (! __cil_tmp___9) {
#line 81
      return (0);
    }
#line 82
    __cil_tmp___10 = Client_ID(Client);
#line 82
    IRC_WriteStrServersPrefix((CLIENT *)((void *)0), Client, (char *)"MODE %s :+o",
                              __cil_tmp___10);
  }
#line 85
  __cil_tmp___13 = Client_OperByMe(Client);
#line 85
  if (! __cil_tmp___13) {
#line 85
    __cil_tmp___12 = Client_Mask(Client);
#line 85
    Log(1029, "Got valid OPER from \"%s\", user is an IRC operator now.", __cil_tmp___12);
  }
#line 87
  Client_SetOperByMe(Client, 1);
#line 88
  __cil_tmp___14 = Client_ID(Client);
#line 88
  __cil_tmp___15 = IRC_WriteStrClient(Client, (char *)"381 %s :You are now an IRC Operator",
                                      __cil_tmp___14);
#line 88
  return (__cil_tmp___15);
}
}
#line 92 "irc-oper.c"
int IRC_DIE(CLIENT *Client , REQUEST *Req ) 
{ CONN_ID c ;
  CLIENT *cl ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;

  {
#line 104
  __cil_tmp___1 = Client_HasMode(Client, (char )'o');
#line 104
  if (__cil_tmp___1) {
#line 104
    __cil_tmp___2 = Client_OperByMe(Client);
#line 104
    if (! __cil_tmp___2) {
      _L: /* CIL Label */ 
#line 105
      __cil_tmp = Client_ID(Client);
#line 105
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 105
      return (__cil_tmp___0);
    }
  } else {
#line 104
    goto _L;
  }
#line 112
  if (Req->argc > 1) {
#line 114
    __cil_tmp___3 = Client_ID(Client);
#line 114
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 114
    return (__cil_tmp___4);
  }
#line 118
  if (Req->argc > 0) {
#line 119
    c = Conn_First();
#line 120
    while (c != -1) {
#line 121
      cl = Conn_GetClient(c);
#line 122
      __cil_tmp___6 = Client_Type(cl);
#line 122
      if (__cil_tmp___6 == 16) {
#line 123
        __cil_tmp___5 = Client_ID(cl);
#line 123
        IRC_WriteStrClient(cl, (char *)"NOTICE %s :%s", __cil_tmp___5, Req->argv[0]);
      }
#line 125
      c = Conn_Next(c);
    }
  }
#line 129
  __cil_tmp___7 = Client_Mask(Client);
#line 129
  Log(1029, "Got DIE command from \"%s\" ...", __cil_tmp___7);
#line 131
  NGIRCd_SignalQuit = 1;
#line 133
  return (1);
}
}
#line 137 "irc-oper.c"
int IRC_REHASH(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;

  {
#line 146
  __cil_tmp___1 = Client_HasMode(Client, (char )'o');
#line 146
  if (__cil_tmp___1) {
#line 146
    __cil_tmp___2 = Client_OperByMe(Client);
#line 146
    if (! __cil_tmp___2) {
      _L: /* CIL Label */ 
#line 146
      __cil_tmp = Client_ID(Client);
#line 146
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 146
      return (__cil_tmp___0);
    }
  } else {
#line 146
    goto _L;
  }
#line 149
  if (Req->argc != 0) {
#line 149
    __cil_tmp___3 = Client_ID(Client);
#line 149
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 149
    return (__cil_tmp___4);
  }
#line 151
  __cil_tmp___5 = Client_Mask(Client);
#line 151
  Log(1029, "Got REHASH command from \"%s\" ...", __cil_tmp___5);
#line 152
  NGIRCd_SignalRehash = 1;
#line 154
  return (1);
}
}
#line 158 "irc-oper.c"
int IRC_RESTART(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;

  {
#line 167
  __cil_tmp___1 = Client_HasMode(Client, (char )'o');
#line 167
  if (__cil_tmp___1) {
#line 167
    __cil_tmp___2 = Client_OperByMe(Client);
#line 167
    if (! __cil_tmp___2) {
      _L: /* CIL Label */ 
#line 167
      __cil_tmp = Client_ID(Client);
#line 167
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 167
      return (__cil_tmp___0);
    }
  } else {
#line 167
    goto _L;
  }
#line 170
  if (Req->argc != 0) {
#line 170
    __cil_tmp___3 = Client_ID(Client);
#line 170
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 170
    return (__cil_tmp___4);
  }
#line 172
  __cil_tmp___5 = Client_Mask(Client);
#line 172
  Log(1029, "Got RESTART command from \"%s\" ...", __cil_tmp___5);
#line 173
  NGIRCd_SignalRestart = 1;
#line 174
  return (1);
}
}
#line 181 "irc-oper.c"
int IRC_CONNECT(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int __cil_tmp___10 ;
  int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  int __cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  int __cil_tmp___18 ;
  int __cil_tmp___19 ;

  {
#line 189
  __cil_tmp___1 = Client_HasMode(Client, (char )'o');
#line 189
  if (__cil_tmp___1) {
#line 189
    __cil_tmp___2 = Client_OperByMe(Client);
#line 189
    if (! __cil_tmp___2) {
      _L: /* CIL Label */ 
#line 190
      __cil_tmp = Client_ID(Client);
#line 190
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 190
      return (__cil_tmp___0);
    }
  } else {
#line 189
    goto _L;
  }
#line 194
  if ((Req->argc != 1 && Req->argc != 2) && Req->argc != 5) {
#line 195
    __cil_tmp___3 = Client_ID(Client);
#line 195
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 195
    return (__cil_tmp___4);
  }
#line 199
  if (Req->argc > 1) {
#line 199
    __cil_tmp___7 = atoi((char const   *)Req->argv[1]);
#line 199
    if (__cil_tmp___7 < 1) {
#line 200
      __cil_tmp___5 = Client_ID(Client);
#line 200
      __cil_tmp___6 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                         __cil_tmp___5, Req->command);
#line 200
      return (__cil_tmp___6);
    } else {
#line 199
      goto _L___0;
    }
  } else {
    _L___0: /* CIL Label */ ;
  }
#line 203
  __cil_tmp___8 = Client_Mask(Client);
#line 203
  Log(1029, "Got CONNECT command from \"%s\" for \"%s\".", __cil_tmp___8, Req->argv[0]);
#line 207
  switch (Req->argc) {
  case 1: 
#line 209
  __cil_tmp___11 = Conf_EnablePassiveServer((char const   *)Req->argv[0]);
#line 209
  if (! __cil_tmp___11) {
#line 210
    __cil_tmp___9 = Client_ID(Client);
#line 210
    __cil_tmp___10 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                        __cil_tmp___9, Req->argv[0]);
#line 210
    return (__cil_tmp___10);
  }
#line 213
  break;
  case 2: 
#line 216
  __cil_tmp___14 = atoi((char const   *)Req->argv[1]);
#line 216
  __cil_tmp___15 = Conf_EnableServer(Req->argv[0], (unsigned short )__cil_tmp___14);
#line 216
  if (! __cil_tmp___15) {
#line 218
    __cil_tmp___12 = Client_ID(Client);
#line 218
    __cil_tmp___13 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                        __cil_tmp___12, Req->argv[0]);
#line 218
    return (__cil_tmp___13);
  }
#line 221
  break;
  default: 
#line 224
  __cil_tmp___18 = atoi((char const   *)Req->argv[1]);
#line 224
  __cil_tmp___19 = Conf_AddServer(Req->argv[0], (unsigned short )__cil_tmp___18, Req->argv[2],
                                  Req->argv[3], Req->argv[4]);
#line 224
  if (! __cil_tmp___19) {
#line 227
    __cil_tmp___16 = Client_ID(Client);
#line 227
    __cil_tmp___17 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                        __cil_tmp___16, Req->argv[0]);
#line 227
    return (__cil_tmp___17);
  }
  }
#line 232
  return (1);
}
}
#line 236 "irc-oper.c"
int IRC_DISCONNECT(CLIENT *Client , REQUEST *Req ) 
{ CONN_ID my_conn ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  CLIENT *__cil_tmp___9 ;

  {
#line 247
  __cil_tmp___1 = Client_HasMode(Client, (char )'o');
#line 247
  if (__cil_tmp___1) {
#line 247
    __cil_tmp___2 = Client_OperByMe(Client);
#line 247
    if (! __cil_tmp___2) {
      _L: /* CIL Label */ 
#line 247
      __cil_tmp = Client_ID(Client);
#line 247
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 247
      return (__cil_tmp___0);
    }
  } else {
#line 247
    goto _L;
  }
#line 250
  if (Req->argc != 1) {
#line 250
    __cil_tmp___3 = Client_ID(Client);
#line 250
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 250
    return (__cil_tmp___4);
  }
#line 252
  __cil_tmp___5 = Client_Mask(Client);
#line 252
  Log(1029, "Got DISCONNECT command from \"%s\" for0 \"%s\".", __cil_tmp___5, Req->argv[0]);
#line 255
  my_conn = Client_Conn(Client);
#line 258
  __cil_tmp___8 = Conf_DisableServer(Req->argv[0]);
#line 258
  if (! __cil_tmp___8) {
#line 258
    __cil_tmp___6 = Client_ID(Client);
#line 258
    __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                       __cil_tmp___6, Req->argv[0]);
#line 258
    return (__cil_tmp___7);
  }
#line 261
  __cil_tmp___9 = Conn_GetClient(my_conn);
#line 261
  if (__cil_tmp___9) {
#line 261
    return (1);
  } else {
#line 262
    return (0);
  }
}
}
#line 266 "irc-oper.c"
int IRC_WALLOPS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *to ;
  CLIENT *from ;
  int client_type ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  CONN_ID __cil_tmp___6 ;
  int __cil_tmp___7 ;

  {
#line 275
  if (Req->argc != 1) {
#line 276
    __cil_tmp = Client_ID(Client);
#line 276
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 276
    return (__cil_tmp___0);
  }
#line 278
  client_type = Client_Type(Client);
#line 279
  switch (client_type) {
  case 16: 
#line 281
  __cil_tmp___3 = Client_OperByMe(Client);
#line 281
  if (! __cil_tmp___3) {
#line 282
    __cil_tmp___1 = Client_ID(Client);
#line 282
    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                       __cil_tmp___1);
#line 282
    return (__cil_tmp___2);
  }
#line 283
  from = Client;
#line 284
  break;
  case 32: 
#line 286
  from = Client_Search(Req->prefix);
#line 287
  break;
  default: ;
#line 289
  return (1);
  }
#line 292
  if (! from) {
#line 293
    __cil_tmp___4 = Client_ID(Client);
#line 293
    __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___4, Req->prefix);
#line 293
    return (__cil_tmp___5);
  }
#line 295
  to = Client_First();
#line 295
  while ((unsigned int )to != (unsigned int )((void *)0)) {
#line 296
    __cil_tmp___6 = Client_Conn(to);
#line 296
    if (__cil_tmp___6 < 0) {
#line 297
      goto __Cont;
    }
#line 299
    client_type = Client_Type(to);
#line 300
    switch (client_type) {
    case 16: 
#line 302
    __cil_tmp___7 = Client_HasMode(to, (char )'w');
#line 302
    if (__cil_tmp___7) {
#line 303
      IRC_WriteStrClientPrefix(to, from, (char *)"WALLOPS :%s", Req->argv[0]);
    }
#line 304
    break;
    case 32: 
#line 306
    if ((unsigned int )to != (unsigned int )Client) {
#line 307
      IRC_WriteStrClientPrefix(to, from, (char *)"WALLOPS :%s", Req->argv[0]);
    }
#line 308
    break;
    }
    __Cont: /* CIL Label */ 
#line 295
    to = Client_Next(to);
  }
#line 311
  return (1);
}
}
#line 1 "irc-server.o"
#pragma merger(0,"/tmp/cil-uygEYJD1.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 19 "numeric.h"
int IRC_Num_ENDOFMOTD(CLIENT *Client , REQUEST *Req  __attribute__((__unused__)) ) ;
#line 21 "irc-server.h"
int IRC_SERVER(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_NJOIN(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_SQUIT(CLIENT *Client , REQUEST *Req ) ;
#line 50 "irc-server.c"
int IRC_SERVER(CLIENT *Client , REQUEST *Req ) 
{ char str[256] ;
  char *ptr ;
  CLIENT *from ;
  CLIENT *c ;
  int ok ;
  int i ;
  CONN_ID con ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  CONN_ID __cil_tmp___1 ;
  CONN_ID __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  CONN_ID __cil_tmp___6 ;
  CONN_ID __cil_tmp___7 ;
  CONN_ID __cil_tmp___8 ;
  CONN_ID __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  int __cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  int __cil_tmp___15 ;
  int __cil_tmp___16 ;
  char *__cil_tmp___17 ;
  int __cil_tmp___18 ;
  char *__cil_tmp___19 ;
  char *__cil_tmp___20 ;
  int __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;
  int __cil_tmp___24 ;
  CONN_ID __cil_tmp___25 ;
  CONN_ID __cil_tmp___26 ;
  int __cil_tmp___27 ;
  int __cil_tmp___28 ;
  CONN_ID __cil_tmp___29 ;
  CONN_ID __cil_tmp___30 ;
  char *__cil_tmp___31 ;
  int __cil_tmp___32 ;
  char const   *__cil_tmp___34 ;
  int __cil_tmp___35 ;
  int __cil_tmp___36 ;
  char *__cil_tmp___37 ;
  char *__cil_tmp___38 ;
  char *__cil_tmp___39 ;
  int __cil_tmp___40 ;
  int __cil_tmp___41 ;
  char *__cil_tmp___42 ;
  char *__cil_tmp___43 ;
  int __cil_tmp___44 ;
  int __cil_tmp___45 ;
  int __cil_tmp___46 ;

  {
#line 63
  __cil_tmp___1 = Client_Conn(Client);
#line 63
  if (__cil_tmp___1 <= -1) {
#line 64
    __cil_tmp = Client_ID(Client);
#line 64
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"421 %s %s :Unknown command",
                                       __cil_tmp, Req->command);
#line 64
    return (__cil_tmp___0);
  }
#line 67
  __cil_tmp___46 = Client_Type(Client);
#line 67
  if (__cil_tmp___46 == 2) {
#line 70
    __cil_tmp___2 = Client_Conn(Client);
#line 70
    LogDebug("Connection %d: got SERVER command (new server link) ...", __cil_tmp___2);
#line 74
    if (Req->argc != 2 && Req->argc != 3) {
#line 74
      __cil_tmp___3 = Client_ID(Client);
#line 74
      __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                         __cil_tmp___3, Req->command);
#line 74
      return (__cil_tmp___4);
    }
#line 77
    i = 0;
#line 77
    while (i < 16) {
#line 77
      __cil_tmp___5 = strcasecmp((char const   *)Req->argv[0], (char const   *)(Conf_Server[i].name));
#line 77
      if (__cil_tmp___5 == 0) {
#line 77
        break;
      }
#line 77
      i ++;
    }
#line 78
    if (i >= 16) {
#line 81
      __cil_tmp___6 = Client_Conn(Client);
#line 81
      Log(3, "Connection %d: Server \"%s\" not configured here!", __cil_tmp___6, Req->argv[0]);
#line 82
      __cil_tmp___7 = Client_Conn(Client);
#line 82
      Conn_Close(__cil_tmp___7, (char *)((void *)0), (char *)"Server not configured here",
                 1);
#line 83
      return (0);
    }
#line 85
    __cil_tmp___10 = Client_Password(Client);
#line 85
    __cil_tmp___11 = strcmp((char const   *)__cil_tmp___10, (char const   *)(Conf_Server[i].pwd_in));
#line 85
    if (__cil_tmp___11 != 0) {
#line 88
      __cil_tmp___8 = Client_Conn(Client);
#line 88
      Log(3, "Connection %d: Got bad password from server \"%s\"!", __cil_tmp___8,
          Req->argv[0]);
#line 89
      __cil_tmp___9 = Client_Conn(Client);
#line 89
      Conn_Close(__cil_tmp___9, (char *)((void *)0), (char *)"Bad password", 1);
#line 90
      return (0);
    }
#line 94
    __cil_tmp___12 = Client_CheckID(Client, Req->argv[0]);
#line 94
    if (! __cil_tmp___12) {
#line 94
      return (0);
    }
#line 97
    Client_SetID(Client, Req->argv[0]);
#line 98
    Client_SetHops(Client, 1);
#line 99
    Client_SetInfo(Client, Req->argv[Req->argc - 1]);
#line 103
    con = Client_Conn(Client);
#line 104
    __cil_tmp___15 = Client_Token(Client);
#line 104
    if (__cil_tmp___15 != -2) {
#line 107
      ok = 1;
#line 108
      __cil_tmp___13 = IRC_WriteStrClient(Client, (char *)"PASS %s %s", Conf_Server[i].pwd_out,
                                          NGIRCd_ProtoID);
#line 108
      if (__cil_tmp___13) {
#line 109
        ok = IRC_WriteStrClient(Client, (char *)"SERVER %s 1 :%s", Conf_ServerName,
                                Conf_ServerInfo);
      } else {
#line 108
        ok = 0;
      }
#line 110
      if (! ok) {
#line 112
        Conn_Close(con, (char *)"Unexpected server behavior!", (char *)((void *)0),
                   0);
#line 113
        return (0);
      }
#line 115
      Client_SetIntroducer(Client, Client);
#line 116
      Client_SetToken(Client, 1);
    } else {
#line 122
      __cil_tmp___14 = atoi((char const   *)Req->argv[1]);
#line 122
      Client_SetToken(Client, __cil_tmp___14);
    }
#line 126
    Conf_SetServer(i, con);
#line 128
    Client_SetType(Client, 128);
#line 144
    __cil_tmp___19 = Client_Flags(Client);
#line 144
    __cil_tmp___20 = strchr((char const   *)__cil_tmp___19, 'H');
#line 144
    if (__cil_tmp___20) {
#line 145
      LogDebug("Peer supports IRC+ extended server handshake ...");
#line 146
      __cil_tmp___16 = IRC_Send_ISUPPORT(Client);
#line 146
      if (! __cil_tmp___16) {
#line 147
        return (0);
      }
#line 148
      __cil_tmp___17 = Client_ID(Client);
#line 148
      __cil_tmp___18 = IRC_WriteStrClient(Client, (char *)"376 %s :End of MOTD command",
                                          __cil_tmp___17);
#line 148
      return (__cil_tmp___18);
    } else {
#line 152
      if (Conf_MaxNickLength != 10U) {
#line 153
        Log(2, "Attention: this server uses a non-standard nick length, but the peer doesn\'t support the IRC+ extended server handshake!");
      }
    }
#line 159
    __cil_tmp___21 = IRC_Num_ENDOFMOTD(Client, Req);
#line 159
    return (__cil_tmp___21);
  } else {
#line 161
    __cil_tmp___45 = Client_Type(Client);
#line 161
    if (__cil_tmp___45 == 32) {
#line 166
      if (Req->argc != 4) {
#line 166
        __cil_tmp___22 = Client_ID(Client);
#line 166
        __cil_tmp___23 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                            __cil_tmp___22, Req->command);
#line 166
        return (__cil_tmp___23);
      }
#line 169
      __cil_tmp___24 = Client_CheckID(Client, Req->argv[0]);
#line 169
      if (! __cil_tmp___24) {
#line 169
        return (0);
      }
#line 172
      ptr = strchr((char const   *)(Req->argv[3] + 2), '[');
#line 173
      if (! ptr) {
#line 173
        ptr = Req->argv[3];
      }
#line 175
      from = Client_Search(Req->prefix);
#line 176
      if (! from) {
#line 179
        __cil_tmp___25 = Client_Conn(Client);
#line 179
        Log(1, "Unknown ID in prefix of SERVER: \"%s\"! (on connection %d)", Req->prefix,
            __cil_tmp___25);
#line 180
        __cil_tmp___26 = Client_Conn(Client);
#line 180
        Conn_Close(__cil_tmp___26, (char *)((void *)0), (char *)"Unknown ID in prefix of SERVER",
                   1);
#line 181
        return (0);
      }
#line 185
      __cil_tmp___27 = atoi((char const   *)Req->argv[2]);
#line 185
      __cil_tmp___28 = atoi((char const   *)Req->argv[1]);
#line 185
      c = Client_NewRemoteServer(Client, Req->argv[0], from, __cil_tmp___28, __cil_tmp___27,
                                 ptr, 1);
#line 186
      if (! c) {
#line 189
        __cil_tmp___29 = Client_Conn(Client);
#line 189
        Log(1, "Can\'t create client structure for server! (on connection %d)", __cil_tmp___29);
#line 190
        __cil_tmp___30 = Client_Conn(Client);
#line 190
        Conn_Close(__cil_tmp___30, (char *)((void *)0), (char *)"Can\'t allocate client structure for remote server",
                   1);
#line 191
        return (0);
      }
#line 195
      __cil_tmp___32 = Client_Hops(c);
#line 195
      if (__cil_tmp___32 > 1 && (int )*(Req->prefix + 0)) {
#line 195
        __cil_tmp___31 = Client_ID(from);
#line 195
        snprintf((char * __restrict  )(str), sizeof(str), (char const   * __restrict  )"connected to %s, ",
                 __cil_tmp___31);
      } else {
#line 196
        strcpy((char * __restrict  )(str), (char const   * __restrict  )"");
      }
#line 197
      __cil_tmp___35 = Client_Hops(c);
#line 197
      if (__cil_tmp___35 > 1) {
#line 197
        __cil_tmp___34 = "s";
      } else {
#line 197
        __cil_tmp___34 = "";
      }
#line 197
      __cil_tmp___36 = Client_Hops(c);
#line 197
      __cil_tmp___37 = Client_ID(Client);
#line 197
      __cil_tmp___38 = Client_ID(c);
#line 197
      Log(1029, "Server \"%s\" registered (via %s, %s%d hop%s).", __cil_tmp___38,
          __cil_tmp___37, str, __cil_tmp___36, __cil_tmp___34);
#line 200
      __cil_tmp___39 = Client_Info(c);
#line 200
      __cil_tmp___40 = Client_MyToken(c);
#line 200
      __cil_tmp___41 = Client_Hops(c);
#line 200
      __cil_tmp___42 = Client_ID(c);
#line 200
      IRC_WriteStrServersPrefix(Client, from, (char *)"SERVER %s %d %d :%s", __cil_tmp___42,
                                __cil_tmp___41 + 1, __cil_tmp___40, __cil_tmp___39);
#line 202
      return (1);
    } else {
#line 204
      __cil_tmp___43 = Client_ID(Client);
#line 204
      __cil_tmp___44 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                          __cil_tmp___43, Req->command);
#line 204
      return (__cil_tmp___44);
    }
  }
}
}
#line 209 "irc-server.c"
int IRC_NJOIN(CLIENT *Client , REQUEST *Req ) 
{ char nick_in[513] ;
  char nick_out[513] ;
  char *channame ;
  char *ptr ;
  char modes[8] ;
  int is_op ;
  int is_voiced ;
  CHANNEL *chan ;
  CLIENT *c ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  CLIENT *__cil_tmp___3 ;

  {
#line 221
  if (Req->argc != 2) {
#line 221
    __cil_tmp = Client_ID(Client);
#line 221
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 221
    return (__cil_tmp___0);
  }
#line 223
  strlcpy(nick_in, (char const   *)Req->argv[1], sizeof(nick_in));
#line 224
  strcpy((char * __restrict  )(nick_out), (char const   * __restrict  )"");
#line 226
  channame = Req->argv[0];
#line 227
  ptr = strtok((char * __restrict  )(nick_in), (char const   * __restrict  )",");
#line 228
  while (ptr) {
#line 230
    is_voiced = 0;
#line 230
    is_op = is_voiced;
#line 233
    while ((int )*ptr == 64 || (int )*ptr == 43) {
#line 235
      if ((int )*ptr == 64) {
#line 235
        is_op = 1;
      }
#line 236
      if ((int )*ptr == 43) {
#line 236
        is_voiced = 1;
      }
#line 237
      ptr ++;
    }
#line 240
    c = Client_Search(ptr);
#line 241
    if (c) {
#line 243
      Channel_Join(c, channame);
#line 244
      chan = Channel_Search((char const   *)channame);
#line 247
      if (is_op) {
#line 247
        Channel_UserModeAdd(chan, c, (char )'o');
      }
#line 248
      if (is_voiced) {
#line 248
        Channel_UserModeAdd(chan, c, (char )'v');
      }
#line 251
      IRC_WriteStrChannelPrefix(Client, chan, c, 0, (char *)"JOIN :%s", channame);
#line 254
      __cil_tmp___1 = Channel_UserModes(chan, c);
#line 254
      strlcpy(modes, (char const   *)__cil_tmp___1, sizeof(modes));
#line 255
      if (modes[0]) {
#line 258
        __cil_tmp___2 = Client_ID(c);
#line 258
        IRC_WriteStrChannelPrefix(Client, chan, Client, 0, (char *)"MODE %s +%s %s",
                                  channame, modes, __cil_tmp___2);
      }
#line 261
      if ((int )nick_out[0] != 0) {
#line 261
        strlcat(nick_out, ",", sizeof(nick_out));
      }
#line 262
      if (is_op) {
#line 262
        strlcat(nick_out, "@", sizeof(nick_out));
      }
#line 263
      if (is_voiced) {
#line 263
        strlcat(nick_out, "+", sizeof(nick_out));
      }
#line 264
      strlcat(nick_out, (char const   *)ptr, sizeof(nick_out));
    } else {
#line 266
      Log(3, "Got NJOIN for unknown nick \"%s\" for channel \"%s\"!", ptr, channame);
    }
#line 269
    ptr = strtok((char * __restrict  )((void *)0), (char const   * __restrict  )",");
  }
#line 273
  if ((int )nick_out[0] != 0) {
#line 273
    __cil_tmp___3 = Client_ThisServer();
#line 273
    IRC_WriteStrServersPrefix(Client, __cil_tmp___3, (char *)"NJOIN %s :%s", Req->argv[0],
                              nick_out);
  }
#line 275
  return (1);
}
}
#line 279 "irc-server.c"
int IRC_SQUIT(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  char msg[320] ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  size_t __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  CONN_ID __cil_tmp___6 ;
  CONN_ID __cil_tmp___7 ;
  CONN_ID __cil_tmp___8 ;

  {
#line 289
  if (Req->argc != 2) {
#line 289
    __cil_tmp = Client_ID(Client);
#line 289
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 289
    return (__cil_tmp___0);
  }
#line 291
  __cil_tmp___1 = Client_ID(Client);
#line 291
  Log(7, "Got SQUIT from %s for \"%s\": \"%s\" ...", __cil_tmp___1, Req->argv[0],
      Req->argv[1]);
#line 293
  target = Client_Search(Req->argv[0]);
#line 294
  if (! target) {
#line 297
    __cil_tmp___2 = Client_ID(Client);
#line 297
    Log(4, "Got SQUIT from %s for unknown server \"%s\"!?", __cil_tmp___2, Req->argv[0]);
#line 298
    return (1);
  }
#line 301
  if (*(Req->argv[1] + 0)) {
#line 303
    __cil_tmp___3 = strlen((char const   *)Req->argv[1]);
#line 303
    if (__cil_tmp___3 > 256U) {
#line 303
      *(Req->argv[1] + 256) = (char )'\000';
    }
#line 304
    __cil_tmp___4 = Client_ID(Client);
#line 304
    snprintf((char * __restrict  )(msg), sizeof(msg), (char const   * __restrict  )"%s (SQUIT from %s).",
             Req->argv[1], __cil_tmp___4);
  } else {
#line 306
    __cil_tmp___5 = Client_ID(Client);
#line 306
    snprintf((char * __restrict  )(msg), sizeof(msg), (char const   * __restrict  )"Got SQUIT from %s.",
             __cil_tmp___5);
  }
#line 308
  __cil_tmp___8 = Client_Conn(target);
#line 308
  if (__cil_tmp___8 > -1) {
#line 311
    if (*(Req->argv[1] + 0)) {
#line 311
      __cil_tmp___6 = Client_Conn(target);
#line 311
      Conn_Close(__cil_tmp___6, msg, Req->argv[1], 1);
    } else {
#line 312
      __cil_tmp___7 = Client_Conn(target);
#line 312
      Conn_Close(__cil_tmp___7, msg, (char *)((void *)0), 1);
    }
#line 313
    return (0);
  } else {
#line 318
    Client_Destroy(target, msg, Req->argv[1], 0);
#line 319
    return (1);
  }
}
}
#line 1 "irc-write.o"
#pragma merger(0,"/tmp/cil-GsXmKZSD.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 24 "irc-write.h"
int IRC_WriteStrChannel(CLIENT *Client , CHANNEL *Chan , int Remote , char *Format 
                        , ...) ;
#line 42 "irc-write.c"
static char *Get_Prefix(CLIENT *Target , CLIENT *Client ) ;
#line 46 "irc-write.c"
int IRC_WriteStrClient(CLIENT *Client , char *Format  , ...) 
{ char buffer[1000] ;
  int ok ;
  va_list ap ;
  CLIENT *__cil_tmp ;

  {
#line 57
  ok = 1;
#line 64
  __builtin_va_start(ap, Format);
#line 68
  vsnprintf((char * __restrict  )(buffer), 1000U, (char const   * __restrict  )Format,
            ap);
#line 69
  __builtin_va_end(ap);
#line 72
  __cil_tmp = Client_ThisServer();
#line 72
  ok = IRC_WriteStrClientPrefix(Client, __cil_tmp, (char *)"%s", buffer);
#line 74
  return (ok);
}
}
#line 79 "irc-write.c"
int IRC_WriteStrClientPrefix(CLIENT *Client , CLIENT *Prefix , char *Format  , ...) 
{ char buffer[1000] ;
  va_list ap ;
  CLIENT *__cil_tmp ;
  char *__cil_tmp___0 ;
  CLIENT *__cil_tmp___1 ;
  CONN_ID __cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 100
  __builtin_va_start(ap, Format);
#line 104
  vsnprintf((char * __restrict  )(buffer), 1000U, (char const   * __restrict  )Format,
            ap);
#line 105
  __builtin_va_end(ap);
#line 107
  __cil_tmp = Client_NextHop(Client);
#line 107
  __cil_tmp___0 = Get_Prefix(__cil_tmp, Prefix);
#line 107
  __cil_tmp___1 = Client_NextHop(Client);
#line 107
  __cil_tmp___2 = Client_Conn(__cil_tmp___1);
#line 107
  __cil_tmp___3 = Conn_WriteStr(__cil_tmp___2, (char *)":%s %s", __cil_tmp___0, buffer);
#line 107
  return (__cil_tmp___3);
}
}
#line 112 "irc-write.c"
int IRC_WriteStrChannel(CLIENT *Client , CHANNEL *Chan , int Remote , char *Format 
                        , ...) 
{ char buffer[1000] ;
  va_list ap ;
  CLIENT *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 131
  __builtin_va_start(ap, Format);
#line 135
  vsnprintf((char * __restrict  )(buffer), 1000U, (char const   * __restrict  )Format,
            ap);
#line 136
  __builtin_va_end(ap);
#line 138
  __cil_tmp = Client_ThisServer();
#line 138
  __cil_tmp___0 = IRC_WriteStrChannelPrefix(Client, Chan, __cil_tmp, Remote, (char *)"%s",
                                            buffer);
#line 138
  return (__cil_tmp___0);
}
}
#line 143 "irc-write.c"
int IRC_WriteStrChannelPrefix(CLIENT *Client , CHANNEL *Chan , CLIENT *Prefix , int Remote ,
                              char *Format  , ...) 
{ int ok ;
  char buffer[1000] ;
  CL2CHAN *cl2chan ;
  CONN_ID conn ;
  CLIENT *c ;
  va_list ap ;
  int __cil_tmp ;
  CONN_ID __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;

  {
#line 156
  ok = 1;
#line 169
  __builtin_va_start(ap, Format);
#line 173
  vsnprintf((char * __restrict  )(buffer), 1000U, (char const   * __restrict  )Format,
            ap);
#line 174
  __builtin_va_end(ap);
#line 176
  Conn_ClearFlags();
#line 180
  cl2chan = Channel_FirstMember(Chan);
#line 181
  while (cl2chan) {
#line 183
    c = Channel_GetClient(cl2chan);
#line 184
    if (! Remote) {
#line 186
      __cil_tmp___0 = Client_Conn(c);
#line 186
      if (__cil_tmp___0 <= -1) {
#line 186
        c = (CLIENT *)((void *)0);
      } else {
#line 187
        __cil_tmp = Client_Type(c);
#line 187
        if (__cil_tmp == 32) {
#line 187
          c = (CLIENT *)((void *)0);
        }
      }
    }
#line 189
    if (c) {
#line 189
      c = Client_NextHop(c);
    }
#line 191
    if ((int )c && (unsigned int )c != (unsigned int )Client) {
#line 194
      conn = Client_Conn(c);
#line 195
      __cil_tmp___1 = Client_Type(c);
#line 195
      if (__cil_tmp___1 == 32) {
#line 195
        Conn_SetFlag(conn, 2);
      } else {
#line 196
        Conn_SetFlag(conn, 1);
      }
    }
#line 198
    cl2chan = Channel_NextMember(Chan, cl2chan);
  }
#line 202
  conn = Conn_First();
#line 203
  while (conn != -1) {
#line 206
    __cil_tmp___5 = Conn_Flag(conn);
#line 206
    if (__cil_tmp___5 == 2) {
#line 206
      __cil_tmp___2 = Client_ID(Prefix);
#line 206
      ok = Conn_WriteStr(conn, (char *)":%s %s", __cil_tmp___2, buffer);
    } else {
#line 207
      __cil_tmp___4 = Conn_Flag(conn);
#line 207
      if (__cil_tmp___4 == 1) {
#line 207
        __cil_tmp___3 = Client_Mask(Prefix);
#line 207
        ok = Conn_WriteStr(conn, (char *)":%s %s", __cil_tmp___3, buffer);
      }
    }
#line 208
    if (! ok) {
#line 208
      break;
    }
#line 211
    conn = Conn_Next(conn);
  }
#line 214
  return (ok);
}
}
#line 219 "irc-write.c"
void IRC_WriteStrServers(CLIENT *ExceptOf , char *Format  , ...) 
{ char buffer[1000] ;
  va_list ap ;
  CLIENT *__cil_tmp ;

  {
#line 235
  __builtin_va_start(ap, Format);
#line 239
  vsnprintf((char * __restrict  )(buffer), 1000U, (char const   * __restrict  )Format,
            ap);
#line 240
  __builtin_va_end(ap);
#line 243
  __cil_tmp = Client_ThisServer();
#line 243
  IRC_WriteStrServersPrefix(ExceptOf, __cil_tmp, (char *)"%s", buffer);
#line 244
  return;
}
}
#line 248 "irc-write.c"
void IRC_WriteStrServersPrefix(CLIENT *ExceptOf , CLIENT *Prefix , char *Format  , ...) 
{ char buffer[1000] ;
  va_list ap ;

  {
#line 266
  __builtin_va_start(ap, Format);
#line 270
  vsnprintf((char * __restrict  )(buffer), 1000U, (char const   * __restrict  )Format,
            ap);
#line 271
  __builtin_va_end(ap);
#line 273
  IRC_WriteStrServersPrefixFlag(ExceptOf, Prefix, (char )'\000', (char *)"%s", buffer);
#line 274
  return;
}
}
#line 278 "irc-write.c"
void IRC_WriteStrServersPrefixFlag(CLIENT *ExceptOf , CLIENT *Prefix , char Flag ,
                                   char *Format  , ...) 
{ char buffer[1000] ;
  CLIENT *c ;
  va_list ap ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  CONN_ID __cil_tmp___2 ;
  CLIENT *__cil_tmp___3 ;

  {
#line 298
  __builtin_va_start(ap, Format);
#line 302
  vsnprintf((char * __restrict  )(buffer), 1000U, (char const   * __restrict  )Format,
            ap);
#line 303
  __builtin_va_end(ap);
#line 305
  c = Client_First();
#line 306
  while (c) {
#line 308
    __cil_tmp___1 = Client_Type(c);
#line 308
    if (__cil_tmp___1 == 32) {
#line 308
      __cil_tmp___2 = Client_Conn(c);
#line 308
      if (__cil_tmp___2 > -1) {
#line 308
        __cil_tmp___3 = Client_ThisServer();
#line 308
        if ((unsigned int )c != (unsigned int )__cil_tmp___3) {
#line 308
          if ((unsigned int )c != (unsigned int )ExceptOf) {
#line 311
            if ((int )Flag == 0) {
#line 311
              goto _L;
            } else {
#line 311
              __cil_tmp = Client_Flags(c);
#line 311
              __cil_tmp___0 = strchr((char const   *)__cil_tmp, (int )Flag);
#line 311
              if ((unsigned int )__cil_tmp___0 != (unsigned int )((void *)0)) {
                _L: /* CIL Label */ 
#line 311
                IRC_WriteStrClientPrefix(c, Prefix, (char *)"%s", buffer);
              }
            }
          } else {
#line 308
            goto _L___2;
          }
        } else {
#line 308
          goto _L___2;
        }
      } else {
#line 308
        goto _L___2;
      }
    } else {
      _L___2: /* CIL Label */ ;
    }
#line 313
    c = Client_Next(c);
  }
#line 315
  return;
}
}
#line 319 "irc-write.c"
int IRC_WriteStrRelatedPrefix(CLIENT *Client , CLIENT *Prefix , int Remote , char *Format 
                              , ...) 
{ int ok ;
  CL2CHAN *chan_cl2chan ;
  CL2CHAN *cl2chan ;
  char buffer[1000] ;
  CHANNEL *chan ;
  CONN_ID conn ;
  va_list ap ;
  CLIENT *c ;
  int __cil_tmp ;
  CONN_ID __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;

  {
#line 331
  ok = 1;
#line 344
  __builtin_va_start(ap, Format);
#line 348
  vsnprintf((char * __restrict  )(buffer), 1000U, (char const   * __restrict  )Format,
            ap);
#line 349
  __builtin_va_end(ap);
#line 352
  Conn_ClearFlags();
#line 356
  chan_cl2chan = Channel_FirstChannelOf(Client);
#line 357
  while (chan_cl2chan) {
#line 360
    chan = Channel_GetChannel(chan_cl2chan);
#line 361
    cl2chan = Channel_FirstMember(chan);
#line 362
    while (cl2chan) {
#line 364
      c = Channel_GetClient(cl2chan);
#line 365
      if (! Remote) {
#line 367
        __cil_tmp___0 = Client_Conn(c);
#line 367
        if (__cil_tmp___0 <= -1) {
#line 367
          c = (CLIENT *)((void *)0);
        } else {
#line 368
          __cil_tmp = Client_Type(c);
#line 368
          if (__cil_tmp == 32) {
#line 368
            c = (CLIENT *)((void *)0);
          }
        }
      }
#line 370
      if (c) {
#line 370
        c = Client_NextHop(c);
      }
#line 372
      if ((int )c && (unsigned int )c != (unsigned int )Client) {
#line 375
        conn = Client_Conn(c);
#line 376
        __cil_tmp___1 = Client_Type(c);
#line 376
        if (__cil_tmp___1 == 32) {
#line 376
          Conn_SetFlag(conn, 2);
        } else {
#line 377
          Conn_SetFlag(conn, 1);
        }
      }
#line 379
      cl2chan = Channel_NextMember(chan, cl2chan);
    }
#line 383
    chan_cl2chan = Channel_NextChannelOf(Client, chan_cl2chan);
  }
#line 387
  conn = Conn_First();
#line 388
  while (conn != -1) {
#line 391
    __cil_tmp___5 = Conn_Flag(conn);
#line 391
    if (__cil_tmp___5 == 2) {
#line 391
      __cil_tmp___2 = Client_ID(Prefix);
#line 391
      ok = Conn_WriteStr(conn, (char *)":%s %s", __cil_tmp___2, buffer);
    } else {
#line 392
      __cil_tmp___4 = Conn_Flag(conn);
#line 392
      if (__cil_tmp___4 == 1) {
#line 392
        __cil_tmp___3 = Client_Mask(Prefix);
#line 392
        ok = Conn_WriteStr(conn, (char *)":%s %s", __cil_tmp___3, buffer);
      }
    }
#line 393
    if (! ok) {
#line 393
      break;
    }
#line 396
    conn = Conn_Next(conn);
  }
#line 398
  return (ok);
}
}
#line 402 "irc-write.c"
void IRC_SetPenalty(CLIENT *Client , time_t Seconds ) 
{ CONN_ID c ;
  int __cil_tmp ;

  {
#line 410
  __cil_tmp = Client_Type(Client);
#line 410
  if (__cil_tmp == 32) {
#line 410
    return;
  }
#line 412
  c = Client_Conn(Client);
#line 413
  if (c > -1) {
#line 414
    Conn_SetPenalty(c, Seconds);
  }
#line 415
  return;
}
}
#line 418 "irc-write.c"
static char *Get_Prefix(CLIENT *Target , CLIENT *Client ) 
{ char *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 424
  __cil_tmp___1 = Client_Type(Target);
#line 424
  if (__cil_tmp___1 == 32) {
#line 424
    __cil_tmp = Client_ID(Client);
#line 424
    return (__cil_tmp);
  } else {
#line 425
    __cil_tmp___0 = Client_Mask(Client);
#line 425
    return (__cil_tmp___0);
  }
}
}
#line 1 "lists.o"
#pragma merger(0,"/tmp/cil-1vdwNzCc.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 45 "lists.c"
char const   *Lists_GetMask(struct list_elem  const  *e ) 
{ 

  {
#line 48
  return ((char const   *)(e->mask));
}
}
#line 52 "lists.c"
struct list_elem *Lists_GetFirst(struct list_head  const  *h ) 
{ 

  {
#line 55
  return ((struct list_elem *)h->first);
}
}
#line 59 "lists.c"
struct list_elem *Lists_GetNext(struct list_elem  const  *e ) 
{ 

  {
#line 62
  return ((struct list_elem *)e->next);
}
}
#line 66 "lists.c"
int Lists_Add(struct list_head *header , char const   *Mask , int OnlyOnce ) 
{ struct list_elem *e ;
  struct list_elem *newelem ;
  int __cil_tmp ;
  void *__cil_tmp___0 ;

  {
#line 74
  __cil_tmp = Lists_CheckDupeMask((struct list_head  const  *)header, Mask);
#line 74
  if (__cil_tmp) {
#line 74
    return (1);
  }
#line 76
  e = Lists_GetFirst((struct list_head  const  *)header);
#line 78
  __cil_tmp___0 = malloc(sizeof(struct list_elem ));
#line 78
  newelem = (struct list_elem *)__cil_tmp___0;
#line 79
  if (! newelem) {
#line 80
    Log(0, "Can\'t allocate memory for new Ban/Invite entry!");
#line 81
    return (0);
  }
#line 84
  strlcpy(newelem->mask, Mask, sizeof(newelem->mask));
#line 85
  newelem->onlyonce = OnlyOnce;
#line 86
  newelem->next = e;
#line 87
  header->first = newelem;
#line 89
  LogDebug("Added \"%s\" to invite list", Mask);
#line 90
  return (1);
}
}
#line 94 "lists.c"
static void Lists_Unlink(struct list_head *header , struct list_elem *p , struct list_elem *victim ) 
{ 

  {
#line 100
  if (p) {
#line 100
    p->next = victim->next;
  } else {
#line 101
    header->first = victim->next;
  }
#line 103
  free((void *)victim);
#line 104
  return;
}
}
#line 107 "lists.c"
void Lists_Del(struct list_head *header , char const   *Mask ) 
{ struct list_elem *e ;
  struct list_elem *last ;
  struct list_elem *victim ;
  int __cil_tmp ;

  {
#line 115
  last = (struct list_elem *)((void *)0);
#line 116
  e = Lists_GetFirst((struct list_head  const  *)header);
#line 117
  while (e) {
#line 118
    __cil_tmp = strcasecmp((char const   *)(e->mask), Mask);
#line 118
    if (__cil_tmp == 0) {
#line 119
      LogDebug("Deleted \"%s\" from list", e->mask);
#line 120
      victim = e;
#line 121
      e = victim->next;
#line 122
      Lists_Unlink(header, last, victim);
#line 123
      continue;
    }
#line 125
    last = e;
#line 126
    e = e->next;
  }
#line 128
  return;
}
}
#line 131 "lists.c"
void Lists_Free(struct list_head *head ) 
{ struct list_elem *e ;
  struct list_elem *victim ;

  {
#line 138
  e = head->first;
#line 139
  head->first = (struct list_elem *)((void *)0);
#line 140
  while (e) {
#line 141
    LogDebug("Deleted \"%s\" from invite list", e->mask);
#line 142
    victim = e;
#line 143
    e = e->next;
#line 144
    free((void *)victim);
  }
#line 146
  return;
}
}
#line 149 "lists.c"
int Lists_CheckDupeMask(struct list_head  const  *h , char const   *Mask ) 
{ struct list_elem *e ;
  int __cil_tmp ;

  {
#line 153
  e = (struct list_elem *)h->first;
#line 154
  while (e) {
#line 155
    __cil_tmp = strcasecmp((char const   *)(e->mask), Mask);
#line 155
    if (__cil_tmp == 0) {
#line 156
      return (1);
    }
#line 157
    e = e->next;
  }
#line 159
  return (0);
}
}
#line 171 "lists.c"
static char TheMask[128]  ;
#line 163 "lists.c"
char const   *Lists_MakeMask(char const   *Pattern ) 
{ char *excl ;
  char *at ;

  {
#line 176
  excl = strchr(Pattern, '!');
#line 177
  at = strchr(Pattern, '@');
#line 179
  if ((int )at && (unsigned int )at < (unsigned int )excl) {
#line 179
    excl = (char *)((void *)0);
  }
#line 181
  if (! at && ! excl) {
#line 184
    strlcpy(TheMask, Pattern, sizeof(TheMask) - 5U);
#line 185
    strlcat(TheMask, "!*@*", sizeof(TheMask));
#line 186
    return ((char const   *)(TheMask));
  }
#line 189
  if (! at && (int )excl) {
#line 192
    strlcpy(TheMask, Pattern, sizeof(TheMask) - 3U);
#line 193
    strlcat(TheMask, "@*", sizeof(TheMask));
#line 194
    return ((char const   *)(TheMask));
  }
#line 197
  if ((int )at && ! excl) {
#line 200
    *at = (char )'\000';
#line 200
    at ++;
#line 201
    strlcpy(TheMask, Pattern, sizeof(TheMask) - 5U);
#line 202
    strlcat(TheMask, "!*@", sizeof(TheMask));
#line 203
    strlcat(TheMask, (char const   *)at, sizeof(TheMask));
#line 204
    return ((char const   *)(TheMask));
  }
#line 208
  strlcpy(TheMask, Pattern, sizeof(TheMask));
#line 209
  return ((char const   *)(TheMask));
}
}
#line 214 "lists.c"
int Lists_Check(struct list_head *header , CLIENT *Client ) 
{ struct list_elem *e ;
  struct list_elem *last ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 221
  e = header->first;
#line 222
  last = (struct list_elem *)((void *)0);
#line 224
  while (e) {
#line 225
    __cil_tmp = Client_Mask(Client);
#line 225
    __cil_tmp___0 = Match((char const   *)(e->mask), (char const   *)__cil_tmp);
#line 225
    if (__cil_tmp___0) {
#line 226
      if (e->onlyonce) {
#line 227
        LogDebug("Deleted \"%s\" from list", e->mask);
#line 228
        Lists_Unlink(header, last, e);
      }
#line 230
      return (1);
    }
#line 232
    last = e;
#line 233
    e = e->next;
  }
#line 236
  return (0);
}
}
#line 1 "log.o"
#pragma merger(0,"/tmp/cil-nQdr0lHq.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 50 "log.h"
void Log_Init_Resolver(void) ;
#line 51
void Log_Exit_Resolver(void) ;
#line 53
void Log_Resolver(int Level , char const   *Format  , ...) ;
#line 47 "log.c"
static char Init_Txt[127]  ;
#line 48 "log.c"
static int Is_Daemon  ;
#line 55
static void Wall_ServerNotice(char *Msg ) ;
#line 58 "log.c"
void Log_Init(int Daemon_Mode ) 
{ 

  {
#line 61
  Is_Daemon = Daemon_Mode;
#line 75
  Log(5, "%s started.", NGIRCd_Version);
#line 78
  Init_Txt[0] = (char )'\000';
#line 85
  if (! Is_Daemon) {
#line 87
    if (Init_Txt[0]) {
#line 87
      strlcat(Init_Txt, ", ", sizeof(Init_Txt));
    }
#line 88
    strlcat(Init_Txt, "no-daemon-mode", sizeof(Init_Txt));
  }
#line 90
  if (NGIRCd_Passive) {
#line 92
    if (Init_Txt[0]) {
#line 92
      strlcat(Init_Txt, ", ", sizeof(Init_Txt));
    }
#line 93
    strlcat(Init_Txt, "passive-mode", sizeof(Init_Txt));
  }
#line 102
  if (Init_Txt[0]) {
#line 102
    Log(6, "Activating: %s.", Init_Txt);
  }
#line 107
  return;
}
}
#line 143 "log.c"
void Log_Exit(void) 
{ 

  {
#line 147
  if (NGIRCd_SignalRestart) {
#line 147
    Log(5, "%s done (restarting).", "ngircd");
  } else {
#line 148
    Log(5, "%s done.", "ngircd");
  }
#line 162
  return;
}
}
#line 211 "log.c"
void Log(int Level , char const   *Format  , ...) 
{ char msg[256] ;
  int snotice ;
  va_list ap ;
  __pid_t __cil_tmp ;

  {
#line 228
  if (Level & 1024) {
#line 231
    snotice = 1;
#line 232
    Level &= -1025;
  } else {
#line 234
    snotice = 0;
  }
#line 239
  if (Level == 7) {
#line 239
    return;
  }
#line 244
  __builtin_va_start(ap, Format);
#line 248
  vsnprintf((char * __restrict  )(msg), 256U, (char const   * __restrict  )Format,
            ap);
#line 249
  __builtin_va_end(ap);
#line 251
  if (! Is_Daemon) {
#line 254
    __cil_tmp = getpid();
#line 254
    fprintf((FILE * __restrict  )stdout, (char const   * __restrict  )"[%d:%d] %s\n",
            __cil_tmp, Level, msg);
#line 255
    fflush(stdout);
  }
#line 265
  if (Level <= 2) {
#line 268
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"%s\n", msg);
#line 269
    fflush(stderr);
  }
#line 272
  if (snotice) {
#line 275
    Wall_ServerNotice(msg);
  }
#line 277
  return;
}
}
#line 280 "log.c"
void Log_Init_Resolver(void) 
{ 

  {
#line 289
  return;
}
}
#line 292 "log.c"
void Log_Exit_Resolver(void) 
{ 

  {
#line 301
  return;
}
}
#line 305 "log.c"
void Log_Resolver(int Level , char const   *Format  , ...) 
{ char msg[256] ;
  va_list ap ;
  __pid_t __cil_tmp ;

  {
#line 325
  if (Level == 7) {
#line 325
    return;
  }
#line 330
  __builtin_va_start(ap, Format);
#line 334
  vsnprintf((char * __restrict  )(msg), 256U, (char const   * __restrict  )Format,
            ap);
#line 335
  __builtin_va_end(ap);
#line 337
  if (! Is_Daemon) {
#line 340
    __cil_tmp = getpid();
#line 340
    fprintf((FILE * __restrict  )stdout, (char const   * __restrict  )"[%d:%d] %s\n",
            __cil_tmp, Level, msg);
#line 341
    fflush(stdout);
  }
#line 346
  return;
}
}
#line 353 "log.c"
static void Wall_ServerNotice(char *Msg ) 
{ CLIENT *c ;
  char *__cil_tmp ;
  CONN_ID __cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 360
  c = Client_First();
#line 361
  while (c) {
#line 362
    __cil_tmp___0 = Client_Conn(c);
#line 362
    if (__cil_tmp___0 > -1) {
#line 362
      __cil_tmp___1 = Client_HasMode(c, (char )'s');
#line 362
      if (__cil_tmp___1) {
#line 363
        __cil_tmp = Client_ID(c);
#line 363
        IRC_WriteStrClient(c, (char *)"NOTICE %s :%s%s", __cil_tmp, "", Msg);
      } else {
#line 362
        goto _L;
      }
    } else {
      _L: /* CIL Label */ ;
    }
#line 366
    c = Client_Next(c);
  }
#line 368
  return;
}
}
#line 1 "match.o"
#pragma merger(0,"/tmp/cil-4nC18f5G.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 35 "match.c"
static int Matche(char const   *p , char const   *t ) ;
#line 36
static int Matche_After_Star(char const   *p , char const   *t ) ;
#line 47 "match.c"
int Match(char const   *Pattern , char const   *String ) 
{ int __cil_tmp ;

  {
#line 51
  __cil_tmp = Matche(Pattern, String);
#line 51
  if (__cil_tmp == 1) {
#line 51
    return (1);
  } else {
#line 52
    return (0);
  }
}
}
#line 56 "match.c"
static int Matche(char const   *p , char const   *t ) 
{ register char range_start ;
  register char range_end ;
  int invert ;
  int member_match ;
  int loop ;
  int __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 64
  while (*p) {
#line 67
    if (! *t) {
#line 69
      if ((int const   )*p == 42) {
#line 69
        p ++;
#line 69
        if ((int const   )*p == 0) {
#line 69
          __cil_tmp = 1;
        } else {
#line 69
          goto _L;
        }
      } else {
        _L: /* CIL Label */ 
#line 69
        __cil_tmp = 3;
      }
#line 69
      return (__cil_tmp);
    }
#line 73
    switch ((int )*p) {
    case 63: 
#line 76
    break;
    case 42: 
#line 79
    __cil_tmp___0 = Matche_After_Star(p, t);
#line 79
    return (__cil_tmp___0);
    case 91: 
#line 83
    p ++;
#line 86
    invert = 0;
#line 87
    if ((int const   )*p == 33 || (int const   )*p == 94) {
#line 89
      invert = 1;
#line 90
      p ++;
    }
#line 94
    if ((int const   )*p == 93) {
#line 94
      return (6);
    }
#line 96
    member_match = 0;
#line 97
    loop = 1;
#line 99
    while (loop) {
#line 102
      if ((int const   )*p == 93) {
#line 104
        loop = 0;
#line 105
        continue;
      }
#line 109
      if ((int const   )*p == 92) {
#line 109
        p ++;
#line 109
        range_end = (char )*p;
#line 109
        range_start = range_end;
      } else {
#line 110
        range_end = (char )*p;
#line 110
        range_start = range_end;
      }
#line 113
      if (! *p) {
#line 113
        return (6);
      }
#line 116
      p ++;
#line 116
      if ((int const   )*p == 45) {
#line 119
        p ++;
#line 119
        range_end = (char )*p;
#line 122
        if ((int )range_end == 0 || (int )range_end == 93) {
#line 122
          return (6);
        }
#line 125
        if ((int )range_end == 92) {
#line 127
          p ++;
#line 127
          range_end = (char )*p;
#line 130
          if (! range_end) {
#line 130
            return (6);
          }
        }
#line 134
        p ++;
      }
#line 139
      if ((int )range_start < (int )range_end) {
#line 141
        if ((int const   )*t >= (int const   )range_start && (int const   )*t <= (int const   )range_end) {
#line 143
          member_match = 1;
#line 144
          loop = 0;
        }
      } else {
#line 149
        if ((int const   )*t >= (int const   )range_end && (int const   )*t <= (int const   )range_start) {
#line 151
          member_match = 1;
#line 152
          loop = 0;
        }
      }
    }
#line 159
    if ((invert && member_match) || ! (invert || member_match)) {
#line 159
      return (4);
    }
#line 163
    if (member_match) {
#line 165
      while ((int const   )*p != 93) {
#line 168
        if (! *p) {
#line 168
          return (6);
        }
#line 171
        if ((int const   )*p == 92) {
#line 173
          p ++;
#line 176
          if (! *p) {
#line 176
            return (6);
          }
        }
#line 180
        p ++;
      }
    }
#line 183
    break;
    case 92: 
#line 186
    p ++;
#line 189
    if (! *p) {
#line 189
      return (6);
    }
    default: ;
#line 193
    if ((int const   )*p != (int const   )*t) {
#line 193
      return (5);
    }
    }
#line 64
    p ++;
#line 64
    t ++;
  }
#line 198
  if (*t) {
#line 198
    return (2);
  } else {
#line 199
    return (1);
  }
}
}
#line 203 "match.c"
static int Matche_After_Star(char const   *p , char const   *t ) 
{ register int nextp ;
  register int match ;
  char const   *__cil_tmp ;
  char const   *__cil_tmp___0 ;

  {
#line 206
  match = 0;
#line 209
  while ((int const   )*p == 63 || (int const   )*p == 42) {
#line 212
    if ((int const   )*p == 63) {
#line 215
      __cil_tmp = t;
#line 215
      t ++;
#line 215
      if (! *__cil_tmp) {
#line 215
        return (3);
      }
    }
#line 219
    p ++;
  }
#line 223
  if (! *p) {
#line 223
    return (1);
  }
#line 226
  nextp = (int )*p;
#line 227
  if (nextp == 92) {
#line 229
    nextp = (int )*(p + 1);
#line 232
    if (! nextp) {
#line 232
      return (6);
    }
  }
#line 236
  while (1) {
#line 242
    if (nextp == (int )*t || nextp == 91) {
#line 242
      match = Matche(p, t);
    }
#line 245
    __cil_tmp___0 = t;
#line 245
    t ++;
#line 245
    if (! *__cil_tmp___0) {
#line 245
      match = 3;
    }
#line 236
    if (! ((match != 1 && match != 3) && match != 6)) {
#line 236
      break;
    }
  }
#line 249
  return (match);
}
}
#line 1 "numeric.o"
#pragma merger(0,"/tmp/cil-iz20daz4.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 20 "numeric.h"
int IRC_Num_ISUPPORT(CLIENT *Client , REQUEST *Req ) ;
#line 46 "numeric.c"
static int Announce_Server(CLIENT *Client , CLIENT *Server ) 
{ CLIENT *c ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  CONN_ID __cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int __cil_tmp___10 ;

  {
#line 51
  __cil_tmp___4 = Client_Conn(Server);
#line 51
  if (__cil_tmp___4 > -1) {
#line 54
    __cil_tmp = Client_Info(Client);
#line 54
    __cil_tmp___0 = Client_MyToken(Client);
#line 54
    __cil_tmp___1 = Client_Hops(Client);
#line 54
    __cil_tmp___2 = Client_ID(Client);
#line 54
    __cil_tmp___3 = IRC_WriteStrClient(Server, (char *)"SERVER %s %d %d :%s", __cil_tmp___2,
                                       __cil_tmp___1 + 1, __cil_tmp___0, __cil_tmp);
#line 54
    if (! __cil_tmp___3) {
#line 58
      return (0);
    }
  }
#line 61
  __cil_tmp___5 = Client_Hops(Server);
#line 61
  if (__cil_tmp___5 == 1) {
#line 62
    c = Client_ThisServer();
  } else {
#line 64
    c = Client_Introducer(Server);
  }
#line 67
  __cil_tmp___6 = Client_Info(Server);
#line 67
  __cil_tmp___7 = Client_MyToken(Server);
#line 67
  __cil_tmp___8 = Client_Hops(Server);
#line 67
  __cil_tmp___9 = Client_ID(Server);
#line 67
  __cil_tmp___10 = IRC_WriteStrClientPrefix(Client, c, (char *)"SERVER %s %d %d :%s",
                                            __cil_tmp___9, __cil_tmp___8 + 1, __cil_tmp___7,
                                            __cil_tmp___6);
#line 67
  return (__cil_tmp___10);
}
}
#line 78 "numeric.c"
static int Announce_User(CLIENT *Client , CLIENT *User ) 
{ char *__cil_tmp ;
  char *__cil_tmp___0 ;
  CLIENT *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;

  {
#line 81
  __cil_tmp = Client_Info(User);
#line 81
  __cil_tmp___0 = Client_Modes(User);
#line 81
  __cil_tmp___1 = Client_Introducer(User);
#line 81
  __cil_tmp___2 = Client_MyToken(__cil_tmp___1);
#line 81
  __cil_tmp___3 = Client_Hostname(User);
#line 81
  __cil_tmp___4 = Client_User(User);
#line 81
  __cil_tmp___5 = Client_Hops(User);
#line 81
  __cil_tmp___6 = Client_ID(User);
#line 81
  __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"NICK %s %d %s %s %d +%s :%s",
                                     __cil_tmp___6, __cil_tmp___5 + 1, __cil_tmp___4,
                                     __cil_tmp___3, __cil_tmp___2, __cil_tmp___0,
                                     __cil_tmp);
#line 81
  return (__cil_tmp___7);
}
}
#line 94 "numeric.c"
static int Synchronize_Lists(CLIENT *Client ) 
{ CHANNEL *c ;
  struct list_head *head ;
  struct list_elem *elem ;
  char const   *__cil_tmp ;
  char const   *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  char const   *__cil_tmp___2 ;
  char const   *__cil_tmp___3 ;
  int __cil_tmp___4 ;

  {
#line 103
  c = Channel_First();
#line 104
  while (c) {
#line 106
    head = Channel_GetListBans(c);
#line 107
    elem = Lists_GetFirst((struct list_head  const  *)head);
#line 108
    while (elem) {
#line 109
      __cil_tmp = Lists_GetMask((struct list_elem  const  *)elem);
#line 109
      __cil_tmp___0 = Channel_Name((CHANNEL const   *)c);
#line 109
      __cil_tmp___1 = IRC_WriteStrClient(Client, (char *)"MODE %s +b %s", __cil_tmp___0,
                                         __cil_tmp);
#line 109
      if (! __cil_tmp___1) {
#line 112
        return (0);
      }
#line 114
      elem = Lists_GetNext((struct list_elem  const  *)elem);
    }
#line 118
    head = Channel_GetListInvites(c);
#line 119
    elem = Lists_GetFirst((struct list_head  const  *)head);
#line 120
    while (elem) {
#line 121
      __cil_tmp___2 = Lists_GetMask((struct list_elem  const  *)elem);
#line 121
      __cil_tmp___3 = Channel_Name((CHANNEL const   *)c);
#line 121
      __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"MODE %s +I %s", __cil_tmp___3,
                                         __cil_tmp___2);
#line 121
      if (! __cil_tmp___4) {
#line 124
        return (0);
      }
#line 126
      elem = Lists_GetNext((struct list_elem  const  *)elem);
    }
#line 129
    c = Channel_Next(c);
  }
#line 131
  return (1);
}
}
#line 140 "numeric.c"
static int Send_CHANINFO(CLIENT *Client , CHANNEL *Chan ) 
{ char *modes ;
  char *topic ;
  int has_k ;
  int has_l ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  char const   *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char const   *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  unsigned long __cil_tmp___6 ;
  char const   *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  char const   *__cil_tmp___10 ;
  int __cil_tmp___11 ;

  {
#line 150
  modes = Channel_Modes(Chan);
#line 151
  topic = Channel_Topic(Chan);
#line 153
  if (! *modes && ! *topic) {
#line 154
    return (1);
  }
#line 156
  __cil_tmp = strchr((char const   *)modes, 'k');
#line 156
  has_k = (unsigned int )__cil_tmp != (unsigned int )((void *)0);
#line 157
  __cil_tmp___0 = strchr((char const   *)modes, 'l');
#line 157
  has_l = (unsigned int )__cil_tmp___0 != (unsigned int )((void *)0);
#line 160
  if (! has_k && ! has_l) {
#line 161
    if (! *topic) {
#line 163
      __cil_tmp___1 = Channel_Name((CHANNEL const   *)Chan);
#line 163
      __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"CHANINFO %s +%s", __cil_tmp___1,
                                         modes);
#line 163
      return (__cil_tmp___2);
    }
#line 167
    __cil_tmp___3 = Channel_Name((CHANNEL const   *)Chan);
#line 167
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"CHANINFO %s +%s :%s", __cil_tmp___3,
                                       modes, topic);
#line 167
    return (__cil_tmp___4);
  }
#line 171
  if (has_l) {
#line 171
    __cil_tmp___6 = Channel_MaxUsers(Chan);
  } else {
#line 171
    __cil_tmp___6 = 0UL;
  }
#line 171
  if (has_k) {
#line 171
    __cil_tmp___9 = Channel_Key(Chan);
#line 171
    __cil_tmp___8 = (char const   *)__cil_tmp___9;
  } else {
#line 171
    __cil_tmp___8 = "*";
  }
#line 171
  __cil_tmp___10 = Channel_Name((CHANNEL const   *)Chan);
#line 171
  __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"CHANINFO %s +%s %s %lu :%s",
                                      __cil_tmp___10, modes, __cil_tmp___8, __cil_tmp___6,
                                      topic);
#line 171
  return (__cil_tmp___11);
}
}
#line 185 "numeric.c"
int IRC_Num_ENDOFMOTD(CLIENT *Client , REQUEST *Req  __attribute__((__unused__)) ) 
{ char str[256] ;
  int max_hops ;
  int i ;
  CLIENT *c ;
  CLIENT *cl ;
  CHANNEL *chan ;
  CL2CHAN *cl2chan ;
  CONN_ID __cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  CLIENT *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  char *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  char const   *__cil_tmp___11 ;
  size_t __cil_tmp___12 ;
  char *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  int __cil_tmp___18 ;
  char const   *__cil_tmp___19 ;
  size_t __cil_tmp___20 ;
  int __cil_tmp___21 ;
  size_t __cil_tmp___22 ;
  int __cil_tmp___23 ;
  char *__cil_tmp___24 ;
  char *__cil_tmp___25 ;

  {
#line 194
  Client_SetType(Client, 32);
#line 196
  __cil_tmp = Client_Conn(Client);
#line 196
  __cil_tmp___0 = Client_ID(Client);
#line 196
  Log(1029, "Server \"%s\" registered (connection %d, 1 hop - direct link).", __cil_tmp___0,
      __cil_tmp);
#line 201
  max_hops = 0;
#line 202
  c = Client_First();
#line 203
  while (c) {
#line 204
    __cil_tmp___1 = Client_Hops(c);
#line 204
    if (__cil_tmp___1 > max_hops) {
#line 205
      max_hops = Client_Hops(c);
    }
#line 206
    c = Client_Next(c);
  }
#line 213
  i = 0;
#line 213
  while (i < max_hops + 1) {
#line 214
    c = Client_First();
#line 214
    while ((unsigned int )c != (unsigned int )((void *)0)) {
#line 215
      __cil_tmp___2 = Client_Type(c);
#line 215
      if (__cil_tmp___2 != 32) {
#line 216
        goto __Cont;
      }
#line 217
      __cil_tmp___3 = Client_Hops(c);
#line 217
      if (__cil_tmp___3 != i) {
#line 218
        goto __Cont;
      }
#line 219
      if ((unsigned int )c == (unsigned int )Client) {
#line 219
        goto _L;
      } else {
#line 219
        __cil_tmp___4 = Client_ThisServer();
#line 219
        if ((unsigned int )c == (unsigned int )__cil_tmp___4) {
          _L: /* CIL Label */ 
#line 220
          goto __Cont;
        }
      }
#line 222
      __cil_tmp___5 = Announce_Server(Client, c);
#line 222
      if (! __cil_tmp___5) {
#line 223
        return (0);
      }
      __Cont: /* CIL Label */ 
#line 214
      c = Client_Next(c);
    }
#line 213
    i ++;
  }
#line 228
  c = Client_First();
#line 229
  while (c) {
#line 230
    __cil_tmp___7 = Client_Type(c);
#line 230
    if (__cil_tmp___7 == 16) {
#line 231
      __cil_tmp___6 = Announce_User(Client, c);
#line 231
      if (! __cil_tmp___6) {
#line 232
        return (0);
      }
    }
#line 234
    c = Client_Next(c);
  }
#line 238
  chan = Channel_First();
#line 239
  while (chan) {
#line 242
    __cil_tmp___9 = Client_Flags(Client);
#line 242
    __cil_tmp___10 = strchr((char const   *)__cil_tmp___9, 'C');
#line 242
    if (__cil_tmp___10) {
#line 243
      __cil_tmp___8 = Send_CHANINFO(Client, chan);
#line 243
      if (! __cil_tmp___8) {
#line 244
        return (0);
      }
    }
#line 249
    cl2chan = Channel_FirstMember(chan);
#line 250
    __cil_tmp___11 = Channel_Name((CHANNEL const   *)chan);
#line 250
    snprintf((char * __restrict  )(str), sizeof(str), (char const   * __restrict  )"NJOIN %s :",
             __cil_tmp___11);
#line 251
    while (cl2chan) {
#line 252
      cl = Channel_GetClient(cl2chan);
#line 256
      __cil_tmp___12 = strlen((char const   *)(str));
#line 256
      if ((int )str[__cil_tmp___12 - 1U] != 58) {
#line 257
        strlcat(str, ",", sizeof(str));
      }
#line 258
      __cil_tmp___13 = Channel_UserModes(chan, cl);
#line 258
      __cil_tmp___14 = strchr((char const   *)__cil_tmp___13, 'v');
#line 258
      if (__cil_tmp___14) {
#line 259
        strlcat(str, "+", sizeof(str));
      }
#line 260
      __cil_tmp___15 = Channel_UserModes(chan, cl);
#line 260
      __cil_tmp___16 = strchr((char const   *)__cil_tmp___15, 'o');
#line 260
      if (__cil_tmp___16) {
#line 261
        strlcat(str, "@", sizeof(str));
      }
#line 262
      __cil_tmp___17 = Client_ID(cl);
#line 262
      strlcat(str, (char const   *)__cil_tmp___17, sizeof(str));
#line 265
      __cil_tmp___20 = strlen((char const   *)(str));
#line 265
      if (__cil_tmp___20 > 216U) {
#line 266
        __cil_tmp___18 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 266
        if (! __cil_tmp___18) {
#line 267
          return (0);
        }
#line 268
        __cil_tmp___19 = Channel_Name((CHANNEL const   *)chan);
#line 268
        snprintf((char * __restrict  )(str), sizeof(str), (char const   * __restrict  )"NJOIN %s :",
                 __cil_tmp___19);
      }
#line 272
      cl2chan = Channel_NextMember(chan, cl2chan);
    }
#line 276
    __cil_tmp___22 = strlen((char const   *)(str));
#line 276
    if ((int )str[__cil_tmp___22 - 1U] != 58) {
#line 278
      __cil_tmp___21 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 278
      if (! __cil_tmp___21) {
#line 279
        return (0);
      }
    }
#line 283
    chan = Channel_Next(chan);
  }
#line 287
  __cil_tmp___24 = Client_Flags(Client);
#line 287
  __cil_tmp___25 = strchr((char const   *)__cil_tmp___24, 'L');
#line 287
  if (__cil_tmp___25) {
#line 288
    LogDebug("Synchronizing INVITE- and BAN-lists ...");
#line 289
    __cil_tmp___23 = Synchronize_Lists(Client);
#line 289
    if (! __cil_tmp___23) {
#line 290
      return (0);
    }
  }
#line 294
  return (1);
}
}
#line 301 "numeric.c"
int IRC_Num_ISUPPORT(CLIENT *Client , REQUEST *Req ) 
{ int i ;
  char *key ;
  char *value ;
  char *__cil_tmp ;
  long __cil_tmp___0 ;
  int __cil_tmp___1 ;
  CONN_ID __cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 307
  i = 1;
#line 307
  while (i < Req->argc - 1) {
#line 308
    key = Req->argv[i];
#line 309
    value = strchr((char const   *)key, '=');
#line 310
    if (value) {
#line 311
      __cil_tmp = value;
#line 311
      value ++;
#line 311
      *__cil_tmp = (char )'\000';
    } else {
#line 313
      value = (char *)"";
    }
#line 315
    __cil_tmp___3 = strcmp("NICKLEN", (char const   *)key);
#line 315
    if (__cil_tmp___3 == 0) {
#line 316
      __cil_tmp___0 = atol((char const   *)value);
#line 316
      if ((unsigned int )__cil_tmp___0 == Conf_MaxNickLength - 1U) {
#line 317
        goto __Cont;
      }
#line 320
      __cil_tmp___1 = atoi((char const   *)value);
#line 320
      Log(3, "Peer uses incompatible nick name length (%d/%d)! Disconnecting ...",
          Conf_MaxNickLength - 1U, __cil_tmp___1);
#line 323
      __cil_tmp___2 = Client_Conn(Client);
#line 323
      Conn_Close(__cil_tmp___2, (char *)"Incompatible nick name length", (char *)((void *)0),
                 0);
#line 326
      return (0);
    }
    __Cont: /* CIL Label */ 
#line 307
    i ++;
  }
#line 330
  return (1);
}
}
#line 1 "parse.o"
#pragma merger(0,"/tmp/cil-kgiLuJBx.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 61 "parse.c"
static COMMAND My_Commands[48]  = 
#line 61 "parse.c"
  {      {(char *)"ADMIN", & IRC_ADMIN, 48, 0L, 0L, 0L}, 
        {(char *)"AWAY", & IRC_AWAY, 16, 0L, 0L, 0L}, 
        {(char *)"CONNECT", & IRC_CONNECT, 16, 0L, 0L, 0L}, 
        {(char *)"DIE", & IRC_DIE, 16, 0L, 0L, 0L}, 
        {(char *)"DISCONNECT", & IRC_DISCONNECT, 16, 0L, 0L, 0L}, 
        {(char *)"ERROR", & IRC_ERROR, 65535, 0L, 0L, 0L}, 
        {(char *)"HELP", & IRC_HELP, 16, 0L, 0L, 0L}, 
        {(char *)"INFO", & IRC_INFO, 48, 0L, 0L, 0L}, 
        {(char *)"INVITE", & IRC_INVITE, 48, 0L, 0L, 0L}, 
        {(char *)"ISON", & IRC_ISON, 16, 0L, 0L, 0L}, 
        {(char *)"JOIN", & IRC_JOIN, 48, 0L, 0L, 0L}, 
        {(char *)"KICK", & IRC_KICK, 48, 0L, 0L, 0L}, 
        {(char *)"KILL", & IRC_KILL, 48, 0L, 0L, 0L}, 
        {(char *)"LINKS", & IRC_LINKS, 48, 0L, 0L, 0L}, 
        {(char *)"LIST", & IRC_LIST, 48, 0L, 0L, 0L}, 
        {(char *)"LUSERS", & IRC_LUSERS, 48, 0L, 0L, 0L}, 
        {(char *)"MODE", & IRC_MODE, 48, 0L, 0L, 0L}, 
        {(char *)"MOTD", & IRC_MOTD, 48, 0L, 0L, 0L}, 
        {(char *)"NAMES", & IRC_NAMES, 48, 0L, 0L, 0L}, 
        {(char *)"NICK", & IRC_NICK, 65535, 0L, 0L, 0L}, 
        {(char *)"NJOIN", & IRC_NJOIN, 32, 0L, 0L, 0L}, 
        {(char *)"NOTICE", & IRC_NOTICE, 65535, 0L, 0L, 0L}, 
        {(char *)"OPER", & IRC_OPER, 16, 0L, 0L, 0L}, 
        {(char *)"PART", & IRC_PART, 48, 0L, 0L, 0L}, 
        {(char *)"PASS", & IRC_PASS, 65535, 0L, 0L, 0L}, 
        {(char *)"PING", & IRC_PING, 48, 0L, 0L, 0L}, 
        {(char *)"PONG", & IRC_PONG, 48, 0L, 0L, 0L}, 
        {(char *)"PRIVMSG", & IRC_PRIVMSG, 48, 0L, 0L, 0L}, 
        {(char *)"QUIT", & IRC_QUIT, 65535, 0L, 0L, 0L}, 
        {(char *)"REHASH", & IRC_REHASH, 16, 0L, 0L, 0L}, 
        {(char *)"RESTART", & IRC_RESTART, 16, 0L, 0L, 0L}, 
        {(char *)"SERVER", & IRC_SERVER, 65535, 0L, 0L, 0L}, 
        {(char *)"SQUIT", & IRC_SQUIT, 32, 0L, 0L, 0L}, 
        {(char *)"STATS", & IRC_STATS, 48, 0L, 0L, 0L}, 
        {(char *)"SUMMON", & IRC_SUMMON, 48, 0L, 0L, 0L}, 
        {(char *)"TIME", & IRC_TIME, 48, 0L, 0L, 0L}, 
        {(char *)"TOPIC", & IRC_TOPIC, 48, 0L, 0L, 0L}, 
        {(char *)"TRACE", & IRC_TRACE, 48, 0L, 0L, 0L}, 
        {(char *)"USER", & IRC_USER, 65535, 0L, 0L, 0L}, 
        {(char *)"USERHOST", & IRC_USERHOST, 16, 0L, 0L, 0L}, 
        {(char *)"USERS", & IRC_USERS, 48, 0L, 0L, 0L}, 
        {(char *)"VERSION", & IRC_VERSION, 48, 0L, 0L, 0L}, 
        {(char *)"WALLOPS", & IRC_WALLOPS, 48, 0L, 0L, 0L}, 
        {(char *)"WHO", & IRC_WHO, 16, 0L, 0L, 0L}, 
        {(char *)"WHOIS", & IRC_WHOIS, 48, 0L, 0L, 0L}, 
        {(char *)"WHOWAS", & IRC_WHOWAS, 48, 0L, 0L, 0L}, 
        {(char *)"CHANINFO", & IRC_CHANINFO, 32, 0L, 0L, 0L}, 
        {(char *)((void *)0), (int (*)(CLIENT *Client , REQUEST *Request ))((void *)0),
      0, 0L, 0L, 0L}};
#line 115
static void Init_Request(REQUEST *Req ) ;
#line 117
static int Validate_Prefix(CONN_ID Idx , REQUEST *Req , int *Closed ) ;
#line 118
static int Validate_Command(CONN_ID Idx  __attribute__((__unused__)) , REQUEST *Req  __attribute__((__unused__)) ,
                            int *Closed ) ;
#line 119
static int Validate_Args(CONN_ID Idx  __attribute__((__unused__)) , REQUEST *Req  __attribute__((__unused__)) ,
                         int *Closed ) ;
#line 121
static int Handle_Request(CONN_ID Idx , REQUEST *Req ) ;
#line 131 "parse.c"
COMMAND *Parse_GetCommandStruct(void) 
{ 

  {
#line 134
  return (My_Commands);
}
}
#line 156 "parse.c"
int Parse_Request(CONN_ID Idx , char *Request ) 
{ REQUEST req ;
  char *start ;
  char *ptr ;
  int closed ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 170
  Init_Request(& req);
#line 173
  ngt_TrimStr(Request);
#line 176
  if ((int )*(Request + 0) == 58) {
#line 179
    req.prefix = Request + 1;
#line 180
    ptr = strchr((char const   *)Request, ' ');
#line 181
    if (! ptr) {
#line 183
      Log(7, "Connection %d: Parse error: prefix without command!?", Idx);
#line 184
      __cil_tmp = Conn_WriteStr(Idx, (char *)"ERROR :Prefix without command!?");
#line 184
      return (__cil_tmp);
    }
#line 186
    *ptr = (char )'\000';
#line 190
    while ((int )*(ptr + 1) == 32) {
#line 190
      ptr ++;
    }
#line 192
    start = ptr + 1;
  } else {
#line 194
    start = Request;
  }
#line 197
  ptr = strchr((char const   *)start, ' ');
#line 198
  if (ptr) {
#line 200
    *ptr = (char )'\000';
#line 204
    while ((int )*(ptr + 1) == 32) {
#line 204
      ptr ++;
    }
  }
#line 207
  req.command = start;
#line 210
  if (ptr) {
#line 213
    start = ptr + 1;
#line 214
    while (start) {
#line 217
      if ((int )*(start + 0) == 58) {
#line 219
        req.argv[req.argc] = start + 1;
#line 220
        ptr = (char *)((void *)0);
      } else {
#line 224
        req.argv[req.argc] = start;
#line 225
        ptr = strchr((char const   *)start, ' ');
#line 226
        if (ptr) {
#line 228
          *ptr = (char )'\000';
#line 232
          while ((int )*(ptr + 1) == 32) {
#line 232
            ptr ++;
          }
        }
      }
#line 237
      (req.argc) ++;
#line 239
      if ((int )*(start + 0) == 58) {
#line 239
        break;
      }
#line 240
      if (req.argc > 14) {
#line 240
        break;
      }
#line 242
      if (ptr) {
#line 242
        start = ptr + 1;
      } else {
#line 243
        start = (char *)((void *)0);
      }
    }
  }
#line 248
  __cil_tmp___0 = Validate_Prefix(Idx, & req, & closed);
#line 248
  if (! __cil_tmp___0) {
#line 248
    return (! closed);
  }
#line 249
  __cil_tmp___1 = Validate_Command(Idx, & req, & closed);
#line 249
  if (! __cil_tmp___1) {
#line 249
    return (! closed);
  }
#line 250
  __cil_tmp___2 = Validate_Args(Idx, & req, & closed);
#line 250
  if (! __cil_tmp___2) {
#line 250
    return (! closed);
  }
#line 252
  __cil_tmp___3 = Handle_Request(Idx, & req);
#line 252
  return (__cil_tmp___3);
}
}
#line 260 "parse.c"
static void Init_Request(REQUEST *Req ) 
{ int i ;
  int __cil_tmp ;

  {
#line 269
  Req->prefix = (char *)((void *)0);
#line 270
  Req->command = (char *)((void *)0);
#line 271
  i = 0;
#line 271
  while (i < 15) {
#line 271
    __cil_tmp = i;
#line 271
    i ++;
#line 271
    Req->argv[__cil_tmp] = (char *)((void *)0);
  }
#line 272
  Req->argc = 0;
#line 273
  return;
}
}
#line 276 "parse.c"
static int Validate_Prefix(CONN_ID Idx , REQUEST *Req , int *Closed ) 
{ CLIENT *client ;
  CLIENT *c ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  CLIENT *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  CLIENT *__cil_tmp___5 ;

  {
#line 284
  *Closed = 0;
#line 287
  if (! Req->prefix) {
#line 287
    return (1);
  }
#line 290
  client = Conn_GetClient(Idx);
#line 294
  __cil_tmp = Client_Type(client);
#line 294
  if (__cil_tmp != 16) {
#line 294
    __cil_tmp___0 = Client_Type(client);
#line 294
    if (__cil_tmp___0 != 32) {
#line 294
      __cil_tmp___1 = Client_Type(client);
#line 294
      if (__cil_tmp___1 != 64) {
#line 298
        Req->prefix = (char *)((void *)0);
#line 299
        return (1);
      } else {
#line 294
        goto _L___0;
      }
    } else {
#line 294
      goto _L___0;
    }
  } else {
    _L___0: /* CIL Label */ ;
  }
#line 303
  c = Client_Search(Req->prefix);
#line 304
  if (! c) {
#line 307
    Log(3, "Invalid prefix \"%s\", client not known (connection %d, command %s)!?",
        Req->prefix, Idx, Req->command);
#line 308
    __cil_tmp___2 = Conn_WriteStr(Idx, (char *)"ERROR :Invalid prefix \"%s\", client not known!?",
                                  Req->prefix);
#line 308
    if (! __cil_tmp___2) {
#line 308
      *Closed = 1;
    }
#line 309
    return (0);
  }
#line 315
  __cil_tmp___5 = Client_NextHop(c);
#line 315
  if ((unsigned int )__cil_tmp___5 != (unsigned int )client) {
#line 319
    __cil_tmp___3 = Conn_GetClient(Idx);
#line 319
    __cil_tmp___4 = Client_Mask(__cil_tmp___3);
#line 319
    Log(3, "Spoofed prefix \"%s\" from \"%s\" (connection %d, command %s)!", Req->prefix,
        __cil_tmp___4, Idx, Req->command);
#line 320
    Conn_Close(Idx, (char *)((void *)0), (char *)"Spoofed prefix", 1);
#line 321
    *Closed = 1;
#line 322
    return (0);
  }
#line 325
  return (1);
}
}
#line 329 "parse.c"
static int Validate_Command(CONN_ID Idx  __attribute__((__unused__)) , REQUEST *Req  __attribute__((__unused__)) ,
                            int *Closed ) 
{ 

  {
#line 334
  *Closed = 0;
#line 336
  return (1);
}
}
#line 340 "parse.c"
static int Validate_Args(CONN_ID Idx  __attribute__((__unused__)) , REQUEST *Req  __attribute__((__unused__)) ,
                         int *Closed ) 
{ 

  {
#line 345
  *Closed = 0;
#line 347
  return (1);
}
}
#line 355
static int Handle_Numeric(CLIENT *client , REQUEST *Req ) ;
#line 355 "parse.c"
static struct _NUMERIC  const  Numerics[2]  = {      {5, & IRC_Num_ISUPPORT}, 
        {376, & IRC_Num_ENDOFMOTD}};
#line 352 "parse.c"
static int Handle_Numeric(CLIENT *client , REQUEST *Req ) 
{ int i ;
  int num ;
  char str[256] ;
  CLIENT *prefix ;
  CLIENT *target ;
  int __cil_tmp ;
  char *__cil_tmp___0 ;
  CLIENT *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 361
  target = (CLIENT *)((void *)0);
#line 364
  if (Req->argc > 0) {
#line 365
    target = Client_Search(Req->argv[0]);
  }
#line 367
  if (! target) {
#line 369
    if (Req->argc > 0) {
#line 370
      Log(4, "Unknown target for status code %s: \"%s\"", Req->command, Req->argv[0]);
    } else {
#line 374
      Log(4, "Unknown target for status code %s!", Req->command);
    }
#line 377
    return (1);
  }
#line 379
  __cil_tmp___1 = Client_ThisServer();
#line 379
  if ((unsigned int )target == (unsigned int )__cil_tmp___1) {
#line 381
    num = atoi((char const   *)Req->command);
#line 383
    i = 0;
#line 383
    while (i < (int )(sizeof(Numerics) / sizeof(Numerics[0]))) {
#line 384
      if (num == (int )Numerics[i].numeric) {
#line 385
        __cil_tmp = (*(Numerics[i].function))(client, Req);
#line 385
        return (__cil_tmp);
      }
#line 383
      i ++;
    }
#line 388
    __cil_tmp___0 = Client_ID(client);
#line 388
    LogDebug("Ignored status code %s from \"%s\".", Req->command, __cil_tmp___0);
#line 390
    return (1);
  }
#line 394
  if (! *(Req->prefix + 0)) {
#line 396
    __cil_tmp___2 = Client_ID(client);
#line 396
    Log(4, "Got status code %s from \"%s\" without prefix!?", Req->command, __cil_tmp___2);
#line 398
    return (1);
  }
#line 401
  prefix = Client_Search(Req->prefix);
#line 402
  if (! prefix) {
#line 403
    Log(4, "Got status code %s from unknown source: \"%s\"", Req->command, Req->prefix);
#line 404
    return (1);
  }
#line 408
  strlcpy(str, (char const   *)Req->command, sizeof(str));
#line 409
  i = 0;
#line 409
  while (i < Req->argc) {
#line 410
    if (i < Req->argc - 1) {
#line 411
      strlcat(str, " ", sizeof(str));
    } else {
#line 413
      strlcat(str, " :", sizeof(str));
    }
#line 414
    strlcat(str, (char const   *)Req->argv[i], sizeof(str));
#line 409
    i ++;
  }
#line 416
  __cil_tmp___3 = IRC_WriteStrClientPrefix(target, prefix, (char *)"%s", str);
#line 416
  return (__cil_tmp___3);
}
}
#line 420 "parse.c"
static int Handle_Request(CONN_ID Idx , REQUEST *Req ) 
{ CLIENT *client ;
  int result ;
  int client_type ;
  COMMAND *cmd ;
  int __cil_tmp ;
  size_t __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  long __cil_tmp___5 ;
  char const   *__cil_tmp___6 ;
  char const   *__cil_tmp___7 ;
  CONN_ID __cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int __cil_tmp___10 ;

  {
#line 426
  result = 1;
#line 434
  client = Conn_GetClient(Idx);
#line 438
  client_type = Client_Type(client);
#line 439
  if (client_type == 32 || client_type == 128) {
#line 439
    __cil_tmp___0 = strlen((char const   *)Req->command);
#line 439
    if (__cil_tmp___0 == 3U) {
#line 439
      __cil_tmp___1 = atoi((char const   *)Req->command);
#line 439
      if (__cil_tmp___1 > 1) {
#line 442
        __cil_tmp = Handle_Numeric(client, Req);
#line 442
        return (__cil_tmp);
      } else {
#line 439
        goto _L___0;
      }
    } else {
#line 439
      goto _L___0;
    }
  } else {
    _L___0: /* CIL Label */ ;
  }
#line 444
  cmd = My_Commands;
#line 445
  while (cmd->name) {
#line 447
    __cil_tmp___2 = strcasecmp((char const   *)Req->command, (char const   *)cmd->name);
#line 447
    if (__cil_tmp___2 != 0) {
#line 448
      cmd ++;
#line 449
      continue;
    }
#line 452
    if (! (client_type & cmd->type)) {
#line 453
      __cil_tmp___3 = Client_ID(client);
#line 453
      __cil_tmp___4 = IRC_WriteStrClient(client, (char *)"451 %s :Connection not registered",
                                         __cil_tmp___3);
#line 453
      return (__cil_tmp___4);
    }
#line 456
    Conn_ResetWCounter();
#line 457
    result = (*(cmd->function))(client, Req);
#line 458
    __cil_tmp___5 = Conn_WCounter();
#line 458
    cmd->bytes += __cil_tmp___5;
#line 461
    if (client_type != 32) {
#line 462
      (cmd->lcount) ++;
    } else {
#line 464
      (cmd->rcount) ++;
    }
#line 465
    return (result);
  }
#line 468
  if ((client_type != 16 && client_type != 32) && client_type != 64) {
#line 471
    return (1);
  }
#line 474
  if (Req->prefix) {
#line 474
    __cil_tmp___6 = "";
  } else {
#line 474
    __cil_tmp___6 = " no";
  }
#line 474
  if (Req->argc == 1) {
#line 474
    __cil_tmp___7 = "parameter";
  } else {
#line 474
    __cil_tmp___7 = "parameters";
  }
#line 474
  __cil_tmp___8 = Client_Conn(client);
#line 474
  LogDebug("Connection %d: Unknown command \"%s\", %d %s,%s prefix.", __cil_tmp___8,
           Req->command, Req->argc, __cil_tmp___7, __cil_tmp___6);
#line 479
  __cil_tmp___10 = Client_Type(client);
#line 479
  if (__cil_tmp___10 != 32) {
#line 480
    __cil_tmp___9 = Client_ID(client);
#line 480
    result = IRC_WriteStrClient(client, (char *)"421 %s %s :Unknown command", __cil_tmp___9,
                                Req->command);
#line 482
    Conn_SetPenalty(Idx, 1L);
  }
#line 484
  return (result);
}
}
#line 1 "rendezvous.o"
#pragma merger(0,"/tmp/cil-TRLhQeB1.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 1 "resolve.o"
#pragma merger(0,"/tmp/cil-tpbx3HhC.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 371 "/usr/include/unistd.h"
extern  __attribute__((__nothrow__)) int pipe(int *__pipedes ) ;
#line 61 "/usr/include/netdb.h"
extern  __attribute__((__nothrow__)) int *__h_errno_location(void)  __attribute__((__const__)) ;
#line 131
extern struct hostent *gethostbyaddr(void const   *__addr , __socklen_t __len , int __type ) ;
#line 44 "resolve.c"
static void Do_ResolveAddr(ng_ipaddr_t const   *Addr , int identsock , int w_fd ) ;
#line 45
static void Do_ResolveName(char const   *Host , int w_fd ) ;
#line 46
static int register_callback(RES_STAT *s , void (*cbfunc)(int  , short  ) ) ;
#line 53 "resolve.c"
static pid_t Resolver_fork(int *pipefds ) 
{ pid_t pid ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;

  {
#line 58
  __cil_tmp___1 = pipe((int *)pipefds);
#line 58
  if (__cil_tmp___1 != 0) {
#line 59
    __cil_tmp = __errno_location();
#line 59
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 59
    Log(1, "Resolver: Can\'t create output pipe: %s!", __cil_tmp___0);
#line 60
    return (-1);
  }
#line 63
  pid = fork();
#line 64
  switch (pid) {
  case -1: 
#line 66
  __cil_tmp___2 = __errno_location();
#line 66
  __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 66
  Log(2, "Resolver: Can\'t fork: %s!", __cil_tmp___3);
#line 67
  close(*(pipefds + 0));
#line 68
  close(*(pipefds + 1));
#line 69
  return (-1);
  case 0: 
#line 71
  close(*(pipefds + 0));
#line 72
  Log_Init_Resolver();
#line 73
  return (0);
  }
#line 76
  close(*(pipefds + 1));
#line 77
  return (pid);
}
}
#line 84 "resolve.c"
int Resolve_Addr(RES_STAT *s , ng_ipaddr_t const   *Addr , int identsock , void (*cbfunc)(int  ,
                                                                                          short  ) ) 
{ int pipefd[2] ;
  pid_t pid ;
  char const   *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 93
  pid = Resolver_fork(pipefd);
#line 94
  if (pid > 0) {
#line 95
    __cil_tmp = ng_ipaddr_tostr(Addr);
#line 95
    Log(7, "Resolver for %s created (PID %d).", __cil_tmp, pid);
#line 97
    s->pid = pid;
#line 98
    s->resolver_fd = pipefd[0];
#line 99
    __cil_tmp___0 = register_callback(s, cbfunc);
#line 99
    return (__cil_tmp___0);
  } else {
#line 100
    if (pid == 0) {
#line 102
      Do_ResolveAddr(Addr, identsock, pipefd[1]);
#line 103
      Log_Exit_Resolver();
#line 104
      exit(0);
    }
  }
#line 106
  return (0);
}
}
#line 113 "resolve.c"
int Resolve_Name(RES_STAT *s , char const   *Host , void (*cbfunc)(int  , short  ) ) 
{ int pipefd[2] ;
  pid_t pid ;
  int __cil_tmp ;

  {
#line 121
  pid = Resolver_fork(pipefd);
#line 122
  if (pid > 0) {
#line 127
    s->pid = pid;
#line 128
    s->resolver_fd = pipefd[0];
#line 129
    __cil_tmp = register_callback(s, cbfunc);
#line 129
    return (__cil_tmp);
  } else {
#line 130
    if (pid == 0) {
#line 132
      Do_ResolveName(Host, pipefd[1]);
#line 133
      Log_Exit_Resolver();
#line 134
      exit(0);
    }
  }
#line 136
  return (0);
}
}
#line 140 "resolve.c"
void Resolve_Init(RES_STAT *s ) 
{ 

  {
#line 144
  s->resolver_fd = -1;
#line 145
  s->pid = 0;
#line 146
  return;
}
}
#line 151 "resolve.c"
static char *Get_Error(int H_Error ) 
{ 

  {
#line 155
  switch (H_Error) {
  case 1: 
#line 157
  return ((char *)"host not found");
  case 4: 
#line 159
  return ((char *)"name valid but no IP address defined");
  case 3: 
#line 161
  return ((char *)"name server error");
  case 2: 
#line 163
  return ((char *)"name server temporary not available");
  }
#line 165
  return ((char *)"unknown error");
}
}
#line 172 "resolve.c"
static void Do_IdentQuery(int identsock , array *resolved_addr ) 
{ 

  {
#line 200
  return;
}
}
#line 235
static int ReverseLookup(ng_ipaddr_t const   *IpAddr , char *resbuf , size_t reslen ) ;
#line 235 "resolve.c"
static char const   funcname[14]  = 
#line 235
  {      (char const   )'g',      (char const   )'e',      (char const   )'t',      (char const   )'h', 
        (char const   )'o',      (char const   )'s',      (char const   )'t',      (char const   )'b', 
        (char const   )'y',      (char const   )'a',      (char const   )'d',      (char const   )'d', 
        (char const   )'r',      (char const   )'\000'};
#line 212 "resolve.c"
static int ReverseLookup(ng_ipaddr_t const   *IpAddr , char *resbuf , size_t reslen ) 
{ char tmp_ip_str[16] ;
  char const   *errmsg ;
  struct sockaddr_in  const  *Addr ;
  struct hostent *h ;
  size_t __cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;

  {
#line 233
  Addr = (struct sockaddr_in  const  *)IpAddr;
#line 237
  h = gethostbyaddr((void const   *)((char *)(& Addr->sin_addr)), sizeof(Addr->sin_addr),
                    2);
#line 238
  if (h) {
#line 239
    __cil_tmp = strlcpy(resbuf, (char const   *)h->h_name, reslen);
#line 239
    if (__cil_tmp < reslen) {
#line 240
      return (1);
    }
#line 241
    errmsg = "hostname too long";
  } else {
#line 244
    __cil_tmp___0 = __h_errno_location();
#line 244
    __cil_tmp___1 = Get_Error(*__cil_tmp___0);
#line 244
    errmsg = (char const   *)__cil_tmp___1;
  }
#line 253
  ng_ipaddr_tostr_r(IpAddr, tmp_ip_str);
#line 255
  Log_Resolver(4, "%s: Can\'t resolve address \"%s\": %s", funcname, tmp_ip_str, errmsg);
#line 257
  strlcpy(resbuf, (char const   *)(tmp_ip_str), reslen);
#line 258
  return (0);
}
}
#line 270 "resolve.c"
static int ForwardLookup(char const   *hostname , array *IpAddr ) 
{ ng_ipaddr_t addr ;
  struct hostent *h ;
  struct hostent *__cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 321
  __cil_tmp = gethostbyname(hostname);
#line 321
  h = __cil_tmp;
#line 323
  if (! h) {
#line 325
    __cil_tmp___0 = __h_errno_location();
#line 325
    __cil_tmp___1 = Get_Error(*__cil_tmp___0);
#line 325
    Log_Resolver(4, "Can\'t resolve \"%s\": %s", hostname, __cil_tmp___1);
#line 329
    return (0);
  }
#line 331
  memset((void *)(& addr), 0, sizeof(addr));
#line 333
  addr.sin4.sin_family = (unsigned short)2;
#line 334
  memcpy((void * __restrict  )(& addr.sin4.sin_addr), (void const   * __restrict  )*(h->h_addr_list + 0),
         sizeof(struct in_addr ));
#line 336
  __cil_tmp___2 = array_copyb(IpAddr, (char const   *)((char *)(& addr)), sizeof(addr));
#line 336
  return (__cil_tmp___2);
}
}
#line 341 "resolve.c"
static int Addr_in_list(array const   *resolved_addr , ng_ipaddr_t const   *Addr ) 
{ char tmp_ip_str[16] ;
  ng_ipaddr_t const   *tmpAddrs ;
  void *__cil_tmp ;
  size_t len ;
  size_t __cil_tmp___0 ;
  int __cil_tmp___1 ;
  void *__cil_tmp___2 ;
  char const   *__cil_tmp___3 ;

  {
#line 345
  __cil_tmp = array_start(resolved_addr);
#line 345
  tmpAddrs = (ng_ipaddr_t const   *)__cil_tmp;
#line 346
  __cil_tmp___0 = array_length(resolved_addr, sizeof(*tmpAddrs));
#line 346
  len = __cil_tmp___0;
#line 351
  while (len > 0U) {
#line 352
    __cil_tmp___1 = ng_ipaddr_ipequal(Addr, tmpAddrs);
#line 352
    if (__cil_tmp___1) {
#line 353
      return (1);
    }
#line 354
    tmpAddrs ++;
#line 355
    len --;
  }
#line 358
  ng_ipaddr_tostr_r(Addr, tmp_ip_str);
#line 359
  len = array_length(resolved_addr, sizeof(*tmpAddrs));
#line 360
  __cil_tmp___2 = array_start(resolved_addr);
#line 360
  tmpAddrs = (ng_ipaddr_t const   *)__cil_tmp___2;
#line 362
  while (len > 0U) {
#line 363
    __cil_tmp___3 = ng_ipaddr_tostr(tmpAddrs);
#line 363
    Log_Resolver(4, "Address mismatch: %s != %s", tmp_ip_str, __cil_tmp___3);
#line 365
    tmpAddrs ++;
#line 366
    len --;
  }
#line 369
  return (0);
}
}
#line 373 "resolve.c"
static void Log_Forgery_NoIP(char const   *ip , char const   *host ) 
{ 

  {
#line 376
  Log_Resolver(4, "Possible forgery: %s resolved to %s (which has no ip address)",
               ip, host);
#line 378
  return;
}
}
#line 380 "resolve.c"
static void Log_Forgery_WrongIP(char const   *ip , char const   *host ) 
{ 

  {
#line 383
  Log_Resolver(4, "Possible forgery: %s resolved to %s (which points to different address)",
               ip, host);
#line 385
  return;
}
}
#line 388 "resolve.c"
static void ArrayWrite(int fd , array const   *a ) 
{ size_t len ;
  char const   *data ;
  void *__cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  ssize_t __cil_tmp___2 ;

  {
#line 391
  len = (size_t )a->used;
#line 392
  __cil_tmp = array_start(a);
#line 392
  data = (char const   *)__cil_tmp;
#line 396
  __cil_tmp___2 = write(fd, (void const   *)data, len);
#line 396
  if ((unsigned int )__cil_tmp___2 != len) {
#line 397
    __cil_tmp___0 = __errno_location();
#line 397
    __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 397
    Log_Resolver(2, "Resolver: Can\'t write to parent: %s!", __cil_tmp___1);
  }
#line 399
  return;
}
}
#line 402 "resolve.c"
static void Do_ResolveAddr(ng_ipaddr_t const   *Addr , int identsock , int w_fd ) 
{ char hostname[64] ;
  char tmp_ip_str[16] ;
  size_t len ;
  array resolved_addr ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;

  {
#line 412
  array_init(& resolved_addr);
#line 413
  ng_ipaddr_tostr_r(Addr, tmp_ip_str);
#line 417
  __cil_tmp = ReverseLookup(Addr, hostname, sizeof(hostname));
#line 417
  if (! __cil_tmp) {
#line 418
    goto dns_done;
  }
#line 420
  __cil_tmp___1 = ForwardLookup((char const   *)(hostname), & resolved_addr);
#line 420
  if (__cil_tmp___1) {
#line 421
    __cil_tmp___0 = Addr_in_list((array const   *)(& resolved_addr), Addr);
#line 421
    if (! __cil_tmp___0) {
#line 422
      Log_Forgery_WrongIP((char const   *)(tmp_ip_str), (char const   *)(hostname));
#line 423
      strlcpy(hostname, (char const   *)(tmp_ip_str), sizeof(hostname));
    }
  } else {
#line 426
    Log_Forgery_NoIP((char const   *)(tmp_ip_str), (char const   *)(hostname));
#line 427
    strlcpy(hostname, (char const   *)(tmp_ip_str), sizeof(hostname));
  }
  dns_done: 
#line 433
  len = strlen((char const   *)(hostname));
#line 434
  hostname[len] = (char )'\n';
#line 435
  len ++;
#line 435
  __cil_tmp___4 = array_copyb(& resolved_addr, (char const   *)(hostname), len);
#line 435
  if (! __cil_tmp___4) {
#line 436
    __cil_tmp___2 = __errno_location();
#line 436
    __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 436
    Log_Resolver(2, "Resolver: Can\'t copy resolved name: %s!", __cil_tmp___3);
#line 437
    array_free(& resolved_addr);
#line 438
    return;
  }
#line 441
  Do_IdentQuery(identsock, & resolved_addr);
#line 443
  ArrayWrite(w_fd, (array const   *)(& resolved_addr));
#line 445
  array_free(& resolved_addr);
#line 446
  return;
}
}
#line 449 "resolve.c"
static void Do_ResolveName(char const   *Host , int w_fd ) 
{ array IpAddrs ;
  int __cil_tmp ;

  {
#line 459
  Log_Resolver(7, "Now resolving \"%s\" ...", Host);
#line 461
  array_init(& IpAddrs);
#line 463
  __cil_tmp = ForwardLookup(Host, & IpAddrs);
#line 463
  if (! __cil_tmp) {
#line 464
    close(w_fd);
#line 465
    return;
  }
#line 478
  ArrayWrite(w_fd, (array const   *)(& IpAddrs));
#line 480
  array_free(& IpAddrs);
#line 481
  return;
}
}
#line 484 "resolve.c"
static int register_callback(RES_STAT *s , void (*cbfunc)(int  , short  ) ) 
{ int __cil_tmp ;
  int __cil_tmp___0 ;
  int *__cil_tmp___1 ;
  char *__cil_tmp___2 ;

  {
#line 491
  __cil_tmp = io_setnonblock(s->resolver_fd);
#line 491
  if (__cil_tmp) {
#line 491
    __cil_tmp___0 = io_event_create(s->resolver_fd, (short)1, cbfunc);
#line 491
    if (__cil_tmp___0) {
#line 493
      return (1);
    } else {
#line 491
      goto _L;
    }
  } else {
    _L: /* CIL Label */ ;
  }
#line 495
  __cil_tmp___1 = __errno_location();
#line 495
  __cil_tmp___2 = strerror(*__cil_tmp___1);
#line 495
  Log(2, "Resolver: Could not register callback function: %s!", __cil_tmp___2);
#line 496
  close(s->resolver_fd);
#line 497
  Resolve_Init(s);
#line 498
  return (0);
}
}
#line 502 "resolve.c"
int Resolve_Shutdown(RES_STAT *s ) 
{ int ret ;

  {
#line 505
  ret = 0;
#line 510
  if (s->resolver_fd >= 0) {
#line 511
    ret = io_close(s->resolver_fd);
  }
#line 513
  Resolve_Init(s);
#line 514
  return (ret);
}
}
#line 521 "resolve.c"
size_t Resolve_Read(RES_STAT *s , void *readbuf , size_t buflen ) 
{ ssize_t bytes_read ;
  int *__cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;

  {
#line 529
  bytes_read = read(s->resolver_fd, readbuf, buflen);
#line 530
  if (bytes_read < 0) {
#line 531
    __cil_tmp = __errno_location();
#line 531
    if (*__cil_tmp == 11) {
#line 532
      return (0U);
    }
#line 534
    __cil_tmp___0 = __errno_location();
#line 534
    __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 534
    Log(2, "Resolver: Can\'t read result: %s!", __cil_tmp___1);
#line 535
    bytes_read = 0;
  }
#line 541
  Resolve_Shutdown(s);
#line 542
  return ((unsigned int )bytes_read);
}
}
#line 1 "strlcpy.o"
#pragma merger(0,"/tmp/cil-MC8qslEU.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 33 "strlcpy.c"
size_t strlcat(char *dst , char const   *src , size_t size ) 
{ size_t len1 ;
  size_t __cil_tmp ;
  size_t len2 ;
  size_t __cil_tmp___0 ;
  size_t ret ;

  {
#line 39
  __cil_tmp = strlen((char const   *)dst);
#line 39
  len1 = __cil_tmp;
#line 40
  __cil_tmp___0 = strlen(src);
#line 40
  len2 = __cil_tmp___0;
#line 41
  ret = len1 + len2;
#line 43
  if ((int )size && len1 < size - 1U) {
#line 44
    if (len2 >= size - len1) {
#line 45
      len2 = (size - len1) - 1U;
    }
#line 46
    memcpy((void * __restrict  )(dst + len1), (void const   * __restrict  )src, len2);
#line 47
    *(dst + (len1 + len2)) = (char)0;
  }
#line 49
  return (ret);
}
}
#line 57 "strlcpy.c"
size_t strlcpy(char *dst , char const   *src , size_t size ) 
{ size_t len ;
  size_t __cil_tmp ;
  size_t ret ;

  {
#line 63
  __cil_tmp = strlen(src);
#line 63
  len = __cil_tmp;
#line 64
  ret = len;
#line 66
  if (size > 0U) {
#line 67
    if (len >= size) {
#line 67
      len = size - 1U;
    }
#line 68
    memcpy((void * __restrict  )dst, (void const   * __restrict  )src, len);
#line 69
    *(dst + len) = (char)0;
  }
#line 71
  return (ret);
}
}
#line 1 "strdup.o"
#pragma merger(0,"/tmp/cil-Fj9GtvAi.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 1 "vsnprintf.o"
#pragma merger(0,"/tmp/cil-RWS04o8P.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 101 "vsnprintf.c"
void dummy_snprintf(void) ;
#line 102 "vsnprintf.c"
void dummy_snprintf(void) 
{ 

  {
#line 102
  return;
}
}
#line 1 "libngtool.a"
#pragma merger(0,"/tmp/cil-zmh0nMP2.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 140 "/fs/skoll/symexe/trunk/experiments/ngircd/codeCoverageTest/../../../libc/ctype.h"
extern int tolower(int  ) ;
#line 35 "tool.c"
void ngt_TrimStr(char *String ) 
{ char *start ;
  char *end ;

  {
#line 42
  start = String;
#line 45
  while ((((int )*start == 32 || (int )*start == 9) || (int )*start == 10) || (int )*start == 13) {
#line 47
    start ++;
  }
#line 49
  if (! *start) {
#line 50
    *String = (char )'\000';
#line 51
    return;
  }
#line 55
  end = strchr((char const   *)start, '\000');
#line 56
  end --;
#line 57
  while (((((int )*end == 32 || (int )*end == 9) || (int )*end == 10) || (int )*end == 13) && (unsigned int )end >= (unsigned int )start) {
#line 59
    end --;
  }
#line 62
  end ++;
#line 62
  *end = (char )'\000';
#line 64
  memmove((void *)String, (void const   *)start, (unsigned int )(end - start) + 1U);
#line 65
  return;
}
}
#line 68 "tool.c"
char *ngt_LowerStr(char *String ) 
{ char *ptr ;
  int __cil_tmp ;

  {
#line 80
  ptr = String;
#line 81
  while (*ptr) {
#line 83
    __cil_tmp = tolower((int )*ptr);
#line 83
    *ptr = (char )__cil_tmp;
#line 84
    ptr ++;
  }
#line 87
  return (String);
}
}
#line 91 "tool.c"
void ngt_TrimLastChr(char *String , char Chr ) 
{ unsigned int len ;

  {
#line 101
  len = strlen((char const   *)String);
#line 102
  if (len == 0U) {
#line 102
    return;
  }
#line 104
  len --;
#line 106
  if ((int )*(String + len) == (int )Chr) {
#line 106
    *(String + len) = (char )'\000';
  }
#line 107
  return;
}
}
#line 1 "libngipaddr.a"
#pragma merger(0,"/tmp/cil-cYfsY9ut.i","-fno-builtin,-fno-inline,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes")
#line 62 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) int memcmp(void const   *__s1 , void const   *__s2 ,
                                                size_t __n )  __attribute__((__pure__,
__nonnull__(1,2))) ;
#line 359 "/usr/include/netinet/in.h"
extern  __attribute__((__nothrow__)) uint16_t htons(uint16_t __hostshort )  __attribute__((__const__)) ;
#line 74 "/usr/include/arpa/inet.h"
extern  __attribute__((__nothrow__)) int inet_aton(char const   *__cp , struct in_addr *__inp ) ;
#line 20 "ng_ipaddr.c"
int ng_ipaddr_init(ng_ipaddr_t *addr , char const   *ip_str , UINT16 port ) 
{ int __cil_tmp ;

  {
#line 52
  if ((unsigned int )ip_str == (unsigned int )((void *)0)) {
#line 53
    ip_str = "0.0.0.0";
  }
#line 54
  addr->sin4.sin_family = (unsigned short)2;
#line 56
  __cil_tmp = inet_aton(ip_str, & addr->sin4.sin_addr);
#line 56
  if (__cil_tmp == 0) {
#line 57
    return (0);
  }
#line 63
  ng_ipaddr_setport(addr, port);
#line 64
  return (1);
}
}
#line 69 "ng_ipaddr.c"
void ng_ipaddr_setport(ng_ipaddr_t *a , UINT16 port ) 
{ 

  {
#line 92
  a->sin4.sin_port = htons(port);
#line 94
  return;
}
}
#line 98 "ng_ipaddr.c"
int ng_ipaddr_ipequal(ng_ipaddr_t const   *a , ng_ipaddr_t const   *b ) 
{ int __cil_tmp ;

  {
#line 117
  __cil_tmp = memcmp((void const   *)(& a->sin4.sin_addr), (void const   *)(& b->sin4.sin_addr),
                     sizeof(a->sin4.sin_addr));
#line 117
  return (__cil_tmp == 0);
}
}
