/* Generated by CIL v. 1.3.6 */
/* print_CIL_Input is true */

#line 43 "/usr/include/i386/_types.h"
typedef unsigned short __uint16_t;
#line 44 "/usr/include/i386/_types.h"
typedef int __int32_t;
#line 45 "/usr/include/i386/_types.h"
typedef unsigned int __uint32_t;
#line 46 "/usr/include/i386/_types.h"
typedef long long __int64_t;
#line 90 "/usr/include/i386/_types.h"
typedef unsigned long __darwin_size_t;
#line 117 "/usr/include/i386/_types.h"
typedef long __darwin_ssize_t;
#line 118 "/usr/include/i386/_types.h"
typedef long __darwin_time_t;
#line 99 "/usr/include/sys/_types.h"
typedef __uint32_t __darwin_gid_t;
#line 109 "/usr/include/sys/_types.h"
typedef __uint16_t __darwin_mode_t;
#line 110 "/usr/include/sys/_types.h"
typedef __int64_t __darwin_off_t;
#line 111 "/usr/include/sys/_types.h"
typedef __int32_t __darwin_pid_t;
#line 131 "/usr/include/sys/_types.h"
typedef __uint32_t __darwin_sigset_t;
#line 133 "/usr/include/sys/_types.h"
typedef __uint32_t __darwin_uid_t;
#line 120 "/usr/include/sys/types.h"
typedef __darwin_gid_t gid_t;
#line 152 "/usr/include/sys/types.h"
typedef __darwin_mode_t mode_t;
#line 167 "/usr/include/sys/types.h"
typedef __darwin_pid_t pid_t;
#line 180 "/usr/include/sys/types.h"
typedef __darwin_uid_t uid_t;
#line 230 "/usr/include/sys/types.h"
typedef __darwin_size_t size_t;
#line 235 "/usr/include/sys/types.h"
typedef __darwin_ssize_t ssize_t;
#line 240 "/usr/include/sys/types.h"
typedef __darwin_time_t time_t;
#line 87 "/usr/include/stdio.h"
typedef __darwin_off_t fpos_t;
#line 98 "/usr/include/stdio.h"
struct __sbuf {
   unsigned char *_base ;
   int _size ;
};
#line 104
struct __sFILEX;
#line 132 "/usr/include/stdio.h"
struct __sFILE {
   unsigned char *_p ;
   int _r ;
   int _w ;
   short _flags ;
   short _file ;
   struct __sbuf _bf ;
   int _lbfsize ;
   void *_cookie ;
   int (*_close)(void * ) ;
   int (*_read)(void * , char * , int  ) ;
   fpos_t (*_seek)(void * , fpos_t  , int  ) ;
   int (*_write)(void * , char const   * , int  ) ;
   struct __sbuf _ub ;
   struct __sFILEX *_extra ;
   int _ur ;
   unsigned char _ubuf[3] ;
   unsigned char _nbuf[1] ;
   struct __sbuf _lb ;
   int _blksize ;
   fpos_t _offset ;
};
#line 132 "/usr/include/stdio.h"
typedef struct __sFILE FILE;
#line 168 "/usr/include/sys/signal.h"
typedef __darwin_sigset_t sigset_t;
#line 181 "/usr/include/sys/signal.h"
union sigval {
   int sival_int ;
   void *sival_ptr ;
};
#line 200 "/usr/include/sys/signal.h"
struct __siginfo {
   int si_signo ;
   int si_errno ;
   int si_code ;
   pid_t si_pid ;
   uid_t si_uid ;
   int si_status ;
   void *si_addr ;
   union sigval si_value ;
   long si_band ;
   unsigned long __pad[7] ;
};
#line 292 "/usr/include/sys/signal.h"
union __sigaction_u {
   void (*__sa_handler)(int  ) ;
   void (*__sa_sigaction)(int  , struct __siginfo * , void * ) ;
};
#line 309 "/usr/include/sys/signal.h"
struct sigaction {
   union __sigaction_u __sigaction_u ;
   sigset_t sa_mask ;
   int sa_flags ;
};
#line 90 "/usr/include/time.h"
struct tm {
   int tm_sec ;
   int tm_min ;
   int tm_hour ;
   int tm_mday ;
   int tm_mon ;
   int tm_year ;
   int tm_wday ;
   int tm_yday ;
   int tm_isdst ;
   long tm_gmtoff ;
   char *tm_zone ;
};
#line 377 "/usr/include/sys/fcntl.h"
#pragma pack(4)
#line 385
#pragma pack()
#line 119 "/usr/include/pwd.h"
struct passwd {
   char *pw_name ;
   char *pw_passwd ;
   uid_t pw_uid ;
   gid_t pw_gid ;
   __darwin_time_t pw_change ;
   char *pw_class ;
   char *pw_gecos ;
   char *pw_dir ;
   char *pw_shell ;
   __darwin_time_t pw_expire ;
};
#line 87 "/usr/include/grp.h"
struct group {
   char *gr_name ;
   char *gr_passwd ;
   gid_t gr_gid ;
   char **gr_mem ;
};
#line 19 "array.h"
struct __anonstruct_array_3 {
   char *mem ;
   size_t allocated ;
   size_t used ;
};
#line 19 "array.h"
typedef struct __anonstruct_array_3 array;
#line 50 "/usr/lib/gcc/i686-apple-darwin9/4.0.1/include/stdint.h"
typedef unsigned int uint32_t;
#line 76 "./../portab/portab.h"
typedef void POINTER;
#line 81 "./../portab/portab.h"
typedef uint32_t UINT32;
#line 32 "conn.h"
typedef int CONN_ID;
#line 36 "client.h"
struct _CLIENT {
   time_t starttime ;
   char id[64] ;
   UINT32 hash ;
   POINTER *next ;
   int type ;
   CONN_ID conn_id ;
   struct _CLIENT *introducer ;
   struct _CLIENT *topserver ;
   char pwd[21] ;
   char host[64] ;
   char user[10] ;
   char info[64] ;
   char modes[9] ;
   int hops ;
   int token ;
   int mytoken ;
   int oper_by_me ;
   char away[128] ;
   char flags[100] ;
};
#line 36 "client.h"
typedef struct _CLIENT CLIENT;
#line 22 "lists.h"
struct list_elem;
#line 24 "lists.h"
struct list_head {
   struct list_elem *first ;
};
#line 27 "channel.h"
struct _CHANNEL {
   struct _CHANNEL *next ;
   char name[51] ;
   UINT32 hash ;
   char modes[9] ;
   array topic ;
   time_t topic_time ;
   char topic_who[32] ;
   char key[21] ;
   unsigned long maxusers ;
   struct list_head list_bans ;
   struct list_head list_invites ;
};
#line 27 "channel.h"
typedef struct _CHANNEL CHANNEL;
#line 44 "channel.h"
struct _CLIENT2CHAN {
   struct _CLIENT2CHAN *next ;
   CLIENT *client ;
   CHANNEL *channel ;
   char modes[9] ;
};
#line 44 "channel.h"
typedef struct _CLIENT2CHAN CL2CHAN;
#line 48 "conf.h"
struct _Conf_Channel {
   char name[51] ;
   char modes[9] ;
   char key[21] ;
   unsigned long maxusers ;
   array topic ;
};
#line 48 "conf.h"
typedef struct _Conf_Channel CONF_CHANNEL;
#line 115 "/usr/include/netdb.h"
struct hostent {
   char *h_name ;
   char **h_aliases ;
   int h_addrtype ;
   int h_length ;
   char **h_addr_list ;
};
#line 64 "client.h"
struct _WHOWAS {
   time_t time ;
   char id[32] ;
   char host[64] ;
   char user[10] ;
   char info[64] ;
   char server[64] ;
};
#line 64 "client.h"
typedef struct _WHOWAS WHOWAS;
#line 70 "/usr/include/i386/_types.h"
typedef int __darwin_ct_rune_t;
#line 102 "/usr/include/i386/_types.h"
typedef int __darwin_wchar_t;
#line 107 "/usr/include/i386/_types.h"
typedef __darwin_wchar_t __darwin_rune_t;
#line 126 "/usr/include/sys/types.h"
typedef __uint32_t in_addr_t;
#line 45 "/usr/lib/gcc/i686-apple-darwin9/4.0.1/include/stdint.h"
typedef unsigned short uint16_t;
#line 80 "./../portab/portab.h"
typedef uint16_t UINT16;
#line 43 "/usr/lib/gcc/i686-apple-darwin9/4.0.1/include/stdarg.h"
typedef __builtin_va_list __gnuc_va_list;
#line 105 "/usr/lib/gcc/i686-apple-darwin9/4.0.1/include/stdarg.h"
typedef __gnuc_va_list va_list;
#line 81 "/usr/include/runetype.h"
struct __anonstruct__RuneEntry_9 {
   __darwin_rune_t __min ;
   __darwin_rune_t __max ;
   __darwin_rune_t __map ;
   __uint32_t *__types ;
};
#line 81 "/usr/include/runetype.h"
typedef struct __anonstruct__RuneEntry_9 _RuneEntry;
#line 88 "/usr/include/runetype.h"
struct __anonstruct__RuneRange_10 {
   int __nranges ;
   _RuneEntry *__ranges ;
};
#line 88 "/usr/include/runetype.h"
typedef struct __anonstruct__RuneRange_10 _RuneRange;
#line 93 "/usr/include/runetype.h"
struct __anonstruct__RuneCharClass_11 {
   char __name[14] ;
   __uint32_t __mask ;
};
#line 93 "/usr/include/runetype.h"
typedef struct __anonstruct__RuneCharClass_11 _RuneCharClass;
#line 98 "/usr/include/runetype.h"
struct __anonstruct__RuneLocale_12 {
   char __magic[8] ;
   char __encoding[32] ;
   __darwin_rune_t (*__sgetrune)(char const   * , __darwin_size_t  , char const   ** ) ;
   int (*__sputrune)(__darwin_rune_t  , char * , __darwin_size_t  , char ** ) ;
   __darwin_rune_t __invalid_rune ;
   __uint32_t __runetype[1 << 8] ;
   __darwin_rune_t __maplower[1 << 8] ;
   __darwin_rune_t __mapupper[1 << 8] ;
   _RuneRange __runetype_ext ;
   _RuneRange __maplower_ext ;
   _RuneRange __mapupper_ext ;
   void *__variable ;
   int __variable_len ;
   int __ncharclasses ;
   _RuneCharClass *__charclasses ;
};
#line 98 "/usr/include/runetype.h"
typedef struct __anonstruct__RuneLocale_12 _RuneLocale;
#line 304 "/usr/include/netinet/in.h"
struct in_addr {
   in_addr_t s_addr ;
};
#line 24 "resolve.h"
struct _Res_Stat {
   pid_t pid ;
   int resolver_fd ;
};
#line 24 "resolve.h"
typedef struct _Res_Stat RES_STAT;
#line 26 "conf.h"
struct _Conf_Oper {
   char name[21] ;
   char pwd[21] ;
   char *mask ;
};
#line 26 "conf.h"
typedef struct _Conf_Oper CONF_OPER;
#line 33 "conf.h"
struct _Conf_Server {
   char host[256] ;
   char name[64] ;
   char pwd_in[21] ;
   char pwd_out[21] ;
   UINT16 port ;
   int group ;
   time_t lasttry ;
   RES_STAT res_stat ;
   int flags ;
   CONN_ID conn_id ;
   struct in_addr bind_addr ;
};
#line 33 "conf.h"
typedef struct _Conf_Server CONF_SERVER;
#line 41 "/usr/include/i386/_types.h"
typedef unsigned char __uint8_t;
#line 116 "/usr/include/i386/_types.h"
typedef __uint32_t __darwin_socklen_t;
#line 132 "/usr/include/sys/_types.h"
typedef __int32_t __darwin_suseconds_t;
#line 131 "/usr/include/sys/types.h"
typedef __uint16_t in_port_t;
#line 100 "/usr/include/sys/_structs.h"
struct timeval {
   __darwin_time_t tv_sec ;
   __darwin_suseconds_t tv_usec ;
};
#line 103 "/usr/include/sys/socket.h"
typedef __uint8_t sa_family_t;
#line 108 "/usr/include/sys/socket.h"
typedef __darwin_socklen_t socklen_t;
#line 294 "/usr/include/sys/socket.h"
struct sockaddr {
   __uint8_t sa_len ;
   sa_family_t sa_family ;
   char sa_data[14] ;
};
#line 362 "/usr/include/netinet/in.h"
struct sockaddr_in {
   __uint8_t sin_len ;
   sa_family_t sin_family ;
   in_port_t sin_port ;
   struct in_addr sin_addr ;
   char sin_zero[8] ;
};
#line 54 "conn.h"
struct _Connection {
   int sock ;
   struct sockaddr_in addr ;
   RES_STAT res_stat ;
   char host[256] ;
   array rbuf ;
   array wbuf ;
   time_t signon ;
   time_t lastdata ;
   time_t lastping ;
   time_t lastprivmsg ;
   time_t delaytime ;
   long bytes_in ;
   long bytes_out ;
   long msg_in ;
   long msg_out ;
   int flag ;
   UINT16 options ;
   CLIENT *client ;
};
#line 54 "conn.h"
typedef struct _Connection CONNECTION;
#line 40 "/usr/lib/gcc/i686-apple-darwin9/4.0.1/include/stdint.h"
typedef unsigned char uint8_t;
#line 79 "./../portab/portab.h"
typedef uint8_t UINT8;
#line 377 "/usr/include/sys/fcntl.h"
#pragma pack(4)
#line 385
#pragma pack()
#line 32 "io.c"
struct __anonstruct_io_event_11 {
   void (*callback)(int  , short  ) ;
   short what ;
};
#line 32 "io.c"
typedef struct __anonstruct_io_event_11 io_event;
#line 96 "/usr/include/sys/poll.h"
struct pollfd {
   int fd ;
   short events ;
   short revents ;
};
#line 103 "/usr/include/sys/poll.h"
typedef unsigned int nfds_t;
#line 22 "parse.h"
struct _REQUEST {
   char *prefix ;
   char *command ;
   char *argv[15] ;
   int argc ;
};
#line 22 "parse.h"
typedef struct _REQUEST REQUEST;
#line 31 "parse.h"
struct _COMMAND {
   char *name ;
   int (*function)(CLIENT *Client , REQUEST *Request ) ;
   int type ;
   long lcount ;
   long rcount ;
   long bytes ;
};
#line 31 "parse.h"
typedef struct _COMMAND COMMAND;
#line 40 "lists.c"
struct list_elem {
   struct list_elem *next ;
   char mask[128] ;
   int onlyonce ;
};
#line 41 "parse.h"
struct _NUMERIC {
   int numeric ;
   int (*function)(CLIENT *Client , REQUEST *Request ) ;
};
#line 41 "parse.h"
typedef struct _NUMERIC NUMERIC;
#line 1 "ngircd.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-3XxxZaYg.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 74 "/usr/include/sys/errno.h"
extern int *__error(void) ;
#line 168 "/usr/include/stdio.h"
extern FILE *__stdoutp ;
#line 169
extern FILE *__stderrp ;
#line 253
extern int fflush(FILE * ) ;
#line 258
extern int fprintf(FILE * , char const   *  , ...) ;
#line 277
extern int printf(char const   *  , ...) ;
#line 280
extern int puts(char const   * ) ;
#line 341
extern int snprintf(char * , size_t  , char const   *  , ...) ;
#line 256 "/usr/include/sys/wait.h"
extern pid_t waitpid(pid_t  , int * , int  )  __asm__("_waitpid$UNIX2003")  ;
#line 159 "/usr/include/stdlib.h"
extern  __attribute__((__noreturn__)) void exit(int  ) ;
#line 86 "/usr/include/signal.h"
extern int sigaction(int  , struct sigaction  const  * , struct sigaction * ) ;
#line 85 "/usr/include/string.h"
extern void *memset(void * , int  , size_t  ) ;
#line 90
extern char *strcat(char * , char const   * ) ;
#line 92
extern int strcmp(char const   * , char const   * ) ;
#line 96
extern char *strerror(int  )  __asm__("_strerror$UNIX2003")  ;
#line 98
extern size_t strlen(char const   * ) ;
#line 131
extern size_t strlcat(char * , char const   * , size_t  ) ;
#line 132
extern size_t strlcpy(char * , char const   * , size_t  ) ;
#line 420 "/usr/include/unistd.h"
extern int chdir(char const   * ) ;
#line 422
extern int close(int  )  __asm__("_close$UNIX2003")  ;
#line 427
extern int dup2(int  , int  ) ;
#line 441
extern pid_t fork(void) ;
#line 448
extern gid_t getgid(void) ;
#line 457
extern pid_t getpid(void) ;
#line 460
extern uid_t getuid(void) ;
#line 478
extern int setgid(gid_t  ) ;
#line 487
extern pid_t setsid(void) ;
#line 488
extern int setuid(uid_t  ) ;
#line 506
extern int unlink(char const   * ) ;
#line 509
extern ssize_t write(int  , void const   * , size_t  )  __asm__("_write$UNIX2003")  ;
#line 522
extern int chroot(char const   * ) ;
#line 129 "/usr/include/time.h"
extern struct tm *localtime(time_t const   * ) ;
#line 131
extern size_t strftime(char * , size_t  , char const   * , struct tm  const  * )  __asm__("_strftime$UNIX2003")  ;
#line 133
extern time_t time(time_t * ) ;
#line 432 "/usr/include/sys/stat.h"
extern mode_t umask(mode_t  ) ;
#line 418 "/usr/include/sys/fcntl.h"
extern int open(char const   * , int   , ...)  __asm__("_open$UNIX2003")  ;
#line 135 "/usr/include/pwd.h"
extern struct passwd *getpwuid(uid_t  ) ;
#line 136
extern struct passwd *getpwnam(char const   * ) ;
#line 145
extern void endpwent(void) ;
#line 98 "/usr/include/grp.h"
extern struct group *getgrgid(gid_t  ) ;
#line 75 "client.h"
void Client_Init(void) ;
#line 76
void Client_Exit(void) ;
#line 84 "conn.h"
void Conn_Init(void) ;
#line 85
void Conn_Exit(void) ;
#line 87
unsigned int Conn_InitListeners(void) ;
#line 88
void Conn_ExitListeners(void) ;
#line 90
void Conn_Handler(void) ;
#line 96
void Conn_SyncServerStruct(void) ;
#line 62 "channel.h"
void Channel_Init(void) ;
#line 63
void Channel_InitPredefined(void) ;
#line 64
void Channel_Exit(void) ;
#line 63 "conf.h"
char Conf_ServerName[64] ;
#line 89
uid_t Conf_UID ;
#line 90
gid_t Conf_GID ;
#line 93
char Conf_Chroot[256] ;
#line 96
char Conf_PidFile[256] ;
#line 119
int Conf_OperCanMode ;
#line 139
unsigned int Conf_MaxNickLength ;
#line 141
void Conf_Init(void) ;
#line 142
void Conf_Rehash(void) ;
#line 143
int Conf_Test(void) ;
#line 38 "log.h"
void Log_Init(int Daemon_Mode ) ;
#line 39
void Log_Exit(void) ;
#line 41
void Log(int Level , char const   *Format  , ...) ;
#line 25 "ngircd.h"
time_t NGIRCd_Start  ;
#line 26 "ngircd.h"
char NGIRCd_StartStr[64]  ;
#line 27 "ngircd.h"
char NGIRCd_Version[126]  ;
#line 28 "ngircd.h"
char NGIRCd_VersionAddition[126]  ;
#line 38 "ngircd.h"
int NGIRCd_Passive  ;
#line 40 "ngircd.h"
int NGIRCd_SignalQuit  ;
#line 41 "ngircd.h"
int NGIRCd_SignalRestart  ;
#line 42 "ngircd.h"
int NGIRCd_SignalRehash  ;
#line 44 "ngircd.h"
char NGIRCd_DebugLevel[2]  ;
#line 46 "ngircd.h"
char NGIRCd_ConfFile[256]  ;
#line 48 "ngircd.h"
char NGIRCd_ProtoID[513]  ;
#line 51
void NGIRCd_Rehash(void) ;
#line 59 "ngircd.c"
static void Initialize_Signal_Handler(void) ;
#line 60
static void Signal_Handler(int Signal ) ;
#line 62
static void Show_Version(void) ;
#line 63
static void Show_Help(void) ;
#line 65
static void Pidfile_Create(pid_t pid ) ;
#line 66
static void Pidfile_Delete(void) ;
#line 68
static void Fill_Version(void) ;
#line 70
static void Setup_FDStreams(void) ;
#line 72
static int NGIRCd_Init(int NGIRCd_NoDaemon ) ;
#line 82 "ngircd.c"
int main(int argc , char const   **argv ) 
{ int ok ;
  int configtest ;
  int NGIRCd_NoDaemon ;
  int i ;
  size_t n ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  size_t __cil_tmp___5 ;
  int __cil_tmp___6 ;
  struct tm *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  unsigned int __cil_tmp___9 ;

  {
#line 85
  configtest = 0;
#line 86
  NGIRCd_NoDaemon = 0;
#line 90
  umask((unsigned short)63);
#line 92
  NGIRCd_SignalRehash = 0;
#line 92
  NGIRCd_SignalRestart = NGIRCd_SignalRehash;
#line 92
  NGIRCd_SignalQuit = NGIRCd_SignalRestart;
#line 93
  NGIRCd_Passive = 0;
#line 100
  strlcpy(NGIRCd_ConfFile, "/usr/local/etc", sizeof(NGIRCd_ConfFile));
#line 101
  strlcat(NGIRCd_ConfFile, "/ngircd.conf", sizeof(NGIRCd_ConfFile));
#line 103
  Fill_Version();
#line 106
  i = 1;
#line 106
  while (i < argc) {
#line 108
    ok = 0;
#line 109
    if ((int const   )*(*(argv + i) + 0) == 45) {
#line 109
      if ((int const   )*(*(argv + i) + 1) == 45) {
#line 113
        __cil_tmp = strcmp(*(argv + i), "--config");
#line 113
        if (__cil_tmp == 0) {
#line 115
          if (i + 1 < argc) {
#line 118
            strlcpy(NGIRCd_ConfFile, *(argv + (i + 1)), sizeof(NGIRCd_ConfFile));
#line 121
            i ++;
#line 121
            ok = 1;
          }
        }
#line 124
        __cil_tmp___0 = strcmp(*(argv + i), "--configtest");
#line 124
        if (__cil_tmp___0 == 0) {
#line 126
          configtest = 1;
#line 127
          ok = 1;
        }
#line 136
        __cil_tmp___1 = strcmp(*(argv + i), "--help");
#line 136
        if (__cil_tmp___1 == 0) {
#line 138
          Show_Version();
#line 139
          puts("");
#line 139
          Show_Help();
#line 139
          puts("");
#line 140
          exit(1);
        }
#line 142
        __cil_tmp___2 = strcmp(*(argv + i), "--nodaemon");
#line 142
        if (__cil_tmp___2 == 0) {
#line 144
          NGIRCd_NoDaemon = 1;
#line 145
          ok = 1;
        }
#line 147
        __cil_tmp___3 = strcmp(*(argv + i), "--passive");
#line 147
        if (__cil_tmp___3 == 0) {
#line 149
          NGIRCd_Passive = 1;
#line 150
          ok = 1;
        }
#line 159
        __cil_tmp___4 = strcmp(*(argv + i), "--version");
#line 159
        if (__cil_tmp___4 == 0) {
#line 161
          Show_Version();
#line 162
          exit(1);
        }
      } else {
        goto _L;
      }
    } else {
      _L: /* CIL Label */ 
#line 165
      if ((int const   )*(*(argv + i) + 0) == 45) {
#line 165
        if ((int const   )*(*(argv + i) + 1) != 45) {
#line 168
          n = 1UL;
#line 168
          while (1) {
#line 168
            __cil_tmp___5 = strlen(*(argv + i));
#line 168
            if (! (n < __cil_tmp___5)) {
#line 168
              break;
            }
#line 170
            ok = 0;
#line 178
            if ((int const   )*(*(argv + i) + n) == 102) {
#line 180
              if (! *(*(argv + i) + (n + 1UL))) {
#line 180
                if (i + 1 < argc) {
#line 183
                  strlcpy(NGIRCd_ConfFile, *(argv + (i + 1)), sizeof(NGIRCd_ConfFile));
#line 186
                  i ++;
#line 187
                  n = strlen(*(argv + i));
#line 188
                  ok = 1;
                }
              }
            }
#line 191
            if ((int const   )*(*(argv + i) + n) == 110) {
#line 193
              NGIRCd_NoDaemon = 1;
#line 194
              ok = 1;
            }
#line 196
            if ((int const   )*(*(argv + i) + n) == 112) {
#line 198
              NGIRCd_Passive = 1;
#line 199
              ok = 1;
            }
#line 208
            if ((int const   )*(*(argv + i) + n) == 116) {
#line 210
              configtest = 1;
#line 211
              ok = 1;
            }
#line 214
            if (! ok) {
#line 216
              printf("%s: invalid option \"-%c\"!\n", "ngircd", *(*(argv + i) + n));
#line 217
              printf("Try \"%s --help\" for more information.\n", "ngircd");
#line 218
              exit(1);
            }
#line 168
            n ++;
          }
        }
      }
    }
#line 223
    if (! ok) {
#line 225
      printf("%s: invalid option \"%s\"!\n", "ngircd", *(argv + i));
#line 226
      printf("Try \"%s --help\" for more information.\n", "ngircd");
#line 227
      exit(1);
    }
#line 106
    i ++;
  }
#line 232
  NGIRCd_DebugLevel[0] = (char )'\000';
#line 245
  if (configtest) {
#line 247
    Show_Version();
#line 247
    puts("");
#line 248
    __cil_tmp___6 = Conf_Test();
#line 248
    exit(__cil_tmp___6);
  }
#line 251
  while (! NGIRCd_SignalQuit) {
#line 254
    NGIRCd_Start = time((time_t *)((void *)0));
#line 255
    __cil_tmp___7 = localtime((time_t const   *)(& NGIRCd_Start));
#line 255
    strftime(NGIRCd_StartStr, 64UL, "%a %b %d %Y at %H:%M:%S (%Z)", (struct tm  const  *)__cil_tmp___7);
#line 257
    NGIRCd_SignalRehash = 0;
#line 258
    NGIRCd_SignalRestart = 0;
#line 259
    NGIRCd_SignalQuit = 0;
#line 262
    Log_Init(! NGIRCd_NoDaemon);
#line 263
    Conf_Init();
#line 267
    __cil_tmp___8 = NGIRCd_Init(NGIRCd_NoDaemon);
#line 267
    if (! __cil_tmp___8) {
#line 268
      Log(1, "Fatal: Initialization failed");
#line 269
      exit(1);
    }
#line 274
    Channel_Init();
#line 275
    Client_Init();
#line 279
    Conn_Init();
#line 288
    Initialize_Signal_Handler();
#line 294
    snprintf(NGIRCd_ProtoID, sizeof(NGIRCd_ProtoID), "%s%s %s|%s:%s", "0210", "-IRC+",
             "ngircd", "0.11.1", "CHL");
#line 298
    if (Conf_OperCanMode) {
#line 298
      strcat(NGIRCd_ProtoID, "o");
    }
#line 302
    strlcat(NGIRCd_ProtoID, " P", sizeof(NGIRCd_ProtoID));
#line 306
    Log(7, "Protocol and server ID is \"%s\".", NGIRCd_ProtoID);
#line 309
    Channel_InitPredefined();
#line 312
    __cil_tmp___9 = Conn_InitListeners();
#line 312
    if (__cil_tmp___9 < 1U) {
#line 314
      Log(1, "Server isn\'t listening on a single port!");
#line 315
      Log(1, "%s exiting due to fatal errors!", "ngircd");
#line 316
      Pidfile_Delete();
#line 317
      exit(1);
    }
#line 321
    Conn_Handler();
#line 324
    Conn_Exit();
#line 328
    Client_Exit();
#line 329
    Channel_Exit();
#line 330
    Log_Exit();
  }
#line 332
  Pidfile_Delete();
#line 334
  return (0);
}
}
#line 344 "ngircd.c"
static void Fill_Version(void) 
{ 

  {
#line 347
  NGIRCd_VersionAddition[0] = (char )'\000';
#line 395
  if (NGIRCd_VersionAddition[0]) {
#line 396
    strlcat(NGIRCd_VersionAddition, "+", sizeof(NGIRCd_VersionAddition));
  }
#line 398
  strlcat(NGIRCd_VersionAddition, "IRCPLUS", sizeof(NGIRCd_VersionAddition));
#line 401
  if (NGIRCd_VersionAddition[0]) {
#line 402
    strlcat(NGIRCd_VersionAddition, "-", sizeof(NGIRCd_VersionAddition));
  }
#line 404
  strlcat(NGIRCd_VersionAddition, "i386", sizeof(NGIRCd_VersionAddition));
#line 405
  strlcat(NGIRCd_VersionAddition, "/", sizeof(NGIRCd_VersionAddition));
#line 406
  strlcat(NGIRCd_VersionAddition, "apple", sizeof(NGIRCd_VersionAddition));
#line 407
  strlcat(NGIRCd_VersionAddition, "/", sizeof(NGIRCd_VersionAddition));
#line 408
  strlcat(NGIRCd_VersionAddition, "darwin9.4.0", sizeof(NGIRCd_VersionAddition));
#line 413
  snprintf(NGIRCd_Version, sizeof(NGIRCd_Version), "%s %s-%s", "ngircd", "0.11.1",
           NGIRCd_VersionAddition);
#line 415
  return;
}
}
#line 421 "ngircd.c"
void NGIRCd_Rehash(void) 
{ char old_name[64] ;
  unsigned int old_nicklen ;
  int __cil_tmp ;

  {
#line 427
  Log(1029, "Re-reading configuration NOW!");
#line 428
  NGIRCd_SignalRehash = 0;
#line 431
  Conn_ExitListeners();
#line 434
  strlcpy(old_name, (char const   *)(Conf_ServerName), sizeof(old_name));
#line 435
  old_nicklen = Conf_MaxNickLength;
#line 438
  Conf_Rehash();
#line 442
  __cil_tmp = strcmp((char const   *)(old_name), (char const   *)(Conf_ServerName));
#line 442
  if (__cil_tmp != 0) {
#line 443
    strlcpy(Conf_ServerName, (char const   *)(old_name), sizeof(Conf_ServerName));
#line 444
    Log(3, "Can\'t change \"ServerName\" on runtime! Ignored new name.");
  }
#line 446
  if (old_nicklen != Conf_MaxNickLength) {
#line 447
    Conf_MaxNickLength = old_nicklen;
#line 448
    Log(3, "Can\'t change \"MaxNickLength\" on runtime! Ignored new value.");
  }
#line 452
  Channel_InitPredefined();
#line 455
  Conn_InitListeners();
#line 458
  Conn_SyncServerStruct();
#line 460
  Log(1029, "Re-reading of configuration done.");
#line 461
  return;
}
}
#line 467 "ngircd.c"
static void Initialize_Signal_Handler(void) 
{ struct sigaction saction ;

  {
#line 479
  memset((void *)(& saction), 0, sizeof(saction));
#line 480
  saction.__sigaction_u.__sa_handler = & Signal_Handler;
#line 482
  saction.sa_flags |= 2;
#line 485
  saction.sa_flags |= 32;
#line 489
  sigaction(2, (struct sigaction  const  *)(& saction), (struct sigaction *)((void *)0));
#line 490
  sigaction(3, (struct sigaction  const  *)(& saction), (struct sigaction *)((void *)0));
#line 491
  sigaction(15, (struct sigaction  const  *)(& saction), (struct sigaction *)((void *)0));
#line 492
  sigaction(1, (struct sigaction  const  *)(& saction), (struct sigaction *)((void *)0));
#line 493
  sigaction(20, (struct sigaction  const  *)(& saction), (struct sigaction *)((void *)0));
#line 496
  saction.__sigaction_u.__sa_handler = (void (*)(int  ))1;
#line 497
  sigaction(13, (struct sigaction  const  *)(& saction), (struct sigaction *)((void *)0));
#line 511
  return;
}
}
#line 520 "ngircd.c"
static void Signal_Handler(int Signal ) 
{ pid_t __cil_tmp ;

  {
#line 523
  switch (Signal) {
  case 15: 
  case 2: 
  case 3: 
#line 529
  NGIRCd_SignalQuit = 1;
#line 530
  break;
  case 1: 
#line 533
  NGIRCd_SignalRehash = 1;
#line 534
  break;
  case 20: 
#line 537
  while (1) {
#line 537
    __cil_tmp = waitpid(-1, (int *)((void *)0), 1);
#line 537
    if (! (__cil_tmp > 0)) {
#line 537
      break;
    }
  }
#line 538
  break;
  }
#line 545
  return;
}
}
#line 551 "ngircd.c"
static void Show_Version(void) 
{ 

  {
#line 554
  puts((char const   *)(NGIRCd_Version));
#line 555
  puts("Copyright (c)2001-2007 Alexander Barton (<alex@barton.de>) and Contributors.");
#line 556
  puts("Homepage: <http://ngircd.barton.de/>\n");
#line 557
  puts("This is free software; see the source for copying conditions. There is NO");
#line 558
  puts("warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.");
#line 559
  return;
}
}
#line 567 "ngircd.c"
static void Show_Help(void) 
{ 

  {
#line 573
  puts("  -f, --config <f>   use file <f> as configuration file");
#line 574
  puts("  -n, --nodaemon     don\'t fork and don\'t detach from controlling terminal");
#line 575
  puts("  -p, --passive      disable automatic connections to other servers");
#line 579
  puts("  -t, --configtest   read, validate and display configuration; then exit");
#line 580
  puts("      --version      output version information and exit");
#line 581
  puts("      --help         display this help and exit");
#line 582
  return;
}
}
#line 588 "ngircd.c"
static void Pidfile_Delete(void) 
{ int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 592
  if (! Conf_PidFile[0]) {
#line 592
    return;
  }
#line 598
  __cil_tmp___1 = unlink((char const   *)(Conf_PidFile));
#line 598
  if (__cil_tmp___1) {
#line 599
    __cil_tmp = __error();
#line 599
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 599
    Log(3, "Error unlinking PID file (%s): %s", Conf_PidFile, __cil_tmp___0);
  }
#line 600
  return;
}
}
#line 607 "ngircd.c"
static void Pidfile_Create(pid_t pid ) 
{ int pidfd ;
  char pidbuf[64] ;
  int len ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  ssize_t __cil_tmp___3 ;
  int *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 615
  if (! Conf_PidFile[0]) {
#line 615
    return;
  }
#line 621
  pidfd = open((char const   *)(Conf_PidFile), 2562, 420);
#line 622
  if (pidfd < 0) {
#line 623
    __cil_tmp = __error();
#line 623
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 623
    Log(3, "Error writing PID file (%s): %s", Conf_PidFile, __cil_tmp___0);
#line 624
    return;
  }
#line 627
  len = snprintf(pidbuf, sizeof(pidbuf), "%ld\n", (long )pid);
#line 628
  if (len < 0) {
#line 629
    Log(3, "Error converting pid");
#line 630
    return;
  } else {
#line 628
    if (len >= (int )sizeof(pidbuf)) {
#line 629
      Log(3, "Error converting pid");
#line 630
      return;
    }
  }
#line 633
  __cil_tmp___3 = write(pidfd, (void const   *)(pidbuf), (unsigned long )len);
#line 633
  if (__cil_tmp___3 != (long )len) {
#line 634
    __cil_tmp___1 = __error();
#line 634
    __cil_tmp___2 = strerror(*__cil_tmp___1);
#line 634
    Log(3, "Can\'t write PID file (%s): %s", Conf_PidFile, __cil_tmp___2);
  }
#line 636
  __cil_tmp___6 = close(pidfd);
#line 636
  if (__cil_tmp___6 != 0) {
#line 637
    __cil_tmp___4 = __error();
#line 637
    __cil_tmp___5 = strerror(*__cil_tmp___4);
#line 637
    Log(3, "Error closing PID file (%s): %s", Conf_PidFile, __cil_tmp___5);
  }
#line 638
  return;
}
}
#line 644 "ngircd.c"
static void Setup_FDStreams(void) 
{ int fd ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;

  {
#line 652
  fd = open("/dev/null", 2);
#line 653
  if (fd < 0) {
#line 654
    __cil_tmp = __error();
#line 654
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 654
    Log(4, "Could not open /dev/null: %s", __cil_tmp___0);
#line 655
    return;
  }
#line 658
  fflush(__stdoutp);
#line 659
  fflush(__stderrp);
#line 662
  dup2(fd, 0);
#line 662
  dup2(fd, 1);
#line 662
  dup2(fd, 2);
#line 665
  if (fd > 2) {
#line 665
    close(fd);
  }
#line 666
  return;
}
}
#line 669 "ngircd.c"
static int NGIRCd_getNobodyID(uid_t *uid , gid_t *gid ) 
{ struct passwd *pwd ;

  {
#line 674
  pwd = getpwnam("nobody");
#line 675
  if (! pwd) {
#line 675
    return (0);
  }
#line 677
  if (! pwd->pw_uid) {
#line 678
    return (0);
  } else {
#line 677
    if (! pwd->pw_gid) {
#line 678
      return (0);
    }
  }
#line 680
  *uid = pwd->pw_uid;
#line 681
  *gid = pwd->pw_gid;
#line 682
  endpwent();
#line 684
  return (1);
}
}
#line 691 "ngircd.c"
static int initialized  ;
#line 688 "ngircd.c"
static int NGIRCd_Init(int NGIRCd_NoDaemon ) 
{ int chrooted ;
  struct passwd *pwd ;
  struct group *grp ;
  int real_errno ;
  pid_t pid ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char const   *__cil_tmp___9 ;
  int *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  int *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  int *__cil_tmp___14 ;
  int *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  gid_t __cil_tmp___18 ;
  int *__cil_tmp___19 ;
  int *__cil_tmp___20 ;
  char *__cil_tmp___21 ;
  int __cil_tmp___22 ;
  uid_t __cil_tmp___23 ;
  int *__cil_tmp___24 ;
  char *__cil_tmp___25 ;
  char const   *__cil_tmp___26 ;
  char const   *__cil_tmp___27 ;
  int *__cil_tmp___28 ;
  char *__cil_tmp___29 ;
  int __cil_tmp___30 ;

  {
#line 692
  chrooted = 0;
#line 698
  if (initialized) {
#line 699
    return (1);
  }
#line 701
  if (Conf_Chroot[0]) {
#line 702
    __cil_tmp___1 = chdir((char const   *)(Conf_Chroot));
#line 702
    if (__cil_tmp___1 != 0) {
#line 703
      __cil_tmp = __error();
#line 703
      __cil_tmp___0 = strerror(*__cil_tmp);
#line 703
      Log(3, "Can\'t chdir() in ChrootDir (%s): %s", Conf_Chroot, __cil_tmp___0);
#line 704
      return (0);
    }
#line 707
    __cil_tmp___5 = chroot((char const   *)(Conf_Chroot));
#line 707
    if (__cil_tmp___5 != 0) {
#line 708
      __cil_tmp___4 = __error();
#line 708
      if (*__cil_tmp___4 != 1) {
#line 709
        __cil_tmp___2 = __error();
#line 709
        __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 709
        Log(3, "Can\'t change root directory to \"%s\": %s", Conf_Chroot, __cil_tmp___3);
#line 712
        return (0);
      }
    } else {
#line 715
      chrooted = 1;
#line 716
      Log(6, "Changed root and working directory to \"%s\".", Conf_Chroot);
    }
  }
#line 720
  if (Conf_UID == 0U) {
#line 721
    Log(6, "ServerUID must not be 0, using \"nobody\" instead.", Conf_UID);
#line 723
    __cil_tmp___13 = NGIRCd_getNobodyID(& Conf_UID, & Conf_GID);
#line 723
    if (! __cil_tmp___13) {
#line 724
      __cil_tmp___12 = __error();
#line 724
      if (*__cil_tmp___12) {
#line 724
        __cil_tmp___10 = __error();
#line 724
        __cil_tmp___11 = strerror(*__cil_tmp___10);
#line 724
        __cil_tmp___9 = (char const   *)__cil_tmp___11;
      } else {
#line 724
        __cil_tmp___9 = "not found";
      }
#line 724
      Log(4, "Could not get user/group ID of user \"nobody\": %s", __cil_tmp___9);
#line 726
      return (0);
    }
  }
#line 730
  __cil_tmp___18 = getgid();
#line 730
  if (__cil_tmp___18 != Conf_GID) {
#line 732
    __cil_tmp___17 = setgid(Conf_GID);
#line 732
    if (__cil_tmp___17 != 0) {
#line 733
      __cil_tmp___14 = __error();
#line 733
      real_errno = *__cil_tmp___14;
#line 734
      __cil_tmp___15 = __error();
#line 734
      __cil_tmp___16 = strerror(*__cil_tmp___15);
#line 734
      Log(3, "Can\'t change group ID to %u: %s", Conf_GID, __cil_tmp___16);
#line 735
      if (real_errno != 1) {
#line 736
        return (0);
      }
    }
  }
#line 740
  __cil_tmp___23 = getuid();
#line 740
  if (__cil_tmp___23 != Conf_UID) {
#line 742
    __cil_tmp___22 = setuid(Conf_UID);
#line 742
    if (__cil_tmp___22 != 0) {
#line 743
      __cil_tmp___19 = __error();
#line 743
      real_errno = *__cil_tmp___19;
#line 744
      __cil_tmp___20 = __error();
#line 744
      __cil_tmp___21 = strerror(*__cil_tmp___20);
#line 744
      Log(3, "Can\'t change user ID to %u: %s", Conf_UID, __cil_tmp___21);
#line 745
      if (real_errno != 1) {
#line 746
        return (0);
      }
    }
  }
#line 750
  initialized = 1;
#line 755
  if (! NGIRCd_NoDaemon) {
#line 756
    pid = fork();
#line 757
    if (pid > 0) {
#line 759
      exit(0);
    }
#line 761
    if (pid < 0) {
#line 763
      __cil_tmp___24 = __error();
#line 763
      __cil_tmp___25 = strerror(*__cil_tmp___24);
#line 763
      fprintf(__stderrp, "%s: Can\'t fork: %s!\nFatal error, exiting now ...\n", "ngircd",
              __cil_tmp___25);
#line 765
      exit(1);
    }
#line 769
    setsid();
#line 770
    chdir("/");
#line 773
    Setup_FDStreams();
  }
#line 775
  pid = getpid();
#line 777
  Pidfile_Create(pid);
#line 781
  Conf_UID = getuid();
#line 782
  Conf_GID = getgid();
#line 784
  pwd = getpwuid(Conf_UID);
#line 785
  grp = getgrgid(Conf_GID);
#line 787
  if (grp) {
#line 787
    __cil_tmp___26 = (char const   *)grp->gr_name;
  } else {
#line 787
    __cil_tmp___26 = "unknown";
  }
#line 787
  if (pwd) {
#line 787
    __cil_tmp___27 = (char const   *)pwd->pw_name;
  } else {
#line 787
    __cil_tmp___27 = "unknown";
  }
#line 787
  Log(6, "Running as user %s(%ld), group %s(%ld), with PID %ld.", __cil_tmp___27,
      Conf_UID, __cil_tmp___26, Conf_GID, pid);
#line 791
  if (chrooted) {
#line 792
    Log(6, "Running chrooted, chrootdir \"%s\".", Conf_Chroot);
#line 793
    return (1);
  } else {
#line 795
    Log(6, "Not running chrooted.");
  }
#line 801
  if (pwd) {
#line 802
    if (! NGIRCd_NoDaemon) {
#line 803
      __cil_tmp___30 = chdir((char const   *)pwd->pw_dir);
#line 803
      if (__cil_tmp___30 == 0) {
#line 804
        Log(7, "Changed working directory to \"%s\" ...", pwd->pw_dir);
      } else {
#line 806
        __cil_tmp___28 = __error();
#line 806
        __cil_tmp___29 = strerror(*__cil_tmp___28);
#line 806
        Log(6, "Notice: Can\'t change working directory to \"%s\": %s", pwd->pw_dir,
            __cil_tmp___29);
      }
    }
  } else {
#line 810
    Log(3, "Can\'t get user informaton for UID %d!?", Conf_UID);
  }
#line 813
  return (1);
}
}
#line 1 "array.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-uFm2Tlz1.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 32 "array.h"
void array_init(array *a ) ;
#line 36
void *array_alloc(array *a , size_t size , size_t pos ) ;
#line 42
size_t array_length(array const   *a , size_t membersize ) ;
#line 49
int array_copy(array *dest , array const   *src ) ;
#line 52
int array_copyb(array *dest , char const   *src , size_t len ) ;
#line 55
int array_copys(array *dest , char const   *src ) ;
#line 62
int array_catb(array *dest , char const   *src , size_t len ) ;
#line 65
int array_cats(array *dest , char const   *src ) ;
#line 68
int array_cat0(array *a ) ;
#line 71
int array_cat0_temporary(array *a ) ;
#line 74
int array_cat(array *dest , array const   *src ) ;
#line 79
void *array_get(array *a , size_t membersize , size_t pos ) ;
#line 82
void array_free(array *a ) ;
#line 88
void *array_start(array const   *a ) ;
#line 91
void array_trunc(array *a ) ;
#line 94
void array_truncate(array *a , size_t membersize , size_t len ) ;
#line 97
void array_moveleft(array *a , size_t membersize , size_t pos ) ;
#line 160 "/usr/include/stdlib.h"
extern void free(void * ) ;
#line 176
extern void *realloc(void * , size_t  ) ;
#line 83 "/usr/include/string.h"
extern void *memcpy(void * , void const   * , size_t  ) ;
#line 84
extern void *memmove(void * , void const   * , size_t  ) ;
#line 36 "array.c"
static int safemult_sizet(size_t a , size_t b , size_t *res ) 
{ size_t tmp ;

  {
#line 39
  tmp = a * b;
#line 41
  if (b) {
#line 41
    if (tmp / b != a) {
#line 42
      return (0);
    }
  }
#line 44
  *res = tmp;
#line 45
  return (1);
}
}
#line 49 "array.c"
void array_init(array *a ) 
{ 

  {
#line 53
  a->mem = (char *)((void *)0);
#line 54
  a->allocated = 0UL;
#line 55
  a->used = 0UL;
#line 56
  return;
}
}
#line 60 "array.c"
void *array_alloc(array *a , size_t size , size_t pos ) 
{ size_t alloc ;
  size_t pos_plus1 ;
  size_t aligned ;
  char *tmp ;
  int __cil_tmp ;
  void *__cil_tmp___0 ;

  {
#line 63
  pos_plus1 = pos + 1UL;
#line 64
  aligned = (size_t )0;
#line 69
  if (pos_plus1 == 0UL) {
#line 70
    return ((void *)0);
  } else {
#line 69
    __cil_tmp = safemult_sizet(size, pos_plus1, & alloc);
#line 69
    if (! __cil_tmp) {
#line 70
      return ((void *)0);
    }
  }
#line 72
  if (a->allocated < alloc) {
#line 73
    if (alloc < 128UL) {
#line 74
      aligned = (alloc + 31UL) & 4294967264UL;
    } else {
#line 76
      if (alloc < 4096UL) {
#line 77
        aligned = (alloc + 1023UL) & 4294966272UL;
      } else {
#line 79
        aligned = (alloc + 4095UL) & 4294963200UL;
      }
    }
#line 88
    if (aligned < alloc) {
#line 89
      return ((void *)0);
    }
#line 91
    alloc = aligned;
#line 97
    __cil_tmp___0 = realloc((void *)a->mem, alloc);
#line 97
    tmp = (char *)__cil_tmp___0;
#line 98
    if (! tmp) {
#line 99
      return ((void *)0);
    }
#line 101
    a->mem = tmp;
#line 102
    a->allocated = alloc;
#line 106
    memset((void *)(a->mem + a->used), 0, a->allocated - a->used);
#line 108
    a->used = alloc;
  }
#line 110
  return ((void *)(a->mem + pos * size));
}
}
#line 115 "array.c"
size_t array_length(array const   *a , size_t membersize ) 
{ size_t __cil_tmp ;

  {
#line 121
  if (! a->mem) {
#line 122
    return (0UL);
  } else {
#line 121
    if (0UL == a->allocated) {
#line 122
      return (0UL);
    }
  }
#line 124
  if (membersize) {
#line 124
    __cil_tmp = a->used / (size_t const   )membersize;
  } else {
#line 124
    __cil_tmp = (unsigned long const   )0;
  }
#line 124
  return ((unsigned long )__cil_tmp);
}
}
#line 129 "array.c"
int array_copy(array *dest , array const   *src ) 
{ int __cil_tmp ;

  {
#line 132
  if (! src->mem) {
#line 133
    return (0);
  } else {
#line 132
    if (0UL == src->allocated) {
#line 133
      return (0);
    }
  }
#line 135
  __cil_tmp = array_copyb(dest, (char const   *)src->mem, (unsigned long )src->used);
#line 135
  return (__cil_tmp);
}
}
#line 140 "array.c"
int array_copyb(array *dest , char const   *src , size_t len ) 
{ int __cil_tmp ;

  {
#line 146
  if (! src) {
#line 147
    return (0);
  } else {
#line 146
    if (! dest) {
#line 147
      return (0);
    }
  }
#line 149
  array_trunc(dest);
#line 150
  __cil_tmp = array_catb(dest, src, len);
#line 150
  return (__cil_tmp);
}
}
#line 155 "array.c"
int array_copys(array *dest , char const   *src ) 
{ size_t __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 158
  __cil_tmp = strlen(src);
#line 158
  __cil_tmp___0 = array_copyb(dest, src, __cil_tmp);
#line 158
  return (__cil_tmp___0);
}
}
#line 164 "array.c"
int array_catb(array *dest , char const   *src , size_t len ) 
{ size_t tmp ;
  size_t used ;
  char *ptr ;
  void *__cil_tmp ;

  {
#line 174
  if (! len) {
#line 175
    return (1);
  }
#line 177
  if (! src) {
#line 178
    return (0);
  } else {
#line 177
    if (! dest) {
#line 178
      return (0);
    }
  }
#line 180
  used = dest->used;
#line 181
  tmp = used + len;
#line 183
  if (tmp < used) {
#line 184
    return (0);
  } else {
#line 183
    if (tmp < len) {
#line 184
      return (0);
    }
  }
#line 186
  __cil_tmp = array_alloc(dest, 1UL, tmp);
#line 186
  if (! __cil_tmp) {
#line 187
    return (0);
  }
#line 189
  ptr = dest->mem;
#line 198
  memcpy((void *)(ptr + used), (void const   *)src, len);
#line 199
  dest->used = tmp;
#line 200
  return (1);
}
}
#line 205 "array.c"
int array_cats(array *dest , char const   *src ) 
{ size_t __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 208
  __cil_tmp = strlen(src);
#line 208
  __cil_tmp___0 = array_catb(dest, src, __cil_tmp);
#line 208
  return (__cil_tmp___0);
}
}
#line 213 "array.c"
int array_cat0(array *a ) 
{ int __cil_tmp ;

  {
#line 216
  __cil_tmp = array_catb(a, "", 1UL);
#line 216
  return (__cil_tmp);
}
}
#line 221 "array.c"
int array_cat0_temporary(array *a ) 
{ char *endpos ;
  void *__cil_tmp ;

  {
#line 224
  __cil_tmp = array_alloc(a, 1UL, a->used);
#line 224
  endpos = (char *)__cil_tmp;
#line 225
  if (! endpos) {
#line 226
    return (0);
  }
#line 228
  *endpos = (char )'\000';
#line 229
  return (1);
}
}
#line 233 "array.c"
int array_cat(array *dest , array const   *src ) 
{ int __cil_tmp ;

  {
#line 236
  if (! src->mem) {
#line 237
    return (0);
  } else {
#line 236
    if (0UL == src->allocated) {
#line 237
      return (0);
    }
  }
#line 239
  __cil_tmp = array_catb(dest, (char const   *)src->mem, (unsigned long )src->used);
#line 239
  return (__cil_tmp);
}
}
#line 246 "array.c"
void *array_get(array *a , size_t membersize , size_t pos ) 
{ size_t totalsize ;
  size_t posplus1 ;
  int __cil_tmp ;

  {
#line 250
  posplus1 = pos + 1UL;
#line 255
  if (! posplus1) {
#line 256
    return ((void *)0);
  } else {
#line 255
    if (! a->mem) {
#line 256
      return ((void *)0);
    } else {
#line 255
      if (0UL == a->allocated) {
#line 256
        return ((void *)0);
      }
    }
  }
#line 258
  __cil_tmp = safemult_sizet(posplus1, membersize, & totalsize);
#line 258
  if (! __cil_tmp) {
#line 259
    return ((void *)0);
  }
#line 261
  if (a->allocated < totalsize) {
#line 262
    return ((void *)0);
  }
#line 264
  totalsize = pos * membersize;
#line 265
  return ((void *)(a->mem + totalsize));
}
}
#line 269 "array.c"
void array_free(array *a ) 
{ 

  {
#line 278
  free((void *)a->mem);
#line 279
  a->mem = (char *)((void *)0);
#line 280
  a->allocated = 0UL;
#line 281
  a->used = 0UL;
#line 282
  return;
}
}
#line 285 "array.c"
void *array_start(array const   *a ) 
{ 

  {
#line 289
  return ((void *)a->mem);
}
}
#line 293 "array.c"
void array_trunc(array *a ) 
{ 

  {
#line 297
  a->used = 0UL;
#line 298
  return;
}
}
#line 301 "array.c"
void array_truncate(array *a , size_t membersize , size_t len ) 
{ size_t newlen ;
  int __cil_tmp ;

  {
#line 306
  __cil_tmp = safemult_sizet(membersize, len, & newlen);
#line 306
  if (! __cil_tmp) {
#line 307
    return;
  }
#line 309
  if (newlen <= a->allocated) {
#line 310
    a->used = newlen;
  }
#line 311
  return;
}
}
#line 315 "array.c"
void array_moveleft(array *a , size_t membersize , size_t pos ) 
{ size_t bytepos ;
  int __cil_tmp ;

  {
#line 323
  __cil_tmp = safemult_sizet(membersize, pos, & bytepos);
#line 323
  if (! __cil_tmp) {
#line 324
    a->used = 0UL;
#line 325
    return;
  }
#line 328
  if (! bytepos) {
#line 329
    return;
  }
#line 336
  if (a->used <= bytepos) {
#line 337
    a->used = 0UL;
#line 338
    return;
  }
#line 341
  a->used -= bytepos;
#line 342
  memmove((void *)a->mem, (void const   *)(a->mem + bytepos), a->used);
#line 343
  return;
}
}
#line 1 "channel.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-tk3ZGU1y.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 169 "/usr/include/stdlib.h"
extern void *malloc(size_t  ) ;
#line 91 "/usr/include/string.h"
extern char *strchr(char const   * , int  ) ;
#line 94
extern char *strcpy(char * , char const   * ) ;
#line 95
extern size_t strcspn(char const   * , char const   * ) ;
#line 130
extern int strcasecmp(char const   * , char const   * ) ;
#line 92 "client.h"
int Client_Type(CLIENT *Client ) ;
#line 93
CONN_ID Client_Conn(CLIENT *Client ) ;
#line 94
char *Client_ID(CLIENT *Client ) ;
#line 95
char *Client_Mask(CLIENT *Client ) ;
#line 108
CLIENT *Client_NextHop(CLIENT *Client ) ;
#line 29 "conn-func.h"
void Conn_UpdateIdle(CONN_ID Idx ) ;
#line 29 "lists.h"
struct list_elem *Lists_GetFirst(struct list_head  const  *h ) ;
#line 30
struct list_elem *Lists_GetNext(struct list_elem  const  *e ) ;
#line 32
int Lists_Check(struct list_head *header , CLIENT *Client ) ;
#line 35
int Lists_Add(struct list_head *header , char const   *Mask , int OnlyOnce ) ;
#line 40
void Lists_Free(struct list_head *head ) ;
#line 43
char const   *Lists_GetMask(struct list_elem  const  *e ) ;
#line 59 "channel.h"
struct list_head *Channel_GetListBans(CHANNEL *c ) ;
#line 60
struct list_head *Channel_GetListInvites(CHANNEL *c ) ;
#line 66
int Channel_Join(CLIENT *Client , char *Name ) ;
#line 67
int Channel_Part(CLIENT *Client , CLIENT *Origin , char *Name , char *Reason ) ;
#line 69
void Channel_Quit(CLIENT *Client , char *Reason ) ;
#line 71
void Channel_Kick(CLIENT *Client , CLIENT *Origin , char *Name , char *Reason ) ;
#line 73
unsigned long Channel_Count(void) ;
#line 74
unsigned long Channel_MemberCount(CHANNEL *Chan ) ;
#line 75
int Channel_CountForUser(CLIENT *Client ) ;
#line 77
char const   *Channel_Name(CHANNEL const   *Chan ) ;
#line 78
char *Channel_Modes(CHANNEL *Chan ) ;
#line 79
char *Channel_Topic(CHANNEL *Chan ) ;
#line 80
char *Channel_Key(CHANNEL *Chan ) ;
#line 81
unsigned long Channel_MaxUsers(CHANNEL *Chan ) ;
#line 83
void Channel_SetTopic(CHANNEL *Chan , CLIENT *Client , char *Topic ) ;
#line 84
void Channel_SetModes(CHANNEL *Chan , char *Modes ) ;
#line 85
void Channel_SetKey(CHANNEL *Chan , char *Key ) ;
#line 86
void Channel_SetMaxUsers(CHANNEL *Chan , unsigned long Count___0 ) ;
#line 88
CHANNEL *Channel_Search(char *Name ) ;
#line 90
CHANNEL *Channel_First(void) ;
#line 91
CHANNEL *Channel_Next(CHANNEL *Chan ) ;
#line 93
CL2CHAN *Channel_FirstMember(CHANNEL *Chan ) ;
#line 94
CL2CHAN *Channel_NextMember(CHANNEL *Chan , CL2CHAN *Cl2Chan ) ;
#line 95
CL2CHAN *Channel_FirstChannelOf(CLIENT *Client ) ;
#line 96
CL2CHAN *Channel_NextChannelOf(CLIENT *Client , CL2CHAN *Cl2Chan ) ;
#line 98
CLIENT *Channel_GetClient(CL2CHAN *Cl2Chan ) ;
#line 99
CHANNEL *Channel_GetChannel(CL2CHAN *Cl2Chan ) ;
#line 101
int Channel_IsValidName(char const   *Name ) ;
#line 103
int Channel_ModeAdd(CHANNEL *Chan , char Mode ) ;
#line 104
int Channel_ModeDel(CHANNEL *Chan , char Mode ) ;
#line 106
int Channel_UserModeAdd(CHANNEL *Chan , CLIENT *Client , char Mode ) ;
#line 107
int Channel_UserModeDel(CHANNEL *Chan , CLIENT *Client , char Mode ) ;
#line 108
char *Channel_UserModes(CHANNEL *Chan , CLIENT *Client ) ;
#line 110
int Channel_IsMemberOf(CHANNEL *Chan , CLIENT *Client ) ;
#line 112
int Channel_Write(CHANNEL *Chan , CLIENT *From , CLIENT *Client , char *Text ) ;
#line 114
CHANNEL *Channel_Create(char *Name ) ;
#line 117
unsigned int Channel_TopicTime(CHANNEL *Chan ) ;
#line 118
char *Channel_TopicWho(CHANNEL *Chan ) ;
#line 121
int Channel_AddInvite(CHANNEL *c , char const   *mask , int onlyonce ) ;
#line 122
int Channel_AddBan(CHANNEL *c , char const   *mask ) ;
#line 124
int Channel_ShowBans(CLIENT *Client , CHANNEL *Channel ) ;
#line 125
int Channel_ShowInvites(CLIENT *Client , CHANNEL *Channel ) ;
#line 21 "irc-write.h"
int IRC_WriteStrClient(CLIENT *Client , char *Format  , ...) ;
#line 22
int IRC_WriteStrClientPrefix(CLIENT *Client , CLIENT *Prefix , char *Format  , ...) ;
#line 25
int IRC_WriteStrChannelPrefix(CLIENT *Client , CHANNEL *Chan , CLIENT *Prefix , int Remote ,
                              char *Format  , ...) ;
#line 28
void IRC_WriteStrServersPrefix(CLIENT *ExceptOf , CLIENT *Prefix , char *Format  , ...) ;
#line 31
int IRC_WriteStrRelatedPrefix(CLIENT *Client , CLIENT *Prefix , int Remote , char *Format 
                              , ...) ;
#line 113 "conf.h"
CONF_CHANNEL Conf_Channel[16] ;
#line 114
unsigned int Conf_Channel_Count ;
#line 20 "hash.h"
UINT32 Hash(char const   *String ) ;
#line 46 "log.h"
__inline static void LogDebug(char const   *Format  __attribute__((__unused__))  , ...) 
{ 

  {
#line 46
  return;
}
}
#line 53 "channel.c"
static CHANNEL *My_Channels  ;
#line 54 "channel.c"
static CL2CHAN *My_Cl2Chan  ;
#line 57
static CL2CHAN *Get_Cl2Chan(CHANNEL *Chan , CLIENT *Client ) ;
#line 58
static CL2CHAN *Add_Client(CHANNEL *Chan , CLIENT *Client ) ;
#line 59
static int Remove_Client(int Type , CHANNEL *Chan , CLIENT *Client , CLIENT *Origin ,
                         char *Reason , int InformServer ) ;
#line 60
static CL2CHAN *Get_First_Cl2Chan(CLIENT *Client , CHANNEL *Chan ) ;
#line 61
static CL2CHAN *Get_Next_Cl2Chan(CL2CHAN *Start , CLIENT *Client , CHANNEL *Channel ) ;
#line 62
static int Delete_Channel(CHANNEL *Chan ) ;
#line 65 "channel.c"
void Channel_Init(void) 
{ 

  {
#line 68
  My_Channels = (CHANNEL *)((void *)0);
#line 69
  My_Cl2Chan = (CL2CHAN *)((void *)0);
#line 70
  return;
}
}
#line 73 "channel.c"
struct list_head *Channel_GetListBans(CHANNEL *c ) 
{ 

  {
#line 77
  return (& c->list_bans);
}
}
#line 81 "channel.c"
struct list_head *Channel_GetListInvites(CHANNEL *c ) 
{ 

  {
#line 85
  return (& c->list_invites);
}
}
#line 89 "channel.c"
void Channel_InitPredefined(void) 
{ CHANNEL *chan ;
  char *c ;
  unsigned int i ;
  int __cil_tmp ;
  void *__cil_tmp___0 ;
  void *__cil_tmp___1 ;
  char *__cil_tmp___2 ;

  {
#line 98
  i = 0U;
#line 98
  while (i < Conf_Channel_Count) {
#line 101
    if (! Conf_Channel[i].name[0]) {
      goto __Cont;
    }
#line 104
    __cil_tmp = Channel_IsValidName((char const   *)(Conf_Channel[i].name));
#line 104
    if (! __cil_tmp) {
#line 106
      Log(3, "Can\'t create pre-defined channel: invalid name: \"%s\"!", Conf_Channel[i].name);
#line 107
      array_free(& Conf_Channel[i].topic);
      goto __Cont;
    }
#line 112
    chan = Channel_Search(Conf_Channel[i].name);
#line 113
    if (chan) {
#line 115
      Log(6, "Can\'t create pre-defined channel \"%s\": name already in use.", Conf_Channel[i].name);
#line 116
      array_free(& Conf_Channel[i].topic);
      goto __Cont;
    }
#line 121
    chan = Channel_Create(Conf_Channel[i].name);
#line 122
    if (chan) {
#line 123
      Channel_ModeAdd(chan, (char )'P');
#line 125
      __cil_tmp___1 = array_start((array const   *)(& Conf_Channel[i].topic));
#line 125
      if ((unsigned int )__cil_tmp___1 != (unsigned int )((void *)0)) {
#line 126
        __cil_tmp___0 = array_start((array const   *)(& Conf_Channel[i].topic));
#line 126
        Channel_SetTopic(chan, (CLIENT *)((void *)0), (char *)__cil_tmp___0);
      }
#line 128
      array_free(& Conf_Channel[i].topic);
#line 130
      c = Conf_Channel[i].modes;
#line 131
      while (*c) {
#line 132
        __cil_tmp___2 = c;
#line 132
        c ++;
#line 132
        Channel_ModeAdd(chan, *__cil_tmp___2);
      }
#line 134
      Channel_SetKey(chan, Conf_Channel[i].key);
#line 135
      Channel_SetMaxUsers(chan, Conf_Channel[i].maxusers);
#line 137
      Log(6, "Created pre-defined channel \"%s\".", Conf_Channel[i].name);
    } else {
#line 140
      Log(3, "Can\'t create pre-defined channel \"%s\"!", Conf_Channel[i].name);
    }
    __Cont: /* CIL Label */ 
#line 98
    i ++;
  }
#line 143
  return;
}
}
#line 146 "channel.c"
void Channel_Exit(void) 
{ CHANNEL *c ;
  CHANNEL *c_next ;
  CL2CHAN *cl2chan ;
  CL2CHAN *cl2chan_next ;

  {
#line 153
  c = My_Channels;
#line 154
  while (c) {
#line 156
    c_next = c->next;
#line 157
    array_free(& c->topic);
#line 158
    free((void *)c);
#line 159
    c = c_next;
  }
#line 163
  cl2chan = My_Cl2Chan;
#line 164
  while (c) {
#line 166
    cl2chan_next = cl2chan->next;
#line 167
    free((void *)cl2chan);
#line 168
    cl2chan = cl2chan_next;
  }
#line 170
  return;
}
}
#line 173 "channel.c"
int Channel_Join(CLIENT *Client , char *Name ) 
{ CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  CL2CHAN *__cil_tmp___1 ;
  CL2CHAN *__cil_tmp___2 ;

  {
#line 181
  __cil_tmp___0 = Channel_IsValidName((char const   *)Name);
#line 181
  if (! __cil_tmp___0) {
#line 182
    __cil_tmp = Client_ID(Client);
#line 182
    IRC_WriteStrClient(Client, (char *)"403 %s %s :No such channel", __cil_tmp, Name);
#line 183
    return (0);
  }
#line 186
  chan = Channel_Search(Name);
#line 187
  if (chan) {
#line 189
    __cil_tmp___1 = Get_Cl2Chan(chan, Client);
#line 189
    if (__cil_tmp___1) {
#line 189
      return (0);
    }
  } else {
#line 194
    chan = Channel_Create(Name);
#line 195
    if (! chan) {
#line 195
      return (0);
    }
  }
#line 199
  __cil_tmp___2 = Add_Client(chan, Client);
#line 199
  if (__cil_tmp___2) {
#line 200
    return (1);
  } else {
#line 199
    return (0);
  }
}
}
#line 204 "channel.c"
int Channel_Part(CLIENT *Client , CLIENT *Origin , char *Name , char *Reason ) 
{ CHANNEL *chan ;
  char *__cil_tmp ;
  CL2CHAN *__cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 213
  chan = Channel_Search(Name);
#line 214
  if (! chan) {
#line 216
    __cil_tmp = Client_ID(Client);
#line 216
    IRC_WriteStrClient(Client, (char *)"403 %s %s :No such channel", __cil_tmp, Name);
#line 217
    return (0);
  } else {
#line 214
    __cil_tmp___0 = Get_Cl2Chan(chan, Client);
#line 214
    if (! __cil_tmp___0) {
#line 216
      __cil_tmp = Client_ID(Client);
#line 216
      IRC_WriteStrClient(Client, (char *)"403 %s %s :No such channel", __cil_tmp,
                         Name);
#line 217
      return (0);
    }
  }
#line 221
  __cil_tmp___1 = Remove_Client(0, chan, Client, Origin, Reason, 1);
#line 221
  if (__cil_tmp___1) {
#line 222
    return (1);
  } else {
#line 221
    return (0);
  }
}
}
#line 226 "channel.c"
void Channel_Kick(CLIENT *Client , CLIENT *Origin , char *Name , char *Reason ) 
{ CHANNEL *chan ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;

  {
#line 236
  chan = Channel_Search(Name);
#line 237
  if (! chan) {
#line 239
    __cil_tmp = Client_ID(Origin);
#line 239
    IRC_WriteStrClient(Origin, (char *)"403 %s %s :No such channel", __cil_tmp, Name);
#line 240
    return;
  }
#line 243
  __cil_tmp___1 = Channel_IsMemberOf(chan, Origin);
#line 243
  if (! __cil_tmp___1) {
#line 245
    __cil_tmp___0 = Client_ID(Origin);
#line 245
    IRC_WriteStrClient(Origin, (char *)"442 %s %s :You are not on that channel", __cil_tmp___0,
                       Name);
#line 246
    return;
  }
#line 250
  __cil_tmp___3 = Channel_UserModes(chan, Origin);
#line 250
  __cil_tmp___4 = strchr((char const   *)__cil_tmp___3, 'o');
#line 250
  if (! __cil_tmp___4) {
#line 252
    __cil_tmp___2 = Client_ID(Origin);
#line 252
    IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                       __cil_tmp___2, Name);
#line 253
    return;
  }
#line 257
  __cil_tmp___7 = Channel_IsMemberOf(chan, Client);
#line 257
  if (! __cil_tmp___7) {
#line 259
    __cil_tmp___5 = Client_ID(Client);
#line 259
    __cil_tmp___6 = Client_ID(Origin);
#line 259
    IRC_WriteStrClient(Origin, (char *)"441 %s %s %s :They aren\'t on that channel",
                       __cil_tmp___6, __cil_tmp___5, Name);
#line 260
    return;
  }
#line 263
  Remove_Client(2, chan, Client, Origin, Reason, 1);
#line 264
  return;
}
}
#line 267 "channel.c"
void Channel_Quit(CLIENT *Client , char *Reason ) 
{ CHANNEL *c ;
  CHANNEL *next_c ;

  {
#line 275
  IRC_WriteStrRelatedPrefix(Client, Client, 0, (char *)"QUIT :%s", Reason);
#line 277
  c = My_Channels;
#line 278
  while (c) {
#line 280
    next_c = c->next;
#line 281
    Remove_Client(1, c, Client, Client, Reason, 0);
#line 282
    c = next_c;
  }
#line 284
  return;
}
}
#line 287 "channel.c"
unsigned long Channel_Count(void) 
{ CHANNEL *c ;
  unsigned long count ;

  {
#line 291
  count = 0UL;
#line 293
  c = My_Channels;
#line 294
  while (c) {
#line 296
    count ++;
#line 297
    c = c->next;
  }
#line 299
  return (count);
}
}
#line 303 "channel.c"
unsigned long Channel_MemberCount(CHANNEL *Chan ) 
{ CL2CHAN *cl2chan ;
  unsigned long count ;

  {
#line 307
  count = 0UL;
#line 311
  cl2chan = My_Cl2Chan;
#line 312
  while (cl2chan) {
#line 314
    if ((unsigned int )cl2chan->channel == (unsigned int )Chan) {
#line 314
      count ++;
    }
#line 315
    cl2chan = cl2chan->next;
  }
#line 317
  return (count);
}
}
#line 321 "channel.c"
int Channel_CountForUser(CLIENT *Client ) 
{ CL2CHAN *cl2chan ;
  int count ;

  {
#line 327
  count = 0;
#line 331
  cl2chan = My_Cl2Chan;
#line 332
  while (cl2chan) {
#line 334
    if ((unsigned int )cl2chan->client == (unsigned int )Client) {
#line 334
      count ++;
    }
#line 335
    cl2chan = cl2chan->next;
  }
#line 338
  return (count);
}
}
#line 343 "channel.c"
char const   *Channel_Name(CHANNEL const   *Chan ) 
{ 

  {
#line 347
  return ((char const   *)(Chan->name));
}
}
#line 351 "channel.c"
char *Channel_Modes(CHANNEL *Chan ) 
{ 

  {
#line 355
  return (Chan->modes);
}
}
#line 359 "channel.c"
char *Channel_Key(CHANNEL *Chan ) 
{ 

  {
#line 363
  return (Chan->key);
}
}
#line 367 "channel.c"
unsigned long Channel_MaxUsers(CHANNEL *Chan ) 
{ 

  {
#line 371
  return (Chan->maxusers);
}
}
#line 375 "channel.c"
CHANNEL *Channel_First(void) 
{ 

  {
#line 378
  return (My_Channels);
}
}
#line 382 "channel.c"
CHANNEL *Channel_Next(CHANNEL *Chan ) 
{ 

  {
#line 386
  return (Chan->next);
}
}
#line 390 "channel.c"
CHANNEL *Channel_Search(char *Name ) 
{ CHANNEL *c ;
  UINT32 search_hash ;
  int __cil_tmp ;

  {
#line 400
  search_hash = Hash((char const   *)Name);
#line 401
  c = My_Channels;
#line 402
  while (c) {
#line 404
    if (search_hash == c->hash) {
#line 407
      __cil_tmp = strcasecmp((char const   *)Name, (char const   *)(c->name));
#line 407
      if (__cil_tmp == 0) {
#line 407
        return (c);
      }
    }
#line 409
    c = c->next;
  }
#line 411
  return ((CHANNEL *)((void *)0));
}
}
#line 415 "channel.c"
CL2CHAN *Channel_FirstMember(CHANNEL *Chan ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 419
  __cil_tmp = Get_First_Cl2Chan((CLIENT *)((void *)0), Chan);
#line 419
  return (__cil_tmp);
}
}
#line 423 "channel.c"
CL2CHAN *Channel_NextMember(CHANNEL *Chan , CL2CHAN *Cl2Chan ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 428
  __cil_tmp = Get_Next_Cl2Chan(Cl2Chan->next, (CLIENT *)((void *)0), Chan);
#line 428
  return (__cil_tmp);
}
}
#line 432 "channel.c"
CL2CHAN *Channel_FirstChannelOf(CLIENT *Client ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 436
  __cil_tmp = Get_First_Cl2Chan(Client, (CHANNEL *)((void *)0));
#line 436
  return (__cil_tmp);
}
}
#line 440 "channel.c"
CL2CHAN *Channel_NextChannelOf(CLIENT *Client , CL2CHAN *Cl2Chan ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 445
  __cil_tmp = Get_Next_Cl2Chan(Cl2Chan->next, Client, (CHANNEL *)((void *)0));
#line 445
  return (__cil_tmp);
}
}
#line 449 "channel.c"
CLIENT *Channel_GetClient(CL2CHAN *Cl2Chan ) 
{ 

  {
#line 453
  return (Cl2Chan->client);
}
}
#line 457 "channel.c"
CHANNEL *Channel_GetChannel(CL2CHAN *Cl2Chan ) 
{ 

  {
#line 461
  return (Cl2Chan->channel);
}
}
#line 465 "channel.c"
int Channel_IsValidName(char const   *Name ) 
{ size_t __cil_tmp ;
  size_t __cil_tmp___0 ;

  {
#line 470
  if ((int const   )*(Name + 0) != 35) {
#line 470
    return (0);
  } else {
#line 470
    __cil_tmp = strlen(Name);
#line 470
    if (__cil_tmp >= 51UL) {
#line 470
      return (0);
    }
  }
#line 472
  __cil_tmp___0 = strcspn(Name, " ,:\a");
#line 472
  return ((int const   )*(Name + __cil_tmp___0) == 0);
}
}
#line 476 "channel.c"
int Channel_ModeAdd(CHANNEL *Chan , char Mode ) 
{ char x[2] ;
  char *__cil_tmp ;

  {
#line 488
  x[0] = Mode;
#line 488
  x[1] = (char )'\000';
#line 489
  __cil_tmp = strchr((char const   *)(Chan->modes), (int )x[0]);
#line 489
  if (__cil_tmp) {
#line 495
    return (0);
  } else {
#line 492
    strlcat(Chan->modes, (char const   *)(x), sizeof(Chan->modes));
#line 493
    return (1);
  }
}
}
#line 499 "channel.c"
int Channel_ModeDel(CHANNEL *Chan , char Mode ) 
{ char *p ;

  {
#line 510
  p = strchr((char const   *)(Chan->modes), (int )Mode);
#line 511
  if (! p) {
#line 511
    return (0);
  }
#line 514
  while (*p) {
#line 516
    *p = *(p + 1);
#line 517
    p ++;
  }
#line 519
  return (1);
}
}
#line 523 "channel.c"
int Channel_UserModeAdd(CHANNEL *Chan , CLIENT *Client , char Mode ) 
{ CL2CHAN *cl2chan ;
  char x[2] ;
  char *__cil_tmp ;

  {
#line 537
  cl2chan = Get_Cl2Chan(Chan, Client);
#line 540
  x[0] = Mode;
#line 540
  x[1] = (char )'\000';
#line 541
  __cil_tmp = strchr((char const   *)(cl2chan->modes), (int )x[0]);
#line 541
  if (__cil_tmp) {
#line 547
    return (0);
  } else {
#line 544
    strlcat(cl2chan->modes, (char const   *)(x), sizeof(cl2chan->modes));
#line 545
    return (1);
  }
}
}
#line 551 "channel.c"
int Channel_UserModeDel(CHANNEL *Chan , CLIENT *Client , char Mode ) 
{ CL2CHAN *cl2chan ;
  char *p ;

  {
#line 565
  cl2chan = Get_Cl2Chan(Chan, Client);
#line 568
  p = strchr((char const   *)(cl2chan->modes), (int )Mode);
#line 569
  if (! p) {
#line 569
    return (0);
  }
#line 572
  while (*p) {
#line 574
    *p = *(p + 1);
#line 575
    p ++;
  }
#line 577
  return (1);
}
}
#line 581 "channel.c"
char *Channel_UserModes(CHANNEL *Chan , CLIENT *Client ) 
{ CL2CHAN *cl2chan ;

  {
#line 591
  cl2chan = Get_Cl2Chan(Chan, Client);
#line 594
  return (cl2chan->modes);
}
}
#line 598 "channel.c"
int Channel_IsMemberOf(CHANNEL *Chan , CLIENT *Client ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 605
  __cil_tmp = Get_Cl2Chan(Chan, Client);
#line 605
  return ((unsigned int )__cil_tmp != (unsigned int )((void *)0));
}
}
#line 609 "channel.c"
char *Channel_Topic(CHANNEL *Chan ) 
{ char *ret ;
  void *__cil_tmp ;
  char const   *__cil_tmp___0 ;

  {
#line 614
  __cil_tmp = array_start((array const   *)(& Chan->topic));
#line 614
  ret = (char *)__cil_tmp;
#line 615
  if (ret) {
#line 615
    __cil_tmp___0 = (char const   *)ret;
  } else {
#line 615
    __cil_tmp___0 = "";
  }
#line 615
  return ((char *)__cil_tmp___0);
}
}
#line 621 "channel.c"
unsigned int Channel_TopicTime(CHANNEL *Chan ) 
{ 

  {
#line 625
  return ((unsigned int )Chan->topic_time);
}
}
#line 629 "channel.c"
char *Channel_TopicWho(CHANNEL *Chan ) 
{ 

  {
#line 633
  return (Chan->topic_who);
}
}
#line 639 "channel.c"
void Channel_SetTopic(CHANNEL *Chan , CLIENT *Client , char *Topic ) 
{ size_t len ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 646
  len = strlen((char const   *)Topic);
#line 647
  if (len < Chan->topic.used) {
#line 648
    array_free(& Chan->topic);
  }
#line 650
  if (len >= 513UL) {
#line 651
    __cil_tmp = __error();
#line 651
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 651
    Log(4, "could not set new Topic \"%s\" on %s: %s", Topic, Chan->name, __cil_tmp___0);
  } else {
#line 650
    __cil_tmp___1 = array_copyb(& Chan->topic, (char const   *)Topic, len + 1UL);
#line 650
    if (! __cil_tmp___1) {
#line 651
      __cil_tmp = __error();
#line 651
      __cil_tmp___0 = strerror(*__cil_tmp);
#line 651
      Log(4, "could not set new Topic \"%s\" on %s: %s", Topic, Chan->name, __cil_tmp___0);
    }
  }
#line 654
  Chan->topic_time = time((time_t *)((void *)0));
#line 655
  if ((unsigned int )Client != (unsigned int )((void *)0)) {
#line 655
    __cil_tmp___3 = Client_Type(Client);
#line 655
    if (__cil_tmp___3 != 32) {
#line 656
      __cil_tmp___2 = Client_ID(Client);
#line 656
      strlcpy(Chan->topic_who, (char const   *)__cil_tmp___2, sizeof(Chan->topic_who));
    } else {
#line 659
      strlcpy(Chan->topic_who, "-Server-", sizeof(Chan->topic_who));
    }
  } else {
#line 659
    strlcpy(Chan->topic_who, "-Server-", sizeof(Chan->topic_who));
  }
#line 664
  return;
}
}
#line 667 "channel.c"
void Channel_SetModes(CHANNEL *Chan , char *Modes ) 
{ 

  {
#line 673
  strlcpy(Chan->modes, (char const   *)Modes, sizeof(Chan->modes));
#line 674
  return;
}
}
#line 677 "channel.c"
void Channel_SetKey(CHANNEL *Chan , char *Key ) 
{ 

  {
#line 683
  strlcpy(Chan->key, (char const   *)Key, sizeof(Chan->key));
#line 684
  LogDebug("Channel %s: Key is now \"%s\".", Chan->name, Chan->key);
#line 685
  return;
}
}
#line 688 "channel.c"
void Channel_SetMaxUsers(CHANNEL *Chan , unsigned long Count___0 ) 
{ 

  {
#line 693
  Chan->maxusers = Count___0;
#line 694
  LogDebug("Channel %s: Member limit is now %lu.", Chan->name, Chan->maxusers);
#line 695
  return;
}
}
#line 698 "channel.c"
int Channel_Write(CHANNEL *Chan , CLIENT *From , CLIENT *Client , char *Text ) 
{ int is_member ;
  int has_voice ;
  int is_op ;
  int ok ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  char const   *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  CONN_ID __cil_tmp___12 ;
  CONN_ID __cil_tmp___13 ;
  char const   *__cil_tmp___14 ;
  int __cil_tmp___15 ;

  {
#line 704
  is_op = 0;
#line 704
  has_voice = is_op;
#line 704
  is_member = has_voice;
#line 705
  __cil_tmp___3 = Channel_IsMemberOf(Chan, From);
#line 705
  if (__cil_tmp___3) {
#line 707
    is_member = 1;
#line 708
    __cil_tmp = Channel_UserModes(Chan, From);
#line 708
    __cil_tmp___0 = strchr((char const   *)__cil_tmp, 'v');
#line 708
    if (__cil_tmp___0) {
#line 708
      has_voice = 1;
    }
#line 709
    __cil_tmp___1 = Channel_UserModes(Chan, From);
#line 709
    __cil_tmp___2 = strchr((char const   *)__cil_tmp___1, 'o');
#line 709
    if (__cil_tmp___2) {
#line 709
      is_op = 1;
    }
  }
#line 713
  ok = 1;
#line 714
  __cil_tmp___4 = Channel_Modes(Chan);
#line 714
  __cil_tmp___5 = strchr((char const   *)__cil_tmp___4, 'n');
#line 714
  if (__cil_tmp___5) {
#line 714
    if (! is_member) {
#line 714
      ok = 0;
    }
  }
#line 715
  __cil_tmp___6 = Channel_Modes(Chan);
#line 715
  __cil_tmp___7 = strchr((char const   *)__cil_tmp___6, 'm');
#line 715
  if (__cil_tmp___7) {
#line 715
    if (! is_op) {
#line 715
      if (! has_voice) {
#line 715
        ok = 0;
      }
    }
  }
#line 718
  __cil_tmp___8 = Lists_Check(& Chan->list_bans, From);
#line 718
  if (__cil_tmp___8) {
#line 721
    if (! has_voice) {
#line 721
      if (! is_op) {
#line 721
        ok = 0;
      }
    }
  }
#line 724
  if (! ok) {
#line 724
    __cil_tmp___9 = Channel_Name((CHANNEL const   *)Chan);
#line 724
    __cil_tmp___10 = Client_ID(From);
#line 724
    __cil_tmp___11 = IRC_WriteStrClient(From, (char *)"404 %s %s :Cannot send to channel",
                                        __cil_tmp___10, __cil_tmp___9);
#line 724
    return (__cil_tmp___11);
  }
#line 727
  __cil_tmp___13 = Client_Conn(From);
#line 727
  if (__cil_tmp___13 > -1) {
#line 727
    __cil_tmp___12 = Client_Conn(From);
#line 727
    Conn_UpdateIdle(__cil_tmp___12);
  }
#line 728
  __cil_tmp___14 = Channel_Name((CHANNEL const   *)Chan);
#line 728
  __cil_tmp___15 = IRC_WriteStrChannelPrefix(Client, Chan, From, 1, (char *)"PRIVMSG %s :%s",
                                             __cil_tmp___14, Text);
#line 728
  return (__cil_tmp___15);
}
}
#line 732 "channel.c"
CHANNEL *Channel_Create(char *Name ) 
{ CHANNEL *c ;
  void *__cil_tmp ;

  {
#line 740
  __cil_tmp = malloc(sizeof(CHANNEL ));
#line 740
  c = (CHANNEL *)__cil_tmp;
#line 741
  if (! c) {
#line 743
    Log(0, "Can\'t allocate memory! [New_Chan]");
#line 744
    return ((CHANNEL *)((void *)0));
  }
#line 746
  memset((void *)c, 0, sizeof(CHANNEL ));
#line 747
  strlcpy(c->name, (char const   *)Name, sizeof(c->name));
#line 748
  c->hash = Hash((char const   *)(c->name));
#line 749
  c->next = My_Channels;
#line 750
  My_Channels = c;
#line 751
  LogDebug("Created new channel structure for \"%s\".", Name);
#line 752
  return (c);
}
}
#line 756 "channel.c"
static CL2CHAN *Get_Cl2Chan(CHANNEL *Chan , CLIENT *Client ) 
{ CL2CHAN *cl2chan ;

  {
#line 764
  cl2chan = My_Cl2Chan;
#line 765
  while (cl2chan) {
#line 767
    if ((unsigned int )cl2chan->channel == (unsigned int )Chan) {
#line 767
      if ((unsigned int )cl2chan->client == (unsigned int )Client) {
#line 767
        return (cl2chan);
      }
    }
#line 768
    cl2chan = cl2chan->next;
  }
#line 770
  return ((CL2CHAN *)((void *)0));
}
}
#line 774 "channel.c"
static CL2CHAN *Add_Client(CHANNEL *Chan , CLIENT *Client ) 
{ CL2CHAN *cl2chan ;
  void *__cil_tmp ;
  char *__cil_tmp___0 ;

  {
#line 783
  __cil_tmp = malloc(sizeof(CL2CHAN ));
#line 783
  cl2chan = (CL2CHAN *)__cil_tmp;
#line 784
  if (! cl2chan) {
#line 786
    Log(0, "Can\'t allocate memory! [Add_Client]");
#line 787
    return ((CL2CHAN *)((void *)0));
  }
#line 789
  cl2chan->channel = Chan;
#line 790
  cl2chan->client = Client;
#line 791
  strcpy(cl2chan->modes, "");
#line 794
  cl2chan->next = My_Cl2Chan;
#line 795
  My_Cl2Chan = cl2chan;
#line 797
  __cil_tmp___0 = Client_Mask(Client);
#line 797
  Log(7, "User \"%s\" joined channel \"%s\".", __cil_tmp___0, Chan->name);
#line 799
  return (cl2chan);
}
}
#line 803 "channel.c"
static int Remove_Client(int Type , CHANNEL *Chan , CLIENT *Client , CLIENT *Origin ,
                         char *Reason , int InformServer ) 
{ CL2CHAN *cl2chan ;
  CL2CHAN *last_cl2chan ;
  CHANNEL *c ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  CLIENT *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  CONN_ID __cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  CONN_ID __cil_tmp___9 ;
  int __cil_tmp___10 ;
  CL2CHAN *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  char *__cil_tmp___13 ;

  {
#line 814
  last_cl2chan = (CL2CHAN *)((void *)0);
#line 815
  cl2chan = My_Cl2Chan;
#line 816
  while (cl2chan) {
#line 818
    if ((unsigned int )cl2chan->channel == (unsigned int )Chan) {
#line 818
      if ((unsigned int )cl2chan->client == (unsigned int )Client) {
#line 818
        break;
      }
    }
#line 819
    last_cl2chan = cl2chan;
#line 820
    cl2chan = cl2chan->next;
  }
#line 822
  if (! cl2chan) {
#line 822
    return (0);
  }
#line 824
  c = cl2chan->channel;
#line 828
  if (last_cl2chan) {
#line 828
    last_cl2chan->next = cl2chan->next;
  } else {
#line 829
    My_Cl2Chan = cl2chan->next;
  }
#line 830
  free((void *)cl2chan);
#line 832
  switch (Type) {
  case 1: 
#line 838
  __cil_tmp = Client_Mask(Client);
#line 838
  LogDebug("User \"%s\" left channel \"%s\" (%s).", __cil_tmp, c->name, Reason);
#line 840
  break;
  case 2: 
#line 843
  if (InformServer) {
#line 844
    __cil_tmp___0 = Client_ID(Client);
#line 844
    __cil_tmp___1 = Client_NextHop(Origin);
#line 844
    IRC_WriteStrServersPrefix(__cil_tmp___1, Origin, (char *)"KICK %s %s :%s", c->name,
                              __cil_tmp___0, Reason);
  }
#line 846
  __cil_tmp___2 = Client_ID(Client);
#line 846
  IRC_WriteStrChannelPrefix(Client, c, Origin, 0, (char *)"KICK %s %s :%s", c->name,
                            __cil_tmp___2, Reason);
#line 848
  __cil_tmp___4 = Client_Conn(Client);
#line 848
  if (__cil_tmp___4 > -1) {
#line 848
    __cil_tmp___5 = Client_Type(Client);
#line 848
    if (__cil_tmp___5 == 16) {
#line 851
      __cil_tmp___3 = Client_ID(Client);
#line 851
      IRC_WriteStrClientPrefix(Client, Origin, (char *)"KICK %s %s :%s", c->name,
                               __cil_tmp___3, Reason);
    }
  }
#line 854
  __cil_tmp___6 = Client_ID(Origin);
#line 854
  __cil_tmp___7 = Client_Mask(Client);
#line 854
  LogDebug("User \"%s\" has been kicked of \"%s\" by \"%s\": %s.", __cil_tmp___7,
           c->name, __cil_tmp___6, Reason);
#line 856
  break;
  default: ;
#line 858
  if (InformServer) {
#line 859
    IRC_WriteStrServersPrefix(Origin, Client, (char *)"PART %s :%s", c->name, Reason);
  }
#line 861
  IRC_WriteStrChannelPrefix(Origin, c, Client, 0, (char *)"PART %s :%s", c->name,
                            Reason);
#line 864
  __cil_tmp___9 = Client_Conn(Origin);
#line 864
  if (__cil_tmp___9 > -1) {
#line 864
    __cil_tmp___10 = Client_Type(Origin);
#line 864
    if (__cil_tmp___10 == 16) {
#line 867
      IRC_WriteStrClientPrefix(Origin, Client, (char *)"PART %s :%s", c->name, Reason);
#line 868
      __cil_tmp___8 = Client_Mask(Client);
#line 868
      LogDebug("User \"%s\" left channel \"%s\" (%s).", __cil_tmp___8, c->name, Reason);
    }
  }
  }
#line 874
  __cil_tmp___12 = Channel_Modes(Chan);
#line 874
  __cil_tmp___13 = strchr((char const   *)__cil_tmp___12, 'P');
#line 874
  if (! __cil_tmp___13) {
#line 876
    __cil_tmp___11 = Get_First_Cl2Chan((CLIENT *)((void *)0), Chan);
#line 876
    if (! __cil_tmp___11) {
#line 876
      Delete_Channel(Chan);
    }
  }
#line 879
  return (1);
}
}
#line 883 "channel.c"
int Channel_AddBan(CHANNEL *c , char const   *mask ) 
{ struct list_head *h ;
  struct list_head *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 886
  __cil_tmp = Channel_GetListBans(c);
#line 886
  h = __cil_tmp;
#line 887
  __cil_tmp___0 = Lists_Add(h, mask, 0);
#line 887
  return (__cil_tmp___0);
}
}
#line 891 "channel.c"
int Channel_AddInvite(CHANNEL *c , char const   *mask , int onlyonce ) 
{ struct list_head *h ;
  struct list_head *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 894
  __cil_tmp = Channel_GetListInvites(c);
#line 894
  h = __cil_tmp;
#line 895
  __cil_tmp___0 = Lists_Add(h, mask, onlyonce);
#line 895
  return (__cil_tmp___0);
}
}
#line 899 "channel.c"
static int ShowInvitesBans(struct list_head *head , CLIENT *Client , CHANNEL *Channel ,
                           int invite ) 
{ struct list_elem *e ;
  char *msg ;
  char const   *__cil_tmp ;
  char *msg_end ;
  char const   *__cil_tmp___0 ;
  char const   *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char const   *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 903
  if (invite) {
#line 903
    __cil_tmp = "346 %s %s %s";
  } else {
#line 903
    __cil_tmp = "367 %s %s %s";
  }
#line 903
  msg = (char *)__cil_tmp;
#line 909
  e = Lists_GetFirst((struct list_head  const  *)head);
#line 910
  while (e) {
#line 911
    __cil_tmp___0 = Lists_GetMask((struct list_elem  const  *)e);
#line 911
    __cil_tmp___1 = Channel_Name((CHANNEL const   *)Channel);
#line 911
    __cil_tmp___2 = Client_ID(Client);
#line 911
    __cil_tmp___3 = IRC_WriteStrClient(Client, msg, __cil_tmp___2, __cil_tmp___1,
                                       __cil_tmp___0);
#line 911
    if (! __cil_tmp___3) {
#line 912
      return (0);
    }
#line 913
    e = Lists_GetNext((struct list_elem  const  *)e);
  }
#line 916
  if (invite) {
#line 916
    msg_end = (char *)"347 %s %s :End of channel invite list";
  } else {
#line 916
    msg_end = (char *)"368 %s %s :End of channel ban list";
  }
#line 917
  __cil_tmp___4 = Channel_Name((CHANNEL const   *)Channel);
#line 917
  __cil_tmp___5 = Client_ID(Client);
#line 917
  __cil_tmp___6 = IRC_WriteStrClient(Client, msg_end, __cil_tmp___5, __cil_tmp___4);
#line 917
  return (__cil_tmp___6);
}
}
#line 921 "channel.c"
int Channel_ShowBans(CLIENT *Client , CHANNEL *Channel ) 
{ struct list_head *h ;
  int __cil_tmp ;

  {
#line 928
  h = Channel_GetListBans(Channel);
#line 929
  __cil_tmp = ShowInvitesBans(h, Client, Channel, 0);
#line 929
  return (__cil_tmp);
}
}
#line 933 "channel.c"
int Channel_ShowInvites(CLIENT *Client , CHANNEL *Channel ) 
{ struct list_head *h ;
  int __cil_tmp ;

  {
#line 940
  h = Channel_GetListInvites(Channel);
#line 941
  __cil_tmp = ShowInvitesBans(h, Client, Channel, 1);
#line 941
  return (__cil_tmp);
}
}
#line 945 "channel.c"
static CL2CHAN *Get_First_Cl2Chan(CLIENT *Client , CHANNEL *Chan ) 
{ CL2CHAN *__cil_tmp ;

  {
#line 948
  __cil_tmp = Get_Next_Cl2Chan(My_Cl2Chan, Client, Chan);
#line 948
  return (__cil_tmp);
}
}
#line 952 "channel.c"
static CL2CHAN *Get_Next_Cl2Chan(CL2CHAN *Start , CLIENT *Client , CHANNEL *Channel ) 
{ CL2CHAN *cl2chan ;

  {
#line 959
  cl2chan = Start;
#line 960
  while (cl2chan) {
#line 962
    if (Client) {
#line 962
      if ((unsigned int )cl2chan->client == (unsigned int )Client) {
#line 962
        return (cl2chan);
      }
    }
#line 963
    if (Channel) {
#line 963
      if ((unsigned int )cl2chan->channel == (unsigned int )Channel) {
#line 963
        return (cl2chan);
      }
    }
#line 964
    cl2chan = cl2chan->next;
  }
#line 966
  return ((CL2CHAN *)((void *)0));
}
}
#line 970 "channel.c"
static int Delete_Channel(CHANNEL *Chan ) 
{ CHANNEL *chan ;
  CHANNEL *last_chan ;

  {
#line 977
  last_chan = (CHANNEL *)((void *)0);
#line 978
  chan = My_Channels;
#line 979
  while (chan) {
#line 981
    if ((unsigned int )chan == (unsigned int )Chan) {
#line 981
      break;
    }
#line 982
    last_chan = chan;
#line 983
    chan = chan->next;
  }
#line 985
  if (! chan) {
#line 985
    return (0);
  }
#line 987
  Log(7, "Freed channel structure for \"%s\".", Chan->name);
#line 990
  Lists_Free(& chan->list_bans);
#line 991
  Lists_Free(& chan->list_invites);
#line 994
  if (last_chan) {
#line 994
    last_chan->next = chan->next;
  } else {
#line 995
    My_Channels = chan->next;
  }
#line 996
  free((void *)chan);
#line 998
  return (1);
}
}
#line 1 "client.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-gzU1JIoa.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 451 "/usr/include/unistd.h"
extern int gethostname(char * , size_t  ) ;
#line 268 "/usr/include/netdb.h"
extern struct hostent *gethostbyname(char const   * ) ;
#line 78 "client.h"
CLIENT *Client_NewLocal(CONN_ID Idx , char *Hostname , int Type , int Idented ) ;
#line 79
CLIENT *Client_NewRemoteServer(CLIENT *Introducer , char *Hostname , CLIENT *TopServer ,
                               int Hops , int Token , char *Info , int Idented ) ;
#line 80
CLIENT *Client_NewRemoteUser(CLIENT *Introducer , char *Nick , int Hops , char *User ,
                             char *Hostname , int Token , char *Modes , char *Info ,
                             int Idented ) ;
#line 82
void Client_Destroy(CLIENT *Client , char *LogMsg , char *FwdMsg , int SendQuit ) ;
#line 84
CLIENT *Client_ThisServer(void) ;
#line 86
CLIENT *Client_GetFromToken(CLIENT *Client , int Token ) ;
#line 88
CLIENT *Client_Search(char *Nick ) ;
#line 89
CLIENT *Client_First(void) ;
#line 90
CLIENT *Client_Next(CLIENT *c ) ;
#line 96
char *Client_Info(CLIENT *Client ) ;
#line 97
char *Client_User(CLIENT *Client ) ;
#line 98
char *Client_Hostname(CLIENT *Client ) ;
#line 99
char *Client_Password(CLIENT *Client ) ;
#line 100
char *Client_Modes(CLIENT *Client ) ;
#line 101
char *Client_Flags(CLIENT *Client ) ;
#line 102
CLIENT *Client_Introducer(CLIENT *Client ) ;
#line 103
int Client_OperByMe(CLIENT *Client ) ;
#line 104
int Client_Hops(CLIENT *Client ) ;
#line 105
int Client_Token(CLIENT *Client ) ;
#line 106
int Client_MyToken(CLIENT *Client ) ;
#line 107
CLIENT *Client_TopServer(CLIENT *Client ) ;
#line 109
char *Client_Away(CLIENT *Client ) ;
#line 110
time_t Client_StartTime(CLIENT *Client ) ;
#line 112
int Client_HasMode(CLIENT *Client , char Mode ) ;
#line 114
void Client_SetHostname(CLIENT *Client , char *Hostname ) ;
#line 115
void Client_SetID(CLIENT *Client , char *ID ) ;
#line 116
void Client_SetUser(CLIENT *Client , char *User , int Idented ) ;
#line 117
void Client_SetInfo(CLIENT *Client , char *Info ) ;
#line 118
void Client_SetPassword(CLIENT *Client , char *Pwd ) ;
#line 119
void Client_SetType(CLIENT *Client , int Type ) ;
#line 120
void Client_SetHops(CLIENT *Client , int Hops ) ;
#line 121
void Client_SetToken(CLIENT *Client , int Token ) ;
#line 122
void Client_SetOperByMe(CLIENT *Client , int OperByMe ) ;
#line 123
void Client_SetModes(CLIENT *Client , char *Modes ) ;
#line 124
void Client_SetFlags(CLIENT *Client , char *Flags ) ;
#line 125
void Client_SetIntroducer(CLIENT *Client , CLIENT *Introducer ) ;
#line 126
void Client_SetAway(CLIENT *Client , char *Txt ) ;
#line 128
int Client_ModeAdd(CLIENT *Client , char Mode ) ;
#line 129
int Client_ModeDel(CLIENT *Client , char Mode ) ;
#line 131
int Client_CheckNick(CLIENT *Client , char *Nick ) ;
#line 132
int Client_CheckID(CLIENT *Client , char *ID ) ;
#line 134
long Client_UserCount(void) ;
#line 135
long Client_ServiceCount(void) ;
#line 136
long Client_ServerCount(void) ;
#line 137
unsigned long Client_OperCount(void) ;
#line 138
unsigned long Client_UnknownCount(void) ;
#line 139
long Client_MyUserCount(void) ;
#line 140
long Client_MyServiceCount(void) ;
#line 141
unsigned long Client_MyServerCount(void) ;
#line 142
long Client_MaxUserCount(void) ;
#line 143
long Client_MyMaxUserCount(void) ;
#line 145
int Client_IsValidNick(char const   *Nick ) ;
#line 147
WHOWAS *Client_GetWhowas(void) ;
#line 148
int Client_GetLastWhowasIndex(void) ;
#line 150
void Client_RegisterWhowas(CLIENT *Client ) ;
#line 94 "conn.h"
void Conn_Close(CONN_ID Idx , char *LogMsg , char *FwdMsg , int InformClient ) ;
#line 66 "conf.h"
char Conf_ServerInfo[64] ;
#line 122
int Conf_NoDNS ;
#line 53 "client.c"
static CLIENT *This_Server  ;
#line 53 "client.c"
static CLIENT *My_Clients  ;
#line 54 "client.c"
static char GetID_Buffer[106]  ;
#line 56 "client.c"
static WHOWAS My_Whowas[64]  ;
#line 57 "client.c"
static int Last_Whowas  =    -1;
#line 60
static unsigned long Count(int Type ) ;
#line 61
static unsigned long MyCount(int Type ) ;
#line 63
static CLIENT *New_Client_Struct(void) ;
#line 64
static void Generate_MyToken(CLIENT *Client ) ;
#line 65
static void Adjust_Counters(CLIENT *Client ) ;
#line 67
static CLIENT *Init_New_Client(CONN_ID Idx , CLIENT *Introducer , CLIENT *TopServer ,
                               int Type , char *ID , char *User , char *Hostname ,
                               char *Info , int Hops , int Token , char *Modes , int Idented ) ;
#line 72 "client.c"
long Max_Users  =    0L;
#line 72 "client.c"
long My_Max_Users  =    0L;
#line 75 "client.c"
void Client_Init(void) 
{ struct hostent *h ;

  {
#line 80
  This_Server = New_Client_Struct();
#line 81
  if (! This_Server) {
#line 83
    Log(0, "Can\'t allocate client structure for server! Going down.");
#line 84
    Log(1, "%s exiting due to fatal errors!", "ngircd");
#line 85
    exit(1);
  }
#line 89
  This_Server->next = (void *)0;
#line 90
  This_Server->type = 32;
#line 91
  This_Server->conn_id = -1;
#line 92
  This_Server->introducer = This_Server;
#line 93
  This_Server->mytoken = 1;
#line 94
  This_Server->hops = 0;
#line 96
  gethostname(This_Server->host, 64UL);
#line 97
  if (! Conf_NoDNS) {
#line 98
    h = gethostbyname((char const   *)(This_Server->host));
#line 99
    if (h) {
#line 99
      strlcpy(This_Server->host, (char const   *)h->h_name, sizeof(This_Server->host));
    }
  }
#line 101
  Client_SetID(This_Server, Conf_ServerName);
#line 102
  Client_SetInfo(This_Server, Conf_ServerInfo);
#line 104
  My_Clients = This_Server;
#line 106
  memset((void *)(& My_Whowas), 0, sizeof(My_Whowas));
#line 107
  return;
}
}
#line 110 "client.c"
void Client_Exit(void) 
{ CLIENT *c ;
  CLIENT *next ;
  int cnt ;
  char const   *__cil_tmp ;

  {
#line 116
  if (NGIRCd_SignalRestart) {
#line 116
    Client_Destroy(This_Server, (char *)"Server going down (restarting).", (char *)((void *)0),
                   0);
  } else {
#line 117
    Client_Destroy(This_Server, (char *)"Server going down.", (char *)((void *)0),
                   0);
  }
#line 119
  cnt = 0;
#line 120
  c = My_Clients;
#line 121
  while (c) {
#line 123
    cnt ++;
#line 124
    next = (CLIENT *)c->next;
#line 125
    free((void *)c);
#line 126
    c = next;
  }
#line 128
  if (cnt) {
#line 128
    if (cnt == 1) {
#line 128
      __cil_tmp = "";
    } else {
#line 128
      __cil_tmp = "s";
    }
#line 128
    Log(6, "Freed %d client structure%s.", cnt, __cil_tmp);
  }
#line 129
  return;
}
}
#line 132 "client.c"
CLIENT *Client_ThisServer(void) 
{ 

  {
#line 135
  return (This_Server);
}
}
#line 143 "client.c"
CLIENT *Client_NewLocal(CONN_ID Idx , char *Hostname , int Type , int Idented ) 
{ CLIENT *__cil_tmp ;

  {
#line 146
  __cil_tmp = Init_New_Client(Idx, This_Server, (CLIENT *)((void *)0), Type, (char *)((void *)0),
                              (char *)((void *)0), Hostname, (char *)((void *)0),
                              0, 0, (char *)((void *)0), Idented);
#line 146
  return (__cil_tmp);
}
}
#line 155 "client.c"
CLIENT *Client_NewRemoteServer(CLIENT *Introducer , char *Hostname , CLIENT *TopServer ,
                               int Hops , int Token , char *Info , int Idented ) 
{ CLIENT *__cil_tmp ;

  {
#line 159
  __cil_tmp = Init_New_Client(-1, Introducer, TopServer, 32, Hostname, (char *)((void *)0),
                              Hostname, Info, Hops, Token, (char *)((void *)0), Idented);
#line 159
  return (__cil_tmp);
}
}
#line 168 "client.c"
CLIENT *Client_NewRemoteUser(CLIENT *Introducer , char *Nick , int Hops , char *User ,
                             char *Hostname , int Token , char *Modes , char *Info ,
                             int Idented ) 
{ CLIENT *__cil_tmp ;

  {
#line 172
  __cil_tmp = Init_New_Client(-1, Introducer, (CLIENT *)((void *)0), 16, Nick, User,
                              Hostname, Info, Hops, Token, Modes, Idented);
#line 172
  return (__cil_tmp);
}
}
#line 182 "client.c"
static CLIENT *Init_New_Client(CONN_ID Idx , CLIENT *Introducer , CLIENT *TopServer ,
                               int Type , char *ID , char *User , char *Hostname ,
                               char *Info , int Hops , int Token , char *Modes , int Idented ) 
{ CLIENT *client ;
  char *__cil_tmp ;

  {
#line 193
  client = New_Client_Struct();
#line 194
  if (! client) {
#line 194
    return ((CLIENT *)((void *)0));
  }
#line 197
  client->starttime = time((time_t *)((void *)0));
#line 198
  client->conn_id = Idx;
#line 199
  client->introducer = Introducer;
#line 200
  client->topserver = TopServer;
#line 201
  client->type = Type;
#line 202
  if (ID) {
#line 202
    Client_SetID(client, ID);
  }
#line 203
  if (User) {
#line 203
    Client_SetUser(client, User, Idented);
  }
#line 204
  if (Hostname) {
#line 204
    Client_SetHostname(client, Hostname);
  }
#line 205
  if (Info) {
#line 205
    Client_SetInfo(client, Info);
  }
#line 206
  client->hops = Hops;
#line 207
  client->token = Token;
#line 208
  if (Modes) {
#line 208
    Client_SetModes(client, Modes);
  }
#line 209
  if (Type == 32) {
#line 209
    Generate_MyToken(client);
  }
#line 211
  __cil_tmp = strchr((char const   *)(client->modes), 'a');
#line 211
  if (__cil_tmp) {
#line 212
    strlcpy(client->away, "Away", sizeof(client->away));
  }
#line 215
  client->next = (POINTER *)My_Clients;
#line 216
  My_Clients = client;
#line 219
  Adjust_Counters(client);
#line 221
  return (client);
}
}
#line 225 "client.c"
void Client_Destroy(CLIENT *Client , char *LogMsg , char *FwdMsg , int SendQuit ) 
{ CLIENT *last ;
  CLIENT *c ;
  char msg[256] ;
  char *txt ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  CLIENT *__cil_tmp___1 ;
  CLIENT *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  CLIENT *__cil_tmp___4 ;
  CLIENT *__cil_tmp___5 ;
  char const   *__cil_tmp___6 ;

  {
#line 235
  if (LogMsg) {
#line 235
    txt = LogMsg;
  } else {
#line 236
    txt = FwdMsg;
  }
#line 237
  if (! txt) {
#line 237
    txt = (char *)"Reason unknown.";
  }
#line 240
  if (Client->type == 32) {
#line 241
    strlcpy(msg, (char const   *)(This_Server->id), sizeof(msg));
#line 242
    strlcat(msg, " ", sizeof(msg));
#line 243
    strlcat(msg, (char const   *)(Client->id), sizeof(msg));
  }
#line 246
  last = (CLIENT *)((void *)0);
#line 247
  c = My_Clients;
#line 248
  while (c) {
#line 250
    if (Client->type == 32) {
#line 250
      if ((unsigned int )c->introducer == (unsigned int )Client) {
#line 250
        if ((unsigned int )c != (unsigned int )Client) {
#line 254
          Client_Destroy(c, (char *)((void *)0), msg, 0);
#line 255
          last = (CLIENT *)((void *)0);
#line 256
          c = My_Clients;
#line 257
          continue;
        }
      }
    }
#line 259
    if ((unsigned int )c == (unsigned int )Client) {
#line 262
      if (last) {
#line 262
        last->next = c->next;
      } else {
#line 263
        My_Clients = (CLIENT *)c->next;
      }
#line 265
      if (c->type == 16) {
#line 267
        if (c->conn_id != -1) {
#line 270
          __cil_tmp = Client_Mask(c);
#line 270
          Log(5, "User \"%s\" unregistered (connection %d): %s", __cil_tmp, c->conn_id,
              txt);
#line 272
          if (SendQuit) {
#line 275
            if (FwdMsg) {
#line 275
              IRC_WriteStrServersPrefix((CLIENT *)((void *)0), c, (char *)"QUIT :%s",
                                        FwdMsg);
            } else {
#line 276
              IRC_WriteStrServersPrefix((CLIENT *)((void *)0), c, (char *)"QUIT :");
            }
          }
        } else {
#line 282
          __cil_tmp___0 = Client_Mask(c);
#line 282
          Log(7, "User \"%s\" unregistered: %s", __cil_tmp___0, txt);
#line 284
          if (SendQuit) {
#line 289
            if (FwdMsg) {
#line 289
              __cil_tmp___1 = Client_NextHop(c);
#line 289
              IRC_WriteStrServersPrefix(__cil_tmp___1, c, (char *)"QUIT :%s", FwdMsg);
            } else {
#line 290
              __cil_tmp___2 = Client_NextHop(c);
#line 290
              IRC_WriteStrServersPrefix(__cil_tmp___2, c, (char *)"QUIT :");
            }
          }
        }
#line 295
        if (FwdMsg) {
#line 295
          __cil_tmp___3 = FwdMsg;
        } else {
#line 295
          __cil_tmp___3 = c->id;
        }
#line 295
        Channel_Quit(c, __cil_tmp___3);
#line 298
        Client_RegisterWhowas(c);
      } else {
#line 300
        if (c->type == 32) {
#line 302
          if ((unsigned int )c != (unsigned int )This_Server) {
#line 304
            if (c->conn_id != -1) {
#line 304
              Log(1029, "Server \"%s\" unregistered (connection %d): %s", c->id, c->conn_id,
                  txt);
            } else {
#line 305
              Log(1029, "Server \"%s\" unregistered: %s", c->id, txt);
            }
          }
#line 309
          if (! NGIRCd_SignalQuit) {
#line 311
            if (FwdMsg) {
#line 311
              __cil_tmp___4 = Client_NextHop(c);
#line 311
              IRC_WriteStrServersPrefix(__cil_tmp___4, c, (char *)"SQUIT %s :%s",
                                        c->id, FwdMsg);
            } else {
#line 312
              __cil_tmp___5 = Client_NextHop(c);
#line 312
              IRC_WriteStrServersPrefix(__cil_tmp___5, c, (char *)"SQUIT %s :", c->id);
            }
          }
        } else {
#line 317
          if (c->conn_id != -1) {
#line 319
            if (c->id[0]) {
#line 319
              Log(5, "Client \"%s\" unregistered (connection %d): %s", c->id, c->conn_id,
                  txt);
            } else {
#line 320
              Log(5, "Client unregistered (connection %d): %s", c->conn_id, txt);
            }
          } else {
#line 322
            if (c->id[0]) {
#line 322
              __cil_tmp___6 = (char const   *)(c->id);
            } else {
#line 322
              __cil_tmp___6 = "(No Nick)";
            }
#line 322
            Log(4, "Unregistered unknown client \"%s\": %s", __cil_tmp___6, txt);
          }
        }
      }
#line 327
      free((void *)c);
#line 328
      break;
    }
#line 330
    last = c;
#line 331
    c = (CLIENT *)c->next;
  }
#line 333
  return;
}
}
#line 336 "client.c"
void Client_SetHostname(CLIENT *Client , char *Hostname ) 
{ 

  {
#line 344
  strlcpy(Client->host, (char const   *)Hostname, sizeof(Client->host));
#line 345
  return;
}
}
#line 348 "client.c"
void Client_SetID(CLIENT *Client , char *ID ) 
{ 

  {
#line 356
  strlcpy(Client->id, (char const   *)ID, sizeof(Client->id));
#line 359
  Client->hash = Hash((char const   *)(Client->id));
#line 360
  return;
}
}
#line 363 "client.c"
void Client_SetUser(CLIENT *Client , char *User , int Idented ) 
{ 

  {
#line 371
  if (Idented) {
#line 371
    strlcpy(Client->user, (char const   *)User, sizeof(Client->user));
  } else {
#line 374
    Client->user[0] = (char )'~';
#line 375
    strlcpy(Client->user + 1, (char const   *)User, sizeof(Client->user) - 1UL);
  }
#line 377
  return;
}
}
#line 380 "client.c"
void Client_SetInfo(CLIENT *Client , char *Info ) 
{ 

  {
#line 388
  strlcpy(Client->info, (char const   *)Info, sizeof(Client->info));
#line 389
  return;
}
}
#line 392 "client.c"
void Client_SetModes(CLIENT *Client , char *Modes ) 
{ 

  {
#line 400
  strlcpy(Client->modes, (char const   *)Modes, sizeof(Client->modes));
#line 401
  return;
}
}
#line 404 "client.c"
void Client_SetFlags(CLIENT *Client , char *Flags ) 
{ 

  {
#line 412
  strlcpy(Client->flags, (char const   *)Flags, sizeof(Client->flags));
#line 413
  return;
}
}
#line 416 "client.c"
void Client_SetPassword(CLIENT *Client , char *Pwd ) 
{ 

  {
#line 424
  strlcpy(Client->pwd, (char const   *)Pwd, sizeof(Client->pwd));
#line 425
  return;
}
}
#line 428 "client.c"
void Client_SetAway(CLIENT *Client , char *Txt ) 
{ char *__cil_tmp ;

  {
#line 436
  strlcpy(Client->away, (char const   *)Txt, sizeof(Client->away));
#line 437
  __cil_tmp = Client_Mask(Client);
#line 437
  Log(7, "User \"%s\" is away: %s", __cil_tmp, Txt);
#line 438
  return;
}
}
#line 441 "client.c"
void Client_SetType(CLIENT *Client , int Type ) 
{ 

  {
#line 445
  Client->type = Type;
#line 446
  if (Type == 32) {
#line 446
    Generate_MyToken(Client);
  }
#line 447
  Adjust_Counters(Client);
#line 448
  return;
}
}
#line 451 "client.c"
void Client_SetHops(CLIENT *Client , int Hops ) 
{ 

  {
#line 455
  Client->hops = Hops;
#line 456
  return;
}
}
#line 459 "client.c"
void Client_SetToken(CLIENT *Client , int Token ) 
{ 

  {
#line 463
  Client->token = Token;
#line 464
  return;
}
}
#line 467 "client.c"
void Client_SetIntroducer(CLIENT *Client , CLIENT *Introducer ) 
{ 

  {
#line 472
  Client->introducer = Introducer;
#line 473
  return;
}
}
#line 476 "client.c"
void Client_SetOperByMe(CLIENT *Client , int OperByMe ) 
{ 

  {
#line 480
  Client->oper_by_me = OperByMe;
#line 481
  return;
}
}
#line 484 "client.c"
int Client_ModeAdd(CLIENT *Client , char Mode ) 
{ char x[2] ;
  char *__cil_tmp ;

  {
#line 496
  x[0] = Mode;
#line 496
  x[1] = (char )'\000';
#line 497
  __cil_tmp = strchr((char const   *)(Client->modes), (int )x[0]);
#line 497
  if (__cil_tmp) {
#line 503
    return (0);
  } else {
#line 500
    strlcat(Client->modes, (char const   *)(x), sizeof(Client->modes));
#line 501
    return (1);
  }
}
}
#line 507 "client.c"
int Client_ModeDel(CLIENT *Client , char Mode ) 
{ char x[2] ;
  char *p ;

  {
#line 519
  x[0] = Mode;
#line 519
  x[1] = (char )'\000';
#line 521
  p = strchr((char const   *)(Client->modes), (int )x[0]);
#line 522
  if (! p) {
#line 522
    return (0);
  }
#line 525
  while (*p) {
#line 527
    *p = *(p + 1);
#line 528
    p ++;
  }
#line 530
  return (1);
}
}
#line 534 "client.c"
CLIENT *Client_Search(char *Nick ) 
{ char search_id[64] ;
  char *ptr ;
  CLIENT *c ;
  UINT32 search_hash ;
  int __cil_tmp ;

  {
#line 542
  c = (CLIENT *)((void *)0);
#line 548
  strlcpy(search_id, (char const   *)Nick, sizeof(search_id));
#line 549
  ptr = strchr((char const   *)(search_id), '!');
#line 550
  if (ptr) {
#line 550
    *ptr = (char )'\000';
  }
#line 552
  search_hash = Hash((char const   *)(search_id));
#line 554
  c = My_Clients;
#line 555
  while (c) {
#line 557
    if (c->hash == search_hash) {
#line 560
      __cil_tmp = strcasecmp((char const   *)(c->id), (char const   *)(search_id));
#line 560
      if (__cil_tmp == 0) {
#line 560
        return (c);
      }
    }
#line 562
    c = (CLIENT *)c->next;
  }
#line 564
  return ((CLIENT *)((void *)0));
}
}
#line 568 "client.c"
CLIENT *Client_GetFromToken(CLIENT *Client , int Token ) 
{ CLIENT *c ;

  {
#line 580
  c = My_Clients;
#line 581
  while (c) {
#line 583
    if (c->type == 32) {
#line 583
      if ((unsigned int )c->introducer == (unsigned int )Client) {
#line 583
        if (c->token == Token) {
#line 583
          return (c);
        }
      }
    }
#line 584
    c = (CLIENT *)c->next;
  }
#line 586
  return ((CLIENT *)((void *)0));
}
}
#line 590 "client.c"
int Client_Type(CLIENT *Client ) 
{ 

  {
#line 594
  return (Client->type);
}
}
#line 598 "client.c"
CONN_ID Client_Conn(CLIENT *Client ) 
{ 

  {
#line 602
  return (Client->conn_id);
}
}
#line 606 "client.c"
char *Client_ID(CLIENT *Client ) 
{ 

  {
#line 616
  if (Client->id[0]) {
#line 616
    return (Client->id);
  } else {
#line 617
    return ((char *)"*");
  }
}
}
#line 621 "client.c"
char *Client_Info(CLIENT *Client ) 
{ 

  {
#line 625
  return (Client->info);
}
}
#line 629 "client.c"
char *Client_User(CLIENT *Client ) 
{ char const   *__cil_tmp ;

  {
#line 633
  if (Client->user[0]) {
#line 633
    __cil_tmp = (char const   *)(Client->user);
  } else {
#line 633
    __cil_tmp = "~";
  }
#line 633
  return ((char *)__cil_tmp);
}
}
#line 637 "client.c"
char *Client_Hostname(CLIENT *Client ) 
{ 

  {
#line 641
  return (Client->host);
}
}
#line 645 "client.c"
char *Client_Password(CLIENT *Client ) 
{ 

  {
#line 649
  return (Client->pwd);
}
}
#line 653 "client.c"
char *Client_Modes(CLIENT *Client ) 
{ 

  {
#line 657
  return (Client->modes);
}
}
#line 661 "client.c"
char *Client_Flags(CLIENT *Client ) 
{ 

  {
#line 665
  return (Client->flags);
}
}
#line 669 "client.c"
int Client_OperByMe(CLIENT *Client ) 
{ 

  {
#line 673
  return (Client->oper_by_me);
}
}
#line 677 "client.c"
int Client_Hops(CLIENT *Client ) 
{ 

  {
#line 681
  return (Client->hops);
}
}
#line 685 "client.c"
int Client_Token(CLIENT *Client ) 
{ 

  {
#line 689
  return (Client->token);
}
}
#line 693 "client.c"
int Client_MyToken(CLIENT *Client ) 
{ 

  {
#line 697
  return (Client->mytoken);
}
}
#line 701 "client.c"
CLIENT *Client_NextHop(CLIENT *Client ) 
{ CLIENT *c ;

  {
#line 708
  c = Client;
#line 709
  while (1) {
#line 709
    if (c->introducer) {
#line 709
      if ((unsigned int )c->introducer != (unsigned int )c) {
#line 709
        if (! ((unsigned int )c->introducer != (unsigned int )This_Server)) {
#line 709
          break;
        }
      } else {
#line 709
        break;
      }
    } else {
#line 709
      break;
    }
#line 710
    c = c->introducer;
  }
#line 712
  return (c);
}
}
#line 716 "client.c"
char *Client_Mask(CLIENT *Client ) 
{ 

  {
#line 724
  if (Client->type == 32) {
#line 724
    return (Client->id);
  }
#line 726
  snprintf(GetID_Buffer, 106UL, "%s!%s@%s", Client->id, Client->user, Client->host);
#line 727
  return (GetID_Buffer);
}
}
#line 731 "client.c"
CLIENT *Client_Introducer(CLIENT *Client ) 
{ 

  {
#line 735
  return (Client->introducer);
}
}
#line 739 "client.c"
CLIENT *Client_TopServer(CLIENT *Client ) 
{ 

  {
#line 743
  return (Client->topserver);
}
}
#line 747 "client.c"
int Client_HasMode(CLIENT *Client , char Mode ) 
{ char *__cil_tmp ;

  {
#line 751
  __cil_tmp = strchr((char const   *)(Client->modes), (int )Mode);
#line 751
  return ((unsigned int )__cil_tmp != (unsigned int )((void *)0));
}
}
#line 755 "client.c"
char *Client_Away(CLIENT *Client ) 
{ 

  {
#line 761
  return (Client->away);
}
}
#line 765 "client.c"
int Client_CheckNick(CLIENT *Client , char *Nick ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  CLIENT *__cil_tmp___2 ;

  {
#line 771
  __cil_tmp___0 = Client_IsValidNick((char const   *)Nick);
#line 771
  if (! __cil_tmp___0) {
#line 773
    __cil_tmp = Client_ID(Client);
#line 773
    IRC_WriteStrClient(Client, (char *)"432 %s %s :Erroneous nickname", __cil_tmp,
                       Nick);
#line 774
    return (0);
  }
#line 778
  __cil_tmp___2 = Client_Search(Nick);
#line 778
  if (__cil_tmp___2) {
#line 781
    __cil_tmp___1 = Client_ID(Client);
#line 781
    IRC_WriteStrClient(Client, (char *)"433 %s %s :Nickname already in use", __cil_tmp___1,
                       Nick);
#line 782
    return (0);
  }
#line 785
  return (1);
}
}
#line 789 "client.c"
int Client_CheckID(CLIENT *Client , char *ID ) 
{ char str[513] ;
  CLIENT *c ;
  char *__cil_tmp ;
  size_t __cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 802
  __cil_tmp___0 = strlen((char const   *)ID);
#line 802
  if (__cil_tmp___0 > 64UL) {
#line 804
    __cil_tmp = Client_ID(Client);
#line 804
    IRC_WriteStrClient(Client, (char *)"432 %s %s :Erroneous nickname", __cil_tmp,
                       ID);
#line 805
    return (0);
  }
#line 809
  c = My_Clients;
#line 810
  while (c) {
#line 812
    __cil_tmp___1 = strcasecmp((char const   *)(c->id), (char const   *)ID);
#line 812
    if (__cil_tmp___1 == 0) {
#line 815
      snprintf(str, sizeof(str), "ID \"%s\" already registered", ID);
#line 816
      if (Client->conn_id != c->conn_id) {
#line 816
        Log(3, "%s (on connection %d)!", str, c->conn_id);
      } else {
#line 817
        Log(3, "%s (via network)!", str);
      }
#line 818
      Conn_Close(Client->conn_id, str, str, 1);
#line 819
      return (0);
    }
#line 821
    c = (CLIENT *)c->next;
  }
#line 824
  return (1);
}
}
#line 828 "client.c"
CLIENT *Client_First(void) 
{ 

  {
#line 833
  return (My_Clients);
}
}
#line 837 "client.c"
CLIENT *Client_Next(CLIENT *c ) 
{ 

  {
#line 844
  return ((CLIENT *)c->next);
}
}
#line 848 "client.c"
long Client_UserCount(void) 
{ unsigned long __cil_tmp ;

  {
#line 851
  __cil_tmp = Count(16);
#line 851
  return ((long )__cil_tmp);
}
}
#line 855 "client.c"
long Client_ServiceCount(void) 
{ unsigned long __cil_tmp ;

  {
#line 858
  __cil_tmp = Count(64);
#line 858
  return ((long )__cil_tmp);
}
}
#line 862 "client.c"
long Client_ServerCount(void) 
{ unsigned long __cil_tmp ;

  {
#line 865
  __cil_tmp = Count(32);
#line 865
  return ((long )__cil_tmp);
}
}
#line 869 "client.c"
long Client_MyUserCount(void) 
{ unsigned long __cil_tmp ;

  {
#line 872
  __cil_tmp = MyCount(16);
#line 872
  return ((long )__cil_tmp);
}
}
#line 876 "client.c"
long Client_MyServiceCount(void) 
{ unsigned long __cil_tmp ;

  {
#line 879
  __cil_tmp = MyCount(64);
#line 879
  return ((long )__cil_tmp);
}
}
#line 883 "client.c"
unsigned long Client_MyServerCount(void) 
{ CLIENT *c ;
  unsigned long cnt ;

  {
#line 887
  cnt = 0UL;
#line 889
  c = My_Clients;
#line 890
  while (c) {
#line 892
    if (c->type == 32) {
#line 892
      if (c->hops == 1) {
#line 892
        cnt ++;
      }
    }
#line 893
    c = (CLIENT *)c->next;
  }
#line 895
  return (cnt);
}
}
#line 899 "client.c"
unsigned long Client_OperCount(void) 
{ CLIENT *c ;
  unsigned long cnt ;
  char *__cil_tmp ;

  {
#line 903
  cnt = 0UL;
#line 905
  c = My_Clients;
#line 906
  while (c) {
#line 908
    if (c) {
#line 908
      if (c->type == 16) {
#line 908
        __cil_tmp = strchr((char const   *)(c->modes), 'o');
#line 908
        if (__cil_tmp) {
#line 908
          cnt ++;
        }
      }
    }
#line 909
    c = (CLIENT *)c->next;
  }
#line 911
  return (cnt);
}
}
#line 915 "client.c"
unsigned long Client_UnknownCount(void) 
{ CLIENT *c ;
  unsigned long cnt ;

  {
#line 919
  cnt = 0UL;
#line 921
  c = My_Clients;
#line 922
  while (c) {
#line 924
    if (c) {
#line 924
      if (c->type != 16) {
#line 924
        if (c->type != 64) {
#line 924
          if (c->type != 32) {
#line 924
            cnt ++;
          }
        }
      }
    }
#line 925
    c = (CLIENT *)c->next;
  }
#line 928
  return (cnt);
}
}
#line 932 "client.c"
long Client_MaxUserCount(void) 
{ 

  {
#line 935
  return (Max_Users);
}
}
#line 939 "client.c"
long Client_MyMaxUserCount(void) 
{ 

  {
#line 942
  return (My_Max_Users);
}
}
#line 950 "client.c"
static char const   goodchars[13]  = 
#line 950
  {      (char const   )';',      (char const   )'0',      (char const   )'1',      (char const   )'2', 
        (char const   )'3',      (char const   )'4',      (char const   )'5',      (char const   )'6', 
        (char const   )'7',      (char const   )'8',      (char const   )'9',      (char const   )'-', 
        (char const   )'\000'};
#line 946 "client.c"
int Client_IsValidNick(char const   *Nick ) 
{ char const   *ptr ;
  char *__cil_tmp ;
  size_t __cil_tmp___0 ;
  char *__cil_tmp___1 ;

  {
#line 954
  if ((int const   )*(Nick + 0) == 35) {
#line 954
    return (0);
  }
#line 955
  __cil_tmp = strchr(goodchars, (int )*(Nick + 0));
#line 955
  if (__cil_tmp) {
#line 955
    return (0);
  }
#line 956
  __cil_tmp___0 = strlen(Nick);
#line 956
  if (__cil_tmp___0 >= (size_t )Conf_MaxNickLength) {
#line 956
    return (0);
  }
#line 958
  ptr = Nick;
#line 959
  while (*ptr) {
#line 961
    if ((int const   )*ptr < 65) {
#line 961
      __cil_tmp___1 = strchr(goodchars, (int )*ptr);
#line 961
      if (! __cil_tmp___1) {
#line 961
        return (0);
      }
    }
#line 962
    if ((int const   )*ptr > 125) {
#line 962
      return (0);
    }
#line 963
    ptr ++;
  }
#line 966
  return (1);
}
}
#line 973 "client.c"
WHOWAS *Client_GetWhowas(void) 
{ 

  {
#line 976
  return (My_Whowas);
}
}
#line 982 "client.c"
int Client_GetLastWhowasIndex(void) 
{ 

  {
#line 985
  return (Last_Whowas);
}
}
#line 994 "client.c"
time_t Client_StartTime(CLIENT *Client ) 
{ 

  {
#line 998
  return (Client->starttime);
}
}
#line 1002 "client.c"
static unsigned long Count(int Type ) 
{ CLIENT *c ;
  unsigned long cnt ;

  {
#line 1006
  cnt = 0UL;
#line 1008
  c = My_Clients;
#line 1009
  while (c) {
#line 1011
    if (c->type == Type) {
#line 1011
      cnt ++;
    }
#line 1012
    c = (CLIENT *)c->next;
  }
#line 1014
  return (cnt);
}
}
#line 1018 "client.c"
static unsigned long MyCount(int Type ) 
{ CLIENT *c ;
  unsigned long cnt ;

  {
#line 1022
  cnt = 0UL;
#line 1024
  c = My_Clients;
#line 1025
  while (c) {
#line 1027
    if ((unsigned int )c->introducer == (unsigned int )This_Server) {
#line 1027
      if (c->type == Type) {
#line 1027
        cnt ++;
      }
    }
#line 1028
    c = (CLIENT *)c->next;
  }
#line 1030
  return (cnt);
}
}
#line 1034 "client.c"
static CLIENT *New_Client_Struct(void) 
{ CLIENT *c ;
  void *__cil_tmp ;

  {
#line 1041
  __cil_tmp = malloc(sizeof(CLIENT ));
#line 1041
  c = (CLIENT *)__cil_tmp;
#line 1042
  if (! c) {
#line 1044
    Log(0, "Can\'t allocate memory! [New_Client_Struct]");
#line 1045
    return ((CLIENT *)((void *)0));
  }
#line 1048
  memset((void *)c, 0, sizeof(CLIENT ));
#line 1050
  c->type = 1;
#line 1051
  c->conn_id = -1;
#line 1052
  c->oper_by_me = 0;
#line 1053
  c->hops = -1;
#line 1054
  c->token = -1;
#line 1055
  c->mytoken = -1;
#line 1057
  return (c);
}
}
#line 1061 "client.c"
static void Generate_MyToken(CLIENT *Client ) 
{ CLIENT *c ;
  int token ;

  {
#line 1067
  c = My_Clients;
#line 1068
  token = 2;
#line 1069
  while (c) {
#line 1071
    if (c->mytoken == token) {
#line 1074
      token ++;
#line 1075
      c = My_Clients;
#line 1076
      continue;
    } else {
#line 1078
      c = (CLIENT *)c->next;
    }
  }
#line 1080
  Client->mytoken = token;
#line 1081
  Log(7, "Assigned token %d to server \"%s\".", token, Client->id);
#line 1082
  return;
}
}
#line 1085 "client.c"
static void Adjust_Counters(CLIENT *Client ) 
{ long count ;

  {
#line 1092
  if (Client->type != 16) {
#line 1092
    return;
  }
#line 1094
  if (Client->conn_id != -1) {
#line 1097
    count = Client_MyUserCount();
#line 1098
    if (count > My_Max_Users) {
#line 1098
      My_Max_Users = count;
    }
  }
#line 1100
  count = Client_UserCount();
#line 1101
  if (count > Max_Users) {
#line 1101
    Max_Users = count;
  }
#line 1102
  return;
}
}
#line 1111 "client.c"
void Client_RegisterWhowas(CLIENT *Client ) 
{ int slot ;
  time_t now ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  CLIENT *__cil_tmp___3 ;
  char *__cil_tmp___4 ;

  {
#line 1119
  now = time((time_t *)((void *)0));
#line 1121
  if (now - Client->starttime < 30L) {
#line 1122
    return;
  }
#line 1124
  slot = Last_Whowas + 1;
#line 1125
  if (slot >= 64) {
#line 1125
    slot = 0;
  } else {
#line 1125
    if (slot < 0) {
#line 1125
      slot = 0;
    }
  }
#line 1131
  My_Whowas[slot].time = now;
#line 1132
  __cil_tmp = Client_ID(Client);
#line 1132
  strlcpy(My_Whowas[slot].id, (char const   *)__cil_tmp, sizeof(My_Whowas[slot].id));
#line 1134
  __cil_tmp___0 = Client_User(Client);
#line 1134
  strlcpy(My_Whowas[slot].user, (char const   *)__cil_tmp___0, sizeof(My_Whowas[slot].user));
#line 1136
  __cil_tmp___1 = Client_Hostname(Client);
#line 1136
  strlcpy(My_Whowas[slot].host, (char const   *)__cil_tmp___1, sizeof(My_Whowas[slot].host));
#line 1138
  __cil_tmp___2 = Client_Info(Client);
#line 1138
  strlcpy(My_Whowas[slot].info, (char const   *)__cil_tmp___2, sizeof(My_Whowas[slot].info));
#line 1140
  __cil_tmp___3 = Client_Introducer(Client);
#line 1140
  __cil_tmp___4 = Client_ID(__cil_tmp___3);
#line 1140
  strlcpy(My_Whowas[slot].server, (char const   *)__cil_tmp___4, sizeof(My_Whowas[slot].server));
#line 1143
  Last_Whowas = slot;
#line 1144
  return;
}
}
/* compiler builtin: 
   void __builtin_va_end(__builtin_va_list  ) ;  */
/* compiler builtin: 
   void __builtin_va_start(__builtin_va_list  ) ;  */
#line 1 "conf.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-mtCkkLKk.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 167 "/usr/include/stdio.h"
extern FILE *__stdinp ;
#line 250
extern int fclose(FILE * ) ;
#line 256
extern char *fgets(char * , int  , FILE * ) ;
#line 257
extern FILE *fopen(char const   * , char const   * ) ;
#line 260
extern int fputs(char const   * , FILE * )  __asm__("_fputs$UNIX2003")  ;
#line 270
extern int getchar(void) ;
#line 278
extern int putc(int  , FILE * ) ;
#line 316
extern int fileno(FILE * ) ;
#line 345
extern int vsnprintf(char * , size_t  , char const   * , va_list  ) ;
#line 149 "/usr/include/stdlib.h"
extern int atoi(char const   * ) ;
#line 150
extern long atol(char const   * ) ;
#line 109 "/usr/include/string.h"
extern char *strtok(char * , char const   * ) ;
#line 116
extern char *strdup(char const   * ) ;
#line 462 "/usr/include/unistd.h"
extern int isatty(int  ) ;
#line 99 "/usr/include/grp.h"
extern struct group *getgrnam(char const   * ) ;
#line 132 "/usr/include/runetype.h"
extern _RuneLocale _DefaultRuneLocale ;
#line 180 "/usr/include/ctype.h"
__inline static __darwin_ct_rune_t __isctype(__darwin_ct_rune_t _c , unsigned long _f ) 
{ int __cil_tmp ;

  {
#line 186
  if (_c < 0) {
#line 186
    __cil_tmp = 0;
  } else {
#line 186
    if (_c >= 1 << 8) {
#line 186
      __cil_tmp = 0;
    } else {
#line 186
      __cil_tmp = ! (! ((unsigned long )_DefaultRuneLocale.__runetype[_c] & _f));
    }
  }
#line 186
  return (__cil_tmp);
}
}
#line 253 "/usr/include/ctype.h"
__inline static int isdigit(int _c ) 
{ __darwin_ct_rune_t __cil_tmp ;

  {
#line 256
  __cil_tmp = __isctype(_c, 1024UL);
#line 256
  return (__cil_tmp);
}
}
#line 36 "resolve.h"
void Resolve_Init(RES_STAT *s ) ;
#line 29 "./../tool/tool.h"
void ngt_TrimStr(char *String ) ;
#line 33
int ngt_IPStrToBin(char const   *ip_str , struct in_addr *inaddr ) ;
#line 63 "conf.h"
char Conf_ServerName[64]  ;
#line 66 "conf.h"
char Conf_ServerInfo[64]  ;
#line 69 "conf.h"
char Conf_ServerPwd[21]  ;
#line 72 "conf.h"
char Conf_ServerAdmin1[64]  ;
#line 73 "conf.h"
char Conf_ServerAdmin2[64]  ;
#line 74 "conf.h"
char Conf_ServerAdminMail[64]  ;
#line 77 "conf.h"
char Conf_MotdFile[256]  ;
#line 80 "conf.h"
char Conf_MotdPhrase[256]  ;
#line 83 "conf.h"
array Conf_ListenPorts  ;
#line 86 "conf.h"
char Conf_ListenAddress[16]  ;
#line 89 "conf.h"
uid_t Conf_UID  ;
#line 90 "conf.h"
gid_t Conf_GID  ;
#line 93 "conf.h"
char Conf_Chroot[256]  ;
#line 96 "conf.h"
char Conf_PidFile[256]  ;
#line 99 "conf.h"
int Conf_PingTimeout  ;
#line 100 "conf.h"
int Conf_PongTimeout  ;
#line 103 "conf.h"
int Conf_ConnectRetry  ;
#line 106 "conf.h"
CONF_OPER Conf_Oper[16]  ;
#line 107 "conf.h"
unsigned int Conf_Oper_Count  ;
#line 110 "conf.h"
CONF_SERVER Conf_Server[16]  ;
#line 113 "conf.h"
CONF_CHANNEL Conf_Channel[16]  ;
#line 114 "conf.h"
unsigned int Conf_Channel_Count  ;
#line 116 "conf.h"
int Conf_PredefChannelsOnly  ;
#line 119 "conf.h"
int Conf_OperCanMode  ;
#line 122 "conf.h"
int Conf_NoDNS  ;
#line 127 "conf.h"
int Conf_OperServerMode  ;
#line 130 "conf.h"
long Conf_MaxConnections  ;
#line 133 "conf.h"
int Conf_MaxJoins  ;
#line 136 "conf.h"
int Conf_MaxConnectionsIP  ;
#line 139 "conf.h"
unsigned int Conf_MaxNickLength  ;
#line 145
void Conf_UnsetServer(CONN_ID Idx ) ;
#line 146
void Conf_SetServer(int ConfServer , CONN_ID Idx ) ;
#line 147
int Conf_GetServer(CONN_ID Idx ) ;
#line 149
int Conf_EnableServer(char *Name , UINT16 Port ) ;
#line 150
int Conf_EnablePassiveServer(char const   *Name ) ;
#line 151
int Conf_DisableServer(char *Name ) ;
#line 152
int Conf_AddServer(char *Name , UINT16 Port , char *Host , char *MyPwd , char *PeerPwd ) ;
#line 54 "conf.c"
static int Use_Log  =    1;
#line 55 "conf.c"
static CONF_SERVER New_Server  ;
#line 56 "conf.c"
static int New_Server_Idx  ;
#line 59
static void Set_Defaults(int InitServers ) ;
#line 60
static void Read_Config(void) ;
#line 61
static void Validate_Config(int Configtest , int Rehash ) ;
#line 63
static void Handle_GLOBAL(int Line , char *Var , char *Arg ) ;
#line 64
static void Handle_OPERATOR(int Line , char *Var , char *Arg ) ;
#line 65
static void Handle_SERVER(int Line , char *Var , char *Arg ) ;
#line 66
static void Handle_CHANNEL(int Line , char *Var , char *Arg ) ;
#line 68
static void Config_Error(int Level , char const   *Format  , ...) ;
#line 70
static void Config_Error_NaN(int Line , char const   *Item ) ;
#line 71
static void Config_Error_TooLong(int Line , char const   *Item ) ;
#line 73
static void Init_Server_Struct(CONF_SERVER *Server ) ;
#line 76 "conf.c"
static char *strdup_warn(char const   *str ) 
{ char *ptr ;
  char *__cil_tmp ;

  {
#line 79
  __cil_tmp = strdup(str);
#line 79
  ptr = __cil_tmp;
#line 80
  if (! ptr) {
#line 81
    Config_Error(3, "Could not allocate mem for string: %s", str);
  }
#line 82
  return (ptr);
}
}
#line 86 "conf.c"
static void ports_puts(array *a ) 
{ size_t len ;
  UINT16 *ports ;
  void *__cil_tmp ;
  size_t __cil_tmp___0 ;
  size_t __cil_tmp___1 ;

  {
#line 91
  len = array_length((array const   *)a, sizeof(UINT16 ));
#line 92
  __cil_tmp___1 = len;
#line 92
  len --;
#line 92
  if (__cil_tmp___1) {
#line 93
    __cil_tmp = array_start((array const   *)a);
#line 93
    ports = (UINT16 *)__cil_tmp;
#line 94
    printf("%u", (unsigned int )*ports);
#line 95
    while (1) {
#line 95
      __cil_tmp___0 = len;
#line 95
      len --;
#line 95
      if (! __cil_tmp___0) {
#line 95
        break;
      }
#line 96
      ports ++;
#line 97
      printf(", %u", (unsigned int )*ports);
    }
  }
#line 100
  putc('\n', __stdoutp);
#line 101
  return;
}
}
#line 104 "conf.c"
static void ports_parse(array *a , int Line , char *Arg ) 
{ char *ptr ;
  int port ;
  UINT16 port16 ;
  long __cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 111
  array_trunc(a);
#line 115
  ptr = strtok(Arg, ",");
#line 116
  while (ptr) {
#line 117
    ngt_TrimStr(ptr);
#line 118
    __cil_tmp = atol((char const   *)ptr);
#line 118
    port = (int )__cil_tmp;
#line 119
    if (port > 0) {
#line 119
      if (port < 65535) {
#line 120
        port16 = (unsigned short )port;
#line 121
        __cil_tmp___2 = array_catb(a, (char const   *)((char *)(& port16)), sizeof(port16));
#line 121
        if (! __cil_tmp___2) {
#line 122
          __cil_tmp___0 = __error();
#line 122
          __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 122
          Config_Error(3, "%s, line %d Could not add port number %ld: %s", NGIRCd_ConfFile,
                       Line, port, __cil_tmp___1);
        }
      } else {
#line 125
        Config_Error(3, "%s, line %d (section \"Global\"): Illegal port number %ld!",
                     NGIRCd_ConfFile, Line, port);
      }
    } else {
#line 125
      Config_Error(3, "%s, line %d (section \"Global\"): Illegal port number %ld!",
                   NGIRCd_ConfFile, Line, port);
    }
#line 129
    ptr = strtok((char *)((void *)0), ",");
  }
#line 131
  return;
}
}
#line 134 "conf.c"
void Conf_Init(void) 
{ 

  {
#line 137
  Set_Defaults(1);
#line 138
  Read_Config();
#line 139
  Validate_Config(0, 0);
#line 140
  return;
}
}
#line 143 "conf.c"
void Conf_Rehash(void) 
{ CLIENT *__cil_tmp ;

  {
#line 146
  Set_Defaults(0);
#line 147
  Read_Config();
#line 148
  Validate_Config(0, 1);
#line 151
  __cil_tmp = Client_ThisServer();
#line 151
  Client_SetInfo(__cil_tmp, Conf_ServerInfo);
#line 152
  return;
}
}
#line 155 "conf.c"
int Conf_Test(void) 
{ struct passwd *pwd ;
  struct group *grp ;
  unsigned int i ;
  char *topic ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char const   *__cil_tmp___3 ;
  char const   *__cil_tmp___4 ;
  char const   *__cil_tmp___5 ;
  char const   *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  char const   *__cil_tmp___8 ;
  void *__cil_tmp___9 ;
  char const   *__cil_tmp___10 ;

  {
#line 165
  Use_Log = 0;
#line 166
  Set_Defaults(1);
#line 168
  Read_Config();
#line 169
  Validate_Config(1, 0);
#line 173
  __cil_tmp = fileno(__stdinp);
#line 173
  __cil_tmp___0 = isatty(__cil_tmp);
#line 173
  if (__cil_tmp___0) {
#line 173
    __cil_tmp___1 = fileno(__stdoutp);
#line 173
    __cil_tmp___2 = isatty(__cil_tmp___1);
#line 173
    if (__cil_tmp___2) {
#line 174
      puts("OK, press enter to see a dump of your service configuration ...");
#line 175
      getchar();
    } else {
#line 177
      puts("Ok, dump of your server configuration follows:\n");
    }
  } else {
#line 177
    puts("Ok, dump of your server configuration follows:\n");
  }
#line 180
  puts("[GLOBAL]");
#line 181
  printf("  Name = %s\n", Conf_ServerName);
#line 182
  printf("  Info = %s\n", Conf_ServerInfo);
#line 183
  printf("  Password = %s\n", Conf_ServerPwd);
#line 184
  printf("  AdminInfo1 = %s\n", Conf_ServerAdmin1);
#line 185
  printf("  AdminInfo2 = %s\n", Conf_ServerAdmin2);
#line 186
  printf("  AdminEMail = %s\n", Conf_ServerAdminMail);
#line 187
  printf("  MotdFile = %s\n", Conf_MotdFile);
#line 188
  printf("  MotdPhrase = %s\n", Conf_MotdPhrase);
#line 189
  printf("  ChrootDir = %s\n", Conf_Chroot);
#line 190
  printf("  PidFile = %s\n", Conf_PidFile);
#line 191
  fputs("  Ports = ", __stdoutp);
#line 193
  ports_puts(& Conf_ListenPorts);
#line 195
  printf("  Listen = %s\n", Conf_ListenAddress);
#line 196
  pwd = getpwuid(Conf_UID);
#line 197
  if (pwd) {
#line 197
    printf("  ServerUID = %s\n", pwd->pw_name);
  } else {
#line 198
    printf("  ServerUID = %ld\n", (long )Conf_UID);
  }
#line 199
  grp = getgrgid(Conf_GID);
#line 200
  if (grp) {
#line 200
    printf("  ServerGID = %s\n", grp->gr_name);
  } else {
#line 201
    printf("  ServerGID = %ld\n", (long )Conf_GID);
  }
#line 202
  printf("  PingTimeout = %d\n", Conf_PingTimeout);
#line 203
  printf("  PongTimeout = %d\n", Conf_PongTimeout);
#line 204
  printf("  ConnectRetry = %d\n", Conf_ConnectRetry);
#line 205
  if (Conf_OperCanMode == 1) {
#line 205
    __cil_tmp___3 = "yes";
  } else {
#line 205
    __cil_tmp___3 = "no";
  }
#line 205
  printf("  OperCanUseMode = %s\n", __cil_tmp___3);
#line 206
  if (Conf_OperServerMode == 1) {
#line 206
    __cil_tmp___4 = "yes";
  } else {
#line 206
    __cil_tmp___4 = "no";
  }
#line 206
  printf("  OperServerMode = %s\n", __cil_tmp___4);
#line 207
  if (Conf_PredefChannelsOnly == 1) {
#line 207
    __cil_tmp___5 = "yes";
  } else {
#line 207
    __cil_tmp___5 = "no";
  }
#line 207
  printf("  PredefChannelsOnly = %s\n", __cil_tmp___5);
#line 208
  if (Conf_NoDNS) {
#line 208
    __cil_tmp___6 = "yes";
  } else {
#line 208
    __cil_tmp___6 = "no";
  }
#line 208
  printf("  NoDNS = %s\n", __cil_tmp___6);
#line 209
  printf("  MaxConnections = %ld\n", Conf_MaxConnections);
#line 210
  printf("  MaxConnectionsIP = %d\n", Conf_MaxConnectionsIP);
#line 211
  if (Conf_MaxJoins > 0) {
#line 211
    __cil_tmp___7 = Conf_MaxJoins;
  } else {
#line 211
    __cil_tmp___7 = -1;
  }
#line 211
  printf("  MaxJoins = %d\n", __cil_tmp___7);
#line 212
  printf("  MaxNickLength = %u\n\n", Conf_MaxNickLength - 1U);
#line 214
  i = 0U;
#line 214
  while (i < Conf_Oper_Count) {
#line 215
    if (! Conf_Oper[i].name[0]) {
      goto __Cont;
    }
#line 218
    puts("[OPERATOR]");
#line 219
    printf("  Name = %s\n", Conf_Oper[i].name);
#line 220
    printf("  Password = %s\n", Conf_Oper[i].pwd);
#line 221
    if (Conf_Oper[i].mask) {
#line 221
      printf("  Mask = %s\n", Conf_Oper[i].mask);
    }
#line 222
    puts("");
    __Cont: /* CIL Label */ 
#line 214
    i ++;
  }
#line 225
  i = 0U;
#line 225
  while (i < 16U) {
#line 226
    if (! Conf_Server[i].name[0]) {
      goto __Cont___0;
    }
#line 229
    puts("[SERVER]");
#line 230
    printf("  Name = %s\n", Conf_Server[i].name);
#line 231
    printf("  Host = %s\n", Conf_Server[i].host);
#line 232
    printf("  Port = %u\n", (unsigned int )Conf_Server[i].port);
#line 233
    printf("  MyPassword = %s\n", Conf_Server[i].pwd_in);
#line 234
    printf("  PeerPassword = %s\n", Conf_Server[i].pwd_out);
#line 235
    printf("  Group = %d\n", Conf_Server[i].group);
#line 236
    if (Conf_Server[i].flags & 2) {
#line 236
      __cil_tmp___8 = "yes";
    } else {
#line 236
      __cil_tmp___8 = "no";
    }
#line 236
    printf("  Passive = %s\n\n", __cil_tmp___8);
    __Cont___0: /* CIL Label */ 
#line 225
    i ++;
  }
#line 239
  i = 0U;
#line 239
  while (i < Conf_Channel_Count) {
#line 240
    if (! Conf_Channel[i].name[0]) {
      goto __Cont___1;
    }
#line 243
    puts("[CHANNEL]");
#line 244
    printf("  Name = %s\n", Conf_Channel[i].name);
#line 245
    printf("  Modes = %s\n", Conf_Channel[i].modes);
#line 246
    printf("  Key = %s\n", Conf_Channel[i].key);
#line 247
    printf("  MaxUsers = %lu\n", Conf_Channel[i].maxusers);
#line 249
    __cil_tmp___9 = array_start((array const   *)(& Conf_Channel[i].topic));
#line 249
    topic = (char *)__cil_tmp___9;
#line 250
    if (topic) {
#line 250
      __cil_tmp___10 = (char const   *)topic;
    } else {
#line 250
      __cil_tmp___10 = "";
    }
#line 250
    printf("  Topic = %s\n\n", __cil_tmp___10);
    __Cont___1: /* CIL Label */ 
#line 239
    i ++;
  }
#line 253
  return (0);
}
}
#line 257 "conf.c"
void Conf_UnsetServer(CONN_ID Idx ) 
{ int i ;
  time_t t ;

  {
#line 269
  i = 0;
#line 269
  while (i < 16) {
#line 270
    if (Conf_Server[i].conn_id != Idx) {
      goto __Cont;
    }
#line 273
    Conf_Server[i].conn_id = -1;
#line 275
    if (Conf_Server[i].flags & 1) {
#line 277
      Init_Server_Struct(& Conf_Server[i]);
    } else {
#line 280
      t = time((time_t *)((void *)0));
#line 281
      if (Conf_Server[i].lasttry < t - (time_t )Conf_ConnectRetry) {
#line 284
        Conf_Server[i].lasttry = (t - (time_t )Conf_ConnectRetry) + 3L;
      } else {
#line 287
        Conf_Server[i].lasttry = t;
      }
    }
    __Cont: /* CIL Label */ 
#line 269
    i ++;
  }
#line 290
  return;
}
}
#line 293 "conf.c"
void Conf_SetServer(int ConfServer , CONN_ID Idx ) 
{ 

  {
#line 301
  Conf_Server[ConfServer].conn_id = Idx;
#line 302
  return;
}
}
#line 305 "conf.c"
int Conf_GetServer(CONN_ID Idx ) 
{ int i ;

  {
#line 310
  i = 0;
#line 314
  i = 0;
#line 314
  while (i < 16) {
#line 315
    if (Conf_Server[i].conn_id == Idx) {
#line 315
      return (i);
    }
#line 314
    i ++;
  }
#line 317
  return (-1);
}
}
#line 321 "conf.c"
int Conf_EnableServer(char *Name , UINT16 Port ) 
{ int i ;
  int __cil_tmp ;

  {
#line 330
  i = 0;
#line 330
  while (i < 16) {
#line 331
    __cil_tmp = strcasecmp((char const   *)(Conf_Server[i].name), (char const   *)Name);
#line 331
    if (__cil_tmp == 0) {
#line 333
      Conf_Server[i].port = Port;
#line 334
      Conf_Server[i].flags &= -3;
#line 335
      return (1);
    }
#line 330
    i ++;
  }
#line 338
  return (0);
}
}
#line 342 "conf.c"
int Conf_EnablePassiveServer(char const   *Name ) 
{ int i ;
  int __cil_tmp ;

  {
#line 349
  i = 0;
#line 349
  while (i < 16) {
#line 350
    __cil_tmp = strcasecmp((char const   *)(Conf_Server[i].name), Name);
#line 350
    if (__cil_tmp == 0) {
#line 350
      if ((int )Conf_Server[i].port > 0) {
#line 352
        Conf_Server[i].flags &= -3;
#line 353
        return (1);
      }
    }
#line 349
    i ++;
  }
#line 356
  return (0);
}
}
#line 360 "conf.c"
int Conf_DisableServer(char *Name ) 
{ int i ;
  int __cil_tmp ;

  {
#line 369
  i = 0;
#line 369
  while (i < 16) {
#line 370
    __cil_tmp = strcasecmp((char const   *)(Conf_Server[i].name), (char const   *)Name);
#line 370
    if (__cil_tmp == 0) {
#line 372
      Conf_Server[i].flags |= 2;
#line 373
      if (Conf_Server[i].conn_id > -1) {
#line 373
        Conn_Close(Conf_Server[i].conn_id, (char *)((void *)0), (char *)"Server link terminated on operator request",
                   1);
      }
#line 374
      return (1);
    }
#line 369
    i ++;
  }
#line 377
  return (0);
}
}
#line 381 "conf.c"
int Conf_AddServer(char *Name , UINT16 Port , char *Host , char *MyPwd , char *PeerPwd ) 
{ int i ;

  {
#line 394
  i = 0;
#line 394
  while (i < 16) {
#line 396
    if (! Conf_Server[i].name[0]) {
#line 396
      break;
    }
#line 394
    i ++;
  }
#line 398
  if (i >= 16) {
#line 398
    return (0);
  }
#line 400
  Init_Server_Struct(& Conf_Server[i]);
#line 401
  strlcpy(Conf_Server[i].name, (char const   *)Name, sizeof(Conf_Server[i].name));
#line 402
  strlcpy(Conf_Server[i].host, (char const   *)Host, sizeof(Conf_Server[i].host));
#line 403
  strlcpy(Conf_Server[i].pwd_out, (char const   *)MyPwd, sizeof(Conf_Server[i].pwd_out));
#line 404
  strlcpy(Conf_Server[i].pwd_in, (char const   *)PeerPwd, sizeof(Conf_Server[i].pwd_in));
#line 405
  Conf_Server[i].port = Port;
#line 406
  Conf_Server[i].flags = 1;
#line 408
  return (1);
}
}
#line 412 "conf.c"
static void Set_Defaults(int InitServers ) 
{ int i ;
  int __cil_tmp ;

  {
#line 419
  strcpy(Conf_ServerName, "");
#line 420
  snprintf(Conf_ServerInfo, sizeof(Conf_ServerInfo), "%s %s", "ngircd", "0.11.1");
#line 421
  strcpy(Conf_ServerPwd, "");
#line 423
  strcpy(Conf_ServerAdmin1, "");
#line 424
  strcpy(Conf_ServerAdmin2, "");
#line 425
  strcpy(Conf_ServerAdminMail, "");
#line 427
  strlcpy(Conf_MotdFile, "/usr/local/etc", sizeof(Conf_MotdFile));
#line 428
  strlcat(Conf_MotdFile, "/ngircd.motd", sizeof(Conf_MotdFile));
#line 430
  strlcpy(Conf_MotdPhrase, "", sizeof(Conf_MotdPhrase));
#line 432
  strlcpy(Conf_Chroot, "", sizeof(Conf_Chroot));
#line 434
  strlcpy(Conf_PidFile, "", sizeof(Conf_PidFile));
#line 436
  strcpy(Conf_ListenAddress, "");
#line 438
  Conf_GID = 0U;
#line 438
  Conf_UID = Conf_GID;
#line 440
  Conf_PingTimeout = 120;
#line 441
  Conf_PongTimeout = 20;
#line 443
  Conf_ConnectRetry = 60;
#line 445
  Conf_Oper_Count = 0U;
#line 446
  Conf_Channel_Count = 0U;
#line 448
  Conf_OperCanMode = 0;
#line 449
  Conf_NoDNS = 0;
#line 450
  Conf_PredefChannelsOnly = 0;
#line 451
  Conf_OperServerMode = 0;
#line 453
  Conf_MaxConnections = 0L;
#line 454
  Conf_MaxConnectionsIP = 5;
#line 455
  Conf_MaxJoins = 10;
#line 456
  Conf_MaxNickLength = 10U;
#line 459
  if (InitServers) {
#line 459
    i = 0;
#line 459
    while (i < 16) {
#line 459
      __cil_tmp = i;
#line 459
      i ++;
#line 459
      Init_Server_Struct(& Conf_Server[__cil_tmp]);
    }
  }
#line 460
  return;
}
}
#line 463 "conf.c"
static void Read_Config(void) 
{ char section[256] ;
  char str[256] ;
  char *var ;
  char *arg ;
  char *ptr ;
  UINT16 defaultport ;
  int line ;
  int i ;
  int n ;
  FILE *fd ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  size_t __cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  int __cil_tmp___10 ;
  int *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  size_t __cil_tmp___14 ;

  {
#line 469
  defaultport = (UINT16 )6667;
#line 474
  fd = fopen((char const   *)(NGIRCd_ConfFile), "r");
#line 475
  if (! fd) {
#line 477
    __cil_tmp = __error();
#line 477
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 477
    Config_Error(1, "Can\'t read configuration \"%s\": %s", NGIRCd_ConfFile, __cil_tmp___0);
#line 479
    Config_Error(1, "%s exiting due to fatal errors!", "ngircd");
#line 480
    exit(1);
  }
#line 483
  Config_Error(6, "Reading configuration from \"%s\" ...", NGIRCd_ConfFile);
#line 491
  i = 0;
#line 491
  while (i < 16) {
#line 492
    if (Conf_Server[i].conn_id == -1) {
#line 492
      Init_Server_Struct(& Conf_Server[i]);
    } else {
#line 495
      if (Conf_Server[i].flags & 1) {
#line 497
        n = 0;
#line 497
        while (n < 16) {
#line 498
          if (n == i) {
            goto __Cont;
          }
#line 500
          if (Conf_Server[i].conn_id == Conf_Server[n].conn_id) {
#line 501
            Init_Server_Struct(& Conf_Server[n]);
          }
          __Cont: /* CIL Label */ 
#line 497
          n ++;
        }
      } else {
#line 510
        Conf_Server[i].flags |= 1;
#line 511
        Log(7, "Marked server %d as \"once\"", i);
      }
    }
#line 491
    i ++;
  }
#line 517
  line = 0;
#line 518
  strcpy(section, "");
#line 519
  Init_Server_Struct(& New_Server);
#line 520
  New_Server_Idx = -1;
#line 523
  while (1) {
#line 524
    __cil_tmp___1 = fgets(str, 256, fd);
#line 524
    if (! __cil_tmp___1) {
#line 524
      break;
    }
#line 525
    ngt_TrimStr(str);
#line 526
    line ++;
#line 529
    if ((int )str[0] == 59) {
#line 529
      continue;
    } else {
#line 529
      if ((int )str[0] == 35) {
#line 529
        continue;
      } else {
#line 529
        if ((int )str[0] == 0) {
#line 529
          continue;
        }
      }
    }
#line 532
    if ((int )str[0] == 91) {
#line 532
      __cil_tmp___6 = strlen((char const   *)(str));
#line 532
      if ((int )str[__cil_tmp___6 - 1UL] == 93) {
#line 533
        strlcpy(section, (char const   *)(str), sizeof(section));
#line 534
        __cil_tmp___2 = strcasecmp((char const   *)(section), "[GLOBAL]");
#line 534
        if (__cil_tmp___2 == 0) {
#line 535
          continue;
        }
#line 537
        __cil_tmp___3 = strcasecmp((char const   *)(section), "[OPERATOR]");
#line 537
        if (__cil_tmp___3 == 0) {
#line 538
          if (Conf_Oper_Count + 1U > 16U) {
#line 539
            Config_Error(3, "Too many operators configured.");
          } else {
#line 542
            Conf_Oper[Conf_Oper_Count].name[0] = (char )'\000';
#line 543
            Conf_Oper[Conf_Oper_Count].pwd[0] = (char )'\000';
#line 544
            if (Conf_Oper[Conf_Oper_Count].mask) {
#line 545
              free((void *)Conf_Oper[Conf_Oper_Count].mask);
#line 546
              Conf_Oper[Conf_Oper_Count].mask = (char *)((void *)0);
            }
#line 548
            Conf_Oper_Count ++;
          }
#line 550
          continue;
        }
#line 552
        __cil_tmp___4 = strcasecmp((char const   *)(section), "[SERVER]");
#line 552
        if (__cil_tmp___4 == 0) {
#line 554
          if (New_Server.name[0]) {
#line 557
            Conf_Server[New_Server_Idx] = New_Server;
          }
#line 561
          Init_Server_Struct(& New_Server);
#line 564
          i = 0;
#line 564
          while (i < 16) {
#line 566
            if (! Conf_Server[i].name[0]) {
#line 566
              break;
            }
#line 564
            i ++;
          }
#line 568
          if (i >= 16) {
#line 570
            Config_Error(3, "Too many servers configured.");
#line 571
            New_Server_Idx = -1;
          } else {
#line 573
            New_Server_Idx = i;
          }
#line 574
          continue;
        }
#line 576
        __cil_tmp___5 = strcasecmp((char const   *)(section), "[CHANNEL]");
#line 576
        if (__cil_tmp___5 == 0) {
#line 577
          if (Conf_Channel_Count + 1U > 16U) {
#line 578
            Config_Error(3, "Too many pre-defined channels configured.");
          } else {
#line 581
            strcpy(Conf_Channel[Conf_Channel_Count].name, "");
#line 582
            strcpy(Conf_Channel[Conf_Channel_Count].modes, "");
#line 583
            strcpy(Conf_Channel[Conf_Channel_Count].key, "");
#line 584
            Conf_Channel[Conf_Channel_Count].maxusers = 0UL;
#line 585
            array_free(& Conf_Channel[Conf_Channel_Count].topic);
#line 586
            Conf_Channel_Count ++;
          }
#line 588
          continue;
        }
#line 590
        Config_Error(3, "%s, line %d: Unknown section \"%s\"!", NGIRCd_ConfFile, line,
                     section);
#line 591
        section[0] = (char)1;
      }
    }
#line 593
    if ((int )section[0] == 1) {
#line 593
      continue;
    }
#line 596
    ptr = strchr((char const   *)(str), '=');
#line 597
    if (! ptr) {
#line 598
      Config_Error(3, "%s, line %d: Syntax error!", NGIRCd_ConfFile, line);
#line 599
      continue;
    }
#line 601
    *ptr = (char )'\000';
#line 602
    var = str;
#line 602
    ngt_TrimStr(var);
#line 603
    arg = ptr + 1;
#line 603
    ngt_TrimStr(arg);
#line 605
    __cil_tmp___10 = strcasecmp((char const   *)(section), "[GLOBAL]");
#line 605
    if (__cil_tmp___10 == 0) {
#line 605
      Handle_GLOBAL(line, var, arg);
    } else {
#line 606
      __cil_tmp___9 = strcasecmp((char const   *)(section), "[OPERATOR]");
#line 606
      if (__cil_tmp___9 == 0) {
#line 606
        Handle_OPERATOR(line, var, arg);
      } else {
#line 607
        __cil_tmp___8 = strcasecmp((char const   *)(section), "[SERVER]");
#line 607
        if (__cil_tmp___8 == 0) {
#line 607
          Handle_SERVER(line, var, arg);
        } else {
#line 608
          __cil_tmp___7 = strcasecmp((char const   *)(section), "[CHANNEL]");
#line 608
          if (__cil_tmp___7 == 0) {
#line 608
            Handle_CHANNEL(line, var, arg);
          } else {
#line 609
            Config_Error(3, "%s, line %d: Variable \"%s\" outside section!", NGIRCd_ConfFile,
                         line, var);
          }
        }
      }
    }
  }
#line 613
  fclose(fd);
#line 616
  if (New_Server.name[0]) {
#line 619
    Conf_Server[New_Server_Idx] = New_Server;
  }
#line 622
  __cil_tmp___14 = array_length((array const   *)(& Conf_ListenPorts), sizeof(UINT16 ));
#line 622
  if (0UL == __cil_tmp___14) {
#line 623
    __cil_tmp___13 = array_copyb(& Conf_ListenPorts, (char const   *)((char *)(& defaultport)),
                                 sizeof(defaultport));
#line 623
    if (! __cil_tmp___13) {
#line 624
      __cil_tmp___11 = __error();
#line 624
      __cil_tmp___12 = strerror(*__cil_tmp___11);
#line 624
      Config_Error(1, "Could not add default listening Port %u: %s", (unsigned int )defaultport,
                   __cil_tmp___12);
#line 626
      exit(1);
    }
  }
#line 629
  return;
}
}
#line 632 "conf.c"
static int Check_ArgIsTrue(char const   *Arg ) 
{ int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 635
  __cil_tmp = strcasecmp(Arg, "yes");
#line 635
  if (__cil_tmp == 0) {
#line 635
    return (1);
  }
#line 636
  __cil_tmp___0 = strcasecmp(Arg, "true");
#line 636
  if (__cil_tmp___0 == 0) {
#line 636
    return (1);
  }
#line 637
  __cil_tmp___1 = atoi(Arg);
#line 637
  if (__cil_tmp___1 != 0) {
#line 637
    return (1);
  }
#line 639
  return (0);
}
}
#line 643 "conf.c"
static unsigned int Handle_MaxNickLength(int Line , char const   *Arg ) 
{ unsigned int new ;
  int __cil_tmp ;

  {
#line 647
  __cil_tmp = atoi(Arg);
#line 647
  new = (unsigned int )__cil_tmp + 1U;
#line 648
  if (new > 32U) {
#line 649
    Config_Error(4, "%s, line %d: Value of \"MaxNickLength\" exceeds %u!", NGIRCd_ConfFile,
                 Line, 31);
#line 652
    return (32U);
  }
#line 654
  if (new < 2U) {
#line 655
    Config_Error(4, "%s, line %d: Value of \"MaxNickLength\" must be at least 1!",
                 NGIRCd_ConfFile, Line);
#line 658
    return (2U);
  }
#line 660
  return (new);
}
}
#line 664 "conf.c"
static void Handle_GLOBAL(int Line , char *Var , char *Arg ) 
{ struct passwd *pwd ;
  struct group *grp ;
  size_t len ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  int __cil_tmp___10 ;
  int __cil_tmp___11 ;
  int __cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  int __cil_tmp___15 ;
  int __cil_tmp___16 ;
  int __cil_tmp___17 ;
  int __cil_tmp___18 ;
  int __cil_tmp___19 ;
  int __cil_tmp___20 ;
  int __cil_tmp___21 ;
  int __cil_tmp___22 ;
  int __cil_tmp___23 ;
  int __cil_tmp___24 ;
  int __cil_tmp___25 ;
  int __cil_tmp___26 ;
  int __cil_tmp___27 ;
  int __cil_tmp___28 ;
  int __cil_tmp___29 ;
  int __cil_tmp___30 ;

  {
#line 675
  __cil_tmp = strcasecmp((char const   *)Var, "Name");
#line 675
  if (__cil_tmp == 0) {
#line 677
    len = strlcpy(Conf_ServerName, (char const   *)Arg, sizeof(Conf_ServerName));
#line 678
    if (len >= sizeof(Conf_ServerName)) {
#line 679
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 680
    return;
  }
#line 682
  __cil_tmp___0 = strcasecmp((char const   *)Var, "Info");
#line 682
  if (__cil_tmp___0 == 0) {
#line 684
    len = strlcpy(Conf_ServerInfo, (char const   *)Arg, sizeof(Conf_ServerInfo));
#line 685
    if (len >= sizeof(Conf_ServerInfo)) {
#line 686
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 687
    return;
  }
#line 689
  __cil_tmp___1 = strcasecmp((char const   *)Var, "Password");
#line 689
  if (__cil_tmp___1 == 0) {
#line 691
    len = strlcpy(Conf_ServerPwd, (char const   *)Arg, sizeof(Conf_ServerPwd));
#line 692
    if (len >= sizeof(Conf_ServerPwd)) {
#line 693
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 694
    return;
  }
#line 696
  __cil_tmp___2 = strcasecmp((char const   *)Var, "AdminInfo1");
#line 696
  if (__cil_tmp___2 == 0) {
#line 698
    len = strlcpy(Conf_ServerAdmin1, (char const   *)Arg, sizeof(Conf_ServerAdmin1));
#line 699
    if (len >= sizeof(Conf_ServerAdmin1)) {
#line 700
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 701
    return;
  }
#line 703
  __cil_tmp___3 = strcasecmp((char const   *)Var, "AdminInfo2");
#line 703
  if (__cil_tmp___3 == 0) {
#line 705
    len = strlcpy(Conf_ServerAdmin2, (char const   *)Arg, sizeof(Conf_ServerAdmin2));
#line 706
    if (len >= sizeof(Conf_ServerAdmin2)) {
#line 707
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 708
    return;
  }
#line 710
  __cil_tmp___4 = strcasecmp((char const   *)Var, "AdminEMail");
#line 710
  if (__cil_tmp___4 == 0) {
#line 712
    len = strlcpy(Conf_ServerAdminMail, (char const   *)Arg, sizeof(Conf_ServerAdminMail));
#line 713
    if (len >= sizeof(Conf_ServerAdminMail)) {
#line 714
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 715
    return;
  }
#line 718
  __cil_tmp___5 = strcasecmp((char const   *)Var, "Ports");
#line 718
  if (__cil_tmp___5 == 0) {
#line 719
    ports_parse(& Conf_ListenPorts, Line, Arg);
#line 720
    return;
  }
#line 722
  __cil_tmp___6 = strcasecmp((char const   *)Var, "MotdFile");
#line 722
  if (__cil_tmp___6 == 0) {
#line 724
    len = strlcpy(Conf_MotdFile, (char const   *)Arg, sizeof(Conf_MotdFile));
#line 725
    if (len >= sizeof(Conf_MotdFile)) {
#line 726
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 727
    return;
  }
#line 729
  __cil_tmp___7 = strcasecmp((char const   *)Var, "MotdPhrase");
#line 729
  if (__cil_tmp___7 == 0) {
#line 731
    len = strlcpy(Conf_MotdPhrase, (char const   *)Arg, sizeof(Conf_MotdPhrase));
#line 732
    if (len >= sizeof(Conf_MotdPhrase)) {
#line 733
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 734
    return;
  }
#line 736
  __cil_tmp___8 = strcasecmp((char const   *)Var, "ChrootDir");
#line 736
  if (__cil_tmp___8 == 0) {
#line 738
    len = strlcpy(Conf_Chroot, (char const   *)Arg, sizeof(Conf_Chroot));
#line 739
    if (len >= sizeof(Conf_Chroot)) {
#line 740
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 741
    return;
  }
#line 743
  __cil_tmp___9 = strcasecmp((char const   *)Var, "PidFile");
#line 743
  if (__cil_tmp___9 == 0) {
#line 745
    len = strlcpy(Conf_PidFile, (char const   *)Arg, sizeof(Conf_PidFile));
#line 746
    if (len >= sizeof(Conf_PidFile)) {
#line 747
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 748
    return;
  }
#line 750
  __cil_tmp___12 = strcasecmp((char const   *)Var, "ServerUID");
#line 750
  if (__cil_tmp___12 == 0) {
#line 752
    pwd = getpwnam((char const   *)Arg);
#line 753
    if (pwd) {
#line 753
      Conf_UID = pwd->pw_uid;
    } else {
#line 756
      __cil_tmp___11 = isdigit((int )*Arg);
#line 756
      if (__cil_tmp___11) {
#line 759
        __cil_tmp___10 = atoi((char const   *)Arg);
#line 759
        Conf_UID = (unsigned int )__cil_tmp___10;
      } else {
#line 756
        Config_Error_NaN(Line, (char const   *)Var);
      }
    }
#line 761
    return;
  }
#line 763
  __cil_tmp___15 = strcasecmp((char const   *)Var, "ServerGID");
#line 763
  if (__cil_tmp___15 == 0) {
#line 765
    grp = getgrnam((char const   *)Arg);
#line 766
    if (grp) {
#line 766
      Conf_GID = grp->gr_gid;
    } else {
#line 769
      __cil_tmp___14 = isdigit((int )*Arg);
#line 769
      if (__cil_tmp___14) {
#line 772
        __cil_tmp___13 = atoi((char const   *)Arg);
#line 772
        Conf_GID = (unsigned int )__cil_tmp___13;
      } else {
#line 769
        Config_Error_NaN(Line, (char const   *)Var);
      }
    }
#line 774
    return;
  }
#line 776
  __cil_tmp___16 = strcasecmp((char const   *)Var, "PingTimeout");
#line 776
  if (__cil_tmp___16 == 0) {
#line 778
    Conf_PingTimeout = atoi((char const   *)Arg);
#line 779
    if (Conf_PingTimeout < 5) {
#line 780
      Config_Error(4, "%s, line %d: Value of \"PingTimeout\" too low!", NGIRCd_ConfFile,
                   Line);
#line 782
      Conf_PingTimeout = 5;
    }
#line 784
    return;
  }
#line 786
  __cil_tmp___17 = strcasecmp((char const   *)Var, "PongTimeout");
#line 786
  if (__cil_tmp___17 == 0) {
#line 788
    Conf_PongTimeout = atoi((char const   *)Arg);
#line 789
    if (Conf_PongTimeout < 5) {
#line 790
      Config_Error(4, "%s, line %d: Value of \"PongTimeout\" too low!", NGIRCd_ConfFile,
                   Line);
#line 792
      Conf_PongTimeout = 5;
    }
#line 794
    return;
  }
#line 796
  __cil_tmp___18 = strcasecmp((char const   *)Var, "ConnectRetry");
#line 796
  if (__cil_tmp___18 == 0) {
#line 798
    Conf_ConnectRetry = atoi((char const   *)Arg);
#line 799
    if (Conf_ConnectRetry < 5) {
#line 800
      Config_Error(4, "%s, line %d: Value of \"ConnectRetry\" too low!", NGIRCd_ConfFile,
                   Line);
#line 802
      Conf_ConnectRetry = 5;
    }
#line 804
    return;
  }
#line 806
  __cil_tmp___19 = strcasecmp((char const   *)Var, "PredefChannelsOnly");
#line 806
  if (__cil_tmp___19 == 0) {
#line 808
    Conf_PredefChannelsOnly = Check_ArgIsTrue((char const   *)Arg);
#line 809
    return;
  }
#line 811
  __cil_tmp___20 = strcasecmp((char const   *)Var, "NoDNS");
#line 811
  if (__cil_tmp___20 == 0) {
#line 813
    Conf_NoDNS = Check_ArgIsTrue((char const   *)Arg);
#line 814
    return;
  }
#line 816
  __cil_tmp___21 = strcasecmp((char const   *)Var, "OperCanUseMode");
#line 816
  if (__cil_tmp___21 == 0) {
#line 818
    Conf_OperCanMode = Check_ArgIsTrue((char const   *)Arg);
#line 819
    return;
  }
#line 821
  __cil_tmp___22 = strcasecmp((char const   *)Var, "OperServerMode");
#line 821
  if (__cil_tmp___22 == 0) {
#line 823
    Conf_OperServerMode = Check_ArgIsTrue((char const   *)Arg);
#line 824
    return;
  }
#line 826
  __cil_tmp___24 = strcasecmp((char const   *)Var, "MaxConnections");
#line 826
  if (__cil_tmp___24 == 0) {
#line 829
    __cil_tmp___23 = isdigit((int )*Arg);
#line 829
    if (__cil_tmp___23) {
#line 832
      Conf_MaxConnections = atol((char const   *)Arg);
    } else {
#line 829
      Config_Error_NaN(Line, (char const   *)Var);
    }
#line 833
    return;
  }
#line 835
  __cil_tmp___26 = strcasecmp((char const   *)Var, "MaxConnectionsIP");
#line 835
  if (__cil_tmp___26 == 0) {
#line 838
    __cil_tmp___25 = isdigit((int )*Arg);
#line 838
    if (__cil_tmp___25) {
#line 841
      Conf_MaxConnectionsIP = atoi((char const   *)Arg);
    } else {
#line 838
      Config_Error_NaN(Line, (char const   *)Var);
    }
#line 842
    return;
  }
#line 844
  __cil_tmp___28 = strcasecmp((char const   *)Var, "MaxJoins");
#line 844
  if (__cil_tmp___28 == 0) {
#line 847
    __cil_tmp___27 = isdigit((int )*Arg);
#line 847
    if (__cil_tmp___27) {
#line 850
      Conf_MaxJoins = atoi((char const   *)Arg);
    } else {
#line 847
      Config_Error_NaN(Line, (char const   *)Var);
    }
#line 851
    return;
  }
#line 853
  __cil_tmp___29 = strcasecmp((char const   *)Var, "MaxNickLength");
#line 853
  if (__cil_tmp___29 == 0) {
#line 856
    Conf_MaxNickLength = Handle_MaxNickLength(Line, (char const   *)Arg);
#line 857
    return;
  }
#line 860
  __cil_tmp___30 = strcasecmp((char const   *)Var, "Listen");
#line 860
  if (__cil_tmp___30 == 0) {
#line 862
    len = strlcpy(Conf_ListenAddress, (char const   *)Arg, sizeof(Conf_ListenAddress));
#line 863
    if (len >= sizeof(Conf_ListenAddress)) {
#line 864
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 865
    return;
  }
#line 868
  Config_Error(3, "%s, line %d (section \"Global\"): Unknown variable \"%s\"!", NGIRCd_ConfFile,
               Line, Var);
#line 870
  return;
}
}
#line 873 "conf.c"
static void Handle_OPERATOR(int Line , char *Var , char *Arg ) 
{ unsigned int opercount ;
  size_t len ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 883
  if (Conf_Oper_Count == 0U) {
#line 884
    return;
  }
#line 886
  opercount = Conf_Oper_Count - 1U;
#line 888
  __cil_tmp = strcasecmp((char const   *)Var, "Name");
#line 888
  if (__cil_tmp == 0) {
#line 890
    len = strlcpy(Conf_Oper[opercount].name, (char const   *)Arg, sizeof(Conf_Oper[opercount].name));
#line 891
    if (len >= sizeof(Conf_Oper[opercount].name)) {
#line 892
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 893
    return;
  }
#line 895
  __cil_tmp___0 = strcasecmp((char const   *)Var, "Password");
#line 895
  if (__cil_tmp___0 == 0) {
#line 897
    len = strlcpy(Conf_Oper[opercount].pwd, (char const   *)Arg, sizeof(Conf_Oper[opercount].pwd));
#line 898
    if (len >= sizeof(Conf_Oper[opercount].pwd)) {
#line 899
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 900
    return;
  }
#line 902
  __cil_tmp___1 = strcasecmp((char const   *)Var, "Mask");
#line 902
  if (__cil_tmp___1 == 0) {
#line 903
    if (Conf_Oper[opercount].mask) {
#line 903
      return;
    }
#line 905
    Conf_Oper[opercount].mask = strdup_warn((char const   *)Arg);
#line 906
    return;
  }
#line 908
  Config_Error(3, "%s, line %d (section \"Operator\"): Unknown variable \"%s\"!",
               NGIRCd_ConfFile, Line, Var);
#line 910
  return;
}
}
#line 913 "conf.c"
static void Handle_SERVER(int Line , char *Var , char *Arg ) 
{ long port ;
  size_t len ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 924
  if (New_Server_Idx <= -1) {
#line 924
    return;
  }
#line 926
  __cil_tmp = strcasecmp((char const   *)Var, "Host");
#line 926
  if (__cil_tmp == 0) {
#line 928
    len = strlcpy(New_Server.host, (char const   *)Arg, sizeof(New_Server.host));
#line 929
    if (len >= sizeof(New_Server.host)) {
#line 930
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 931
    return;
  }
#line 933
  __cil_tmp___0 = strcasecmp((char const   *)Var, "Name");
#line 933
  if (__cil_tmp___0 == 0) {
#line 935
    len = strlcpy(New_Server.name, (char const   *)Arg, sizeof(New_Server.name));
#line 936
    if (len >= sizeof(New_Server.name)) {
#line 937
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 938
    return;
  }
#line 940
  __cil_tmp___2 = strcasecmp((char const   *)Var, "Bind");
#line 940
  if (__cil_tmp___2 == 0) {
#line 941
    __cil_tmp___1 = ngt_IPStrToBin((char const   *)Arg, & New_Server.bind_addr);
#line 941
    if (__cil_tmp___1) {
#line 942
      return;
    }
#line 944
    Config_Error(3, "%s, line %d (section \"Server\"): Can\'t parse IP address \"%s\"",
                 NGIRCd_ConfFile, Line, Arg);
#line 946
    return;
  }
#line 948
  __cil_tmp___3 = strcasecmp((char const   *)Var, "MyPassword");
#line 948
  if (__cil_tmp___3 == 0) {
#line 950
    if ((int )*Arg == 58) {
#line 951
      Config_Error(3, "%s, line %d (section \"Server\"): MyPassword must not start with \':\'!",
                   NGIRCd_ConfFile, Line);
    }
#line 955
    len = strlcpy(New_Server.pwd_in, (char const   *)Arg, sizeof(New_Server.pwd_in));
#line 956
    if (len >= sizeof(New_Server.pwd_in)) {
#line 957
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 958
    return;
  }
#line 960
  __cil_tmp___4 = strcasecmp((char const   *)Var, "PeerPassword");
#line 960
  if (__cil_tmp___4 == 0) {
#line 962
    len = strlcpy(New_Server.pwd_out, (char const   *)Arg, sizeof(New_Server.pwd_out));
#line 963
    if (len >= sizeof(New_Server.pwd_out)) {
#line 964
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 965
    return;
  }
#line 967
  __cil_tmp___5 = strcasecmp((char const   *)Var, "Port");
#line 967
  if (__cil_tmp___5 == 0) {
#line 969
    port = atol((char const   *)Arg);
#line 970
    if (port > 0L) {
#line 970
      if (port < 65535L) {
#line 971
        New_Server.port = (unsigned short )port;
      } else {
#line 973
        Config_Error(3, "%s, line %d (section \"Server\"): Illegal port number %ld!",
                     NGIRCd_ConfFile, Line, port);
      }
    } else {
#line 973
      Config_Error(3, "%s, line %d (section \"Server\"): Illegal port number %ld!",
                   NGIRCd_ConfFile, Line, port);
    }
#line 975
    return;
  }
#line 977
  __cil_tmp___7 = strcasecmp((char const   *)Var, "Group");
#line 977
  if (__cil_tmp___7 == 0) {
#line 980
    __cil_tmp___6 = isdigit((int )*Arg);
#line 980
    if (__cil_tmp___6) {
#line 984
      New_Server.group = atoi((char const   *)Arg);
    } else {
#line 981
      Config_Error_NaN(Line, (char const   *)Var);
    }
#line 985
    return;
  }
#line 987
  __cil_tmp___9 = strcasecmp((char const   *)Var, "Passive");
#line 987
  if (__cil_tmp___9 == 0) {
#line 988
    __cil_tmp___8 = Check_ArgIsTrue((char const   *)Arg);
#line 988
    if (__cil_tmp___8) {
#line 989
      New_Server.flags |= 2;
    }
#line 990
    return;
  }
#line 993
  Config_Error(3, "%s, line %d (section \"Server\"): Unknown variable \"%s\"!", NGIRCd_ConfFile,
               Line, Var);
#line 995
  return;
}
}
#line 998 "conf.c"
static int Handle_Channelname(size_t chancount , char const   *name ) 
{ size_t size ;
  char *dest ;
  size_t __cil_tmp ;

  {
#line 1001
  size = sizeof(Conf_Channel[chancount].name);
#line 1002
  dest = Conf_Channel[chancount].name;
#line 1004
  if (*name) {
#line 1004
    if ((int const   )*name != 35) {
#line 1005
      *dest = (char )'#';
#line 1006
      size --;
#line 1007
      dest ++;
    }
  }
#line 1009
  __cil_tmp = strlcpy(dest, name, size);
#line 1009
  return (size > __cil_tmp);
}
}
#line 1013 "conf.c"
static void Handle_CHANNEL(int Line , char *Var , char *Arg ) 
{ size_t len ;
  size_t chancount ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  long __cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 1017
  chancount = (size_t )0;
#line 1022
  if (Conf_Channel_Count > 0U) {
#line 1023
    chancount = (unsigned long )(Conf_Channel_Count - 1U);
  }
#line 1025
  __cil_tmp___0 = strcasecmp((char const   *)Var, "Name");
#line 1025
  if (__cil_tmp___0 == 0) {
#line 1026
    __cil_tmp = Handle_Channelname(chancount, (char const   *)Arg);
#line 1026
    if (! __cil_tmp) {
#line 1027
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 1028
    return;
  }
#line 1030
  __cil_tmp___1 = strcasecmp((char const   *)Var, "Modes");
#line 1030
  if (__cil_tmp___1 == 0) {
#line 1032
    len = strlcpy(Conf_Channel[chancount].modes, (char const   *)Arg, sizeof(Conf_Channel[chancount].modes));
#line 1033
    if (len >= sizeof(Conf_Channel[chancount].modes)) {
#line 1034
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 1035
    return;
  }
#line 1037
  __cil_tmp___3 = strcasecmp((char const   *)Var, "Topic");
#line 1037
  if (__cil_tmp___3 == 0) {
#line 1039
    __cil_tmp___2 = array_copys(& Conf_Channel[chancount].topic, (char const   *)Arg);
#line 1039
    if (! __cil_tmp___2) {
#line 1040
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 1041
    return;
  }
#line 1044
  __cil_tmp___4 = strcasecmp((char const   *)Var, "Key");
#line 1044
  if (__cil_tmp___4 == 0) {
#line 1046
    len = strlcpy(Conf_Channel[chancount].key, (char const   *)Arg, sizeof(Conf_Channel[chancount].key));
#line 1047
    if (len >= sizeof(Conf_Channel[chancount].key)) {
#line 1048
      Config_Error_TooLong(Line, (char const   *)Var);
    }
#line 1049
    return;
  }
#line 1052
  __cil_tmp___6 = strcasecmp((char const   *)Var, "MaxUsers");
#line 1052
  if (__cil_tmp___6 == 0) {
#line 1054
    __cil_tmp___5 = atol((char const   *)Arg);
#line 1054
    Conf_Channel[chancount].maxusers = (unsigned long )__cil_tmp___5;
#line 1055
    if (Conf_Channel[chancount].maxusers == 0UL) {
#line 1056
      Config_Error_NaN(Line, (char const   *)Var);
    }
#line 1057
    return;
  }
#line 1060
  Config_Error(3, "%s, line %d (section \"Channel\"): Unknown variable \"%s\"!", NGIRCd_ConfFile,
               Line, Var);
#line 1062
  return;
}
}
#line 1065 "conf.c"
static void Validate_Config(int Configtest , int Rehash ) 
{ char *ptr ;
  char *__cil_tmp ;

  {
#line 1076
  ptr = Conf_ServerName;
#line 1077
  while (1) {
#line 1078
    if ((int )*ptr >= 97) {
#line 1078
      if ((int )*ptr <= 122) {
        goto __Cont;
      }
    }
#line 1079
    if ((int )*ptr >= 65) {
#line 1079
      if ((int )*ptr <= 90) {
        goto __Cont;
      }
    }
#line 1080
    if ((int )*ptr >= 48) {
#line 1080
      if ((int )*ptr <= 57) {
        goto __Cont;
      }
    }
#line 1081
    if ((unsigned int )ptr > (unsigned int )(Conf_ServerName)) {
#line 1082
      if ((int )*ptr == 46) {
        goto __Cont;
      } else {
#line 1082
        if ((int )*ptr == 45) {
          goto __Cont;
        }
      }
    }
#line 1085
    Conf_ServerName[0] = (char )'\000';
#line 1086
    break;
    __Cont: /* CIL Label */ 
#line 1077
    ptr ++;
#line 1077
    if (! *ptr) {
#line 1077
      break;
    }
  }
#line 1089
  if (! Conf_ServerName[0]) {
#line 1091
    Config_Error(1, "No (valid) server name configured in \"%s\" (section \'Global\': \'Name\')!",
                 NGIRCd_ConfFile);
#line 1094
    if (! Configtest) {
#line 1094
      if (! Rehash) {
#line 1095
        Config_Error(1, "%s exiting due to fatal errors!", "ngircd");
#line 1098
        exit(1);
      }
    }
  }
#line 1102
  if (Conf_ServerName[0]) {
#line 1102
    __cil_tmp = strchr((char const   *)(Conf_ServerName), '.');
#line 1102
    if (! __cil_tmp) {
#line 1104
      Config_Error(1, "Invalid server name configured in \"%s\" (section \'Global\': \'Name\'): Dot missing!",
                   NGIRCd_ConfFile);
#line 1107
      if (! Configtest) {
#line 1108
        Config_Error(1, "%s exiting due to fatal errors!", "ngircd");
#line 1111
        exit(1);
      }
    }
  }
#line 1130
  if (! Conf_ServerAdmin1[0]) {
#line 1130
    if (! Conf_ServerAdmin2[0]) {
#line 1130
      if (! Conf_ServerAdminMail[0]) {
#line 1133
        Config_Error(4, "No administrative information configured but required by RFC!");
      }
    }
  }
#line 1150
  return;
}
}
#line 1153 "conf.c"
static void Config_Error_TooLong(int Line , char const   *Item ) 
{ 

  {
#line 1156
  Config_Error(4, "%s, line %d: Value of \"%s\" too long!", NGIRCd_ConfFile, Line,
               Item);
#line 1157
  return;
}
}
#line 1160 "conf.c"
static void Config_Error_NaN(int Line , char const   *Item ) 
{ 

  {
#line 1163
  Config_Error(4, "%s, line %d: Value of \"%s\" is not a number!", NGIRCd_ConfFile,
               Line, Item);
#line 1165
  return;
}
}
#line 1169 "conf.c"
static void Config_Error(int Level , char const   *Format  , ...) 
{ char msg[256] ;
  va_list ap ;

  {
#line 1185
  __builtin_va_start(ap, Format);
#line 1189
  vsnprintf(msg, 256UL, Format, ap);
#line 1190
  __builtin_va_end(ap);
#line 1195
  if (Use_Log) {
#line 1195
    Log(Level, "%s", msg);
  } else {
#line 1196
    puts((char const   *)(msg));
  }
#line 1197
  return;
}
}
#line 1200 "conf.c"
static void Init_Server_Struct(CONF_SERVER *Server ) 
{ time_t __cil_tmp ;

  {
#line 1207
  memset((void *)Server, 0, sizeof(CONF_SERVER ));
#line 1209
  Server->group = -1;
#line 1210
  __cil_tmp = time((time_t *)((void *)0));
#line 1210
  Server->lasttry = (__cil_tmp - (time_t )Conf_ConnectRetry) + 1L;
#line 1212
  if (NGIRCd_Passive) {
#line 1212
    Server->flags = 2;
  }
#line 1214
  Resolve_Init(& Server->res_stat);
#line 1215
  Server->conn_id = -1;
#line 1216
  Server->bind_addr.s_addr = 0U;
#line 1217
  return;
}
}
#line 1 "conn.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-Qa6BtInl.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 44 "/usr/include/libkern/i386/_OSByteOrder.h"
__inline static __uint16_t _OSSwapInt16(__uint16_t _data ) 
{ 

  {
#line 50
  return ((unsigned short )(((int )_data << 8) | ((int )_data >> 8)));
}
}
#line 25 "io.h"
int io_library_init(unsigned int eventsize ) ;
#line 28
void io_library_shutdown(void) ;
#line 31
int io_event_create(int fd , short what , void (*cbfunc)(int  , short  ) ) ;
#line 34
int io_event_setcb(int fd , void (*cbfunc)(int  , short  ) ) ;
#line 37
int io_event_add(int fd , short what ) ;
#line 40
int io_event_del(int fd , short what ) ;
#line 43
int io_close(int fd ) ;
#line 46
int io_setnonblock(int fd ) ;
#line 49
int io_dispatch(struct timeval *tv ) ;
#line 473 "/usr/include/unistd.h"
extern ssize_t read(int  , void * , size_t  )  __asm__("_read$UNIX2003")  ;
#line 108 "/usr/include/string.h"
extern char *strstr(char const   * , char const   * ) ;
#line 557 "/usr/include/sys/socket.h"
extern int accept(int  , struct sockaddr * , socklen_t * )  __asm__("_accept$UNIX2003")  ;
#line 559
extern int bind(int  , struct sockaddr  const  * , socklen_t  )  __asm__("_bind$UNIX2003")  ;
#line 560
extern int connect(int  , struct sockaddr  const  * , socklen_t  )  __asm__("_connect$UNIX2003")  ;
#line 565
extern int getsockopt(int  , int  , int  , void * , socklen_t * ) ;
#line 566
extern int listen(int  , int  )  __asm__("_listen$UNIX2003")  ;
#line 575
extern int setsockopt(int  , int  , int  , void const   * , socklen_t  ) ;
#line 578
extern int socket(int  , int  , int  ) ;
#line 33 "resolve.h"
int Resolve_Addr(RES_STAT *s , struct sockaddr_in *Addr , int identsock , void (*cbfunc)(int  ,
                                                                                         short  ) ) ;
#line 34
int Resolve_Name(RES_STAT *s , char const   *Host , void (*cbfunc)(int  , short  ) ) ;
#line 35
size_t Resolve_Read(RES_STAT *s , void *readbuf , size_t buflen ) ;
#line 37
int Resolve_Shutdown(RES_STAT *s ) ;
#line 77 "conn.h"
CONNECTION *My_Connections  ;
#line 78 "conn.h"
CONN_ID Pool_Size  ;
#line 79 "conn.h"
long WCounter  ;
#line 92
int Conn_WriteStr(CONN_ID Idx , char *Format  , ...) ;
#line 98
CLIENT *Conn_GetClient(CONN_ID Idx ) ;
#line 41 "conn-func.h"
void Conn_SetPenalty(CONN_ID Idx , time_t Seconds ) ;
#line 42
void Conn_ResetPenalty(CONN_ID Idx ) ;
#line 48 "parse.h"
int Parse_Request(CONN_ID Idx , char *Request ) ;
#line 98 "/usr/include/arpa/inet.h"
extern char *inet_ntoa(struct in_addr  ) ;
#line 79 "conn.c"
static int Handle_Write(CONN_ID Idx ) ;
#line 80
static int Conn_Write(CONN_ID Idx , char *Data , size_t Len ) ;
#line 81
static int New_Connection(int Sock ) ;
#line 82
static CONN_ID Socket2Index(int Sock ) ;
#line 83
static void Read_Request(CONN_ID Idx ) ;
#line 84
static int Handle_Buffer(CONN_ID Idx ) ;
#line 85
static void Check_Connections(void) ;
#line 86
static void Check_Servers(void) ;
#line 87
static void Init_Conn_Struct(CONN_ID Idx ) ;
#line 88
static int Init_Socket(int Sock ) ;
#line 89
static void New_Server___0(int Server , struct in_addr *dest ) ;
#line 90
static void Simple_Message(int Sock , char const   *Msg ) ;
#line 91
static int Count_Connections(struct sockaddr_in addr_in ) ;
#line 92
static int NewListener(UINT16 Port ) ;
#line 94 "conn.c"
static array My_Listeners  ;
#line 95 "conn.c"
static array My_ConnArray  ;
#line 102
static void server_login(CONN_ID idx ) ;
#line 104
static void cb_Read_Resolver_Result(int r_fd , short events  __attribute__((__unused__)) ) ;
#line 105
static void cb_Connect_to_Server(int fd , short events  __attribute__((__unused__)) ) ;
#line 106
static void cb_clientserver(int sock , short what ) ;
#line 108 "conn.c"
static void cb_listen(int sock , short irrelevant ) 
{ 

  {
#line 112
  New_Connection(sock);
#line 113
  return;
}
}
#line 116 "conn.c"
static void cb_connserver(int sock , short what  __attribute__((__unused__)) ) 
{ int res ;
  int err ;
  socklen_t sock_len ;
  CONN_ID idx ;
  CONN_ID __cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 121
  __cil_tmp = Socket2Index(sock);
#line 121
  idx = __cil_tmp;
#line 122
  if (idx <= -1) {
#line 123
    LogDebug("cb_connserver wants to write on unknown socket?!");
#line 124
    io_close(sock);
#line 125
    return;
  }
#line 131
  sock_len = (unsigned int )sizeof(err);
#line 132
  res = getsockopt((My_Connections + idx)->sock, 65535, 4103, (void *)(& err), & sock_len);
#line 136
  if (res != 0) {
    goto _L;
  } else {
#line 136
    if (err != 0) {
      _L: /* CIL Label */ 
#line 137
      if (res != 0) {
#line 138
        __cil_tmp___0 = __error();
#line 138
        __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 138
        Log(2, "getsockopt (connection %d): %s!", idx, __cil_tmp___1);
      } else {
#line 141
        __cil_tmp___2 = strerror(err);
#line 141
        __cil_tmp___3 = Conf_GetServer(idx);
#line 141
        Log(2, "Can\'t connect socket to \"%s:%d\" (connection %d): %s!", (My_Connections + idx)->host,
            Conf_Server[__cil_tmp___3].port, idx, __cil_tmp___2);
      }
#line 147
      Conn_Close(idx, (char *)"Can\'t connect!", (char *)((void *)0), 0);
#line 148
      return;
    }
  }
#line 151
  (My_Connections + idx)->options = (unsigned short )((int )(My_Connections + idx)->options & -3);
#line 152
  server_login(idx);
#line 153
  return;
}
}
#line 156 "conn.c"
static void server_login(CONN_ID idx ) 
{ int __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 159
  __cil_tmp = Conf_GetServer(idx);
#line 159
  Log(6, "Connection %d with \"%s:%d\" established. Now logging in ...", idx, (My_Connections + idx)->host,
      Conf_Server[__cil_tmp].port);
#line 162
  io_event_setcb((My_Connections + idx)->sock, & cb_clientserver);
#line 163
  io_event_add((My_Connections + idx)->sock, (short)3);
#line 166
  __cil_tmp___0 = Conf_GetServer(idx);
#line 166
  Conn_WriteStr(idx, (char *)"PASS %s %s", Conf_Server[__cil_tmp___0].pwd_out, NGIRCd_ProtoID);
#line 167
  Conn_WriteStr(idx, (char *)"SERVER %s :%s", Conf_ServerName, Conf_ServerInfo);
#line 168
  return;
}
}
#line 171 "conn.c"
static void cb_clientserver(int sock , short what ) 
{ CONN_ID idx ;
  CONN_ID __cil_tmp ;

  {
#line 174
  __cil_tmp = Socket2Index(sock);
#line 174
  idx = __cil_tmp;
#line 175
  if (idx <= -1) {
#line 179
    io_close(sock);
#line 180
    return;
  }
#line 183
  if ((int )what & 1) {
#line 184
    Read_Request(idx);
  }
#line 186
  if ((int )what & 2) {
#line 187
    Handle_Write(idx);
  }
#line 188
  return;
}
}
#line 191 "conn.c"
void Conn_Init(void) 
{ CONN_ID i ;
  void *__cil_tmp ;
  void *__cil_tmp___0 ;
  size_t __cil_tmp___1 ;

  {
#line 199
  Pool_Size = 100;
#line 200
  if (Conf_MaxConnections > 0L) {
#line 203
    if ((long )Pool_Size > Conf_MaxConnections) {
#line 203
      Pool_Size = (int )Conf_MaxConnections;
    }
  }
#line 206
  __cil_tmp = array_alloc(& My_ConnArray, sizeof(CONNECTION ), (unsigned long )Pool_Size);
#line 206
  if (! __cil_tmp) {
#line 207
    Log(0, "Can\'t allocate memory! [Conn_Init]");
#line 208
    exit(1);
  }
#line 213
  __cil_tmp___0 = array_start((array const   *)(& My_ConnArray));
#line 213
  My_Connections = (CONNECTION *)__cil_tmp___0;
#line 215
  __cil_tmp___1 = array_length((array const   *)(& My_ConnArray), sizeof(CONNECTION ));
#line 215
  LogDebug("Allocated connection pool for %d items (%ld bytes).", __cil_tmp___1, My_ConnArray.used);
#line 220
  array_free(& My_Listeners);
#line 223
  i = 0;
#line 223
  while (i < Pool_Size) {
#line 223
    Init_Conn_Struct(i);
#line 223
    i ++;
  }
#line 226
  WCounter = 0L;
#line 227
  return;
}
}
#line 230 "conn.c"
void Conn_Exit(void) 
{ CONN_ID idx ;
  char const   *__cil_tmp ;

  {
#line 238
  LogDebug("Shutting down all connections ...");
#line 240
  Conn_ExitListeners();
#line 243
  idx = 0;
#line 243
  while (idx < Pool_Size) {
#line 244
    if ((My_Connections + idx)->sock > -1) {
#line 245
      if (NGIRCd_SignalRestart) {
#line 245
        __cil_tmp = "Server going down (restarting)";
      } else {
#line 245
        __cil_tmp = "Server going down";
      }
#line 245
      Conn_Close(idx, (char *)((void *)0), (char *)__cil_tmp, 1);
    }
#line 243
    idx ++;
  }
#line 250
  array_free(& My_ConnArray);
#line 251
  My_Connections = (CONNECTION *)((void *)0);
#line 252
  Pool_Size = 0;
#line 253
  io_library_shutdown();
#line 254
  return;
}
}
#line 257 "conn.c"
static unsigned int ports_initlisteners(array *a , void (*func)(int  , short  ) ) 
{ unsigned int created ;
  size_t len ;
  int fd ;
  UINT16 *port ;
  void *__cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  size_t __cil_tmp___3 ;

  {
#line 260
  created = 0U;
#line 265
  len = array_length((array const   *)a, sizeof(UINT16 ));
#line 266
  __cil_tmp = array_start((array const   *)a);
#line 266
  port = (UINT16 *)__cil_tmp;
#line 267
  while (1) {
#line 267
    __cil_tmp___3 = len;
#line 267
    len --;
#line 267
    if (! __cil_tmp___3) {
#line 267
      break;
    }
#line 268
    fd = NewListener(*port);
#line 269
    if (fd < 0) {
#line 270
      port ++;
#line 271
      continue;
    }
#line 273
    __cil_tmp___2 = io_event_create(fd, (short)1, func);
#line 273
    if (! __cil_tmp___2) {
#line 274
      __cil_tmp___0 = __error();
#line 274
      __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 274
      Log(3, "io_event_create(): Could not add listening fd %d (port %u): %s!", fd,
          (unsigned int )*port, __cil_tmp___1);
#line 276
      close(fd);
#line 277
      port ++;
#line 278
      continue;
    }
#line 280
    created ++;
#line 281
    port ++;
  }
#line 284
  return (created);
}
}
#line 288 "conn.c"
unsigned int Conn_InitListeners(void) 
{ unsigned int created ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 295
  __cil_tmp___1 = io_library_init(100U);
#line 295
  if (! __cil_tmp___1) {
#line 296
    __cil_tmp = __error();
#line 296
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 296
    Log(0, "Cannot initialize IO routines: %s", __cil_tmp___0);
#line 297
    return (4294967295U);
  }
#line 300
  created = ports_initlisteners(& Conf_ListenPorts, & cb_listen);
#line 302
  return (created);
}
}
#line 306 "conn.c"
void Conn_ExitListeners(void) 
{ int *fd ;
  size_t arraylen ;
  void *__cil_tmp ;
  size_t __cil_tmp___0 ;

  {
#line 316
  arraylen = array_length((array const   *)(& My_Listeners), sizeof(int ));
#line 317
  Log(6, "Shutting down all listening sockets (%d total)...", arraylen);
#line 318
  __cil_tmp = array_start((array const   *)(& My_Listeners));
#line 318
  fd = (int *)__cil_tmp;
#line 319
  while (1) {
#line 319
    __cil_tmp___0 = arraylen;
#line 319
    arraylen --;
#line 319
    if (! __cil_tmp___0) {
#line 319
      break;
    }
#line 322
    io_close(*fd);
#line 323
    LogDebug("Listening socket %d closed.", *fd);
#line 324
    fd ++;
  }
#line 326
  array_free(& My_Listeners);
#line 327
  return;
}
}
#line 330 "conn.c"
static void InitSinaddr(struct sockaddr_in *addr , UINT16 Port ) 
{ struct in_addr inaddr ;
  __uint16_t __cil_tmp ;

  {
#line 335
  memset((void *)addr, 0, sizeof(*addr));
#line 336
  memset((void *)(& inaddr), 0, sizeof(inaddr));
#line 338
  addr->sin_family = (unsigned char)2;
#line 339
  __cil_tmp = _OSSwapInt16(Port);
#line 339
  addr->sin_port = (unsigned short )((int )__cil_tmp);
#line 340
  inaddr.s_addr = 0U;
#line 341
  addr->sin_addr = inaddr;
#line 342
  return;
}
}
#line 345 "conn.c"
static int InitSinaddrListenAddr(struct sockaddr_in *addr , UINT16 Port ) 
{ struct in_addr inaddr ;
  int __cil_tmp ;

  {
#line 350
  InitSinaddr(addr, Port);
#line 352
  if (! Conf_ListenAddress[0]) {
#line 353
    return (1);
  }
#line 355
  __cil_tmp = ngt_IPStrToBin((char const   *)(Conf_ListenAddress), & inaddr);
#line 355
  if (! __cil_tmp) {
#line 356
    Log(2, "Can\'t bind to %s:%u: can\'t convert ip address \"%s\"", Conf_ListenAddress,
        Port, Conf_ListenAddress);
#line 358
    return (0);
  }
#line 361
  addr->sin_addr = inaddr;
#line 362
  return (1);
}
}
#line 367 "conn.c"
static int NewListener(UINT16 Port ) 
{ struct sockaddr_in addr ;
  int sock ;
  __uint16_t __cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;

  {
#line 378
  InitSinaddrListenAddr(& addr, Port);
#line 380
  addr.sin_family = (unsigned char)2;
#line 381
  __cil_tmp = _OSSwapInt16(Port);
#line 381
  addr.sin_port = (unsigned short )((int )__cil_tmp);
#line 383
  sock = socket(2, 1, 0);
#line 384
  if (sock < 0) {
#line 385
    __cil_tmp___0 = __error();
#line 385
    __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 385
    Log(2, "Can\'t create socket: %s!", __cil_tmp___1);
#line 386
    return (-1);
  }
#line 389
  __cil_tmp___2 = Init_Socket(sock);
#line 389
  if (! __cil_tmp___2) {
#line 389
    return (-1);
  }
#line 391
  __cil_tmp___5 = bind(sock, (struct sockaddr  const  *)((struct sockaddr *)(& addr)),
                       (unsigned int )sizeof(addr));
#line 391
  if (__cil_tmp___5 != 0) {
#line 392
    __cil_tmp___3 = __error();
#line 392
    __cil_tmp___4 = strerror(*__cil_tmp___3);
#line 392
    Log(2, "Can\'t bind socket (port %d) : %s!", Port, __cil_tmp___4);
#line 393
    close(sock);
#line 394
    return (-1);
  }
#line 397
  __cil_tmp___8 = listen(sock, 10);
#line 397
  if (__cil_tmp___8 != 0) {
#line 398
    __cil_tmp___6 = __error();
#line 398
    __cil_tmp___7 = strerror(*__cil_tmp___6);
#line 398
    Log(2, "Can\'t listen on socket: %s!", __cil_tmp___7);
#line 399
    close(sock);
#line 400
    return (-1);
  }
#line 404
  __cil_tmp___11 = array_catb(& My_Listeners, (char const   *)((char *)(& sock)),
                              sizeof(int ));
#line 404
  if (! __cil_tmp___11) {
#line 405
    __cil_tmp___9 = __error();
#line 405
    __cil_tmp___10 = strerror(*__cil_tmp___9);
#line 405
    Log(2, "Can\'t add socket to My_Listeners array: %s!", __cil_tmp___10);
#line 406
    close(sock);
#line 407
    return (-1);
  }
#line 410
  if (Conf_ListenAddress[0]) {
#line 410
    Log(6, "Now listening on %s:%d (socket %d).", Conf_ListenAddress, Port, sock);
  } else {
#line 411
    Log(6, "Now listening on 0.0.0.0:%d (socket %d).", Port, sock);
  }
#line 443
  return (sock);
}
}
#line 447 "conn.c"
void Conn_Handler(void) 
{ int i ;
  unsigned int wdatalen ;
  struct timeval tv ;
  time_t t ;
  int timeout ;
  int __cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int *__cil_tmp___2 ;

  {
#line 462
  while (1) {
#line 462
    if (! NGIRCd_SignalQuit) {
#line 462
      if (! (! NGIRCd_SignalRestart)) {
#line 462
        break;
      }
    } else {
#line 462
      break;
    }
#line 463
    timeout = 1;
#line 470
    if (NGIRCd_SignalRehash) {
#line 471
      NGIRCd_Rehash();
    }
#line 475
    Check_Servers();
#line 476
    Check_Connections();
#line 478
    t = time((time_t *)((void *)0));
#line 481
    i = 0;
#line 481
    while (i < Pool_Size) {
#line 482
      if ((My_Connections + i)->sock > -1) {
#line 482
        if ((My_Connections + i)->rbuf.used > 0UL) {
#line 482
          if ((My_Connections + i)->delaytime < t) {
#line 486
            __cil_tmp = Handle_Buffer(i);
#line 486
            if (__cil_tmp) {
#line 486
              timeout = 0;
            }
          }
        }
      }
#line 481
      i ++;
    }
#line 491
    i = 0;
#line 491
    while (i < Pool_Size) {
#line 492
      if ((My_Connections + i)->sock <= -1) {
        goto __Cont;
      }
#line 495
      wdatalen = (unsigned int )(My_Connections + i)->wbuf.used;
#line 500
      if (wdatalen > 0U) {
#line 504
        io_event_add((My_Connections + i)->sock, (short)2);
      }
      __Cont: /* CIL Label */ 
#line 491
      i ++;
    }
#line 509
    i = 0;
#line 509
    while (i < Pool_Size) {
#line 510
      if ((My_Connections + i)->sock <= -1) {
        goto __Cont___0;
      }
#line 513
      if ((My_Connections + i)->res_stat.resolver_fd >= 0) {
#line 515
        io_event_del((My_Connections + i)->sock, (short)1);
        goto __Cont___0;
      }
#line 519
      if (((int )(My_Connections + i)->options & 2) != 0) {
        goto __Cont___0;
      }
#line 522
      if ((My_Connections + i)->delaytime > t) {
#line 524
        io_event_del((My_Connections + i)->sock, (short)1);
        goto __Cont___0;
      }
#line 527
      io_event_add((My_Connections + i)->sock, (short)1);
      __Cont___0: /* CIL Label */ 
#line 509
      i ++;
    }
#line 531
    tv.tv_usec = 0;
#line 532
    if (timeout) {
#line 532
      tv.tv_sec = 1L;
    } else {
#line 532
      tv.tv_sec = 0L;
    }
#line 535
    i = io_dispatch(& tv);
#line 536
    if (i == -1) {
#line 536
      __cil_tmp___2 = __error();
#line 536
      if (*__cil_tmp___2 != 4) {
#line 537
        __cil_tmp___0 = __error();
#line 537
        __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 537
        Log(0, "Conn_Handler(): io_dispatch(): %s!", __cil_tmp___1);
#line 538
        Log(1, "%s exiting due to fatal errors!", "ngircd");
#line 539
        exit(1);
      }
    }
  }
#line 543
  if (NGIRCd_SignalQuit) {
#line 543
    Log(1029, "Server going down NOW!");
  } else {
#line 544
    if (NGIRCd_SignalRestart) {
#line 544
      Log(1029, "Server restarting NOW!");
    }
  }
#line 545
  return;
}
}
#line 558 "conn.c"
int Conn_WriteStr(CONN_ID Idx , char *Format  , ...) 
{ char buffer[513] ;
  size_t len ;
  int ok ;
  va_list ap ;
  size_t __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 577
  __builtin_va_start(ap, Format);
#line 581
  __cil_tmp___0 = vsnprintf(buffer, 511UL, (char const   *)Format, ap);
#line 581
  if (__cil_tmp___0 >= 511) {
#line 605
    __cil_tmp = strlen("[CUT]");
#line 605
    strcpy((((buffer + sizeof(buffer)) - __cil_tmp) - 2) - 1, "[CUT]");
  }
#line 614
  len = strlcat(buffer, "\r\n", sizeof(buffer));
#line 615
  ok = Conn_Write(Idx, buffer, len);
#line 616
  ((My_Connections + Idx)->msg_out) ++;
#line 618
  __builtin_va_end(ap);
#line 619
  return (ok);
}
}
#line 630 "conn.c"
static int Conn_Write(CONN_ID Idx , char *Data , size_t Len ) 
{ CLIENT *c ;
  size_t writebuf_limit ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 634
  writebuf_limit = (size_t )4096;
#line 639
  c = Conn_GetClient(Idx);
#line 644
  __cil_tmp = Client_Type(c);
#line 644
  if (__cil_tmp == 32) {
#line 645
    writebuf_limit = 51200UL;
  }
#line 650
  if ((My_Connections + Idx)->sock <= -1) {
#line 651
    LogDebug("Skipped write on closed socket (connection %d).", Idx);
#line 652
    return (0);
  }
#line 669
  if ((My_Connections + Idx)->wbuf.used + Len >= writebuf_limit) {
#line 673
    __cil_tmp___0 = Handle_Write(Idx);
#line 673
    if (! __cil_tmp___0) {
#line 674
      return (0);
    }
  }
#line 679
  if ((My_Connections + Idx)->wbuf.used + Len >= writebuf_limit) {
#line 681
    Log(5, "Write buffer overflow (connection %d, size %lu byte)!", Idx, (My_Connections + Idx)->wbuf.used);
#line 685
    Conn_Close(Idx, (char *)"Write buffer overflow!", (char *)((void *)0), 0);
#line 686
    return (0);
  }
#line 690
  __cil_tmp___1 = array_catb(& (My_Connections + Idx)->wbuf, (char const   *)Data,
                             Len);
#line 690
  if (! __cil_tmp___1) {
#line 691
    return (0);
  }
#line 693
  (My_Connections + Idx)->bytes_out = (long )((size_t )(My_Connections + Idx)->bytes_out + Len);
#line 697
  WCounter = (long )((size_t )WCounter + Len);
#line 699
  return (1);
}
}
#line 703 "conn.c"
void Conn_Close(CONN_ID Idx , char *LogMsg , char *FwdMsg , int InformClient ) 
{ CLIENT *c ;
  char *txt ;
  double in_k ;
  double out_k ;
  __uint16_t __cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  CLIENT *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  __uint16_t __cil_tmp___7 ;
  int __cil_tmp___8 ;
  __uint16_t __cil_tmp___9 ;

  {
#line 720
  if (((int )(My_Connections + Idx)->options & 1) != 0) {
#line 723
    LogDebug("Recursive request to close connection: %d", Idx);
#line 724
    return;
  }
#line 730
  (My_Connections + Idx)->options = (unsigned short )((int )(My_Connections + Idx)->options | 1);
#line 732
  if (LogMsg) {
#line 733
    txt = LogMsg;
  } else {
#line 735
    txt = FwdMsg;
  }
#line 736
  if (! txt) {
#line 737
    txt = (char *)"Reason unknown";
  }
#line 739
  __cil_tmp = _OSSwapInt16((My_Connections + Idx)->addr.sin_port);
#line 739
  if (LogMsg) {
#line 739
    __cil_tmp___0 = LogMsg;
  } else {
#line 739
    __cil_tmp___0 = FwdMsg;
  }
#line 739
  Log(6, "Shutting down connection %d (%s) with %s:%d ...", Idx, __cil_tmp___0, (My_Connections + Idx)->host,
      (int )__cil_tmp);
#line 744
  c = Conn_GetClient(Idx);
#line 747
  if (InformClient) {
#line 750
    if ((unsigned int )c != (unsigned int )((void *)0)) {
#line 750
      __cil_tmp___4 = Client_Type(c);
#line 750
      if (__cil_tmp___4 == 16) {
#line 751
        __cil_tmp___1 = Client_ID(c);
#line 751
        __cil_tmp___2 = Client_ThisServer();
#line 751
        __cil_tmp___3 = Client_ID(__cil_tmp___2);
#line 751
        Conn_WriteStr(Idx, (char *)":%s NOTICE %s :%sConnection statistics: client %.1f kb, server %.1f kb.",
                      __cil_tmp___3, __cil_tmp___1, "", (double )(My_Connections + Idx)->bytes_in / (double )1024,
                      (double )(My_Connections + Idx)->bytes_out / (double )1024);
      }
    }
#line 760
    if (FwdMsg) {
#line 761
      Conn_WriteStr(Idx, (char *)"ERROR :%s", FwdMsg);
    } else {
#line 763
      Conn_WriteStr(Idx, (char *)"ERROR :Closing connection.");
    }
  }
#line 770
  Handle_Write(Idx);
#line 773
  c = Conn_GetClient(Idx);
#line 776
  __cil_tmp___8 = io_close((My_Connections + Idx)->sock);
#line 776
  if (! __cil_tmp___8) {
#line 778
    __cil_tmp___5 = __error();
#line 778
    __cil_tmp___6 = strerror(*__cil_tmp___5);
#line 778
    __cil_tmp___7 = _OSSwapInt16((My_Connections + Idx)->addr.sin_port);
#line 778
    Log(2, "Error closing connection %d (socket %d) with %s:%d - %s! (ignored)", Idx,
        (My_Connections + Idx)->sock, (My_Connections + Idx)->host, (int )__cil_tmp___7,
        __cil_tmp___6);
  }
#line 785
  (My_Connections + Idx)->sock = -1;
#line 788
  if (c) {
#line 789
    Client_Destroy(c, LogMsg, FwdMsg, 1);
  }
#line 792
  in_k = (double )(My_Connections + Idx)->bytes_in / (double )1024;
#line 793
  out_k = (double )(My_Connections + Idx)->bytes_out / (double )1024;
#line 817
  __cil_tmp___9 = _OSSwapInt16((My_Connections + Idx)->addr.sin_port);
#line 817
  Log(6, "Connection %d with %s:%d closed (in: %.1fk, out: %.1fk).", Idx, (My_Connections + Idx)->host,
      (int )__cil_tmp___9, in_k, out_k);
#line 825
  if ((My_Connections + Idx)->res_stat.resolver_fd >= 0) {
#line 826
    Resolve_Shutdown(& (My_Connections + Idx)->res_stat);
  }
#line 829
  Conf_UnsetServer(Idx);
#line 841
  array_free(& (My_Connections + Idx)->rbuf);
#line 842
  array_free(& (My_Connections + Idx)->wbuf);
#line 845
  Init_Conn_Struct(Idx);
#line 847
  LogDebug("Shutdown of connection %d completed.", Idx);
#line 848
  return;
}
}
#line 851 "conn.c"
void Conn_SyncServerStruct(void) 
{ CLIENT *client ;
  CONN_ID i ;
  int c ;
  int __cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 861
  i = 0;
#line 861
  while (i < Pool_Size) {
#line 863
    if ((My_Connections + i)->sock < 0) {
      goto __Cont;
    }
#line 867
    client = Conn_GetClient(i);
#line 868
    if (! client) {
      goto __Cont;
    } else {
#line 868
      __cil_tmp = Client_Type(client);
#line 868
      if (__cil_tmp != 32) {
        goto __Cont;
      }
    }
#line 870
    c = 0;
#line 870
    while (c < 16) {
#line 873
      if (! Conf_Server[c].host[0]) {
        goto __Cont___0;
      }
#line 876
      __cil_tmp___0 = Client_ID(client);
#line 876
      __cil_tmp___1 = strcmp((char const   *)(Conf_Server[c].name), (char const   *)__cil_tmp___0);
#line 876
      if (__cil_tmp___1 == 0) {
#line 877
        Conf_Server[c].conn_id = i;
      }
      __Cont___0: /* CIL Label */ 
#line 870
      c ++;
    }
    __Cont: /* CIL Label */ 
#line 861
    i ++;
  }
#line 880
  return;
}
}
#line 886 "conn.c"
static int Handle_Write(CONN_ID Idx ) 
{ ssize_t len ;
  size_t wdatalen ;
  void *__cil_tmp ;
  int *__cil_tmp___0 ;
  int *__cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;

  {
#line 893
  if ((My_Connections + Idx)->sock < 0) {
#line 894
    LogDebug("Handle_Write() on closed socket, connection %d", Idx);
#line 895
    return (0);
  }
#line 899
  wdatalen = (My_Connections + Idx)->wbuf.used;
#line 913
  if (wdatalen == 0UL) {
#line 915
    io_event_del((My_Connections + Idx)->sock, (short)2);
#line 916
    return (1);
  }
#line 919
  LogDebug("Handle_Write() called for connection %d, %ld bytes pending ...", Idx,
           wdatalen);
#line 923
  __cil_tmp = array_start((array const   *)(& (My_Connections + Idx)->wbuf));
#line 923
  len = write((My_Connections + Idx)->sock, (void const   *)__cil_tmp, wdatalen);
#line 926
  if (len < 0L) {
#line 927
    __cil_tmp___0 = __error();
#line 927
    if (*__cil_tmp___0 == 35) {
#line 928
      return (1);
    } else {
#line 927
      __cil_tmp___1 = __error();
#line 927
      if (*__cil_tmp___1 == 4) {
#line 928
        return (1);
      }
    }
#line 930
    __cil_tmp___2 = __error();
#line 930
    __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 930
    Log(3, "Write error on connection %d (socket %d): %s!", Idx, (My_Connections + Idx)->sock,
        __cil_tmp___3);
#line 932
    Conn_Close(Idx, (char *)"Write error!", (char *)((void *)0), 0);
#line 933
    return (0);
  }
#line 937
  array_moveleft(& (My_Connections + Idx)->wbuf, 1UL, (unsigned long )len);
#line 939
  return (1);
}
}
#line 943 "conn.c"
static int New_Connection(int Sock ) 
{ struct sockaddr_in new_addr ;
  int new_sock ;
  int new_sock_len ;
  int new_Pool_Size ;
  CLIENT *c ;
  long cnt ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  void *__cil_tmp___4 ;
  size_t __cil_tmp___5 ;
  void *__cil_tmp___6 ;
  CONN_ID __cil_tmp___7 ;
  int __cil_tmp___8 ;
  char *__cil_tmp___9 ;
  __uint16_t __cil_tmp___10 ;
  char *__cil_tmp___11 ;
  char *__cil_tmp___12 ;

  {
#line 959
  new_sock_len = (int )sizeof(new_addr);
#line 960
  new_sock = accept(Sock, (struct sockaddr *)(& new_addr), (socklen_t *)(& new_sock_len));
#line 962
  if (new_sock < 0) {
#line 963
    __cil_tmp = __error();
#line 963
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 963
    Log(2, "Can\'t accept connection: %s!", __cil_tmp___0);
#line 964
    return (-1);
  }
#line 982
  __cil_tmp___1 = Init_Socket(new_sock);
#line 982
  if (! __cil_tmp___1) {
#line 983
    return (-1);
  }
#line 986
  __cil_tmp___2 = Count_Connections(new_addr);
#line 986
  cnt = (long )__cil_tmp___2;
#line 987
  if (Conf_MaxConnectionsIP > 0) {
#line 987
    if (cnt >= (long )Conf_MaxConnectionsIP) {
#line 990
      __cil_tmp___3 = inet_ntoa(new_addr.sin_addr);
#line 990
      Log(3, "Refused connection from %s: too may connections (%ld) from this IP address!",
          __cil_tmp___3, cnt);
#line 991
      Simple_Message(new_sock, "ERROR :Connection refused, too many connections from your IP address!");
#line 992
      close(new_sock);
#line 993
      return (-1);
    }
  }
#line 996
  if (new_sock >= Pool_Size) {
#line 997
    new_Pool_Size = new_sock + 1;
#line 999
    if (Conf_MaxConnections > 0L) {
#line 999
      if ((long )Pool_Size >= Conf_MaxConnections) {
#line 1002
        Log(1, "Can\'t accept connection: limit (%d) reached!", Pool_Size);
#line 1003
        Simple_Message(new_sock, "ERROR :Connection limit reached");
#line 1004
        close(new_sock);
#line 1005
        return (-1);
      } else {
        goto _L;
      }
    } else {
      _L: /* CIL Label */ 
#line 999
      if (new_Pool_Size < Pool_Size) {
#line 1002
        Log(1, "Can\'t accept connection: limit (%d) reached!", Pool_Size);
#line 1003
        Simple_Message(new_sock, "ERROR :Connection limit reached");
#line 1004
        close(new_sock);
#line 1005
        return (-1);
      }
    }
#line 1008
    __cil_tmp___4 = array_alloc(& My_ConnArray, sizeof(CONNECTION ), (unsigned long )new_sock);
#line 1008
    if (! __cil_tmp___4) {
#line 1010
      Log(0, "Can\'t allocate memory! [New_Connection]");
#line 1011
      Simple_Message(new_sock, "ERROR: Internal error");
#line 1012
      close(new_sock);
#line 1013
      return (-1);
    }
#line 1015
    __cil_tmp___5 = array_length((array const   *)(& My_ConnArray), sizeof(CONNECTION ));
#line 1015
    LogDebug("Bumped connection pool to %ld items (internal: %ld items, %ld bytes)",
             new_sock, __cil_tmp___5, My_ConnArray.used);
#line 1019
    __cil_tmp___6 = array_start((array const   *)(& My_ConnArray));
#line 1019
    My_Connections = (CONNECTION *)__cil_tmp___6;
#line 1020
    while (Pool_Size < new_Pool_Size) {
#line 1021
      __cil_tmp___7 = Pool_Size;
#line 1021
      Pool_Size ++;
#line 1021
      Init_Conn_Struct(__cil_tmp___7);
    }
  }
#line 1025
  __cil_tmp___8 = io_event_create(new_sock, (short)1, & cb_clientserver);
#line 1025
  if (! __cil_tmp___8) {
#line 1026
    Log(1, "Can\'t accept connection: io_event_create failed!");
#line 1027
    Simple_Message(new_sock, "ERROR :Internal error");
#line 1028
    close(new_sock);
#line 1029
    return (-1);
  }
#line 1032
  __cil_tmp___9 = inet_ntoa(new_addr.sin_addr);
#line 1032
  c = Client_NewLocal(new_sock, __cil_tmp___9, 1, 0);
#line 1033
  if (! c) {
#line 1034
    Log(1, "Can\'t accept connection: can\'t create client structure!");
#line 1035
    Simple_Message(new_sock, "ERROR :Internal error");
#line 1036
    io_close(new_sock);
#line 1037
    return (-1);
  }
#line 1040
  Init_Conn_Struct(new_sock);
#line 1041
  (My_Connections + new_sock)->sock = new_sock;
#line 1042
  (My_Connections + new_sock)->addr = new_addr;
#line 1043
  (My_Connections + new_sock)->client = c;
#line 1045
  __cil_tmp___10 = _OSSwapInt16(new_addr.sin_port);
#line 1045
  __cil_tmp___11 = inet_ntoa(new_addr.sin_addr);
#line 1045
  Log(6, "Accepted connection %d from %s:%d on socket %d.", new_sock, __cil_tmp___11,
      (int )__cil_tmp___10, Sock);
#line 1049
  __cil_tmp___12 = inet_ntoa(new_addr.sin_addr);
#line 1049
  strlcpy((My_Connections + new_sock)->host, (char const   *)__cil_tmp___12, sizeof((My_Connections + new_sock)->host));
#line 1052
  Client_SetHostname(c, (My_Connections + new_sock)->host);
#line 1054
  if (! Conf_NoDNS) {
#line 1055
    Resolve_Addr(& (My_Connections + new_sock)->res_stat, & new_addr, (My_Connections + new_sock)->sock,
                 & cb_Read_Resolver_Result);
  }
#line 1058
  Conn_SetPenalty(new_sock, 4L);
#line 1059
  return (new_sock);
}
}
#line 1063 "conn.c"
static CONN_ID Socket2Index(int Sock ) 
{ 

  {
#line 1070
  if (Sock >= Pool_Size) {
#line 1073
    LogDebug("Socket2Index: can\'t get connection for socket %d!", Sock);
#line 1074
    return (-1);
  } else {
#line 1070
    if ((My_Connections + Sock)->sock != Sock) {
#line 1073
      LogDebug("Socket2Index: can\'t get connection for socket %d!", Sock);
#line 1074
      return (-1);
    }
  }
#line 1076
  return (Sock);
}
}
#line 1084 "conn.c"
static void Read_Request(CONN_ID Idx ) 
{ ssize_t len ;
  char readbuf[2048] ;
  CLIENT *c ;
  char *__cil_tmp ;
  __uint16_t __cil_tmp___0 ;
  int *__cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;

  {
#line 1097
  if ((My_Connections + Idx)->rbuf.used >= 2048UL) {
#line 1101
    Log(3, "Receive buffer overflow (connection %d): %d bytes!", Idx, (My_Connections + Idx)->rbuf.used);
#line 1104
    Conn_Close(Idx, (char *)"Receive buffer overflow!", (char *)((void *)0), 0);
#line 1105
    return;
  }
#line 1108
  len = read((My_Connections + Idx)->sock, (void *)(readbuf), sizeof(readbuf));
#line 1109
  if (len == 0L) {
#line 1110
    __cil_tmp = inet_ntoa((My_Connections + Idx)->addr.sin_addr);
#line 1110
    __cil_tmp___0 = _OSSwapInt16((My_Connections + Idx)->addr.sin_port);
#line 1110
    Log(6, "%s:%d (%s) is closing the connection ...", (My_Connections + Idx)->host,
        (int )__cil_tmp___0, __cil_tmp);
#line 1114
    Conn_Close(Idx, (char *)"Socket closed!", (char *)"Client closed connection",
               0);
#line 1117
    return;
  }
#line 1120
  if (len < 0L) {
#line 1121
    __cil_tmp___1 = __error();
#line 1121
    if (*__cil_tmp___1 == 35) {
#line 1121
      return;
    }
#line 1122
    __cil_tmp___2 = __error();
#line 1122
    __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 1122
    Log(3, "Read error on connection %d (socket %d): %s!", Idx, (My_Connections + Idx)->sock,
        __cil_tmp___3);
#line 1124
    Conn_Close(Idx, (char *)"Read error!", (char *)"Client closed connection", 0);
#line 1126
    return;
  }
#line 1142
  __cil_tmp___4 = array_catb(& (My_Connections + Idx)->rbuf, (char const   *)(readbuf),
                             (unsigned long )len);
#line 1142
  if (! __cil_tmp___4) {
#line 1143
    Log(3, "Could not append recieved data to input buffer (connn %d): %d bytes!",
        Idx, len);
#line 1144
    Conn_Close(Idx, (char *)"Receive buffer overflow!", (char *)((void *)0), 0);
  }
#line 1149
  (My_Connections + Idx)->bytes_in += len;
#line 1156
  c = Conn_GetClient(Idx);
#line 1157
  if (c) {
#line 1157
    __cil_tmp___5 = Client_Type(c);
#line 1157
    if (__cil_tmp___5 == 16) {
#line 1160
      (My_Connections + Idx)->lastdata = time((time_t *)((void *)0));
#line 1161
      (My_Connections + Idx)->lastping = (My_Connections + Idx)->lastdata;
    } else {
#line 1157
      __cil_tmp___6 = Client_Type(c);
#line 1157
      if (__cil_tmp___6 == 32) {
#line 1160
        (My_Connections + Idx)->lastdata = time((time_t *)((void *)0));
#line 1161
        (My_Connections + Idx)->lastping = (My_Connections + Idx)->lastdata;
      } else {
#line 1157
        __cil_tmp___7 = Client_Type(c);
#line 1157
        if (__cil_tmp___7 == 64) {
#line 1160
          (My_Connections + Idx)->lastdata = time((time_t *)((void *)0));
#line 1161
          (My_Connections + Idx)->lastping = (My_Connections + Idx)->lastdata;
        }
      }
    }
  }
#line 1165
  Handle_Buffer(Idx);
#line 1166
  return;
}
}
#line 1169 "conn.c"
static int Handle_Buffer(CONN_ID Idx ) 
{ char *ptr1 ;
  char *ptr2 ;
  char *ptr ;
  size_t len ;
  size_t delta ;
  int result ;
  time_t starttime ;
  int __cil_tmp ;
  void *__cil_tmp___0 ;
  void *__cil_tmp___1 ;
  void *__cil_tmp___2 ;
  void *__cil_tmp___3 ;
  void *__cil_tmp___4 ;
  int __cil_tmp___5 ;

  {
#line 1185
  starttime = time((time_t *)((void *)0));
#line 1186
  result = 0;
#line 1187
  while (1) {
#line 1189
    if ((My_Connections + Idx)->delaytime > starttime) {
#line 1189
      return (result);
    }
#line 1196
    if (0UL == (My_Connections + Idx)->rbuf.used) {
#line 1197
      break;
    }
#line 1199
    __cil_tmp = array_cat0_temporary(& (My_Connections + Idx)->rbuf);
#line 1199
    if (! __cil_tmp) {
#line 1200
      return (0);
    }
#line 1203
    __cil_tmp___0 = array_start((array const   *)(& (My_Connections + Idx)->rbuf));
#line 1203
    ptr = strstr((char const   *)__cil_tmp___0, "\r\n");
#line 1205
    if (ptr) {
#line 1205
      delta = 2UL;
    } else {
#line 1210
      __cil_tmp___1 = array_start((array const   *)(& (My_Connections + Idx)->rbuf));
#line 1210
      ptr1 = strchr((char const   *)__cil_tmp___1, '\r');
#line 1211
      __cil_tmp___2 = array_start((array const   *)(& (My_Connections + Idx)->rbuf));
#line 1211
      ptr2 = strchr((char const   *)__cil_tmp___2, '\n');
#line 1212
      delta = 1UL;
#line 1213
      if (ptr1) {
#line 1213
        if (ptr2) {
#line 1213
          if ((unsigned int )ptr1 > (unsigned int )ptr2) {
#line 1213
            ptr = ptr2;
          } else {
#line 1213
            ptr = ptr1;
          }
        } else {
          goto _L;
        }
      } else {
        _L: /* CIL Label */ 
#line 1214
        if (ptr1) {
#line 1214
          ptr = ptr1;
        } else {
#line 1215
          if (ptr2) {
#line 1215
            ptr = ptr2;
          }
        }
      }
    }
#line 1219
    if (! ptr) {
#line 1220
      break;
    }
#line 1223
    *ptr = (char )'\000';
#line 1225
    __cil_tmp___3 = array_start((array const   *)(& (My_Connections + Idx)->rbuf));
#line 1225
    len = (size_t )(ptr - (char *)__cil_tmp___3) + delta;
#line 1227
    if (len > 512UL) {
#line 1230
      Log(3, "Request too long (connection %d): %d bytes (max. %d expected)!", Idx,
          (My_Connections + Idx)->rbuf.used, 512);
#line 1232
      Conn_Close(Idx, (char *)((void *)0), (char *)"Request too long", 1);
#line 1233
      return (0);
    }
#line 1236
    if (len <= 2UL) {
#line 1237
      array_moveleft(& (My_Connections + Idx)->rbuf, 1UL, delta);
#line 1238
      break;
    }
#line 1245
    ((My_Connections + Idx)->msg_in) ++;
#line 1246
    __cil_tmp___4 = array_start((array const   *)(& (My_Connections + Idx)->rbuf));
#line 1246
    __cil_tmp___5 = Parse_Request(Idx, (char *)__cil_tmp___4);
#line 1246
    if (! __cil_tmp___5) {
#line 1247
      return (0);
    }
#line 1249
    result = 1;
#line 1251
    array_moveleft(& (My_Connections + Idx)->rbuf, 1UL, len);
#line 1252
    LogDebug("Connection %d: %d bytes left in read buffer.", Idx, (My_Connections + Idx)->rbuf.used);
  }
#line 1270
  return (result);
}
}
#line 1274 "conn.c"
static void Check_Connections(void) 
{ CLIENT *c ;
  CONN_ID i ;
  time_t __cil_tmp ;
  CLIENT *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  time_t __cil_tmp___2 ;
  time_t __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 1282
  i = 0;
#line 1282
  while (i < Pool_Size) {
#line 1283
    if ((My_Connections + i)->sock < 0) {
      goto __Cont;
    }
#line 1286
    c = Conn_GetClient(i);
#line 1287
    if (c) {
#line 1287
      __cil_tmp___4 = Client_Type(c);
#line 1287
      if (__cil_tmp___4 == 16) {
        goto _L___0;
      } else {
#line 1287
        __cil_tmp___5 = Client_Type(c);
#line 1287
        if (__cil_tmp___5 == 32) {
          goto _L___0;
        } else {
#line 1287
          __cil_tmp___6 = Client_Type(c);
#line 1287
          if (__cil_tmp___6 == 64) {
            _L___0: /* CIL Label */ 
#line 1291
            if ((My_Connections + i)->lastping > (My_Connections + i)->lastdata) {
#line 1294
              __cil_tmp = time((time_t *)((void *)0));
#line 1294
              if ((My_Connections + i)->lastping < __cil_tmp - (time_t )Conf_PongTimeout) {
#line 1297
                LogDebug("Connection %d: Ping timeout: %d seconds.", i, Conf_PongTimeout);
#line 1300
                Conn_Close(i, (char *)((void *)0), (char *)"Ping timeout", 1);
              }
            } else {
#line 1303
              __cil_tmp___2 = time((time_t *)((void *)0));
#line 1303
              if ((My_Connections + i)->lastdata < __cil_tmp___2 - (time_t )Conf_PingTimeout) {
#line 1306
                LogDebug("Connection %d: sending PING ...", i);
#line 1307
                (My_Connections + i)->lastping = time((time_t *)((void *)0));
#line 1308
                __cil_tmp___0 = Client_ThisServer();
#line 1308
                __cil_tmp___1 = Client_ID(__cil_tmp___0);
#line 1308
                Conn_WriteStr(i, (char *)"PING :%s", __cil_tmp___1);
              }
            }
          } else {
            goto _L;
          }
        }
      }
    } else {
      _L: /* CIL Label */ 
#line 1317
      __cil_tmp___3 = time((time_t *)((void *)0));
#line 1317
      if ((My_Connections + i)->lastdata < __cil_tmp___3 - (time_t )Conf_PongTimeout) {
#line 1319
        LogDebug("Unregistered connection %d timed out ...", i);
#line 1322
        Conn_Close(i, (char *)((void *)0), (char *)"Timeout", 0);
      }
    }
    __Cont: /* CIL Label */ 
#line 1282
    i ++;
  }
#line 1326
  return;
}
}
#line 1329 "conn.c"
static void Check_Servers(void) 
{ int i ;
  int n ;
  time_t time_now ;

  {
#line 1338
  i = 0;
#line 1338
  while (i < 16) {
#line 1340
    if (! Conf_Server[i].host[0]) {
      goto __Cont;
    } else {
#line 1340
      if (! Conf_Server[i].port > 0) {
        goto __Cont;
      } else {
#line 1340
        if (Conf_Server[i].conn_id > -1) {
          goto __Cont;
        } else {
#line 1340
          if (Conf_Server[i].flags & 2) {
            goto __Cont;
          }
        }
      }
    }
#line 1345
    if (Conf_Server[i].group > -1) {
#line 1346
      n = 0;
#line 1346
      while (n < 16) {
#line 1347
        if (n == i) {
          goto __Cont___0;
        }
#line 1348
        if (Conf_Server[n].conn_id != -1) {
#line 1348
          if (Conf_Server[n].group == Conf_Server[i].group) {
#line 1350
            break;
          }
        }
        __Cont___0: /* CIL Label */ 
#line 1346
        n ++;
      }
#line 1352
      if (n < 16) {
        goto __Cont;
      }
    }
#line 1356
    time_now = time((time_t *)((void *)0));
#line 1357
    if (Conf_Server[i].lasttry > time_now - (time_t )Conf_ConnectRetry) {
      goto __Cont;
    }
#line 1361
    Conf_Server[i].lasttry = time_now;
#line 1362
    Conf_Server[i].conn_id = -2;
#line 1364
    Resolve_Name(& Conf_Server[i].res_stat, (char const   *)(Conf_Server[i].host),
                 & cb_Connect_to_Server);
    __Cont: /* CIL Label */ 
#line 1338
    i ++;
  }
#line 1366
  return;
}
}
#line 1369 "conn.c"
static void New_Server___0(int Server , struct in_addr *dest ) 
{ struct sockaddr_in local_addr ;
  struct sockaddr_in new_addr ;
  int res ;
  int new_sock ;
  CLIENT *c ;
  __uint16_t __cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  int *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int *__cil_tmp___9 ;
  void *__cil_tmp___10 ;
  void *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;

  {
#line 1380
  memset((void *)(& new_addr), 0, sizeof(new_addr));
#line 1381
  new_addr.sin_family = (unsigned char)2;
#line 1382
  new_addr.sin_addr = *dest;
#line 1383
  __cil_tmp = _OSSwapInt16(Conf_Server[Server].port);
#line 1383
  new_addr.sin_port = (unsigned short )((int )__cil_tmp);
#line 1385
  new_sock = socket(2, 1, 0);
#line 1386
  if (new_sock < 0) {
#line 1387
    __cil_tmp___0 = __error();
#line 1387
    __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 1387
    Log(2, "Can\'t create socket: %s!", __cil_tmp___1);
#line 1388
    return;
  }
#line 1391
  __cil_tmp___2 = Init_Socket(new_sock);
#line 1391
  if (! __cil_tmp___2) {
#line 1391
    return;
  }
#line 1394
  InitSinaddr(& local_addr, (unsigned short)0);
#line 1395
  local_addr.sin_addr = Conf_Server[Server].bind_addr;
#line 1396
  __cil_tmp___6 = bind(new_sock, (struct sockaddr  const  *)((struct sockaddr *)(& local_addr)),
                       (unsigned int )sizeof(local_addr));
#line 1396
  if (__cil_tmp___6) {
#line 1397
    __cil_tmp___3 = __error();
#line 1397
    __cil_tmp___4 = strerror(*__cil_tmp___3);
#line 1397
    __cil_tmp___5 = inet_ntoa(Conf_Server[Server].bind_addr);
#line 1397
    Log(4, "Can\'t bind socket to %s: %s!", __cil_tmp___5, __cil_tmp___4);
  }
#line 1399
  res = connect(new_sock, (struct sockaddr  const  *)((struct sockaddr *)(& new_addr)),
                (unsigned int )sizeof(new_addr));
#line 1401
  if (res != 0) {
#line 1401
    __cil_tmp___9 = __error();
#line 1401
    if (*__cil_tmp___9 != 36) {
#line 1402
      __cil_tmp___7 = __error();
#line 1402
      __cil_tmp___8 = strerror(*__cil_tmp___7);
#line 1402
      Log(2, "Can\'t connect socket: %s!", __cil_tmp___8);
#line 1403
      close(new_sock);
#line 1404
      return;
    }
  }
#line 1407
  __cil_tmp___10 = array_alloc(& My_ConnArray, sizeof(CONNECTION ), (unsigned long )new_sock);
#line 1407
  if (! __cil_tmp___10) {
#line 1408
    Log(1, "Cannot allocate memory for server connection (socket %d)", new_sock);
#line 1411
    close(new_sock);
#line 1412
    return;
  }
#line 1415
  __cil_tmp___11 = array_start((array const   *)(& My_ConnArray));
#line 1415
  My_Connections = (CONNECTION *)__cil_tmp___11;
#line 1419
  Init_Conn_Struct(new_sock);
#line 1421
  __cil_tmp___12 = inet_ntoa(new_addr.sin_addr);
#line 1421
  c = Client_NewLocal(new_sock, __cil_tmp___12, 128, 0);
#line 1422
  if (! c) {
#line 1423
    Log(1, "Can\'t establish connection: can\'t create client structure!");
#line 1424
    close(new_sock);
#line 1425
    return;
  }
#line 1428
  Client_SetIntroducer(c, c);
#line 1429
  Client_SetToken(c, -2);
#line 1432
  Conf_Server[Server].conn_id = new_sock;
#line 1433
  (My_Connections + new_sock)->sock = new_sock;
#line 1434
  (My_Connections + new_sock)->addr = new_addr;
#line 1435
  (My_Connections + new_sock)->client = c;
#line 1436
  strlcpy((My_Connections + new_sock)->host, (char const   *)(Conf_Server[Server].host),
          sizeof((My_Connections + new_sock)->host));
#line 1440
  __cil_tmp___15 = io_event_create(new_sock, (short)2, & cb_connserver);
#line 1440
  if (! __cil_tmp___15) {
#line 1441
    __cil_tmp___13 = __error();
#line 1441
    __cil_tmp___14 = strerror(*__cil_tmp___13);
#line 1441
    Log(1, "io_event_create(): could not add fd %d", __cil_tmp___14);
#line 1442
    Conn_Close(new_sock, (char *)"io_event_create() failed", (char *)((void *)0),
               0);
#line 1443
    Init_Conn_Struct(new_sock);
#line 1444
    Conf_Server[Server].conn_id = -1;
  }
#line 1447
  LogDebug("Registered new connection %d on socket %d.", new_sock, (My_Connections + new_sock)->sock);
#line 1449
  (My_Connections + new_sock)->options = (unsigned short )((int )(My_Connections + new_sock)->options | 2);
#line 1450
  return;
}
}
#line 1456 "conn.c"
static void Init_Conn_Struct(CONN_ID Idx ) 
{ time_t now ;
  time_t __cil_tmp ;

  {
#line 1459
  __cil_tmp = time((time_t *)((void *)0));
#line 1459
  now = __cil_tmp;
#line 1461
  memset((void *)(My_Connections + Idx), 0, sizeof(CONNECTION ));
#line 1462
  (My_Connections + Idx)->sock = -1;
#line 1463
  (My_Connections + Idx)->signon = now;
#line 1464
  (My_Connections + Idx)->lastdata = now;
#line 1465
  (My_Connections + Idx)->lastprivmsg = now;
#line 1466
  Resolve_Init(& (My_Connections + Idx)->res_stat);
#line 1467
  return;
}
}
#line 1470 "conn.c"
static int Init_Socket(int Sock ) 
{ int value ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;

  {
#line 1477
  __cil_tmp___1 = io_setnonblock(Sock);
#line 1477
  if (! __cil_tmp___1) {
#line 1478
    __cil_tmp = __error();
#line 1478
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 1478
    Log(2, "Can\'t enable non-blocking mode for socket: %s!", __cil_tmp___0);
#line 1479
    close(Sock);
#line 1480
    return (0);
  }
#line 1484
  value = 1;
#line 1485
  __cil_tmp___4 = setsockopt(Sock, 65535, 4, (void const   *)(& value), (unsigned int )sizeof(value));
#line 1485
  if (__cil_tmp___4 != 0) {
#line 1487
    __cil_tmp___2 = __error();
#line 1487
    __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 1487
    Log(3, "Can\'t set socket option SO_REUSEADDR: %s!", __cil_tmp___3);
  }
#line 1502
  return (1);
}
}
#line 1507 "conn.c"
static void cb_Connect_to_Server(int fd , short events  __attribute__((__unused__)) ) 
{ int i ;
  size_t len ;
  struct in_addr dest_addr ;
  char readbuf[257] ;
  int __cil_tmp ;

  {
#line 1516
  LogDebug("Resolver: Got forward lookup callback on fd %d, events %d", fd, events);
#line 1518
  i = 0;
#line 1518
  while (i < 16) {
#line 1519
    if (Conf_Server[i].res_stat.resolver_fd == fd) {
#line 1520
      break;
    }
#line 1518
    i ++;
  }
#line 1523
  if (i >= 16) {
#line 1525
    io_close(fd);
#line 1526
    LogDebug("Resolver: Got Forward Lookup callback for unknown server!?");
#line 1527
    return;
  }
#line 1531
  len = Resolve_Read(& Conf_Server[i].res_stat, (void *)(readbuf), sizeof(readbuf) - 1UL);
#line 1532
  if (len == 0UL) {
#line 1533
    return;
  }
#line 1535
  readbuf[len] = (char )'\000';
#line 1536
  LogDebug("Got result from resolver: \"%s\" (%u bytes read).", readbuf, len);
#line 1538
  __cil_tmp = ngt_IPStrToBin((char const   *)(readbuf), & dest_addr);
#line 1538
  if (! __cil_tmp) {
#line 1539
    Log(3, "Can\'t connect to \"%s\": can\'t convert ip address %s!", Conf_Server[i].host,
        readbuf);
#line 1541
    return;
  }
#line 1544
  Log(6, "Establishing connection to \"%s\", %s, port %d ... ", Conf_Server[i].host,
      readbuf, Conf_Server[i].port);
#line 1547
  New_Server___0(i, & dest_addr);
#line 1548
  return;
}
}
#line 1551 "conn.c"
static void cb_Read_Resolver_Result(int r_fd , short events  __attribute__((__unused__)) ) 
{ CLIENT *c ;
  int i ;
  size_t len ;
  char *identptr ;
  char readbuf[257] ;
  int __cil_tmp ;

  {
#line 1568
  LogDebug("Resolver: Got callback on fd %d, events %d", r_fd, events);
#line 1571
  i = 0;
#line 1571
  while (i < Pool_Size) {
#line 1572
    if ((My_Connections + i)->sock != -1) {
#line 1572
      if ((My_Connections + i)->res_stat.resolver_fd == r_fd) {
#line 1574
        break;
      }
    }
#line 1571
    i ++;
  }
#line 1576
  if (i >= Pool_Size) {
#line 1579
    io_close(r_fd);
#line 1580
    LogDebug("Resolver: Got callback for unknown connection!?");
#line 1581
    return;
  }
#line 1585
  len = Resolve_Read(& (My_Connections + i)->res_stat, (void *)(readbuf), sizeof(readbuf) - 1UL);
#line 1586
  if (len == 0UL) {
#line 1587
    return;
  }
#line 1589
  readbuf[len] = (char )'\000';
#line 1590
  identptr = strchr((char const   *)(readbuf), '\n');
#line 1592
  if (! identptr) {
#line 1593
    Log(2, "Resolver: Got malformed result!");
#line 1594
    return;
  }
#line 1597
  *identptr = (char )'\000';
#line 1598
  LogDebug("Got result from resolver: \"%s\" (%u bytes read).", readbuf, len);
#line 1604
  c = Conn_GetClient(i);
#line 1608
  __cil_tmp = Client_Type(c);
#line 1608
  if (__cil_tmp == 1) {
#line 1609
    strlcpy((My_Connections + i)->host, (char const   *)(readbuf), sizeof((My_Connections + i)->host));
#line 1610
    Client_SetHostname(c, readbuf);
  }
#line 1625
  Conn_ResetPenalty(i);
#line 1626
  return;
}
}
#line 1629 "conn.c"
static void Simple_Message(int Sock , char const   *Msg ) 
{ char buf[513] ;
  size_t len ;

  {
#line 1640
  strlcpy(buf, Msg, sizeof(buf) - 2UL);
#line 1641
  len = strlcat(buf, "\r\n", sizeof(buf));
#line 1642
  write(Sock, (void const   *)(buf), len);
#line 1643
  return;
}
}
#line 1646 "conn.c"
static int Count_Connections(struct sockaddr_in addr_in ) 
{ int i ;
  int cnt ;

  {
#line 1651
  cnt = 0;
#line 1652
  i = 0;
#line 1652
  while (i < Pool_Size) {
#line 1653
    if ((My_Connections + i)->sock > -1) {
#line 1653
      if ((My_Connections + i)->addr.sin_addr.s_addr == addr_in.sin_addr.s_addr) {
#line 1653
        cnt ++;
      }
    }
#line 1652
    i ++;
  }
#line 1655
  return (cnt);
}
}
#line 1659 "conn.c"
CLIENT *Conn_GetClient(CONN_ID Idx ) 
{ CONNECTION *c ;
  void *__cil_tmp ;
  CLIENT *__cil_tmp___0 ;

  {
#line 1668
  __cil_tmp = array_get(& My_ConnArray, sizeof(CONNECTION ), (unsigned long )Idx);
#line 1668
  c = (CONNECTION *)__cil_tmp;
#line 1672
  if (c) {
#line 1672
    __cil_tmp___0 = c->client;
  } else {
#line 1672
    __cil_tmp___0 = (CLIENT *)((void *)0);
  }
#line 1672
  return (__cil_tmp___0);
}
}
#line 1 "conn-func.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-hW1yrzHm.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 30 "conn-func.h"
time_t Conn_GetSignon(CONN_ID Idx ) ;
#line 31
time_t Conn_GetIdle(CONN_ID Idx ) ;
#line 32
time_t Conn_LastPing(CONN_ID Idx ) ;
#line 33
time_t Conn_StartTime(CONN_ID Idx ) ;
#line 34
size_t Conn_SendQ(CONN_ID Idx ) ;
#line 35
size_t Conn_RecvQ(CONN_ID Idx ) ;
#line 36
long Conn_SendMsg(CONN_ID Idx ) ;
#line 37
long Conn_RecvMsg(CONN_ID Idx ) ;
#line 38
long Conn_SendBytes(CONN_ID Idx ) ;
#line 39
long Conn_RecvBytes(CONN_ID Idx ) ;
#line 44
void Conn_ClearFlags(void) ;
#line 45
int Conn_Flag(CONN_ID Idx ) ;
#line 46
void Conn_SetFlag(CONN_ID Idx , int Flag ) ;
#line 48
CONN_ID Conn_First(void) ;
#line 49
CONN_ID Conn_Next(CONN_ID Idx ) ;
#line 51
UINT16 Conn_Options(CONN_ID Idx ) ;
#line 53
void Conn_ResetWCounter(void) ;
#line 54
long Conn_WCounter(void) ;
#line 32 "conn-func.c"
void Conn_UpdateIdle(CONN_ID Idx ) 
{ 

  {
#line 38
  (My_Connections + Idx)->lastprivmsg = time((time_t *)((void *)0));
#line 39
  return;
}
}
#line 45 "conn-func.c"
time_t Conn_GetSignon(CONN_ID Idx ) 
{ 

  {
#line 49
  return ((My_Connections + Idx)->signon);
}
}
#line 52 "conn-func.c"
time_t Conn_GetIdle(CONN_ID Idx ) 
{ time_t __cil_tmp ;

  {
#line 58
  __cil_tmp = time((time_t *)((void *)0));
#line 58
  return (__cil_tmp - (My_Connections + Idx)->lastprivmsg);
}
}
#line 62 "conn-func.c"
time_t Conn_LastPing(CONN_ID Idx ) 
{ 

  {
#line 68
  return ((My_Connections + Idx)->lastping);
}
}
#line 72 "conn-func.c"
void Conn_SetPenalty(CONN_ID Idx , time_t Seconds ) 
{ time_t t ;
  time_t __cil_tmp ;

  {
#line 85
  __cil_tmp = time((time_t *)((void *)0));
#line 85
  t = __cil_tmp + Seconds;
#line 86
  if (t > (My_Connections + Idx)->delaytime) {
#line 87
    (My_Connections + Idx)->delaytime = t;
  }
#line 93
  return;
}
}
#line 96 "conn-func.c"
void Conn_ResetPenalty(CONN_ID Idx ) 
{ 

  {
#line 100
  (My_Connections + Idx)->delaytime = 0L;
#line 101
  return;
}
}
#line 104 "conn-func.c"
void Conn_ClearFlags(void) 
{ CONN_ID i ;

  {
#line 111
  i = 0;
#line 111
  while (i < Pool_Size) {
#line 111
    (My_Connections + i)->flag = 0;
#line 111
    i ++;
  }
#line 112
  return;
}
}
#line 115 "conn-func.c"
int Conn_Flag(CONN_ID Idx ) 
{ 

  {
#line 121
  return ((My_Connections + Idx)->flag);
}
}
#line 125 "conn-func.c"
void Conn_SetFlag(CONN_ID Idx , int Flag ) 
{ 

  {
#line 131
  (My_Connections + Idx)->flag = Flag;
#line 132
  return;
}
}
#line 135 "conn-func.c"
CONN_ID Conn_First(void) 
{ CONN_ID i ;

  {
#line 143
  i = 0;
#line 143
  while (i < Pool_Size) {
#line 145
    if ((My_Connections + i)->sock != -1) {
#line 145
      return (i);
    }
#line 143
    i ++;
  }
#line 147
  return (-1);
}
}
#line 151 "conn-func.c"
CONN_ID Conn_Next(CONN_ID Idx ) 
{ CONN_ID i ;

  {
#line 157
  i = -1;
#line 161
  i = Idx + 1;
#line 161
  while (i < Pool_Size) {
#line 163
    if ((My_Connections + i)->sock != -1) {
#line 163
      return (i);
    }
#line 161
    i ++;
  }
#line 165
  return (-1);
}
}
#line 169 "conn-func.c"
UINT16 Conn_Options(CONN_ID Idx ) 
{ 

  {
#line 173
  return ((My_Connections + Idx)->options);
}
}
#line 182 "conn-func.c"
time_t Conn_StartTime(CONN_ID Idx ) 
{ CLIENT *c ;
  time_t __cil_tmp ;

  {
#line 190
  c = Conn_GetClient(Idx);
#line 191
  if ((unsigned int )c != (unsigned int )((void *)0)) {
#line 192
    __cil_tmp = Client_StartTime(c);
#line 192
    return (__cil_tmp);
  }
#line 194
  return (0L);
}
}
#line 198 "conn-func.c"
size_t Conn_SendQ(CONN_ID Idx ) 
{ 

  {
#line 209
  return ((My_Connections + Idx)->wbuf.used);
}
}
#line 213 "conn-func.c"
long Conn_SendMsg(CONN_ID Idx ) 
{ 

  {
#line 219
  return ((My_Connections + Idx)->msg_out);
}
}
#line 223 "conn-func.c"
long Conn_SendBytes(CONN_ID Idx ) 
{ 

  {
#line 229
  return ((My_Connections + Idx)->bytes_out);
}
}
#line 233 "conn-func.c"
size_t Conn_RecvQ(CONN_ID Idx ) 
{ 

  {
#line 244
  return ((My_Connections + Idx)->rbuf.used);
}
}
#line 248 "conn-func.c"
long Conn_RecvMsg(CONN_ID Idx ) 
{ 

  {
#line 254
  return ((My_Connections + Idx)->msg_in);
}
}
#line 258 "conn-func.c"
long Conn_RecvBytes(CONN_ID Idx ) 
{ 

  {
#line 264
  return ((My_Connections + Idx)->bytes_in);
}
}
#line 268 "conn-func.c"
void Conn_ResetWCounter(void) 
{ 

  {
#line 271
  WCounter = 0L;
#line 272
  return;
}
}
#line 275 "conn-func.c"
long Conn_WCounter(void) 
{ 

  {
#line 278
  return (WCounter);
}
}
#line 1 "conn-zip.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-ib3iko73.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 1 "hash.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-v11ap3Vy.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 31 "./../tool/tool.h"
char *ngt_LowerStr(char *String ) ;
#line 30 "hash.c"
static UINT32 jenkins_hash(UINT8 *k , UINT32 length , UINT32 initval ) ;
#line 33 "hash.c"
UINT32 Hash(char const   *String ) 
{ char buffer[256] ;
  size_t __cil_tmp ;
  char *__cil_tmp___0 ;
  UINT32 __cil_tmp___1 ;

  {
#line 40
  strlcpy(buffer, String, sizeof(buffer));
#line 41
  __cil_tmp = strlen((char const   *)(buffer));
#line 41
  __cil_tmp___0 = ngt_LowerStr(buffer);
#line 41
  __cil_tmp___1 = jenkins_hash((UINT8 *)__cil_tmp___0, (unsigned int )__cil_tmp, 42U);
#line 41
  return (__cil_tmp___1);
}
}
#line 75 "hash.c"
static UINT32 jenkins_hash(UINT8 *k , UINT32 length , UINT32 initval ) 
{ register UINT32 a ;
  register UINT32 b ;
  register UINT32 c ;
  register UINT32 len ;

  {
#line 86
  len = length;
#line 87
  b = 2654435769U;
#line 87
  a = b;
#line 88
  c = initval;
#line 91
  while (len >= 12U) {
#line 93
    a += (((unsigned int )*(k + 0) + ((unsigned int )*(k + 1) << 8)) + ((unsigned int )*(k + 2) << 16)) + ((unsigned int )*(k + 3) << 24);
#line 94
    b += (((unsigned int )*(k + 4) + ((unsigned int )*(k + 5) << 8)) + ((unsigned int )*(k + 6) << 16)) + ((unsigned int )*(k + 7) << 24);
#line 95
    c += (((unsigned int )*(k + 8) + ((unsigned int )*(k + 9) << 8)) + ((unsigned int )*(k + 10) << 16)) + ((unsigned int )*(k + 11) << 24);
#line 96
    a -= b;
#line 96
    a -= c;
#line 96
    a ^= c >> 13;
#line 96
    b -= c;
#line 96
    b -= a;
#line 96
    b ^= a << 8;
#line 96
    c -= a;
#line 96
    c -= b;
#line 96
    c ^= b >> 13;
#line 96
    a -= b;
#line 96
    a -= c;
#line 96
    a ^= c >> 12;
#line 96
    b -= c;
#line 96
    b -= a;
#line 96
    b ^= a << 16;
#line 96
    c -= a;
#line 96
    c -= b;
#line 96
    c ^= b >> 5;
#line 96
    a -= b;
#line 96
    a -= c;
#line 96
    a ^= c >> 3;
#line 96
    b -= c;
#line 96
    b -= a;
#line 96
    b ^= a << 10;
#line 96
    c -= a;
#line 96
    c -= b;
#line 96
    c ^= b >> 15;
#line 97
    k += 12;
#line 97
    len -= 12U;
  }
#line 101
  c += length;
#line 102
  switch ((int )len) {
  case 11: 
#line 104
  c += (unsigned int )*(k + 10) << 24;
  case 10: 
#line 105
  c += (unsigned int )*(k + 9) << 16;
  case 9: 
#line 106
  c += (unsigned int )*(k + 8) << 8;
  case 8: 
#line 108
  b += (unsigned int )*(k + 7) << 24;
  case 7: 
#line 109
  b += (unsigned int )*(k + 6) << 16;
  case 6: 
#line 110
  b += (unsigned int )*(k + 5) << 8;
  case 5: 
#line 111
  b += (UINT32 )*(k + 4);
  case 4: 
#line 112
  a += (unsigned int )*(k + 3) << 24;
  case 3: 
#line 113
  a += (unsigned int )*(k + 2) << 16;
  case 2: 
#line 114
  a += (unsigned int )*(k + 1) << 8;
  case 1: 
#line 115
  a += (UINT32 )*(k + 0);
  }
#line 118
  a -= b;
#line 118
  a -= c;
#line 118
  a ^= c >> 13;
#line 118
  b -= c;
#line 118
  b -= a;
#line 118
  b ^= a << 8;
#line 118
  c -= a;
#line 118
  c -= b;
#line 118
  c ^= b >> 13;
#line 118
  a -= b;
#line 118
  a -= c;
#line 118
  a ^= c >> 12;
#line 118
  b -= c;
#line 118
  b -= a;
#line 118
  b ^= a << 16;
#line 118
  c -= a;
#line 118
  c -= b;
#line 118
  c ^= b >> 5;
#line 118
  a -= b;
#line 118
  a -= c;
#line 118
  a ^= c >> 3;
#line 118
  b -= c;
#line 118
  b -= a;
#line 118
  b ^= a << 10;
#line 118
  c -= a;
#line 118
  c -= b;
#line 118
  c ^= b >> 15;
#line 121
  return (c);
}
}
#line 1 "io.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-W3fqnkrE.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 420 "/usr/include/sys/fcntl.h"
extern int fcntl(int  , int   , ...)  __asm__("_fcntl$UNIX2003")  ;
#line 69 "io.c"
static int library_initialized  =    0;
#line 114 "/usr/include/sys/poll.h"
extern int poll(struct pollfd * , nfds_t  , int  )  __asm__("_poll$UNIX2003")  ;
#line 92 "io.c"
static array pollfds  ;
#line 93 "io.c"
static int poll_maxfd  ;
#line 95
static int io_event_change_poll(int fd , short what ) ;
#line 121 "io.c"
static array io_events  ;
#line 123
static void io_docallback(int fd , short what ) ;
#line 125 "io.c"
static io_event *io_event_get(int fd ) 
{ io_event *i ;
  void *__cil_tmp ;

  {
#line 132
  __cil_tmp = array_get(& io_events, sizeof(io_event ), (unsigned long )fd);
#line 132
  i = (io_event *)__cil_tmp;
#line 136
  return (i);
}
}
#line 154 "io.c"
static void io_library_init_poll(unsigned int eventsize ) 
{ struct pollfd *p ;
  void *__cil_tmp ;
  unsigned int i ;
  void *__cil_tmp___0 ;

  {
#line 158
  array_init(& pollfds);
#line 159
  poll_maxfd = 0;
#line 160
  Log(6, "IO subsystem: poll (initial maxfd %u).", eventsize);
#line 162
  __cil_tmp = array_alloc(& pollfds, sizeof(struct pollfd ), (unsigned long )eventsize);
#line 162
  p = (struct pollfd *)__cil_tmp;
#line 163
  if (p) {
#line 165
    __cil_tmp___0 = array_start((array const   *)(& pollfds));
#line 165
    p = (struct pollfd *)__cil_tmp___0;
#line 166
    i = 0U;
#line 166
    while (i < eventsize) {
#line 167
      (p + i)->fd = -1;
#line 166
      i ++;
    }
#line 169
    library_initialized = 1;
  }
#line 171
  return;
}
}
#line 230 "io.c"
int io_library_init(unsigned int eventsize ) 
{ void *__cil_tmp ;

  {
#line 233
  if (library_initialized) {
#line 234
    return (1);
  }
#line 244
  if (eventsize > 0U) {
#line 244
    __cil_tmp = array_alloc(& io_events, sizeof(io_event ), (unsigned long )eventsize);
#line 244
    if (! __cil_tmp) {
#line 245
      eventsize = 0U;
    }
  }
#line 260
  io_library_init_poll(eventsize);
#line 266
  return (library_initialized);
}
}
#line 270 "io.c"
void io_library_shutdown(void) 
{ 

  {
#line 287
  library_initialized = 0;
#line 288
  return;
}
}
#line 291 "io.c"
int io_event_setcb(int fd , void (*cbfunc)(int  , short  ) ) 
{ io_event *i ;
  io_event *__cil_tmp ;

  {
#line 294
  __cil_tmp = io_event_get(fd);
#line 294
  i = __cil_tmp;
#line 295
  if (! i) {
#line 296
    return (0);
  }
#line 298
  i->callback = cbfunc;
#line 299
  return (1);
}
}
#line 303 "io.c"
int io_event_create(int fd , short what , void (*cbfunc)(int  , short  ) ) 
{ int ret ;
  io_event *i ;
  void *__cil_tmp ;

  {
#line 318
  __cil_tmp = array_alloc(& io_events, sizeof(io_event ), (unsigned long )fd);
#line 318
  i = (io_event *)__cil_tmp;
#line 319
  if (! i) {
#line 320
    Log(4, "array_alloc failed: could not allocate space for %d io_event structures",
        fd);
#line 323
    return (0);
  }
#line 326
  i->callback = cbfunc;
#line 327
  i->what = (short)0;
#line 332
  ret = io_event_change_poll(fd, what);
#line 344
  if (ret) {
#line 344
    i->what = what;
  }
#line 345
  return (ret);
}
}
#line 370 "io.c"
static int io_event_change_poll(int fd , short what ) 
{ struct pollfd *p ;
  short events ;
  void *__cil_tmp ;

  {
#line 374
  events = (short)0;
#line 376
  if ((int )what & 1) {
#line 377
    events = (short)3;
  }
#line 378
  if ((int )what & 2) {
#line 379
    events = (short )((int )events | 4);
  }
#line 381
  __cil_tmp = array_alloc(& pollfds, sizeof(*p), (unsigned long )fd);
#line 381
  p = (struct pollfd *)__cil_tmp;
#line 382
  if (p) {
#line 383
    p->events = events;
#line 384
    p->fd = fd;
#line 385
    if (fd > poll_maxfd) {
#line 386
      poll_maxfd = fd;
    }
  }
#line 388
  return ((unsigned int )p != (unsigned int )((void *)0));
}
}
#line 464 "io.c"
int io_event_add(int fd , short what ) 
{ io_event *i ;
  io_event *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 467
  __cil_tmp = io_event_get(fd);
#line 467
  i = __cil_tmp;
#line 469
  if (! i) {
#line 469
    return (0);
  }
#line 471
  if (((int )i->what & (int )what) == (int )what) {
#line 472
    return (1);
  }
#line 476
  i->what = (short )((int )i->what | (int )what);
#line 489
  __cil_tmp___0 = io_event_change_poll(fd, i->what);
#line 489
  return (__cil_tmp___0);
}
}
#line 505 "io.c"
int io_setnonblock(int fd ) 
{ int flags ;
  int __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 508
  __cil_tmp = fcntl(fd, 3);
#line 508
  flags = __cil_tmp;
#line 509
  if (flags == -1) {
#line 510
    return (0);
  }
#line 515
  flags |= 4;
#line 517
  __cil_tmp___0 = fcntl(fd, 4, flags);
#line 517
  return (__cil_tmp___0 == 0);
}
}
#line 531 "io.c"
__inline static void io_close_devpoll(int x  __attribute__((__unused__)) ) 
{ 

  {
#line 535
  return;
}
}
#line 541 "io.c"
static void io_close_poll(int fd ) 
{ struct pollfd *p ;
  void *__cil_tmp ;
  void *__cil_tmp___0 ;

  {
#line 545
  __cil_tmp = array_get(& pollfds, sizeof(*p), (unsigned long )fd);
#line 545
  p = (struct pollfd *)__cil_tmp;
#line 546
  if (! p) {
#line 546
    return;
  }
#line 548
  p->fd = -1;
#line 549
  if (fd == poll_maxfd) {
#line 550
    while (poll_maxfd > 0) {
#line 551
      poll_maxfd --;
#line 552
      __cil_tmp___0 = array_get(& pollfds, sizeof(*p), (unsigned long )poll_maxfd);
#line 552
      p = (struct pollfd *)__cil_tmp___0;
#line 553
      if (p) {
#line 553
        if (p->fd >= 0) {
#line 554
          break;
        }
      }
    }
  }
#line 557
  return;
}
}
#line 595 "io.c"
int io_close(int fd ) 
{ io_event *i ;
  int __cil_tmp ;

  {
#line 600
  i = io_event_get(fd);
#line 614
  io_close_devpoll(fd);
#line 615
  io_close_poll(fd);
#line 616
  io_close_devpoll(fd);
#line 621
  if (i) {
#line 622
    i->callback = (void (*)(int  , short  ))((void *)0);
#line 623
    i->what = (short)0;
  }
#line 625
  __cil_tmp = close(fd);
#line 625
  return (__cil_tmp == 0);
}
}
#line 629 "io.c"
int io_event_del(int fd , short what ) 
{ io_event *i ;
  io_event *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 632
  __cil_tmp = io_event_get(fd);
#line 632
  i = __cil_tmp;
#line 636
  if (! i) {
#line 636
    return (0);
  }
#line 638
  if (! ((int )i->what & (int )what)) {
#line 639
    return (1);
  }
#line 641
  i->what = (short )((int )i->what & ~ ((int )what));
#line 647
  __cil_tmp___0 = io_event_change_poll(fd, i->what);
#line 647
  return (__cil_tmp___0);
}
}
#line 750 "io.c"
static int io_dispatch_poll(struct timeval *tv ) 
{ time_t sec ;
  int i ;
  int ret ;
  int timeout ;
  int fds_ready ;
  short what ;
  struct pollfd *p ;
  void *__cil_tmp ;

  {
#line 753
  sec = tv->tv_sec * 1000L;
#line 754
  timeout = (int )((time_t )tv->tv_usec + sec);
#line 757
  __cil_tmp = array_start((array const   *)(& pollfds));
#line 757
  p = (struct pollfd *)__cil_tmp;
#line 759
  if (timeout < 0) {
#line 760
    timeout = 1000;
  }
#line 762
  ret = poll(p, (unsigned int )(poll_maxfd + 1), timeout);
#line 763
  if (ret <= 0) {
#line 764
    return (ret);
  }
#line 766
  fds_ready = ret;
#line 767
  i = 0;
#line 767
  while (i <= poll_maxfd) {
#line 768
    what = (short)0;
#line 769
    if ((int )(p + i)->revents & 3) {
#line 770
      what = (short)1;
    }
#line 772
    if ((int )(p + i)->revents & 4) {
#line 773
      what = (short )((int )what | 2);
    }
#line 775
    if ((p + i)->revents) {
#line 775
      if (! what) {
#line 777
        what = (short)4;
      }
    }
#line 779
    if (what) {
#line 780
      fds_ready --;
#line 781
      io_docallback(i, what);
    }
#line 783
    if (fds_ready <= 0) {
#line 784
      break;
    }
#line 767
    i ++;
  }
#line 787
  return (ret);
}
}
#line 894 "io.c"
int io_dispatch(struct timeval *tv ) 
{ int __cil_tmp ;

  {
#line 911
  __cil_tmp = io_dispatch_poll(tv);
#line 911
  return (__cil_tmp);
}
}
#line 917 "io.c"
static void io_docallback(int fd , short what ) 
{ io_event *i ;
  int __cil_tmp ;

  {
#line 924
  i = io_event_get(fd);
#line 926
  if (i->callback) {
#line 928
    if ((int )what & 4) {
#line 928
      __cil_tmp = (int )i->what;
    } else {
#line 928
      __cil_tmp = (int )what;
    }
#line 928
    (*(i->callback))(fd, (short )__cil_tmp);
  }
#line 931
  return;
}
}
#line 1 "irc.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-RKdd6uO2.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 33 "irc-write.h"
void IRC_SetPenalty(CLIENT *Client , time_t Seconds ) ;
#line 50 "parse.h"
COMMAND *Parse_GetCommandStruct(void) ;
#line 21 "irc.h"
int IRC_ERROR(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_KILL(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_NOTICE(CLIENT *Client , REQUEST *Req ) ;
#line 24
int IRC_PRIVMSG(CLIENT *Client , REQUEST *Req ) ;
#line 25
int IRC_TRACE(CLIENT *Client , REQUEST *Req ) ;
#line 26
int IRC_HELP(CLIENT *Client , REQUEST *Req ) ;
#line 40 "irc.c"
static char *Option_String(CONN_ID Idx ) ;
#line 43 "irc.c"
int IRC_ERROR(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  char *__cil_tmp___0 ;

  {
#line 49
  if (Req->argc < 1) {
#line 49
    __cil_tmp = Client_Mask(Client);
#line 49
    Log(5, "Got ERROR from \"%s\"!", __cil_tmp);
  } else {
#line 50
    __cil_tmp___0 = Client_Mask(Client);
#line 50
    Log(5, "Got ERROR from \"%s\": %s!", __cil_tmp___0, Req->argv[0]);
  }
#line 52
  return (1);
}
}
#line 64 "irc.c"
int IRC_KILL(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *prefix ;
  CLIENT *c ;
  char reason[513] ;
  char *msg ;
  CONN_ID my_conn ;
  CONN_ID conn ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  CLIENT *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  CLIENT *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  int __cil_tmp___15 ;
  CLIENT *__cil_tmp___16 ;

  {
#line 74
  __cil_tmp___1 = Client_Type(Client);
#line 74
  if (__cil_tmp___1 != 32) {
#line 74
    __cil_tmp___2 = Client_OperByMe(Client);
#line 74
    if (! __cil_tmp___2) {
#line 79
      __cil_tmp = Client_ID(Client);
#line 79
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 79
      return (__cil_tmp___0);
    }
  }
#line 83
  if (Req->argc != 2) {
#line 86
    __cil_tmp___3 = Client_ID(Client);
#line 86
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 86
    return (__cil_tmp___4);
  }
#line 90
  if (Req->prefix) {
#line 90
    prefix = Client_Search(Req->prefix);
  } else {
#line 91
    prefix = Client;
  }
#line 92
  if (! prefix) {
#line 94
    Log(4, "Got KILL with invalid prefix: \"%s\"!", Req->prefix);
#line 96
    prefix = Client_ThisServer();
  }
#line 99
  __cil_tmp___6 = Client_ThisServer();
#line 99
  if ((unsigned int )Client != (unsigned int )__cil_tmp___6) {
#line 102
    __cil_tmp___5 = Client_Mask(prefix);
#line 102
    Log(1029, "Got KILL command from \"%s\" for \"%s\": %s", __cil_tmp___5, Req->argv[0],
        Req->argv[1]);
  }
#line 107
  __cil_tmp___8 = Client_Type(Client);
#line 107
  if (__cil_tmp___8 == 16) {
#line 111
    __cil_tmp___7 = Client_ID(Client);
#line 111
    snprintf(reason, sizeof(reason), "KILLed by %s: %s", __cil_tmp___7, Req->argv[1]);
  } else {
#line 115
    strlcpy(reason, (char const   *)Req->argv[1], sizeof(reason));
  }
#line 118
  IRC_WriteStrServersPrefix(Client, prefix, (char *)"KILL %s :%s", Req->argv[0], reason);
#line 122
  my_conn = Client_Conn(Client);
#line 125
  c = Client_Search(Req->argv[0]);
#line 126
  if (c) {
#line 128
    __cil_tmp___14 = Client_Type(c);
#line 128
    if (__cil_tmp___14 != 16) {
#line 128
      __cil_tmp___15 = Client_Type(c);
#line 128
      if (__cil_tmp___15 != 4) {
#line 137
        __cil_tmp___12 = Client_ThisServer();
#line 137
        if ((unsigned int )Client != (unsigned int )__cil_tmp___12) {
#line 140
          __cil_tmp___9 = Client_Type(c);
#line 140
          if (__cil_tmp___9 == 32) {
#line 141
            msg = (char *)"483 %s :You can\'t kill a server!";
          } else {
#line 143
            msg = (char *)"481 %s :Permission denied";
          }
#line 144
          __cil_tmp___10 = Client_ID(Client);
#line 144
          __cil_tmp___11 = IRC_WriteStrClient(Client, msg, __cil_tmp___10);
#line 144
          return (__cil_tmp___11);
        }
#line 148
        __cil_tmp___13 = Client_Type(c);
#line 148
        Log(3, "Got KILL for invalid client type: %d, \"%s\"!", __cil_tmp___13, Req->argv[0]);
      }
    }
#line 153
    conn = Client_Conn(c);
#line 154
    Client_Destroy(c, (char *)((void *)0), reason, 0);
#line 155
    if (conn > -1) {
#line 156
      Conn_Close(conn, (char *)((void *)0), reason, 1);
    }
  } else {
#line 159
    Log(5, "Client with nick \"%s\" is unknown here.", Req->argv[0]);
  }
#line 162
  if (my_conn > -1) {
#line 162
    __cil_tmp___16 = Conn_GetClient(my_conn);
#line 162
    if (__cil_tmp___16) {
#line 163
      return (1);
    } else {
#line 165
      return (0);
    }
  } else {
#line 165
    return (0);
  }
}
}
#line 169 "irc.c"
int IRC_NOTICE(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *to ;
  CLIENT *from ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 177
  __cil_tmp = Client_Type(Client);
#line 177
  if (__cil_tmp != 16) {
#line 177
    __cil_tmp___0 = Client_Type(Client);
#line 177
    if (__cil_tmp___0 != 32) {
#line 177
      return (1);
    }
  }
#line 180
  if (Req->argc != 2) {
#line 180
    return (1);
  }
#line 182
  __cil_tmp___1 = Client_Type(Client);
#line 182
  if (__cil_tmp___1 == 32) {
#line 182
    from = Client_Search(Req->prefix);
  } else {
#line 183
    from = Client;
  }
#line 184
  if (! from) {
#line 184
    __cil_tmp___2 = Client_ID(Client);
#line 184
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 184
    return (__cil_tmp___3);
  }
#line 186
  to = Client_Search(Req->argv[0]);
#line 187
  if (to) {
#line 187
    __cil_tmp___6 = Client_Type(to);
#line 187
    if (__cil_tmp___6 == 16) {
#line 190
      __cil_tmp___4 = Client_ID(to);
#line 190
      __cil_tmp___5 = IRC_WriteStrClientPrefix(to, from, (char *)"NOTICE %s :%s",
                                               __cil_tmp___4, Req->argv[1]);
#line 190
      return (__cil_tmp___5);
    } else {
#line 192
      return (1);
    }
  } else {
#line 192
    return (1);
  }
}
}
#line 196 "irc.c"
int IRC_PRIVMSG(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *cl ;
  CLIENT *from ;
  CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  int __cil_tmp___10 ;
  char *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  char *__cil_tmp___13 ;
  int __cil_tmp___14 ;
  int __cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  CONN_ID __cil_tmp___18 ;
  CONN_ID __cil_tmp___19 ;
  char *__cil_tmp___20 ;
  int __cil_tmp___21 ;
  int __cil_tmp___22 ;
  char *__cil_tmp___23 ;
  int __cil_tmp___24 ;

  {
#line 206
  if (Req->argc == 0) {
#line 206
    __cil_tmp = Client_ID(Client);
#line 206
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"411 %s :No receipient given (%s)",
                                       __cil_tmp, Req->command);
#line 206
    return (__cil_tmp___0);
  }
#line 207
  if (Req->argc == 1) {
#line 207
    __cil_tmp___1 = Client_ID(Client);
#line 207
    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"412 %s :No text to send",
                                       __cil_tmp___1);
#line 207
    return (__cil_tmp___2);
  }
#line 208
  if (Req->argc > 2) {
#line 208
    __cil_tmp___3 = Client_ID(Client);
#line 208
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 208
    return (__cil_tmp___4);
  }
#line 210
  __cil_tmp___5 = Client_Type(Client);
#line 210
  if (__cil_tmp___5 == 32) {
#line 210
    from = Client_Search(Req->prefix);
  } else {
#line 211
    from = Client;
  }
#line 212
  if (! from) {
#line 212
    __cil_tmp___6 = Client_ID(Client);
#line 212
    __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___6, Req->prefix);
#line 212
    return (__cil_tmp___7);
  }
#line 214
  cl = Client_Search(Req->argv[0]);
#line 215
  if (cl) {
#line 218
    __cil_tmp___10 = Client_Type(cl);
#line 218
    if (__cil_tmp___10 != 16) {
#line 218
      __cil_tmp___8 = Client_ID(from);
#line 218
      __cil_tmp___9 = IRC_WriteStrClient(from, (char *)"401 %s %s :No such nick or channel name",
                                         __cil_tmp___8, Req->argv[0]);
#line 218
      return (__cil_tmp___9);
    }
#line 221
    __cil_tmp___15 = Client_Type(Client);
#line 221
    if (__cil_tmp___15 != 32) {
#line 221
      __cil_tmp___16 = Client_Modes(cl);
#line 221
      __cil_tmp___17 = strchr((char const   *)__cil_tmp___16, 'a');
#line 221
      if (__cil_tmp___17) {
#line 224
        __cil_tmp___11 = Client_Away(cl);
#line 224
        __cil_tmp___12 = Client_ID(cl);
#line 224
        __cil_tmp___13 = Client_ID(from);
#line 224
        __cil_tmp___14 = IRC_WriteStrClient(from, (char *)"301 %s %s :%s", __cil_tmp___13,
                                            __cil_tmp___12, __cil_tmp___11);
#line 224
        if (! __cil_tmp___14) {
#line 224
          return (0);
        }
      }
    }
#line 228
    __cil_tmp___19 = Client_Conn(from);
#line 228
    if (__cil_tmp___19 > -1) {
#line 228
      __cil_tmp___18 = Client_Conn(from);
#line 228
      Conn_UpdateIdle(__cil_tmp___18);
    }
#line 229
    __cil_tmp___20 = Client_ID(cl);
#line 229
    __cil_tmp___21 = IRC_WriteStrClientPrefix(cl, from, (char *)"PRIVMSG %s :%s",
                                              __cil_tmp___20, Req->argv[1]);
#line 229
    return (__cil_tmp___21);
  }
#line 232
  chan = Channel_Search(Req->argv[0]);
#line 233
  if (chan) {
#line 233
    __cil_tmp___22 = Channel_Write(chan, from, Client, Req->argv[1]);
#line 233
    return (__cil_tmp___22);
  }
#line 235
  __cil_tmp___23 = Client_ID(from);
#line 235
  __cil_tmp___24 = IRC_WriteStrClient(from, (char *)"401 %s %s :No such nick or channel name",
                                      __cil_tmp___23, Req->argv[0]);
#line 235
  return (__cil_tmp___24);
}
}
#line 239 "irc.c"
int IRC_TRACE(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *from ;
  CLIENT *target ;
  CLIENT *c ;
  CONN_ID idx ;
  CONN_ID idx2 ;
  char user[10] ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  size_t __cil_tmp___8 ;
  size_t __cil_tmp___9 ;
  time_t __cil_tmp___10 ;
  time_t __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  CLIENT *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  CLIENT *__cil_tmp___18 ;
  char *__cil_tmp___19 ;
  CONN_ID __cil_tmp___20 ;
  char *__cil_tmp___21 ;
  CLIENT *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  char *__cil_tmp___24 ;
  char *__cil_tmp___25 ;
  char *__cil_tmp___26 ;
  int __cil_tmp___27 ;
  int __cil_tmp___28 ;
  char *__cil_tmp___29 ;
  char *__cil_tmp___30 ;
  int __cil_tmp___31 ;
  int __cil_tmp___32 ;
  char *__cil_tmp___33 ;
  char *__cil_tmp___34 ;
  CONN_ID __cil_tmp___35 ;
  char *__cil_tmp___36 ;
  int __cil_tmp___37 ;

  {
#line 250
  if (Req->argc > 1) {
#line 250
    __cil_tmp = Client_ID(Client);
#line 250
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"411 %s :No receipient given (%s)",
                                       __cil_tmp, Req->command);
#line 250
    return (__cil_tmp___0);
  }
#line 253
  __cil_tmp___1 = Client_Type(Client);
#line 253
  if (__cil_tmp___1 == 32) {
#line 253
    from = Client_Search(Req->prefix);
  } else {
#line 254
    from = Client;
  }
#line 255
  if (! from) {
#line 255
    __cil_tmp___2 = Client_ID(Client);
#line 255
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 255
    return (__cil_tmp___3);
  }
#line 258
  if (Req->argc == 1) {
#line 258
    target = Client_Search(Req->argv[0]);
  } else {
#line 259
    target = Client_ThisServer();
  }
#line 262
  __cil_tmp___18 = Client_ThisServer();
#line 262
  if ((unsigned int )target != (unsigned int )__cil_tmp___18) {
#line 264
    if (! target) {
#line 264
      __cil_tmp___4 = Client_ID(from);
#line 264
      __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                         __cil_tmp___4, Req->argv[0]);
#line 264
      return (__cil_tmp___5);
    } else {
#line 264
      __cil_tmp___6 = Client_Type(target);
#line 264
      if (__cil_tmp___6 != 32) {
#line 264
        __cil_tmp___4 = Client_ID(from);
#line 264
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 264
        return (__cil_tmp___5);
      }
    }
#line 267
    idx = Client_Conn(Client);
#line 268
    __cil_tmp___7 = Client_NextHop(target);
#line 268
    idx2 = Client_Conn(__cil_tmp___7);
#line 269
    __cil_tmp___8 = Conn_SendQ(idx2);
#line 269
    __cil_tmp___9 = Conn_SendQ(idx);
#line 269
    __cil_tmp___10 = time((time_t *)((void *)0));
#line 269
    __cil_tmp___11 = Conn_StartTime(idx2);
#line 269
    __cil_tmp___12 = Option_String(idx2);
#line 269
    __cil_tmp___13 = Client_NextHop(target);
#line 269
    __cil_tmp___14 = Client_ID(__cil_tmp___13);
#line 269
    __cil_tmp___15 = Client_ID(target);
#line 269
    __cil_tmp___16 = Client_ID(from);
#line 269
    __cil_tmp___17 = IRC_WriteStrClient(from, (char *)"200 %s Link %s-%s %s %s V%s %ld %d %d",
                                        __cil_tmp___16, "ngircd", "0.11.1", __cil_tmp___15,
                                        __cil_tmp___14, __cil_tmp___12, __cil_tmp___10 - __cil_tmp___11,
                                        __cil_tmp___9, __cil_tmp___8);
#line 269
    if (! __cil_tmp___17) {
#line 269
      return (0);
    }
#line 272
    IRC_WriteStrClientPrefix(target, from, (char *)"TRACE %s", Req->argv[0]);
#line 273
    return (1);
  }
#line 277
  c = Client_First();
#line 278
  while (c) {
#line 280
    __cil_tmp___35 = Client_Conn(c);
#line 280
    if (__cil_tmp___35 > -1) {
#line 283
      __cil_tmp___28 = Client_Type(c);
#line 283
      if (__cil_tmp___28 == 32) {
#line 286
        __cil_tmp___19 = Client_User(c);
#line 286
        strlcpy(user, (char const   *)__cil_tmp___19, sizeof(user));
#line 287
        if ((int )user[0] == 126) {
#line 287
          strlcpy(user, "unknown", sizeof(user));
        }
#line 288
        __cil_tmp___20 = Client_Conn(c);
#line 288
        __cil_tmp___21 = Option_String(__cil_tmp___20);
#line 288
        __cil_tmp___22 = Client_ThisServer();
#line 288
        __cil_tmp___23 = Client_Mask(__cil_tmp___22);
#line 288
        __cil_tmp___24 = Client_Hostname(c);
#line 288
        __cil_tmp___25 = Client_ID(c);
#line 288
        __cil_tmp___26 = Client_ID(from);
#line 288
        __cil_tmp___27 = IRC_WriteStrClient(from, (char *)"206 %s Serv 1 0S 0C %s[%s@%s] *!*@%s :V%s",
                                            __cil_tmp___26, __cil_tmp___25, user,
                                            __cil_tmp___24, __cil_tmp___23, __cil_tmp___21);
#line 288
        if (! __cil_tmp___27) {
#line 288
          return (0);
        }
      }
#line 290
      __cil_tmp___32 = Client_Type(c);
#line 290
      if (__cil_tmp___32 == 16) {
#line 290
        __cil_tmp___33 = Client_Modes(c);
#line 290
        __cil_tmp___34 = strchr((char const   *)__cil_tmp___33, 'o');
#line 290
        if (__cil_tmp___34) {
#line 293
          __cil_tmp___29 = Client_ID(c);
#line 293
          __cil_tmp___30 = Client_ID(from);
#line 293
          __cil_tmp___31 = IRC_WriteStrClient(from, (char *)"204 %s Oper 2 :%s", __cil_tmp___30,
                                              __cil_tmp___29);
#line 293
          if (! __cil_tmp___31) {
#line 293
            return (0);
          }
        }
      }
    }
#line 296
    c = Client_Next(c);
  }
#line 299
  IRC_SetPenalty(Client, 3L);
#line 300
  __cil_tmp___36 = Client_ID(from);
#line 300
  __cil_tmp___37 = IRC_WriteStrClient(from, (char *)"262 %s %s %s-%s.%s :End of TRACE",
                                      __cil_tmp___36, Conf_ServerName, "ngircd", "0.11.1",
                                      NGIRCd_DebugLevel);
#line 300
  return (__cil_tmp___37);
}
}
#line 304 "irc.c"
int IRC_HELP(CLIENT *Client , REQUEST *Req ) 
{ COMMAND *cmd ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 313
  if (Req->argc > 0) {
#line 313
    __cil_tmp = Client_ID(Client);
#line 313
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"411 %s :No receipient given (%s)",
                                       __cil_tmp, Req->command);
#line 313
    return (__cil_tmp___0);
  }
#line 315
  cmd = Parse_GetCommandStruct();
#line 316
  while (cmd->name) {
#line 318
    __cil_tmp___1 = Client_ID(Client);
#line 318
    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"NOTICE %s :%s", __cil_tmp___1,
                                       cmd->name);
#line 318
    if (! __cil_tmp___2) {
#line 318
      return (0);
    }
#line 319
    cmd ++;
  }
#line 322
  IRC_SetPenalty(Client, 2L);
#line 323
  return (1);
}
}
#line 330 "irc.c"
static char option_txt[8]  ;
#line 327 "irc.c"
static char *Option_String(CONN_ID Idx ) 
{ UINT16 options ;

  {
#line 333
  options = Conn_Options(Idx);
#line 335
  strcpy(option_txt, "F");
#line 342
  return (option_txt);
}
}
#line 1 "irc-channel.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-Kt2Poytf.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 21 "match.h"
int Match(char const   *Pattern , char const   *String ) ;
#line 36 "irc-info.h"
int IRC_Send_NAMES(CLIENT *Client , CHANNEL *Chan ) ;
#line 29 "irc-write.h"
void IRC_WriteStrServersPrefixFlag(CLIENT *ExceptOf , CLIENT *Prefix , char Flag ,
                                   char *Format  , ...) ;
#line 21 "irc-channel.h"
int IRC_JOIN(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_PART(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_TOPIC(CLIENT *Client , REQUEST *Req ) ;
#line 25
int IRC_LIST(CLIENT *Client , REQUEST *Req ) ;
#line 27
int IRC_CHANINFO(CLIENT *Client , REQUEST *Req ) ;
#line 43 "irc-channel.c"
int IRC_JOIN(CLIENT *Client , REQUEST *Req ) 
{ char *channame ;
  char *channame_ptr ;
  char *key ;
  char *key_ptr ;
  char *flags ;
  char *topic ;
  char modes[8] ;
  int is_new_chan ;
  int is_invited ;
  int is_banned ;
  CLIENT *target ;
  CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  CHANNEL *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  struct list_head *__cil_tmp___10 ;
  struct list_head *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  char *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  char *__cil_tmp___18 ;
  char const   *__cil_tmp___19 ;
  char *__cil_tmp___20 ;
  int __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  char *__cil_tmp___24 ;
  unsigned long __cil_tmp___25 ;
  unsigned long __cil_tmp___26 ;
  struct list_head *__cil_tmp___27 ;
  int __cil_tmp___28 ;
  int __cil_tmp___29 ;
  char *__cil_tmp___30 ;
  char *__cil_tmp___31 ;
  char *__cil_tmp___32 ;
  char *__cil_tmp___33 ;
  char *__cil_tmp___34 ;
  char *__cil_tmp___35 ;
  char *__cil_tmp___36 ;
  unsigned int __cil_tmp___37 ;
  char *__cil_tmp___38 ;
  char *__cil_tmp___39 ;
  char const   *__cil_tmp___40 ;
  char *__cil_tmp___41 ;
  int __cil_tmp___42 ;

  {
#line 55
  if (Req->argc < 1) {
#line 56
    __cil_tmp = Client_ID(Client);
#line 56
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 56
    return (__cil_tmp___0);
  } else {
#line 55
    if (Req->argc > 2) {
#line 56
      __cil_tmp = Client_ID(Client);
#line 56
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                         __cil_tmp, Req->command);
#line 56
      return (__cil_tmp___0);
    }
  }
#line 60
  __cil_tmp___1 = Client_Type(Client);
#line 60
  if (__cil_tmp___1 == 32) {
#line 60
    target = Client_Search(Req->prefix);
  } else {
#line 61
    target = Client;
  }
#line 62
  if (! target) {
#line 62
    __cil_tmp___2 = Client_ID(Client);
#line 62
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 62
    return (__cil_tmp___3);
  }
#line 65
  if (Req->argc > 1) {
#line 66
    key = Req->argv[1];
#line 67
    key_ptr = strchr((char const   *)key, ',');
#line 68
    if (key_ptr) {
#line 68
      *key_ptr = (char )'\000';
    }
  } else {
#line 71
    key_ptr = (char *)((void *)0);
#line 71
    key = key_ptr;
  }
#line 73
  channame = Req->argv[0];
#line 74
  channame_ptr = strchr((char const   *)channame, ',');
#line 75
  if (channame_ptr) {
#line 75
    *channame_ptr = (char )'\000';
  }
#line 78
  while (channame) {
#line 80
    chan = (CHANNEL *)((void *)0);
#line 80
    flags = (char *)((void *)0);
#line 82
    __cil_tmp___4 = Client_Type(Client);
#line 82
    if (__cil_tmp___4 == 32) {
#line 83
      flags = strchr((char const   *)channame, 7);
#line 84
      if (flags) {
#line 85
        *flags = (char )'\000';
#line 86
        flags ++;
      }
    }
#line 91
    __cil_tmp___6 = Channel_Search(channame);
#line 91
    if (__cil_tmp___6) {
#line 92
      is_new_chan = 0;
    } else {
#line 94
      if (Conf_PredefChannelsOnly) {
#line 95
        __cil_tmp___5 = Client_ID(Client);
#line 95
        IRC_WriteStrClient(Client, (char *)"474 %s %s :Cannot join channel (+b)",
                           __cil_tmp___5, channame);
#line 97
        channame = strchr((char const   *)channame, ',');
#line 98
        continue;
      }
#line 100
      is_new_chan = 1;
    }
#line 104
    __cil_tmp___28 = Client_Type(Client);
#line 104
    if (__cil_tmp___28 == 16) {
#line 107
      if (Conf_MaxJoins > 0) {
#line 107
        __cil_tmp___9 = Channel_CountForUser(Client);
#line 107
        if (__cil_tmp___9 >= Conf_MaxJoins) {
#line 108
          __cil_tmp___7 = Client_ID(Client);
#line 108
          __cil_tmp___8 = IRC_WriteStrClient(Client, (char *)"405 %s %s :You have joined too many channels",
                                             __cil_tmp___7, channame);
#line 108
          return (__cil_tmp___8);
        }
      }
#line 112
      if (is_new_chan) {
#line 115
        flags = (char *)"o";
      } else {
#line 120
        chan = Channel_Search(channame);
#line 123
        __cil_tmp___10 = Channel_GetListBans(chan);
#line 123
        is_banned = Lists_Check(__cil_tmp___10, target);
#line 124
        __cil_tmp___11 = Channel_GetListInvites(chan);
#line 124
        is_invited = Lists_Check(__cil_tmp___11, target);
#line 127
        if (is_banned == 1) {
#line 127
          if (is_invited == 0) {
#line 130
            __cil_tmp___12 = Client_ID(Client);
#line 130
            IRC_WriteStrClient(Client, (char *)"474 %s %s :Cannot join channel (+b)",
                               __cil_tmp___12, channame);
#line 133
            channame = strchr((char const   *)channame, ',');
#line 134
            continue;
          }
        }
#line 138
        __cil_tmp___14 = Channel_Modes(chan);
#line 138
        __cil_tmp___15 = strchr((char const   *)__cil_tmp___14, 'i');
#line 138
        if (__cil_tmp___15) {
#line 138
          if (is_invited == 0) {
#line 141
            __cil_tmp___13 = Client_ID(Client);
#line 141
            IRC_WriteStrClient(Client, (char *)"473 %s %s :Cannot join channel (+i)",
                               __cil_tmp___13, channame);
#line 144
            channame = strchr((char const   *)channame, ',');
#line 145
            continue;
          }
        }
#line 149
        __cil_tmp___17 = Channel_Modes(chan);
#line 149
        __cil_tmp___18 = strchr((char const   *)__cil_tmp___17, 'k');
#line 149
        if (__cil_tmp___18) {
#line 149
          if (key) {
#line 149
            __cil_tmp___19 = (char const   *)key;
          } else {
#line 149
            __cil_tmp___19 = "";
          }
#line 149
          __cil_tmp___20 = Channel_Key(chan);
#line 149
          __cil_tmp___21 = strcmp((char const   *)__cil_tmp___20, __cil_tmp___19);
#line 149
          if (__cil_tmp___21 != 0) {
#line 152
            __cil_tmp___16 = Client_ID(Client);
#line 152
            IRC_WriteStrClient(Client, (char *)"475 %s %s :Cannot join channel (+k)",
                               __cil_tmp___16, channame);
#line 155
            channame = strchr((char const   *)channame, ',');
#line 156
            continue;
          }
        }
#line 160
        __cil_tmp___23 = Channel_Modes(chan);
#line 160
        __cil_tmp___24 = strchr((char const   *)__cil_tmp___23, 'l');
#line 160
        if (__cil_tmp___24) {
#line 160
          __cil_tmp___25 = Channel_MaxUsers(chan);
#line 160
          __cil_tmp___26 = Channel_MemberCount(chan);
#line 160
          if (__cil_tmp___25 <= __cil_tmp___26) {
#line 163
            __cil_tmp___22 = Client_ID(Client);
#line 163
            IRC_WriteStrClient(Client, (char *)"471 %s %s :Cannot join channel (+l)",
                               __cil_tmp___22, channame);
#line 166
            channame = strchr((char const   *)channame, ',');
#line 167
            continue;
          }
        }
      }
    } else {
#line 178
      chan = Channel_Search(channame);
#line 179
      if ((unsigned int )chan != (unsigned int )((void *)0)) {
#line 179
        __cil_tmp___27 = Channel_GetListInvites(chan);
#line 179
        Lists_Check(__cil_tmp___27, target);
      }
    }
#line 183
    __cil_tmp___29 = Channel_Join(target, channame);
#line 183
    if (! __cil_tmp___29) {
#line 186
      channame = strchr((char const   *)channame, ',');
#line 187
      continue;
    }
#line 189
    if (! chan) {
#line 189
      chan = Channel_Search(channame);
    }
#line 193
    while (1) {
#line 193
      if (flags) {
#line 193
        if (! *flags) {
#line 193
          break;
        }
      } else {
#line 193
        break;
      }
#line 195
      Channel_UserModeAdd(chan, target, *flags);
#line 196
      flags ++;
    }
#line 200
    __cil_tmp___30 = Channel_Modes(chan);
#line 200
    __cil_tmp___31 = strchr((char const   *)__cil_tmp___30, 'P');
#line 200
    if (__cil_tmp___31) {
#line 200
      __cil_tmp___32 = Client_Modes(target);
#line 200
      __cil_tmp___33 = strchr((char const   *)__cil_tmp___32, 'o');
#line 200
      if (__cil_tmp___33) {
#line 200
        Channel_UserModeAdd(chan, target, (char )'o');
      }
    }
#line 203
    __cil_tmp___34 = Channel_UserModes(chan, target);
#line 203
    strlcpy(& modes[1], (char const   *)__cil_tmp___34, sizeof(modes) - 1UL);
#line 204
    if (modes[1]) {
#line 204
      modes[0] = (char)7;
    } else {
#line 205
      modes[0] = (char )'\000';
    }
#line 208
    IRC_WriteStrServersPrefix(Client, target, (char *)"JOIN :%s%s", channame, modes);
#line 211
    IRC_WriteStrChannelPrefix(Client, chan, target, 0, (char *)"JOIN :%s", channame);
#line 212
    if (modes[1]) {
#line 215
      __cil_tmp___35 = Client_ID(target);
#line 215
      IRC_WriteStrChannelPrefix(Client, chan, target, 0, (char *)"MODE %s +%s %s",
                                channame, & modes[1], __cil_tmp___35);
    }
#line 218
    __cil_tmp___42 = Client_Type(Client);
#line 218
    if (__cil_tmp___42 == 16) {
#line 221
      IRC_WriteStrClientPrefix(Client, target, (char *)"JOIN :%s", channame);
#line 224
      topic = Channel_Topic(chan);
#line 225
      if (*topic) {
#line 226
        __cil_tmp___36 = Client_ID(Client);
#line 226
        IRC_WriteStrClient(Client, (char *)"332 %s %s :%s", __cil_tmp___36, channame,
                           topic);
#line 229
        __cil_tmp___37 = Channel_TopicTime(chan);
#line 229
        __cil_tmp___38 = Channel_TopicWho(chan);
#line 229
        __cil_tmp___39 = Client_ID(Client);
#line 229
        IRC_WriteStrClient(Client, (char *)"333 %s %s %s %u", __cil_tmp___39, channame,
                           __cil_tmp___38, __cil_tmp___37);
      }
#line 237
      IRC_Send_NAMES(Client, chan);
#line 238
      __cil_tmp___40 = Channel_Name((CHANNEL const   *)chan);
#line 238
      __cil_tmp___41 = Client_ID(Client);
#line 238
      IRC_WriteStrClient(Client, (char *)"366 %s %s :End of NAMES list", __cil_tmp___41,
                         __cil_tmp___40);
    }
#line 242
    channame = channame_ptr;
#line 243
    if (channame) {
#line 244
      channame ++;
#line 245
      channame_ptr = strchr((char const   *)channame, ',');
#line 246
      if (channame_ptr) {
#line 246
        *channame_ptr = (char )'\000';
      }
#line 248
      if (key_ptr) {
#line 249
        key_ptr ++;
#line 249
        key = key_ptr;
#line 250
        key_ptr = strchr((char const   *)key, ',');
#line 251
        if (key_ptr) {
#line 251
          *key_ptr = (char )'\000';
        }
      }
    }
  }
#line 255
  return (1);
}
}
#line 259 "irc-channel.c"
int IRC_PART(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  char *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___5 ;

  {
#line 268
  if (Req->argc < 1) {
#line 269
    __cil_tmp = Client_ID(Client);
#line 269
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 269
    return (__cil_tmp___0);
  } else {
#line 268
    if (Req->argc > 2) {
#line 269
      __cil_tmp = Client_ID(Client);
#line 269
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                         __cil_tmp, Req->command);
#line 269
      return (__cil_tmp___0);
    }
  }
#line 273
  __cil_tmp___1 = Client_Type(Client);
#line 273
  if (__cil_tmp___1 == 32) {
#line 273
    target = Client_Search(Req->prefix);
  } else {
#line 274
    target = Client;
  }
#line 275
  if (! target) {
#line 275
    __cil_tmp___2 = Client_ID(Client);
#line 275
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 275
    return (__cil_tmp___3);
  }
#line 278
  chan = strtok(Req->argv[0], ",");
#line 279
  while (chan) {
#line 280
    if (Req->argc > 1) {
#line 280
      __cil_tmp___5 = Req->argv[1];
    } else {
#line 280
      __cil_tmp___5 = Client_ID(target);
    }
#line 280
    Channel_Part(target, Client, chan, __cil_tmp___5);
#line 282
    chan = strtok((char *)((void *)0), ",");
  }
#line 284
  return (1);
}
}
#line 288 "irc-channel.c"
int IRC_TOPIC(CLIENT *Client , REQUEST *Req ) 
{ CHANNEL *chan ;
  CLIENT *from ;
  char *topic ;
  int r ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  char const   *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  unsigned int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  char const   *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char const   *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  char const   *__cil_tmp___18 ;
  char *__cil_tmp___19 ;
  int __cil_tmp___20 ;
  char *__cil_tmp___21 ;
  char *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  char *__cil_tmp___24 ;
  char const   *__cil_tmp___25 ;
  char const   *__cil_tmp___26 ;
  char *__cil_tmp___27 ;
  int __cil_tmp___28 ;
  int __cil_tmp___29 ;

  {
#line 300
  if (Req->argc < 1) {
#line 300
    __cil_tmp = Client_ID(Client);
#line 300
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 300
    return (__cil_tmp___0);
  } else {
#line 300
    if (Req->argc > 2) {
#line 300
      __cil_tmp = Client_ID(Client);
#line 300
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                         __cil_tmp, Req->command);
#line 300
      return (__cil_tmp___0);
    }
  }
#line 302
  __cil_tmp___1 = Client_Type(Client);
#line 302
  if (__cil_tmp___1 == 32) {
#line 302
    from = Client_Search(Req->prefix);
  } else {
#line 303
    from = Client;
  }
#line 304
  if (! from) {
#line 304
    __cil_tmp___2 = Client_ID(Client);
#line 304
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 304
    return (__cil_tmp___3);
  }
#line 307
  chan = Channel_Search(Req->argv[0]);
#line 308
  if (! chan) {
#line 308
    __cil_tmp___4 = Client_ID(from);
#line 308
    __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"403 %s %s :No such channel",
                                       __cil_tmp___4, Req->argv[0]);
#line 308
    return (__cil_tmp___5);
  }
#line 311
  __cil_tmp___8 = Channel_IsMemberOf(chan, from);
#line 311
  if (! __cil_tmp___8) {
#line 311
    __cil_tmp___6 = Client_ID(from);
#line 311
    __cil_tmp___7 = IRC_WriteStrClient(from, (char *)"442 %s %s :You are not on that channel",
                                       __cil_tmp___6, Req->argv[0]);
#line 311
    return (__cil_tmp___7);
  }
#line 313
  if (Req->argc == 1) {
#line 316
    topic = Channel_Topic(chan);
#line 317
    if (*topic) {
#line 318
      __cil_tmp___9 = Channel_Name((CHANNEL const   *)chan);
#line 318
      __cil_tmp___10 = Client_ID(Client);
#line 318
      r = IRC_WriteStrClient(from, (char *)"332 %s %s :%s", __cil_tmp___10, __cil_tmp___9,
                             topic);
#line 321
      __cil_tmp___11 = Channel_TopicTime(chan);
#line 321
      __cil_tmp___12 = Channel_TopicWho(chan);
#line 321
      __cil_tmp___13 = Channel_Name((CHANNEL const   *)chan);
#line 321
      __cil_tmp___14 = Client_ID(Client);
#line 321
      r = IRC_WriteStrClient(from, (char *)"333 %s %s %s %u", __cil_tmp___14, __cil_tmp___13,
                             __cil_tmp___12, __cil_tmp___11);
#line 326
      return (r);
    } else {
#line 329
      __cil_tmp___15 = Channel_Name((CHANNEL const   *)chan);
#line 329
      __cil_tmp___16 = Client_ID(from);
#line 329
      __cil_tmp___17 = IRC_WriteStrClient(from, (char *)"331 %s %s :No topic is set",
                                          __cil_tmp___16, __cil_tmp___15);
#line 329
      return (__cil_tmp___17);
    }
  }
#line 333
  __cil_tmp___23 = Channel_Modes(chan);
#line 333
  __cil_tmp___24 = strchr((char const   *)__cil_tmp___23, 't');
#line 333
  if (__cil_tmp___24) {
#line 336
    __cil_tmp___21 = Channel_UserModes(chan, from);
#line 336
    __cil_tmp___22 = strchr((char const   *)__cil_tmp___21, 'o');
#line 336
    if (! __cil_tmp___22) {
#line 336
      __cil_tmp___18 = Channel_Name((CHANNEL const   *)chan);
#line 336
      __cil_tmp___19 = Client_ID(from);
#line 336
      __cil_tmp___20 = IRC_WriteStrClient(from, (char *)"482 %s %s :You are not channel operator",
                                          __cil_tmp___19, __cil_tmp___18);
#line 336
      return (__cil_tmp___20);
    }
  }
#line 340
  Channel_SetTopic(chan, from, Req->argv[1]);
#line 341
  if (*(Req->argv[1] + 0)) {
#line 341
    __cil_tmp___25 = (char const   *)Req->argv[1];
  } else {
#line 341
    __cil_tmp___25 = "<none>";
  }
#line 341
  __cil_tmp___26 = Channel_Name((CHANNEL const   *)chan);
#line 341
  __cil_tmp___27 = Client_Mask(from);
#line 341
  Log(7, "User \"%s\" set topic on \"%s\": %s", __cil_tmp___27, __cil_tmp___26, __cil_tmp___25);
#line 346
  IRC_WriteStrServersPrefix(Client, from, (char *)"TOPIC %s :%s", Req->argv[0], Req->argv[1]);
#line 347
  IRC_WriteStrChannelPrefix(Client, chan, from, 0, (char *)"TOPIC %s :%s", Req->argv[0],
                            Req->argv[1]);
#line 349
  __cil_tmp___29 = Client_Type(Client);
#line 349
  if (__cil_tmp___29 == 16) {
#line 349
    __cil_tmp___28 = IRC_WriteStrClientPrefix(Client, Client, (char *)"TOPIC %s :%s",
                                              Req->argv[0], Req->argv[1]);
#line 349
    return (__cil_tmp___28);
  } else {
#line 350
    return (1);
  }
}
}
#line 359 "irc-channel.c"
int IRC_LIST(CLIENT *Client , REQUEST *Req ) 
{ char *pattern ;
  CHANNEL *chan ;
  CLIENT *from ;
  CLIENT *target ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  CLIENT *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  unsigned long __cil_tmp___11 ;
  char const   *__cil_tmp___12 ;
  char *__cil_tmp___13 ;
  int __cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  char const   *__cil_tmp___18 ;
  int __cil_tmp___19 ;
  char *__cil_tmp___20 ;
  int __cil_tmp___21 ;

  {
#line 370
  if (Req->argc > 2) {
#line 371
    __cil_tmp = Client_ID(Client);
#line 371
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 371
    return (__cil_tmp___0);
  }
#line 374
  if (Req->argc > 0) {
#line 375
    pattern = strtok(Req->argv[0], ",");
  } else {
#line 377
    pattern = (char *)"*";
  }
#line 380
  __cil_tmp___1 = Client_Type(Client);
#line 380
  if (__cil_tmp___1 == 32) {
#line 381
    from = Client_Search(Req->prefix);
  } else {
#line 383
    from = Client;
  }
#line 385
  if (! from) {
#line 386
    __cil_tmp___2 = Client_ID(Client);
#line 386
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                       __cil_tmp___2, Req->prefix);
#line 386
    return (__cil_tmp___3);
  }
#line 389
  if (Req->argc == 2) {
#line 392
    target = Client_Search(Req->argv[1]);
#line 393
    if (! target) {
#line 394
      __cil_tmp___4 = Client_ID(Client);
#line 394
      __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                         __cil_tmp___4, Req->argv[1]);
#line 394
      return (__cil_tmp___5);
    } else {
#line 393
      __cil_tmp___6 = Client_Type(target);
#line 393
      if (__cil_tmp___6 != 32) {
#line 394
        __cil_tmp___4 = Client_ID(Client);
#line 394
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[1]);
#line 394
        return (__cil_tmp___5);
      }
    }
#line 397
    __cil_tmp___9 = Client_ThisServer();
#line 397
    if ((unsigned int )target != (unsigned int )__cil_tmp___9) {
#line 400
      __cil_tmp___7 = Client_ID(from);
#line 400
      __cil_tmp___8 = IRC_WriteStrClientPrefix(target, from, (char *)"LIST %s :%s",
                                               __cil_tmp___7, Req->argv[1]);
#line 400
      return (__cil_tmp___8);
    }
  }
#line 406
  while (pattern) {
#line 409
    chan = Channel_First();
#line 410
    while (chan) {
#line 413
      __cil_tmp___18 = Channel_Name((CHANNEL const   *)chan);
#line 413
      __cil_tmp___19 = Match((char const   *)pattern, __cil_tmp___18);
#line 413
      if (__cil_tmp___19) {
#line 416
        __cil_tmp___15 = Channel_Modes(chan);
#line 416
        __cil_tmp___16 = strchr((char const   *)__cil_tmp___15, 's');
#line 416
        if (__cil_tmp___16) {
#line 416
          __cil_tmp___17 = Channel_IsMemberOf(chan, from);
#line 416
          if (__cil_tmp___17) {
            _L: /* CIL Label */ 
#line 419
            __cil_tmp___10 = Channel_Topic(chan);
#line 419
            __cil_tmp___11 = Channel_MemberCount(chan);
#line 419
            __cil_tmp___12 = Channel_Name((CHANNEL const   *)chan);
#line 419
            __cil_tmp___13 = Client_ID(from);
#line 419
            __cil_tmp___14 = IRC_WriteStrClient(from, (char *)"322 %s %s %ld :%s",
                                                __cil_tmp___13, __cil_tmp___12, __cil_tmp___11,
                                                __cil_tmp___10);
#line 419
            if (! __cil_tmp___14) {
#line 424
              return (0);
            }
          }
        } else {
          goto _L;
        }
      }
#line 427
      chan = Channel_Next(chan);
    }
#line 431
    if (Req->argc > 0) {
#line 432
      pattern = strtok((char *)((void *)0), ",");
    } else {
#line 434
      pattern = (char *)((void *)0);
    }
  }
#line 437
  __cil_tmp___20 = Client_ID(from);
#line 437
  __cil_tmp___21 = IRC_WriteStrClient(from, (char *)"323 %s :End of LIST", __cil_tmp___20);
#line 437
  return (__cil_tmp___21);
}
}
#line 441 "irc-channel.c"
int IRC_CHANINFO(CLIENT *Client , REQUEST *Req ) 
{ char modes_add[513] ;
  char l[16] ;
  char *ptr ;
  CLIENT *from ;
  CHANNEL *chan ;
  int arg_topic ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  long __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  unsigned long __cil_tmp___8 ;
  char *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  char *__cil_tmp___11 ;

  {
#line 453
  if (Req->argc < 2) {
#line 453
    __cil_tmp = Client_ID(Client);
#line 453
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 453
    return (__cil_tmp___0);
  } else {
#line 453
    if (Req->argc == 4) {
#line 453
      __cil_tmp = Client_ID(Client);
#line 453
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                         __cil_tmp, Req->command);
#line 453
      return (__cil_tmp___0);
    } else {
#line 453
      if (Req->argc > 5) {
#line 453
        __cil_tmp = Client_ID(Client);
#line 453
        __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                           __cil_tmp, Req->command);
#line 453
        return (__cil_tmp___0);
      }
    }
  }
#line 456
  if (Req->argc == 5) {
#line 456
    arg_topic = 4;
  } else {
#line 457
    if (Req->argc == 3) {
#line 457
      arg_topic = 2;
    } else {
#line 458
      arg_topic = -1;
    }
  }
#line 461
  from = Client_Search(Req->prefix);
#line 462
  if (! from) {
#line 462
    __cil_tmp___1 = Client_ID(Client);
#line 462
    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___1, Req->prefix);
#line 462
    return (__cil_tmp___2);
  }
#line 465
  chan = Channel_Search(Req->argv[0]);
#line 466
  if (! chan) {
#line 466
    chan = Channel_Create(Req->argv[0]);
  }
#line 467
  if (! chan) {
#line 467
    return (1);
  }
#line 469
  if ((int )*(Req->argv[1] + 0) == 43) {
#line 471
    ptr = Channel_Modes(chan);
#line 472
    if (! *ptr) {
#line 475
      Channel_SetModes(chan, Req->argv[1] + 1);
#line 477
      if (Req->argc == 5) {
#line 479
        __cil_tmp___3 = Channel_Modes(chan);
#line 479
        __cil_tmp___4 = strchr((char const   *)__cil_tmp___3, 'k');
#line 479
        if (__cil_tmp___4) {
#line 479
          Channel_SetKey(chan, Req->argv[2]);
        }
#line 480
        __cil_tmp___6 = Channel_Modes(chan);
#line 480
        __cil_tmp___7 = strchr((char const   *)__cil_tmp___6, 'l');
#line 480
        if (__cil_tmp___7) {
#line 480
          __cil_tmp___5 = atol((char const   *)Req->argv[3]);
#line 480
          Channel_SetMaxUsers(chan, (unsigned long )__cil_tmp___5);
        }
      } else {
#line 485
        Channel_ModeDel(chan, (char )'l');
#line 486
        Channel_ModeDel(chan, (char )'k');
      }
#line 489
      strcpy(modes_add, "");
#line 490
      ptr = Channel_Modes(chan);
#line 491
      while (*ptr) {
#line 493
        if ((int )*ptr == 108) {
#line 495
          __cil_tmp___8 = Channel_MaxUsers(chan);
#line 495
          snprintf(l, sizeof(l), " %lu", __cil_tmp___8);
#line 496
          strlcat(modes_add, (char const   *)(l), sizeof(modes_add));
        }
#line 498
        if ((int )*ptr == 107) {
#line 500
          strlcat(modes_add, " ", sizeof(modes_add));
#line 501
          __cil_tmp___9 = Channel_Key(chan);
#line 501
          strlcat(modes_add, (char const   *)__cil_tmp___9, sizeof(modes_add));
        }
#line 503
        ptr ++;
      }
#line 507
      __cil_tmp___10 = Channel_Modes(chan);
#line 507
      IRC_WriteStrChannelPrefix(Client, chan, from, 0, (char *)"MODE %s +%s%s", Req->argv[0],
                                __cil_tmp___10, modes_add);
    }
  } else {
#line 510
    Log(4, "CHANINFO: invalid MODE format ignored!");
  }
#line 512
  if (arg_topic > 0) {
#line 515
    ptr = Channel_Topic(chan);
#line 516
    if (! *ptr) {
#line 516
      if (*(Req->argv[arg_topic] + 0)) {
#line 519
        Channel_SetTopic(chan, Client, Req->argv[arg_topic]);
#line 520
        __cil_tmp___11 = Channel_Topic(chan);
#line 520
        IRC_WriteStrChannelPrefix(Client, chan, from, 0, (char *)"TOPIC %s :%s", Req->argv[0],
                                  __cil_tmp___11);
      }
    }
  }
#line 526
  if (Req->argc == 5) {
#line 526
    IRC_WriteStrServersPrefixFlag(Client, from, (char )'C', (char *)"CHANINFO %s %s %s %s :%s",
                                  Req->argv[0], Req->argv[1], Req->argv[2], Req->argv[3],
                                  Req->argv[4]);
  } else {
#line 527
    if (Req->argc == 3) {
#line 527
      IRC_WriteStrServersPrefixFlag(Client, from, (char )'C', (char *)"CHANINFO %s %s :%s",
                                    Req->argv[0], Req->argv[1], Req->argv[2]);
    } else {
#line 528
      IRC_WriteStrServersPrefixFlag(Client, from, (char )'C', (char *)"CHANINFO %s %s",
                                    Req->argv[0], Req->argv[1]);
    }
  }
#line 530
  return (1);
}
}
#line 1 "irc-info.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-app7XFNj.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 27 "./../tool/tool.h"
void ngt_TrimLastChr(char *String , char Chr ) ;
#line 21 "irc-info.h"
int IRC_ADMIN(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_ISON(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_LINKS(CLIENT *Client , REQUEST *Req ) ;
#line 24
int IRC_LUSERS(CLIENT *Client , REQUEST *Req ) ;
#line 25
int IRC_MOTD(CLIENT *Client , REQUEST *Req ) ;
#line 26
int IRC_NAMES(CLIENT *Client , REQUEST *Req ) ;
#line 27
int IRC_STATS(CLIENT *Client , REQUEST *Req ) ;
#line 28
int IRC_TIME(CLIENT *Client , REQUEST *Req ) ;
#line 29
int IRC_USERHOST(CLIENT *Client , REQUEST *Req ) ;
#line 30
int IRC_VERSION(CLIENT *Client , REQUEST *Req ) ;
#line 31
int IRC_WHO(CLIENT *Client , REQUEST *Req ) ;
#line 32
int IRC_WHOIS(CLIENT *Client , REQUEST *Req ) ;
#line 33
int IRC_WHOWAS(CLIENT *Client , REQUEST *Req ) ;
#line 35
int IRC_Send_LUSERS(CLIENT *Client ) ;
#line 37
int IRC_Show_MOTD(CLIENT *Client ) ;
#line 38
int IRC_Send_WHO(CLIENT *Client , CHANNEL *Chan , int OnlyOps ) ;
#line 39
int IRC_Send_ISUPPORT(CLIENT *Client ) ;
#line 46 "irc-info.c"
int IRC_ADMIN(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *prefix ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;

  {
#line 55
  if (Req->argc > 1) {
#line 55
    __cil_tmp = Client_ID(Client);
#line 55
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 55
    return (__cil_tmp___0);
  }
#line 58
  if (Req->argc == 1) {
#line 58
    target = Client_Search(Req->argv[0]);
  } else {
#line 59
    target = Client_ThisServer();
  }
#line 62
  __cil_tmp___1 = Client_Type(Client);
#line 62
  if (__cil_tmp___1 == 32) {
#line 62
    prefix = Client_Search(Req->prefix);
  } else {
#line 63
    prefix = Client;
  }
#line 64
  if (! prefix) {
#line 64
    __cil_tmp___2 = Client_ID(Client);
#line 64
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 64
    return (__cil_tmp___3);
  }
#line 67
  __cil_tmp___7 = Client_ThisServer();
#line 67
  if ((unsigned int )target != (unsigned int )__cil_tmp___7) {
#line 69
    if (! target) {
#line 69
      __cil_tmp___4 = Client_ID(prefix);
#line 69
      __cil_tmp___5 = IRC_WriteStrClient(prefix, (char *)"402 %s %s :No such server",
                                         __cil_tmp___4, Req->argv[0]);
#line 69
      return (__cil_tmp___5);
    } else {
#line 69
      __cil_tmp___6 = Client_Type(target);
#line 69
      if (__cil_tmp___6 != 32) {
#line 69
        __cil_tmp___4 = Client_ID(prefix);
#line 69
        __cil_tmp___5 = IRC_WriteStrClient(prefix, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 69
        return (__cil_tmp___5);
      }
    }
#line 72
    IRC_WriteStrClientPrefix(target, prefix, (char *)"ADMIN %s", Req->argv[0]);
#line 73
    return (1);
  }
#line 77
  __cil_tmp___8 = Client_ID(prefix);
#line 77
  __cil_tmp___9 = IRC_WriteStrClient(Client, (char *)"256 %s %s :Administrative info",
                                     __cil_tmp___8, Conf_ServerName);
#line 77
  if (! __cil_tmp___9) {
#line 77
    return (0);
  }
#line 78
  __cil_tmp___10 = Client_ID(prefix);
#line 78
  __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"257 %s :%s", __cil_tmp___10,
                                      Conf_ServerAdmin1);
#line 78
  if (! __cil_tmp___11) {
#line 78
    return (0);
  }
#line 79
  __cil_tmp___12 = Client_ID(prefix);
#line 79
  __cil_tmp___13 = IRC_WriteStrClient(Client, (char *)"258 %s :%s", __cil_tmp___12,
                                      Conf_ServerAdmin2);
#line 79
  if (! __cil_tmp___13) {
#line 79
    return (0);
  }
#line 80
  __cil_tmp___14 = Client_ID(prefix);
#line 80
  __cil_tmp___15 = IRC_WriteStrClient(Client, (char *)"259 %s :%s", __cil_tmp___14,
                                      Conf_ServerAdminMail);
#line 80
  if (! __cil_tmp___15) {
#line 80
    return (0);
  }
#line 82
  IRC_SetPenalty(Client, 1L);
#line 83
  return (1);
}
}
#line 87 "irc-info.c"
int IRC_ISON(CLIENT *Client , REQUEST *Req ) 
{ char rpl[513] ;
  CLIENT *c ;
  char *ptr ;
  int i ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 99
  if (Req->argc < 1) {
#line 99
    __cil_tmp = Client_ID(Client);
#line 99
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 99
    return (__cil_tmp___0);
  }
#line 101
  strlcpy(rpl, "303 %s :", sizeof(rpl));
#line 102
  i = 0;
#line 102
  while (i < Req->argc) {
#line 104
    ptr = strtok(Req->argv[i], " ");
#line 105
    while (ptr) {
#line 107
      ngt_TrimStr(ptr);
#line 108
      c = Client_Search(ptr);
#line 109
      if (c) {
#line 109
        __cil_tmp___1 = Client_Type(c);
#line 109
        if (__cil_tmp___1 == 16) {
#line 112
          strlcat(rpl, (char const   *)ptr, sizeof(rpl));
#line 113
          strlcat(rpl, " ", sizeof(rpl));
        }
      }
#line 115
      ptr = strtok((char *)((void *)0), " ");
    }
#line 102
    i ++;
  }
#line 118
  ngt_TrimLastChr(rpl, (char )' ');
#line 120
  __cil_tmp___2 = Client_ID(Client);
#line 120
  __cil_tmp___3 = IRC_WriteStrClient(Client, rpl, __cil_tmp___2);
#line 120
  return (__cil_tmp___3);
}
}
#line 124 "irc-info.c"
int IRC_LINKS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *from ;
  CLIENT *c ;
  char *mask ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  CLIENT *__cil_tmp___17 ;
  CLIENT *__cil_tmp___18 ;
  char *__cil_tmp___19 ;
  char *__cil_tmp___20 ;
  char *__cil_tmp___21 ;
  int __cil_tmp___22 ;
  int __cil_tmp___23 ;
  char *__cil_tmp___24 ;
  int __cil_tmp___25 ;

  {
#line 134
  if (Req->argc > 2) {
#line 134
    __cil_tmp = Client_ID(Client);
#line 134
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 134
    return (__cil_tmp___0);
  }
#line 137
  if (Req->argc > 0) {
#line 137
    mask = Req->argv[Req->argc - 1];
  } else {
#line 138
    mask = (char *)"*";
  }
#line 141
  __cil_tmp___1 = Client_Type(Client);
#line 141
  if (__cil_tmp___1 == 32) {
#line 141
    from = Client_Search(Req->prefix);
  } else {
#line 142
    from = Client;
  }
#line 143
  if (! from) {
#line 143
    __cil_tmp___2 = Client_ID(Client);
#line 143
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 143
    return (__cil_tmp___3);
  }
#line 146
  if (Req->argc == 2) {
#line 148
    target = Client_Search(Req->argv[0]);
#line 149
    if (! target) {
#line 149
      __cil_tmp___4 = Client_ID(from);
#line 149
      __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                         __cil_tmp___4, Req->argv[0]);
#line 149
      return (__cil_tmp___5);
    } else {
#line 149
      __cil_tmp___8 = Client_Type(target);
#line 149
      if (__cil_tmp___8 != 32) {
#line 149
        __cil_tmp___4 = Client_ID(from);
#line 149
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 149
        return (__cil_tmp___5);
      } else {
#line 150
        __cil_tmp___7 = Client_ThisServer();
#line 150
        if ((unsigned int )target != (unsigned int )__cil_tmp___7) {
#line 150
          __cil_tmp___6 = IRC_WriteStrClientPrefix(target, from, (char *)"LINKS %s %s",
                                                   Req->argv[0], Req->argv[1]);
#line 150
          return (__cil_tmp___6);
        }
      }
    }
  }
#line 154
  __cil_tmp___9 = Client_Type(Client);
#line 154
  if (__cil_tmp___9 == 32) {
#line 154
    target = Client_Search(Req->prefix);
  } else {
#line 155
    target = Client;
  }
#line 156
  if (! target) {
#line 156
    __cil_tmp___10 = Client_ID(Client);
#line 156
    __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                        __cil_tmp___10, Req->prefix);
#line 156
    return (__cil_tmp___11);
  }
#line 158
  c = Client_First();
#line 159
  while (c) {
#line 161
    __cil_tmp___23 = Client_Type(c);
#line 161
    if (__cil_tmp___23 == 32) {
#line 163
      __cil_tmp___12 = Client_Info(c);
#line 163
      __cil_tmp___13 = Client_Hops(c);
#line 163
      __cil_tmp___18 = Client_TopServer(c);
#line 163
      if (__cil_tmp___18) {
#line 163
        __cil_tmp___17 = Client_TopServer(c);
      } else {
#line 163
        __cil_tmp___17 = Client_ThisServer();
      }
#line 163
      __cil_tmp___19 = Client_ID(__cil_tmp___17);
#line 163
      __cil_tmp___20 = Client_ID(c);
#line 163
      __cil_tmp___21 = Client_ID(target);
#line 163
      __cil_tmp___22 = IRC_WriteStrClient(target, (char *)"364 %s %s %s :%d %s", __cil_tmp___21,
                                          __cil_tmp___20, __cil_tmp___19, __cil_tmp___13,
                                          __cil_tmp___12);
#line 163
      if (! __cil_tmp___22) {
#line 163
        return (0);
      }
    }
#line 165
    c = Client_Next(c);
  }
#line 168
  IRC_SetPenalty(target, 1L);
#line 169
  __cil_tmp___24 = Client_ID(target);
#line 169
  __cil_tmp___25 = IRC_WriteStrClient(target, (char *)"365 %s %s :End of LINKS list",
                                      __cil_tmp___24, mask);
#line 169
  return (__cil_tmp___25);
}
}
#line 173 "irc-info.c"
int IRC_LUSERS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *from ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;

  {
#line 182
  if (Req->argc > 2) {
#line 182
    __cil_tmp = Client_ID(Client);
#line 182
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 182
    return (__cil_tmp___0);
  }
#line 185
  __cil_tmp___1 = Client_Type(Client);
#line 185
  if (__cil_tmp___1 == 32) {
#line 185
    from = Client_Search(Req->prefix);
  } else {
#line 186
    from = Client;
  }
#line 187
  if (! from) {
#line 187
    __cil_tmp___2 = Client_ID(Client);
#line 187
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 187
    return (__cil_tmp___3);
  }
#line 190
  if (Req->argc == 2) {
#line 192
    target = Client_Search(Req->argv[1]);
#line 193
    if (! target) {
#line 193
      __cil_tmp___4 = Client_ID(from);
#line 193
      __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                         __cil_tmp___4, Req->argv[1]);
#line 193
      return (__cil_tmp___5);
    } else {
#line 193
      __cil_tmp___8 = Client_Type(target);
#line 193
      if (__cil_tmp___8 != 32) {
#line 193
        __cil_tmp___4 = Client_ID(from);
#line 193
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[1]);
#line 193
        return (__cil_tmp___5);
      } else {
#line 194
        __cil_tmp___7 = Client_ThisServer();
#line 194
        if ((unsigned int )target != (unsigned int )__cil_tmp___7) {
#line 194
          __cil_tmp___6 = IRC_WriteStrClientPrefix(target, from, (char *)"LUSERS %s %s",
                                                   Req->argv[0], Req->argv[1]);
#line 194
          return (__cil_tmp___6);
        }
      }
    }
  }
#line 198
  __cil_tmp___9 = Client_Type(Client);
#line 198
  if (__cil_tmp___9 == 32) {
#line 198
    target = Client_Search(Req->prefix);
  } else {
#line 199
    target = Client;
  }
#line 200
  if (! target) {
#line 200
    __cil_tmp___10 = Client_ID(Client);
#line 200
    __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                        __cil_tmp___10, Req->prefix);
#line 200
    return (__cil_tmp___11);
  }
#line 202
  IRC_Send_LUSERS(target);
#line 204
  IRC_SetPenalty(target, 1L);
#line 205
  return (1);
}
}
#line 209 "irc-info.c"
int IRC_MOTD(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *from ;
  CLIENT *target ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  CLIENT *__cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 218
  if (Req->argc > 1) {
#line 218
    __cil_tmp = Client_ID(Client);
#line 218
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 218
    return (__cil_tmp___0);
  }
#line 221
  __cil_tmp___1 = Client_Type(Client);
#line 221
  if (__cil_tmp___1 == 32) {
#line 221
    from = Client_Search(Req->prefix);
  } else {
#line 222
    from = Client;
  }
#line 223
  if (! from) {
#line 223
    __cil_tmp___2 = Client_ID(Client);
#line 223
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 223
    return (__cil_tmp___3);
  }
#line 225
  if (Req->argc == 1) {
#line 228
    target = Client_Search(Req->argv[0]);
#line 229
    if (! target) {
#line 229
      __cil_tmp___4 = Client_ID(from);
#line 229
      __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                         __cil_tmp___4, Req->argv[0]);
#line 229
      return (__cil_tmp___5);
    } else {
#line 229
      __cil_tmp___6 = Client_Type(target);
#line 229
      if (__cil_tmp___6 != 32) {
#line 229
        __cil_tmp___4 = Client_ID(from);
#line 229
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 229
        return (__cil_tmp___5);
      }
    }
#line 231
    __cil_tmp___8 = Client_ThisServer();
#line 231
    if ((unsigned int )target != (unsigned int )__cil_tmp___8) {
#line 234
      __cil_tmp___7 = IRC_WriteStrClientPrefix(target, from, (char *)"MOTD %s", Req->argv[0]);
#line 234
      return (__cil_tmp___7);
    }
  }
#line 238
  IRC_SetPenalty(from, 3L);
#line 239
  __cil_tmp___9 = IRC_Show_MOTD(from);
#line 239
  return (__cil_tmp___9);
}
}
#line 243 "irc-info.c"
int IRC_NAMES(CLIENT *Client , REQUEST *Req ) 
{ char rpl[513] ;
  char *ptr ;
  CLIENT *target ;
  CLIENT *from ;
  CLIENT *c ;
  CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  CLIENT *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  int __cil_tmp___12 ;
  char *__cil_tmp___13 ;
  size_t __cil_tmp___14 ;
  char *__cil_tmp___15 ;
  int __cil_tmp___16 ;
  char *__cil_tmp___17 ;
  size_t __cil_tmp___18 ;
  int __cil_tmp___19 ;
  CL2CHAN *__cil_tmp___20 ;
  char *__cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;
  size_t __cil_tmp___24 ;
  char *__cil_tmp___25 ;
  int __cil_tmp___26 ;

  {
#line 254
  if (Req->argc > 2) {
#line 254
    __cil_tmp = Client_ID(Client);
#line 254
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 254
    return (__cil_tmp___0);
  }
#line 257
  __cil_tmp___1 = Client_Type(Client);
#line 257
  if (__cil_tmp___1 == 32) {
#line 257
    from = Client_Search(Req->prefix);
  } else {
#line 258
    from = Client;
  }
#line 259
  if (! from) {
#line 259
    __cil_tmp___2 = Client_ID(Client);
#line 259
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 259
    return (__cil_tmp___3);
  }
#line 261
  if (Req->argc == 2) {
#line 264
    target = Client_Search(Req->argv[1]);
#line 265
    if (! target) {
#line 265
      __cil_tmp___4 = Client_ID(from);
#line 265
      __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                         __cil_tmp___4, Req->argv[1]);
#line 265
      return (__cil_tmp___5);
    } else {
#line 265
      __cil_tmp___6 = Client_Type(target);
#line 265
      if (__cil_tmp___6 != 32) {
#line 265
        __cil_tmp___4 = Client_ID(from);
#line 265
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[1]);
#line 265
        return (__cil_tmp___5);
      }
    }
#line 267
    __cil_tmp___8 = Client_ThisServer();
#line 267
    if ((unsigned int )target != (unsigned int )__cil_tmp___8) {
#line 270
      __cil_tmp___7 = IRC_WriteStrClientPrefix(target, from, (char *)"NAMES %s :%s",
                                               Req->argv[0], Req->argv[1]);
#line 270
      return (__cil_tmp___7);
    }
  }
#line 274
  if (Req->argc > 0) {
#line 277
    ptr = strtok(Req->argv[0], ",");
#line 278
    while (ptr) {
#line 280
      chan = Channel_Search(ptr);
#line 281
      if (chan) {
#line 284
        __cil_tmp___9 = IRC_Send_NAMES(from, chan);
#line 284
        if (! __cil_tmp___9) {
#line 284
          return (0);
        }
      }
#line 286
      __cil_tmp___10 = Client_ID(from);
#line 286
      __cil_tmp___11 = IRC_WriteStrClient(from, (char *)"366 %s %s :End of NAMES list",
                                          __cil_tmp___10, ptr);
#line 286
      if (! __cil_tmp___11) {
#line 286
        return (0);
      }
#line 289
      ptr = strtok((char *)((void *)0), ",");
    }
#line 291
    return (1);
  }
#line 295
  chan = Channel_First();
#line 296
  while (chan) {
#line 299
    __cil_tmp___12 = IRC_Send_NAMES(from, chan);
#line 299
    if (! __cil_tmp___12) {
#line 299
      return (0);
    }
#line 302
    chan = Channel_Next(chan);
  }
#line 306
  c = Client_First();
#line 307
  __cil_tmp___13 = Client_ID(from);
#line 307
  snprintf(rpl, sizeof(rpl), "353 %s %s %s :", __cil_tmp___13, "*", "*");
#line 308
  while (c) {
#line 310
    __cil_tmp___19 = Client_Type(c);
#line 310
    if (__cil_tmp___19 == 16) {
#line 310
      __cil_tmp___20 = Channel_FirstChannelOf(c);
#line 310
      if ((unsigned int )__cil_tmp___20 == (unsigned int )((void *)0)) {
#line 310
        __cil_tmp___21 = Client_Modes(c);
#line 310
        __cil_tmp___22 = strchr((char const   *)__cil_tmp___21, 'i');
#line 310
        if (! __cil_tmp___22) {
#line 313
          __cil_tmp___14 = strlen((char const   *)(rpl));
#line 313
          if ((int )rpl[__cil_tmp___14 - 1UL] != 58) {
#line 313
            strlcat(rpl, " ", sizeof(rpl));
          }
#line 314
          __cil_tmp___15 = Client_ID(c);
#line 314
          strlcat(rpl, (char const   *)__cil_tmp___15, sizeof(rpl));
#line 316
          __cil_tmp___18 = strlen((char const   *)(rpl));
#line 316
          if (__cil_tmp___18 > 220UL) {
#line 319
            __cil_tmp___16 = IRC_WriteStrClient(from, (char *)"%s", rpl);
#line 319
            if (! __cil_tmp___16) {
#line 319
              return (0);
            }
#line 320
            __cil_tmp___17 = Client_ID(from);
#line 320
            snprintf(rpl, sizeof(rpl), "353 %s %s %s :", __cil_tmp___17, "*", "*");
          }
        }
      }
    }
#line 325
    c = Client_Next(c);
  }
#line 327
  __cil_tmp___24 = strlen((char const   *)(rpl));
#line 327
  if ((int )rpl[__cil_tmp___24 - 1UL] != 58) {
#line 330
    __cil_tmp___23 = IRC_WriteStrClient(from, (char *)"%s", rpl);
#line 330
    if (! __cil_tmp___23) {
#line 330
      return (0);
    }
  }
#line 333
  IRC_SetPenalty(from, 1L);
#line 334
  __cil_tmp___25 = Client_ID(from);
#line 334
  __cil_tmp___26 = IRC_WriteStrClient(from, (char *)"366 %s %s :End of NAMES list",
                                      __cil_tmp___25, "*");
#line 334
  return (__cil_tmp___26);
}
}
#line 338 "irc-info.c"
static unsigned int t_diff(time_t *t , time_t div___0 ) 
{ time_t diff ;
  time_t remain ;

  {
#line 343
  diff = *t / div___0;
#line 345
  remain = diff * div___0;
#line 346
  *t -= remain;
#line 348
  return ((unsigned int )diff);
}
}
#line 352 "irc-info.c"
static unsigned int uptime_days(time_t *now ) 
{ unsigned int __cil_tmp ;

  {
#line 355
  __cil_tmp = t_diff(now, 86400L);
#line 355
  return (__cil_tmp);
}
}
#line 359 "irc-info.c"
static unsigned int uptime_hrs(time_t *now ) 
{ unsigned int __cil_tmp ;

  {
#line 362
  __cil_tmp = t_diff(now, 3600L);
#line 362
  return (__cil_tmp);
}
}
#line 366 "irc-info.c"
static unsigned int uptime_mins(time_t *now ) 
{ unsigned int __cil_tmp ;

  {
#line 369
  __cil_tmp = t_diff(now, 60L);
#line 369
  return (__cil_tmp);
}
}
#line 373 "irc-info.c"
int IRC_STATS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *from ;
  CLIENT *target ;
  CLIENT *cl ;
  CONN_ID con ;
  char query ;
  COMMAND *cmd ;
  time_t time_now ;
  unsigned int days ;
  unsigned int hrs ;
  unsigned int mins ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  CLIENT *__cil_tmp___8 ;
  time_t __cil_tmp___9 ;
  long __cil_tmp___10 ;
  long __cil_tmp___11 ;
  long __cil_tmp___12 ;
  long __cil_tmp___13 ;
  size_t __cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  int __cil_tmp___18 ;
  char *__cil_tmp___19 ;
  int __cil_tmp___20 ;
  time_t __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;
  char *__cil_tmp___24 ;
  int __cil_tmp___25 ;

  {
#line 387
  if (Req->argc > 2) {
#line 388
    __cil_tmp = Client_ID(Client);
#line 388
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 388
    return (__cil_tmp___0);
  }
#line 391
  __cil_tmp___1 = Client_Type(Client);
#line 391
  if (__cil_tmp___1 == 32) {
#line 392
    from = Client_Search(Req->prefix);
  } else {
#line 394
    from = Client;
  }
#line 396
  if (! from) {
#line 397
    __cil_tmp___2 = Client_ID(Client);
#line 397
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 397
    return (__cil_tmp___3);
  }
#line 399
  if (Req->argc == 2) {
#line 401
    target = Client_Search(Req->argv[1]);
#line 402
    if (! target) {
#line 403
      __cil_tmp___4 = Client_ID(from);
#line 403
      __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                         __cil_tmp___4, Req->argv[1]);
#line 403
      return (__cil_tmp___5);
    } else {
#line 402
      __cil_tmp___6 = Client_Type(target);
#line 402
      if (__cil_tmp___6 != 32) {
#line 403
        __cil_tmp___4 = Client_ID(from);
#line 403
        __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[1]);
#line 403
        return (__cil_tmp___5);
      }
    }
#line 405
    __cil_tmp___8 = Client_ThisServer();
#line 405
    if ((unsigned int )target != (unsigned int )__cil_tmp___8) {
#line 407
      __cil_tmp___7 = IRC_WriteStrClientPrefix(target, from, (char *)"STATS %s %s",
                                               Req->argv[0], Req->argv[1]);
#line 407
      return (__cil_tmp___7);
    }
  }
#line 411
  if (Req->argc > 0) {
#line 412
    if (*(Req->argv[0] + 0)) {
#line 412
      query = *(Req->argv[0] + 0);
    } else {
#line 412
      query = (char )'*';
    }
  } else {
#line 414
    query = (char )'*';
  }
#line 416
  switch ((int )query) {
  case 108: 
  case 76: 
#line 419
  time_now = time((time_t *)((void *)0));
#line 420
  con = Conn_First();
#line 420
  while (con != -1) {
#line 421
    cl = Conn_GetClient(con);
#line 422
    if (! cl) {
      goto __Cont;
    }
#line 424
    __cil_tmp___18 = Client_Type(cl);
#line 424
    if (__cil_tmp___18 == 32) {
      goto _L;
    } else {
#line 424
      if ((unsigned int )cl == (unsigned int )Client) {
        _L: /* CIL Label */ 
#line 436
        __cil_tmp___9 = Conn_StartTime(con);
#line 436
        __cil_tmp___10 = Conn_RecvBytes(con);
#line 436
        __cil_tmp___11 = Conn_RecvMsg(con);
#line 436
        __cil_tmp___12 = Conn_SendBytes(con);
#line 436
        __cil_tmp___13 = Conn_SendMsg(con);
#line 436
        __cil_tmp___14 = Conn_SendQ(con);
#line 436
        __cil_tmp___15 = Client_Mask(cl);
#line 436
        __cil_tmp___16 = Client_ID(from);
#line 436
        __cil_tmp___17 = IRC_WriteStrClient(from, (char *)"211 %s %s %d %ld %ld %ld %ld :%ld",
                                            __cil_tmp___16, __cil_tmp___15, __cil_tmp___14,
                                            __cil_tmp___13, __cil_tmp___12, __cil_tmp___11,
                                            __cil_tmp___10, time_now - __cil_tmp___9);
#line 436
        if (! __cil_tmp___17) {
#line 439
          return (0);
        }
      }
    }
    __Cont: /* CIL Label */ 
#line 420
    con = Conn_Next(con);
  }
#line 442
  break;
  case 109: 
  case 77: 
#line 445
  cmd = Parse_GetCommandStruct();
#line 446
  while (cmd->name) {
#line 447
    if (cmd->lcount == 0L) {
#line 447
      if (cmd->rcount == 0L) {
        goto __Cont___0;
      }
    }
#line 449
    __cil_tmp___19 = Client_ID(from);
#line 449
    __cil_tmp___20 = IRC_WriteStrClient(from, (char *)"212 %s %s %ld %ld %ld", __cil_tmp___19,
                                        cmd->name, cmd->lcount, cmd->bytes, cmd->rcount);
#line 449
    if (! __cil_tmp___20) {
#line 451
      return (0);
    }
    __Cont___0: /* CIL Label */ 
#line 446
    cmd ++;
  }
#line 453
  break;
  case 117: 
  case 85: 
#line 456
  __cil_tmp___21 = time((time_t *)((void *)0));
#line 456
  time_now = __cil_tmp___21 - NGIRCd_Start;
#line 457
  days = uptime_days(& time_now);
#line 458
  hrs = uptime_hrs(& time_now);
#line 459
  mins = uptime_mins(& time_now);
#line 460
  __cil_tmp___22 = Client_ID(from);
#line 460
  __cil_tmp___23 = IRC_WriteStrClient(from, (char *)"242 %s :Server Up %u days %u:%02u:%02u",
                                      __cil_tmp___22, days, hrs, mins, (unsigned int )time_now);
#line 460
  if (! __cil_tmp___23) {
#line 462
    return (0);
  }
#line 463
  break;
  }
#line 466
  IRC_SetPenalty(from, 2L);
#line 467
  __cil_tmp___24 = Client_ID(from);
#line 467
  __cil_tmp___25 = IRC_WriteStrClient(from, (char *)"219 %s %c :End of STATS report",
                                      __cil_tmp___24, query);
#line 467
  return (__cil_tmp___25);
}
}
#line 471 "irc-info.c"
int IRC_TIME(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *from ;
  CLIENT *target ;
  char t_str[64] ;
  time_t t ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  CLIENT *__cil_tmp___8 ;
  struct tm *__cil_tmp___9 ;
  CLIENT *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;

  {
#line 482
  if (Req->argc > 1) {
#line 482
    __cil_tmp = Client_ID(Client);
#line 482
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 482
    return (__cil_tmp___0);
  }
#line 485
  __cil_tmp___1 = Client_Type(Client);
#line 485
  if (__cil_tmp___1 == 32) {
#line 485
    from = Client_Search(Req->prefix);
  } else {
#line 486
    from = Client;
  }
#line 487
  if (! from) {
#line 487
    __cil_tmp___2 = Client_ID(Client);
#line 487
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 487
    return (__cil_tmp___3);
  }
#line 489
  if (Req->argc == 1) {
#line 492
    target = Client_Search(Req->argv[0]);
#line 493
    if (! target) {
#line 493
      __cil_tmp___4 = Client_ID(Client);
#line 493
      __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                         __cil_tmp___4, Req->argv[0]);
#line 493
      return (__cil_tmp___5);
    } else {
#line 493
      __cil_tmp___6 = Client_Type(target);
#line 493
      if (__cil_tmp___6 != 32) {
#line 493
        __cil_tmp___4 = Client_ID(Client);
#line 493
        __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 493
        return (__cil_tmp___5);
      }
    }
#line 495
    __cil_tmp___8 = Client_ThisServer();
#line 495
    if ((unsigned int )target != (unsigned int )__cil_tmp___8) {
#line 498
      __cil_tmp___7 = IRC_WriteStrClientPrefix(target, from, (char *)"TIME %s", Req->argv[0]);
#line 498
      return (__cil_tmp___7);
    }
  }
#line 502
  t = time((time_t *)((void *)0));
#line 503
  __cil_tmp___9 = localtime((time_t const   *)(& t));
#line 503
  strftime(t_str, 60UL, "%A %B %d %Y -- %H:%M %Z", (struct tm  const  *)__cil_tmp___9);
#line 504
  __cil_tmp___10 = Client_ThisServer();
#line 504
  __cil_tmp___11 = Client_ID(__cil_tmp___10);
#line 504
  __cil_tmp___12 = Client_ID(from);
#line 504
  __cil_tmp___13 = IRC_WriteStrClient(from, (char *)"391 %s %s :%s", __cil_tmp___12,
                                      __cil_tmp___11, t_str);
#line 504
  return (__cil_tmp___13);
}
}
#line 508 "irc-info.c"
int IRC_USERHOST(CLIENT *Client , REQUEST *Req ) 
{ char rpl[513] ;
  CLIENT *c ;
  int max ;
  int i ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;

  {
#line 519
  if (Req->argc < 1) {
#line 519
    __cil_tmp = Client_ID(Client);
#line 519
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 519
    return (__cil_tmp___0);
  }
#line 521
  if (Req->argc > 5) {
#line 521
    max = 5;
  } else {
#line 522
    max = Req->argc;
  }
#line 524
  strlcpy(rpl, "302 %s :", sizeof(rpl));
#line 525
  i = 0;
#line 525
  while (i < max) {
#line 527
    c = Client_Search(Req->argv[i]);
#line 528
    if (c) {
#line 528
      __cil_tmp___6 = Client_Type(c);
#line 528
      if (__cil_tmp___6 == 16) {
#line 531
        __cil_tmp___1 = Client_ID(c);
#line 531
        strlcat(rpl, (char const   *)__cil_tmp___1, sizeof(rpl));
#line 532
        __cil_tmp___2 = Client_HasMode(c, (char )'o');
#line 532
        if (__cil_tmp___2) {
#line 532
          strlcat(rpl, "*", sizeof(rpl));
        }
#line 533
        strlcat(rpl, "=", sizeof(rpl));
#line 534
        __cil_tmp___3 = Client_HasMode(c, (char )'a');
#line 534
        if (__cil_tmp___3) {
#line 534
          strlcat(rpl, "-", sizeof(rpl));
        } else {
#line 535
          strlcat(rpl, "+", sizeof(rpl));
        }
#line 536
        __cil_tmp___4 = Client_User(c);
#line 536
        strlcat(rpl, (char const   *)__cil_tmp___4, sizeof(rpl));
#line 537
        strlcat(rpl, "@", sizeof(rpl));
#line 538
        __cil_tmp___5 = Client_Hostname(c);
#line 538
        strlcat(rpl, (char const   *)__cil_tmp___5, sizeof(rpl));
#line 539
        strlcat(rpl, " ", sizeof(rpl));
      }
    }
#line 525
    i ++;
  }
#line 542
  ngt_TrimLastChr(rpl, (char )' ');
#line 544
  __cil_tmp___7 = Client_ID(Client);
#line 544
  __cil_tmp___8 = IRC_WriteStrClient(Client, rpl, __cil_tmp___7);
#line 544
  return (__cil_tmp___8);
}
}
#line 548 "irc-info.c"
int IRC_VERSION(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *prefix ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 560
  if (Req->argc > 1) {
#line 560
    __cil_tmp = Client_ID(Client);
#line 560
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 560
    return (__cil_tmp___0);
  }
#line 563
  if (Req->argc == 1) {
#line 563
    target = Client_Search(Req->argv[0]);
  } else {
#line 564
    target = Client_ThisServer();
  }
#line 567
  __cil_tmp___1 = Client_Type(Client);
#line 567
  if (__cil_tmp___1 == 32) {
#line 567
    prefix = Client_Search(Req->prefix);
  } else {
#line 568
    prefix = Client;
  }
#line 569
  if (! prefix) {
#line 569
    __cil_tmp___2 = Client_ID(Client);
#line 569
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 569
    return (__cil_tmp___3);
  }
#line 572
  __cil_tmp___7 = Client_ThisServer();
#line 572
  if ((unsigned int )target != (unsigned int )__cil_tmp___7) {
#line 574
    if (! target) {
#line 574
      __cil_tmp___4 = Client_ID(prefix);
#line 574
      __cil_tmp___5 = IRC_WriteStrClient(prefix, (char *)"402 %s %s :No such server",
                                         __cil_tmp___4, Req->argv[0]);
#line 574
      return (__cil_tmp___5);
    } else {
#line 574
      __cil_tmp___6 = Client_Type(target);
#line 574
      if (__cil_tmp___6 != 32) {
#line 574
        __cil_tmp___4 = Client_ID(prefix);
#line 574
        __cil_tmp___5 = IRC_WriteStrClient(prefix, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[0]);
#line 574
        return (__cil_tmp___5);
      }
    }
#line 577
    IRC_WriteStrClientPrefix(target, prefix, (char *)"VERSION %s", Req->argv[0]);
#line 578
    return (1);
  }
#line 582
  IRC_SetPenalty(Client, 1L);
#line 590
  __cil_tmp___8 = Client_ID(prefix);
#line 590
  __cil_tmp___9 = IRC_WriteStrClient(Client, (char *)"351 %s %s-%s.%s %s :%s", __cil_tmp___8,
                                     "ngircd", "0.11.1", NGIRCd_DebugLevel, Conf_ServerName,
                                     NGIRCd_VersionAddition);
#line 590
  return (__cil_tmp___9);
}
}
#line 595 "irc-info.c"
int IRC_WHO(CLIENT *Client , REQUEST *Req ) 
{ int ok ;
  int only_ops ;
  char flags[8] ;
  char const   *ptr ;
  CL2CHAN *cl2chan ;
  CHANNEL *chan ;
  CHANNEL *cn ;
  CLIENT *c ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int __cil_tmp___10 ;
  char *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  char *__cil_tmp___13 ;
  int __cil_tmp___14 ;
  char *__cil_tmp___15 ;
  CLIENT *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  char *__cil_tmp___18 ;
  char *__cil_tmp___19 ;
  char *__cil_tmp___20 ;
  int __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  int __cil_tmp___24 ;
  char *__cil_tmp___25 ;
  char *__cil_tmp___26 ;
  char const   *__cil_tmp___27 ;
  char *__cil_tmp___28 ;
  int __cil_tmp___29 ;
  char *__cil_tmp___30 ;
  int __cil_tmp___31 ;
  char *__cil_tmp___32 ;
  int __cil_tmp___33 ;

  {
#line 609
  if (Req->argc > 2) {
#line 609
    __cil_tmp = Client_ID(Client);
#line 609
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 609
    return (__cil_tmp___0);
  }
#line 611
  only_ops = 0;
#line 612
  chan = (CHANNEL *)((void *)0);
#line 614
  if (Req->argc == 2) {
#line 617
    __cil_tmp___1 = strcmp((char const   *)Req->argv[1], "o");
#line 617
    if (__cil_tmp___1 == 0) {
#line 617
      only_ops = 1;
    }
  }
#line 623
  if (Req->argc >= 1) {
#line 626
    chan = Channel_Search(Req->argv[0]);
  }
#line 629
  if (chan) {
#line 632
    __cil_tmp___2 = IRC_Send_WHO(Client, chan, only_ops);
#line 632
    if (! __cil_tmp___2) {
#line 632
      return (0);
    }
  }
#line 635
  c = Client_First();
#line 636
  while (c) {
#line 638
    __cil_tmp___24 = Client_Type(c);
#line 638
    if (__cil_tmp___24 == 16) {
#line 638
      __cil_tmp___25 = Client_Modes(c);
#line 638
      __cil_tmp___26 = strchr((char const   *)__cil_tmp___25, 'i');
#line 638
      if (! __cil_tmp___26) {
#line 640
        ok = 0;
#line 641
        if (Req->argc == 0) {
#line 641
          ok = 1;
        } else {
#line 644
          __cil_tmp___4 = Client_ID(c);
#line 644
          __cil_tmp___5 = strcasecmp((char const   *)Req->argv[0], (char const   *)__cil_tmp___4);
#line 644
          if (__cil_tmp___5 == 0) {
#line 644
            ok = 1;
          } else {
#line 645
            __cil_tmp___3 = strcmp((char const   *)Req->argv[0], "0");
#line 645
            if (__cil_tmp___3 == 0) {
#line 645
              ok = 1;
            }
          }
        }
#line 648
        if (ok) {
#line 648
          if (! only_ops) {
            goto _L;
          } else {
#line 648
            __cil_tmp___22 = Client_Modes(c);
#line 648
            __cil_tmp___23 = strchr((char const   *)__cil_tmp___22, 'o');
#line 648
            if (__cil_tmp___23) {
              _L: /* CIL Label */ 
#line 651
              __cil_tmp___6 = Client_Modes(c);
#line 651
              __cil_tmp___7 = strchr((char const   *)__cil_tmp___6, 'a');
#line 651
              if (__cil_tmp___7) {
#line 652
                strcpy(flags, "G");
              } else {
#line 654
                strcpy(flags, "H");
              }
#line 656
              __cil_tmp___8 = Client_Modes(c);
#line 656
              __cil_tmp___9 = strchr((char const   *)__cil_tmp___8, 'o');
#line 656
              if (__cil_tmp___9) {
#line 656
                strlcat(flags, "*", sizeof(flags));
              }
#line 659
              cl2chan = Channel_FirstChannelOf(c);
#line 660
              while (cl2chan) {
#line 662
                cn = Channel_GetChannel(cl2chan);
#line 663
                __cil_tmp___10 = Channel_IsMemberOf(cn, Client);
#line 663
                if (__cil_tmp___10) {
#line 666
                  ptr = Channel_Name((CHANNEL const   *)cn);
#line 667
                  break;
                } else {
#line 663
                  __cil_tmp___11 = Channel_Modes(cn);
#line 663
                  __cil_tmp___12 = strchr((char const   *)__cil_tmp___11, 's');
#line 663
                  if (! __cil_tmp___12) {
#line 666
                    ptr = Channel_Name((CHANNEL const   *)cn);
#line 667
                    break;
                  }
                }
#line 669
                cl2chan = Channel_NextChannelOf(c, cl2chan);
              }
#line 671
              if (! cl2chan) {
#line 671
                ptr = "*";
              }
#line 673
              __cil_tmp___13 = Client_Info(c);
#line 673
              __cil_tmp___14 = Client_Hops(c);
#line 673
              __cil_tmp___15 = Client_ID(c);
#line 673
              __cil_tmp___16 = Client_Introducer(c);
#line 673
              __cil_tmp___17 = Client_ID(__cil_tmp___16);
#line 673
              __cil_tmp___18 = Client_Hostname(c);
#line 673
              __cil_tmp___19 = Client_User(c);
#line 673
              __cil_tmp___20 = Client_ID(Client);
#line 673
              __cil_tmp___21 = IRC_WriteStrClient(Client, (char *)"352 %s %s %s %s %s %s %s :%d %s",
                                                  __cil_tmp___20, ptr, __cil_tmp___19,
                                                  __cil_tmp___18, __cil_tmp___17,
                                                  __cil_tmp___15, flags, __cil_tmp___14,
                                                  __cil_tmp___13);
#line 673
              if (! __cil_tmp___21) {
#line 673
                return (0);
              }
            }
          }
        }
      }
    }
#line 678
    c = Client_Next(c);
  }
#line 681
  if (chan) {
#line 681
    __cil_tmp___27 = Channel_Name((CHANNEL const   *)chan);
#line 681
    __cil_tmp___28 = Client_ID(Client);
#line 681
    __cil_tmp___29 = IRC_WriteStrClient(Client, (char *)"315 %s %s :End of WHO list",
                                        __cil_tmp___28, __cil_tmp___27);
#line 681
    return (__cil_tmp___29);
  } else {
#line 682
    if (Req->argc == 0) {
#line 682
      __cil_tmp___30 = Client_ID(Client);
#line 682
      __cil_tmp___31 = IRC_WriteStrClient(Client, (char *)"315 %s %s :End of WHO list",
                                          __cil_tmp___30, "*");
#line 682
      return (__cil_tmp___31);
    } else {
#line 683
      __cil_tmp___32 = Client_ID(Client);
#line 683
      __cil_tmp___33 = IRC_WriteStrClient(Client, (char *)"315 %s %s :End of WHO list",
                                          __cil_tmp___32, Req->argv[0]);
#line 683
      return (__cil_tmp___33);
    }
  }
}
}
#line 687 "irc-info.c"
int IRC_WHOIS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *from ;
  CLIENT *target ;
  CLIENT *c ;
  char str[257] ;
  CL2CHAN *cl2chan ;
  CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  CLIENT *__cil_tmp___10 ;
  CLIENT *__cil_tmp___11 ;
  CLIENT *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  char *__cil_tmp___18 ;
  int __cil_tmp___19 ;
  CLIENT *__cil_tmp___20 ;
  char *__cil_tmp___21 ;
  CLIENT *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  char *__cil_tmp___24 ;
  char *__cil_tmp___25 ;
  int __cil_tmp___26 ;
  char *__cil_tmp___27 ;
  char *__cil_tmp___28 ;
  char *__cil_tmp___29 ;
  char *__cil_tmp___30 ;
  int __cil_tmp___31 ;
  size_t __cil_tmp___32 ;
  char *__cil_tmp___33 ;
  char *__cil_tmp___34 ;
  char *__cil_tmp___35 ;
  char *__cil_tmp___36 ;
  char const   *__cil_tmp___37 ;
  int __cil_tmp___38 ;
  char *__cil_tmp___39 ;
  char *__cil_tmp___40 ;
  size_t __cil_tmp___41 ;
  int __cil_tmp___42 ;
  size_t __cil_tmp___43 ;
  char *__cil_tmp___44 ;
  char *__cil_tmp___45 ;
  int __cil_tmp___46 ;
  int __cil_tmp___47 ;
  CONN_ID __cil_tmp___48 ;
  time_t __cil_tmp___49 ;
  CONN_ID __cil_tmp___50 ;
  time_t __cil_tmp___51 ;
  char *__cil_tmp___52 ;
  char *__cil_tmp___53 ;
  int __cil_tmp___54 ;
  CONN_ID __cil_tmp___55 ;
  char *__cil_tmp___56 ;
  char *__cil_tmp___57 ;
  char *__cil_tmp___58 ;
  int __cil_tmp___59 ;
  int __cil_tmp___60 ;
  char *__cil_tmp___61 ;
  char *__cil_tmp___62 ;
  int __cil_tmp___63 ;

  {
#line 699
  if (Req->argc < 1) {
#line 699
    __cil_tmp = Client_ID(Client);
#line 699
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 699
    return (__cil_tmp___0);
  } else {
#line 699
    if (Req->argc > 2) {
#line 699
      __cil_tmp = Client_ID(Client);
#line 699
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                         __cil_tmp, Req->command);
#line 699
      return (__cil_tmp___0);
    }
  }
#line 702
  c = Client_Search(Req->argv[Req->argc - 1]);
#line 703
  if (! c) {
#line 703
    __cil_tmp___1 = Client_ID(Client);
#line 703
    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___1, Req->argv[Req->argc - 1]);
#line 703
    return (__cil_tmp___2);
  } else {
#line 703
    __cil_tmp___3 = Client_Type(c);
#line 703
    if (__cil_tmp___3 != 16) {
#line 703
      __cil_tmp___1 = Client_ID(Client);
#line 703
      __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                         __cil_tmp___1, Req->argv[Req->argc - 1]);
#line 703
      return (__cil_tmp___2);
    }
  }
#line 706
  __cil_tmp___4 = Client_Type(Client);
#line 706
  if (__cil_tmp___4 == 32) {
#line 706
    from = Client_Search(Req->prefix);
  } else {
#line 707
    from = Client;
  }
#line 708
  if (! from) {
#line 708
    __cil_tmp___5 = Client_ID(Client);
#line 708
    __cil_tmp___6 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___5, Req->prefix);
#line 708
    return (__cil_tmp___6);
  }
#line 711
  if (Req->argc > 1) {
#line 714
    target = Client_Search(Req->argv[0]);
#line 715
    if (! target) {
#line 715
      __cil_tmp___7 = Client_ID(from);
#line 715
      __cil_tmp___8 = IRC_WriteStrClient(from, (char *)"402 %s %s :No such server",
                                         __cil_tmp___7, Req->argv[0]);
#line 715
      return (__cil_tmp___8);
    }
  } else {
#line 717
    target = Client_ThisServer();
  }
#line 721
  __cil_tmp___10 = Client_NextHop(target);
#line 721
  __cil_tmp___11 = Client_ThisServer();
#line 721
  if ((unsigned int )__cil_tmp___10 != (unsigned int )__cil_tmp___11) {
#line 721
    __cil_tmp___12 = Client_NextHop(target);
#line 721
    __cil_tmp___13 = Client_Type(__cil_tmp___12);
#line 721
    if (__cil_tmp___13 == 32) {
#line 721
      __cil_tmp___9 = IRC_WriteStrClientPrefix(target, from, (char *)"WHOIS %s :%s",
                                               Req->argv[0], Req->argv[1]);
#line 721
      return (__cil_tmp___9);
    }
  }
#line 724
  __cil_tmp___14 = Client_Info(c);
#line 724
  __cil_tmp___15 = Client_Hostname(c);
#line 724
  __cil_tmp___16 = Client_User(c);
#line 724
  __cil_tmp___17 = Client_ID(c);
#line 724
  __cil_tmp___18 = Client_ID(from);
#line 724
  __cil_tmp___19 = IRC_WriteStrClient(from, (char *)"311 %s %s %s %s * :%s", __cil_tmp___18,
                                      __cil_tmp___17, __cil_tmp___16, __cil_tmp___15,
                                      __cil_tmp___14);
#line 724
  if (! __cil_tmp___19) {
#line 724
    return (0);
  }
#line 727
  __cil_tmp___20 = Client_Introducer(c);
#line 727
  __cil_tmp___21 = Client_Info(__cil_tmp___20);
#line 727
  __cil_tmp___22 = Client_Introducer(c);
#line 727
  __cil_tmp___23 = Client_ID(__cil_tmp___22);
#line 727
  __cil_tmp___24 = Client_ID(c);
#line 727
  __cil_tmp___25 = Client_ID(from);
#line 727
  __cil_tmp___26 = IRC_WriteStrClient(from, (char *)"312 %s %s %s :%s", __cil_tmp___25,
                                      __cil_tmp___24, __cil_tmp___23, __cil_tmp___21);
#line 727
  if (! __cil_tmp___26) {
#line 727
    return (0);
  }
#line 730
  __cil_tmp___27 = Client_ID(c);
#line 730
  __cil_tmp___28 = Client_ID(from);
#line 730
  snprintf(str, sizeof(str), "319 %s %s :", __cil_tmp___28, __cil_tmp___27);
#line 731
  cl2chan = Channel_FirstChannelOf(c);
#line 732
  while (cl2chan) {
#line 734
    chan = Channel_GetChannel(cl2chan);
#line 738
    cl2chan = Channel_NextChannelOf(c, cl2chan);
#line 741
    __cil_tmp___29 = Channel_Modes(chan);
#line 741
    __cil_tmp___30 = strchr((char const   *)__cil_tmp___29, 's');
#line 741
    if (__cil_tmp___30) {
#line 741
      __cil_tmp___31 = Channel_IsMemberOf(chan, Client);
#line 741
      if (! __cil_tmp___31) {
#line 741
        continue;
      }
    }
#line 744
    __cil_tmp___32 = strlen((char const   *)(str));
#line 744
    if ((int )str[__cil_tmp___32 - 1UL] != 58) {
#line 744
      strlcat(str, " ", sizeof(str));
    }
#line 745
    __cil_tmp___35 = Channel_UserModes(chan, c);
#line 745
    __cil_tmp___36 = strchr((char const   *)__cil_tmp___35, 'o');
#line 745
    if (__cil_tmp___36) {
#line 745
      strlcat(str, "@", sizeof(str));
    } else {
#line 746
      __cil_tmp___33 = Channel_UserModes(chan, c);
#line 746
      __cil_tmp___34 = strchr((char const   *)__cil_tmp___33, 'v');
#line 746
      if (__cil_tmp___34) {
#line 746
        strlcat(str, "+", sizeof(str));
      }
    }
#line 747
    __cil_tmp___37 = Channel_Name((CHANNEL const   *)chan);
#line 747
    strlcat(str, __cil_tmp___37, sizeof(str));
#line 749
    __cil_tmp___41 = strlen((char const   *)(str));
#line 749
    if (__cil_tmp___41 > 201UL) {
#line 752
      __cil_tmp___38 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 752
      if (! __cil_tmp___38) {
#line 752
        return (0);
      }
#line 753
      __cil_tmp___39 = Client_ID(c);
#line 753
      __cil_tmp___40 = Client_ID(from);
#line 753
      snprintf(str, sizeof(str), "319 %s %s :", __cil_tmp___40, __cil_tmp___39);
    }
  }
#line 756
  __cil_tmp___43 = strlen((char const   *)(str));
#line 756
  if ((int )str[__cil_tmp___43 - 1UL] != 58) {
#line 759
    __cil_tmp___42 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 759
    if (! __cil_tmp___42) {
#line 759
      return (0);
    }
  }
#line 763
  __cil_tmp___47 = Client_HasMode(c, (char )'o');
#line 763
  if (__cil_tmp___47) {
#line 765
    __cil_tmp___44 = Client_ID(c);
#line 765
    __cil_tmp___45 = Client_ID(from);
#line 765
    __cil_tmp___46 = IRC_WriteStrClient(from, (char *)"313 %s %s :is an IRC operator",
                                        __cil_tmp___45, __cil_tmp___44);
#line 765
    if (! __cil_tmp___46) {
#line 765
      return (0);
    }
  }
#line 769
  __cil_tmp___55 = Client_Conn(c);
#line 769
  if (__cil_tmp___55 > -1) {
#line 770
    __cil_tmp___48 = Client_Conn(c);
#line 770
    __cil_tmp___49 = Conn_GetSignon(__cil_tmp___48);
#line 770
    __cil_tmp___50 = Client_Conn(c);
#line 770
    __cil_tmp___51 = Conn_GetIdle(__cil_tmp___50);
#line 770
    __cil_tmp___52 = Client_ID(c);
#line 770
    __cil_tmp___53 = Client_ID(from);
#line 770
    __cil_tmp___54 = IRC_WriteStrClient(from, (char *)"317 %s %s %lu %lu :seconds idle, signon time",
                                        __cil_tmp___53, __cil_tmp___52, (unsigned long )__cil_tmp___51,
                                        (unsigned long )__cil_tmp___49);
#line 770
    if (! __cil_tmp___54) {
#line 774
      return (0);
    }
  }
#line 778
  __cil_tmp___60 = Client_HasMode(c, (char )'a');
#line 778
  if (__cil_tmp___60) {
#line 780
    __cil_tmp___56 = Client_Away(c);
#line 780
    __cil_tmp___57 = Client_ID(c);
#line 780
    __cil_tmp___58 = Client_ID(from);
#line 780
    __cil_tmp___59 = IRC_WriteStrClient(from, (char *)"301 %s %s :%s", __cil_tmp___58,
                                        __cil_tmp___57, __cil_tmp___56);
#line 780
    if (! __cil_tmp___59) {
#line 780
      return (0);
    }
  }
#line 784
  __cil_tmp___61 = Client_ID(c);
#line 784
  __cil_tmp___62 = Client_ID(from);
#line 784
  __cil_tmp___63 = IRC_WriteStrClient(from, (char *)"318 %s %s :End of WHOIS list",
                                      __cil_tmp___62, __cil_tmp___61);
#line 784
  return (__cil_tmp___63);
}
}
#line 793 "irc-info.c"
int IRC_WHOWAS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *prefix ;
  WHOWAS *whowas ;
  int max ;
  int last ;
  int count ;
  int i ;
  char t_str[60] ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  struct tm *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int __cil_tmp___10 ;
  char *__cil_tmp___11 ;
  int __cil_tmp___12 ;
  int __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;

  {
#line 805
  if (Req->argc < 1) {
#line 806
    __cil_tmp = Client_ID(Client);
#line 806
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 806
    return (__cil_tmp___0);
  } else {
#line 805
    if (Req->argc > 3) {
#line 806
      __cil_tmp = Client_ID(Client);
#line 806
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                         __cil_tmp, Req->command);
#line 806
      return (__cil_tmp___0);
    }
  }
#line 810
  if (Req->argc == 3) {
#line 811
    target = Client_Search(Req->argv[2]);
  } else {
#line 813
    target = Client_ThisServer();
  }
#line 816
  __cil_tmp___1 = Client_Type(Client);
#line 816
  if (__cil_tmp___1 == 32) {
#line 817
    prefix = Client_Search(Req->prefix);
  } else {
#line 819
    prefix = Client;
  }
#line 821
  if (! prefix) {
#line 822
    __cil_tmp___2 = Client_ID(Client);
#line 822
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 822
    return (__cil_tmp___3);
  }
#line 826
  __cil_tmp___7 = Client_ThisServer();
#line 826
  if ((unsigned int )target != (unsigned int )__cil_tmp___7) {
#line 828
    if (! target) {
#line 829
      __cil_tmp___4 = Client_ID(prefix);
#line 829
      __cil_tmp___5 = IRC_WriteStrClient(prefix, (char *)"402 %s %s :No such server",
                                         __cil_tmp___4, Req->argv[2]);
#line 829
      return (__cil_tmp___5);
    } else {
#line 828
      __cil_tmp___6 = Client_Type(target);
#line 828
      if (__cil_tmp___6 != 32) {
#line 829
        __cil_tmp___4 = Client_ID(prefix);
#line 829
        __cil_tmp___5 = IRC_WriteStrClient(prefix, (char *)"402 %s %s :No such server",
                                           __cil_tmp___4, Req->argv[2]);
#line 829
        return (__cil_tmp___5);
      }
    }
#line 834
    IRC_WriteStrClientPrefix(target, prefix, (char *)"WHOWAS %s %s %s", Req->argv[0],
                             Req->argv[1], Req->argv[2]);
#line 837
    return (1);
  }
#line 840
  whowas = Client_GetWhowas();
#line 841
  last = Client_GetLastWhowasIndex();
#line 842
  if (last < 0) {
#line 842
    last = 0;
  }
#line 844
  if (Req->argc > 1) {
#line 846
    max = atoi((char const   *)Req->argv[1]);
#line 847
    if (max < 1) {
#line 847
      max = 64;
    }
  } else {
#line 850
    max = 5;
  }
#line 852
  i = last;
#line 853
  count = 0;
#line 854
  while (1) {
#line 857
    if ((whowas + i)->time > 0L) {
#line 857
      __cil_tmp___13 = strcasecmp((char const   *)Req->argv[0], (char const   *)((whowas + i)->id));
#line 857
      if (__cil_tmp___13 == 0) {
#line 860
        __cil_tmp___8 = localtime((time_t const   *)(& (whowas + i)->time));
#line 860
        strftime(t_str, sizeof(t_str), "%a %b %d %H:%M:%S %Y", (struct tm  const  *)__cil_tmp___8);
#line 864
        __cil_tmp___9 = Client_ID(prefix);
#line 864
        __cil_tmp___10 = IRC_WriteStrClient(prefix, (char *)"314 %s %s %s %s * :%s",
                                            __cil_tmp___9, (whowas + i)->id, (whowas + i)->user,
                                            (whowas + i)->host, (whowas + i)->info);
#line 864
        if (! __cil_tmp___10) {
#line 870
          return (0);
        }
#line 872
        __cil_tmp___11 = Client_ID(prefix);
#line 872
        __cil_tmp___12 = IRC_WriteStrClient(prefix, (char *)"312 %s %s %s :%s", __cil_tmp___11,
                                            (whowas + i)->id, (whowas + i)->server,
                                            t_str);
#line 872
        if (! __cil_tmp___12) {
#line 876
          return (0);
        }
#line 878
        count ++;
#line 879
        if (count >= max) {
#line 879
          break;
        }
      }
    }
#line 883
    i --;
#line 886
    if (i < 0) {
#line 886
      i = 63;
    }
#line 854
    if (! (i != last)) {
#line 854
      break;
    }
  }
#line 889
  __cil_tmp___14 = Client_ID(prefix);
#line 889
  __cil_tmp___15 = IRC_WriteStrClient(prefix, (char *)"369 %s %s :End of WHOWAS list",
                                      __cil_tmp___14, Req->argv[0]);
#line 889
  return (__cil_tmp___15);
}
}
#line 894 "irc-info.c"
int IRC_Send_LUSERS(CLIENT *Client ) 
{ unsigned long cnt ;
  unsigned long max ;
  long __cil_tmp ;
  long __cil_tmp___0 ;
  long __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  unsigned long __cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int __cil_tmp___10 ;
  unsigned long __cil_tmp___11 ;
  long __cil_tmp___12 ;
  long __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;
  long __cil_tmp___16 ;
  long __cil_tmp___17 ;
  char *__cil_tmp___18 ;
  int __cil_tmp___19 ;
  long __cil_tmp___20 ;
  long __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;

  {
#line 905
  __cil_tmp = Client_ServerCount();
#line 905
  __cil_tmp___0 = Client_ServiceCount();
#line 905
  __cil_tmp___1 = Client_UserCount();
#line 905
  __cil_tmp___2 = Client_ID(Client);
#line 905
  __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"251 %s :There are %ld users and %ld services on %ld servers",
                                     __cil_tmp___2, __cil_tmp___1, __cil_tmp___0,
                                     __cil_tmp);
#line 905
  if (! __cil_tmp___3) {
#line 905
    return (0);
  }
#line 908
  cnt = Client_OperCount();
#line 909
  if (cnt > 0UL) {
#line 911
    __cil_tmp___4 = Client_ID(Client);
#line 911
    __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"252 %s %lu :operator(s) online",
                                       __cil_tmp___4, cnt);
#line 911
    if (! __cil_tmp___5) {
#line 911
      return (0);
    }
  }
#line 915
  cnt = Client_UnknownCount();
#line 916
  if (cnt > 0UL) {
#line 918
    __cil_tmp___6 = Client_ID(Client);
#line 918
    __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"253 %s %lu :unknown connection(s)",
                                       __cil_tmp___6, cnt);
#line 918
    if (! __cil_tmp___7) {
#line 918
      return (0);
    }
  }
#line 922
  __cil_tmp___8 = Channel_Count();
#line 922
  __cil_tmp___9 = Client_ID(Client);
#line 922
  __cil_tmp___10 = IRC_WriteStrClient(Client, (char *)"254 %s %lu :channels formed",
                                      __cil_tmp___9, __cil_tmp___8);
#line 922
  if (! __cil_tmp___10) {
#line 922
    return (0);
  }
#line 925
  __cil_tmp___11 = Client_MyServerCount();
#line 925
  __cil_tmp___12 = Client_MyServiceCount();
#line 925
  __cil_tmp___13 = Client_MyUserCount();
#line 925
  __cil_tmp___14 = Client_ID(Client);
#line 925
  __cil_tmp___15 = IRC_WriteStrClient(Client, (char *)"255 %s :I have %lu users, %lu services and %lu servers",
                                      __cil_tmp___14, __cil_tmp___13, __cil_tmp___12,
                                      __cil_tmp___11);
#line 925
  if (! __cil_tmp___15) {
#line 925
    return (0);
  }
#line 929
  __cil_tmp___16 = Client_MyUserCount();
#line 929
  cnt = (unsigned long )__cil_tmp___16;
#line 930
  __cil_tmp___17 = Client_MyMaxUserCount();
#line 930
  max = (unsigned long )__cil_tmp___17;
#line 931
  __cil_tmp___18 = Client_ID(Client);
#line 931
  __cil_tmp___19 = IRC_WriteStrClient(Client, (char *)"265 %s %lu %lu :Current local users: %lu, Max: %lu",
                                      __cil_tmp___18, cnt, max, cnt, max);
#line 931
  if (! __cil_tmp___19) {
#line 933
    return (0);
  }
#line 935
  __cil_tmp___20 = Client_UserCount();
#line 935
  cnt = (unsigned long )__cil_tmp___20;
#line 936
  __cil_tmp___21 = Client_MaxUserCount();
#line 936
  max = (unsigned long )__cil_tmp___21;
#line 937
  __cil_tmp___22 = Client_ID(Client);
#line 937
  __cil_tmp___23 = IRC_WriteStrClient(Client, (char *)"266 %s %lu %lu :Current global users: %lu, Max: %lu",
                                      __cil_tmp___22, cnt, max, cnt, max);
#line 937
  if (! __cil_tmp___23) {
#line 939
    return (0);
  }
#line 942
  return (1);
}
}
#line 946 "irc-info.c"
static int Show_MOTD_Start(CLIENT *Client ) 
{ CLIENT *__cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 949
  __cil_tmp = Client_ThisServer();
#line 949
  __cil_tmp___0 = Client_ID(__cil_tmp);
#line 949
  __cil_tmp___1 = Client_ID(Client);
#line 949
  __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"375 %s :- %s message of the day",
                                     __cil_tmp___1, __cil_tmp___0);
#line 949
  return (__cil_tmp___2);
}
}
#line 953 "irc-info.c"
static int Show_MOTD_Sendline(CLIENT *Client , char const   *msg ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 956
  __cil_tmp = Client_ID(Client);
#line 956
  __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"372 %s :- %s", __cil_tmp, msg);
#line 956
  return (__cil_tmp___0);
}
}
#line 959 "irc-info.c"
static int Show_MOTD_End(CLIENT *Client ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 962
  __cil_tmp = Client_ID(Client);
#line 962
  __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"376 %s :End of MOTD command",
                                     __cil_tmp);
#line 962
  return (__cil_tmp___0);
}
}
#line 966 "irc-info.c"
int IRC_Show_MOTD(CLIENT *Client ) 
{ char line[127] ;
  FILE *fd ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 974
  if (Conf_MotdPhrase[0]) {
#line 975
    __cil_tmp = Show_MOTD_Start(Client);
#line 975
    if (! __cil_tmp) {
#line 976
      return (0);
    }
#line 977
    __cil_tmp___0 = Show_MOTD_Sendline(Client, (char const   *)(Conf_MotdPhrase));
#line 977
    if (! __cil_tmp___0) {
#line 978
      return (0);
    }
#line 980
    __cil_tmp___1 = Show_MOTD_End(Client);
#line 980
    return (__cil_tmp___1);
  }
#line 983
  fd = fopen((char const   *)(Conf_MotdFile), "r");
#line 984
  if (! fd) {
#line 985
    __cil_tmp___2 = __error();
#line 985
    __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 985
    Log(4, "Can\'t read MOTD file \"%s\": %s", Conf_MotdFile, __cil_tmp___3);
#line 986
    __cil_tmp___4 = Client_ID(Client);
#line 986
    __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"422 %s :MOTD file is missing",
                                       __cil_tmp___4);
#line 986
    return (__cil_tmp___5);
  }
#line 989
  __cil_tmp___6 = Show_MOTD_Start(Client);
#line 989
  if (! __cil_tmp___6) {
#line 990
    fclose(fd);
#line 991
    return (0);
  }
#line 994
  while (1) {
#line 994
    __cil_tmp___8 = fgets(line, (int )sizeof(line), fd);
#line 994
    if (! __cil_tmp___8) {
#line 994
      break;
    }
#line 995
    ngt_TrimLastChr(line, (char )'\n');
#line 997
    __cil_tmp___7 = Show_MOTD_Sendline(Client, (char const   *)(line));
#line 997
    if (! __cil_tmp___7) {
#line 998
      fclose(fd);
#line 999
      return (0);
    }
  }
#line 1002
  fclose(fd);
#line 1003
  __cil_tmp___9 = Show_MOTD_End(Client);
#line 1003
  return (__cil_tmp___9);
}
}
#line 1007 "irc-info.c"
int IRC_Send_NAMES(CLIENT *Client , CHANNEL *Chan ) 
{ int is_visible ;
  int is_member ;
  char str[257] ;
  CL2CHAN *cl2chan ;
  CLIENT *cl ;
  int __cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char const   *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  size_t __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  int __cil_tmp___12 ;
  char const   *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  size_t __cil_tmp___15 ;
  int __cil_tmp___16 ;
  size_t __cil_tmp___17 ;

  {
#line 1018
  __cil_tmp = Channel_IsMemberOf(Chan, Client);
#line 1018
  if (__cil_tmp) {
#line 1018
    is_member = 1;
  } else {
#line 1019
    is_member = 0;
  }
#line 1022
  if (! is_member) {
#line 1022
    __cil_tmp___0 = Channel_Modes(Chan);
#line 1022
    __cil_tmp___1 = strchr((char const   *)__cil_tmp___0, 's');
#line 1022
    if (__cil_tmp___1) {
#line 1022
      return (1);
    }
  }
#line 1025
  __cil_tmp___2 = Channel_Name((CHANNEL const   *)Chan);
#line 1025
  __cil_tmp___3 = Client_ID(Client);
#line 1025
  snprintf(str, sizeof(str), "353 %s %s %s :", __cil_tmp___3, "=", __cil_tmp___2);
#line 1026
  cl2chan = Channel_FirstMember(Chan);
#line 1027
  while (cl2chan) {
#line 1029
    cl = Channel_GetClient(cl2chan);
#line 1031
    __cil_tmp___4 = Client_Modes(cl);
#line 1031
    __cil_tmp___5 = strchr((char const   *)__cil_tmp___4, 'i');
#line 1031
    if (__cil_tmp___5) {
#line 1031
      is_visible = 0;
    } else {
#line 1032
      is_visible = 1;
    }
#line 1034
    if (is_member) {
      goto _L;
    } else {
#line 1034
      if (is_visible) {
        _L: /* CIL Label */ 
#line 1037
        __cil_tmp___6 = strlen((char const   *)(str));
#line 1037
        if ((int )str[__cil_tmp___6 - 1UL] != 58) {
#line 1037
          strlcat(str, " ", sizeof(str));
        }
#line 1038
        __cil_tmp___9 = Channel_UserModes(Chan, cl);
#line 1038
        __cil_tmp___10 = strchr((char const   *)__cil_tmp___9, 'o');
#line 1038
        if (__cil_tmp___10) {
#line 1038
          strlcat(str, "@", sizeof(str));
        } else {
#line 1039
          __cil_tmp___7 = Channel_UserModes(Chan, cl);
#line 1039
          __cil_tmp___8 = strchr((char const   *)__cil_tmp___7, 'v');
#line 1039
          if (__cil_tmp___8) {
#line 1039
            strlcat(str, "+", sizeof(str));
          }
        }
#line 1040
        __cil_tmp___11 = Client_ID(cl);
#line 1040
        strlcat(str, (char const   *)__cil_tmp___11, sizeof(str));
#line 1042
        __cil_tmp___15 = strlen((char const   *)(str));
#line 1042
        if (__cil_tmp___15 > 220UL) {
#line 1045
          __cil_tmp___12 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 1045
          if (! __cil_tmp___12) {
#line 1045
            return (0);
          }
#line 1046
          __cil_tmp___13 = Channel_Name((CHANNEL const   *)Chan);
#line 1046
          __cil_tmp___14 = Client_ID(Client);
#line 1046
          snprintf(str, sizeof(str), "353 %s %s %s :", __cil_tmp___14, "=", __cil_tmp___13);
        }
      }
    }
#line 1051
    cl2chan = Channel_NextMember(Chan, cl2chan);
  }
#line 1053
  __cil_tmp___17 = strlen((char const   *)(str));
#line 1053
  if ((int )str[__cil_tmp___17 - 1UL] != 58) {
#line 1056
    __cil_tmp___16 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 1056
    if (! __cil_tmp___16) {
#line 1056
      return (0);
    }
  }
#line 1059
  return (1);
}
}
#line 1063 "irc-info.c"
int IRC_Send_WHO(CLIENT *Client , CHANNEL *Chan , int OnlyOps ) 
{ int is_visible ;
  int is_member ;
  CL2CHAN *cl2chan ;
  char flags[8] ;
  CLIENT *c ;
  int __cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  CLIENT *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  char *__cil_tmp___18 ;
  char const   *__cil_tmp___19 ;
  char *__cil_tmp___20 ;
  int __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  char *__cil_tmp___23 ;

  {
#line 1074
  __cil_tmp = Channel_IsMemberOf(Chan, Client);
#line 1074
  if (__cil_tmp) {
#line 1074
    is_member = 1;
  } else {
#line 1075
    is_member = 0;
  }
#line 1078
  if (! is_member) {
#line 1078
    __cil_tmp___0 = Channel_Modes(Chan);
#line 1078
    __cil_tmp___1 = strchr((char const   *)__cil_tmp___0, 's');
#line 1078
    if (__cil_tmp___1) {
#line 1078
      return (1);
    }
  }
#line 1081
  cl2chan = Channel_FirstMember(Chan);
#line 1082
  while (cl2chan) {
#line 1084
    c = Channel_GetClient(cl2chan);
#line 1086
    __cil_tmp___2 = Client_Modes(c);
#line 1086
    __cil_tmp___3 = strchr((char const   *)__cil_tmp___2, 'i');
#line 1086
    if (__cil_tmp___3) {
#line 1086
      is_visible = 0;
    } else {
#line 1087
      is_visible = 1;
    }
#line 1089
    if (is_member) {
      goto _L___0;
    } else {
#line 1089
      if (is_visible) {
        _L___0: /* CIL Label */ 
#line 1090
        __cil_tmp___4 = Client_Modes(c);
#line 1090
        __cil_tmp___5 = strchr((char const   *)__cil_tmp___4, 'a');
#line 1090
        if (__cil_tmp___5) {
#line 1091
          strcpy(flags, "G");
        } else {
#line 1093
          strcpy(flags, "H");
        }
#line 1095
        __cil_tmp___6 = Client_Modes(c);
#line 1095
        __cil_tmp___7 = strchr((char const   *)__cil_tmp___6, 'o');
#line 1095
        if (__cil_tmp___7) {
#line 1095
          strlcat(flags, "*", sizeof(flags));
        }
#line 1096
        __cil_tmp___10 = Channel_UserModes(Chan, c);
#line 1096
        __cil_tmp___11 = strchr((char const   *)__cil_tmp___10, 'o');
#line 1096
        if (__cil_tmp___11) {
#line 1096
          strlcat(flags, "@", sizeof(flags));
        } else {
#line 1097
          __cil_tmp___8 = Channel_UserModes(Chan, c);
#line 1097
          __cil_tmp___9 = strchr((char const   *)__cil_tmp___8, 'v');
#line 1097
          if (__cil_tmp___9) {
#line 1097
            strlcat(flags, "+", sizeof(flags));
          }
        }
#line 1100
        if (! OnlyOps) {
          goto _L;
        } else {
#line 1100
          __cil_tmp___22 = Client_Modes(c);
#line 1100
          __cil_tmp___23 = strchr((char const   *)__cil_tmp___22, 'o');
#line 1100
          if (__cil_tmp___23) {
            _L: /* CIL Label */ 
#line 1102
            __cil_tmp___12 = Client_Info(c);
#line 1102
            __cil_tmp___13 = Client_Hops(c);
#line 1102
            __cil_tmp___14 = Client_ID(c);
#line 1102
            __cil_tmp___15 = Client_Introducer(c);
#line 1102
            __cil_tmp___16 = Client_ID(__cil_tmp___15);
#line 1102
            __cil_tmp___17 = Client_Hostname(c);
#line 1102
            __cil_tmp___18 = Client_User(c);
#line 1102
            __cil_tmp___19 = Channel_Name((CHANNEL const   *)Chan);
#line 1102
            __cil_tmp___20 = Client_ID(Client);
#line 1102
            __cil_tmp___21 = IRC_WriteStrClient(Client, (char *)"352 %s %s %s %s %s %s %s :%d %s",
                                                __cil_tmp___20, __cil_tmp___19, __cil_tmp___18,
                                                __cil_tmp___17, __cil_tmp___16, __cil_tmp___14,
                                                flags, __cil_tmp___13, __cil_tmp___12);
#line 1102
            if (! __cil_tmp___21) {
#line 1102
              return (0);
            }
          }
        }
      }
    }
#line 1107
    cl2chan = Channel_NextMember(Chan, cl2chan);
  }
#line 1109
  return (1);
}
}
#line 1118 "irc-info.c"
int IRC_Send_ISUPPORT(CLIENT *Client ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 1121
  __cil_tmp = Client_ID(Client);
#line 1121
  __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"005 %s RFC2812 CASEMAPPING=ascii PREFIX=(ov)@+ CHANTYPES=# CHANMODES=bI,k,l,imnPst CHANLIMIT=#:%d :are supported on this server",
                                     __cil_tmp, Conf_MaxJoins);
#line 1121
  if (! __cil_tmp___0) {
#line 1123
    return (0);
  }
#line 1124
  __cil_tmp___1 = Client_ID(Client);
#line 1124
  __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"005 %s CHANNELLEN=%d NICKLEN=%d TOPICLEN=%d AWAYLEN=%d KICKLEN=%d PENALTY :are supported on this server",
                                     __cil_tmp___1, 50, Conf_MaxNickLength - 1U, 490,
                                     127, 400);
#line 1124
  return (__cil_tmp___2);
}
}
#line 1 "irc-login.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-fZBChbjF.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 27 "irc-write.h"
void IRC_WriteStrServers(CLIENT *ExceptOf , char *Format  , ...) ;
#line 21 "irc-login.h"
int IRC_PASS(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_NICK(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_USER(CLIENT *Client , REQUEST *Req ) ;
#line 24
int IRC_PING(CLIENT *Client , REQUEST *Req ) ;
#line 25
int IRC_PONG(CLIENT *Client , REQUEST *Req ) ;
#line 26
int IRC_QUIT(CLIENT *Client , REQUEST *Req ) ;
#line 44 "irc-login.c"
static int Hello_User(CLIENT *Client ) ;
#line 45
static void Kill_Nick(char *Nick , char *Reason ) ;
#line 52 "irc-login.c"
int IRC_PASS(CLIENT *Client , REQUEST *Req ) 
{ char *type ;
  char *orig_flags ;
  int protohigh ;
  int protolow ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  CONN_ID __cil_tmp___1 ;
  CONN_ID __cil_tmp___2 ;
  CONN_ID __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  int __cil_tmp___10 ;
  int __cil_tmp___11 ;
  int __cil_tmp___12 ;
  int c2 ;
  int c4 ;
  size_t __cil_tmp___13 ;
  size_t __cil_tmp___14 ;
  char *impl ;
  char *ptr ;
  char *serverver ;
  char *flags ;
  char *__cil_tmp___15 ;
  int __cil_tmp___16 ;

  {
#line 62
  __cil_tmp___1 = Client_Conn(Client);
#line 62
  if (__cil_tmp___1 <= -1) {
#line 63
    __cil_tmp = Client_ID(Client);
#line 63
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"421 %s %s :Unknown command",
                                       __cil_tmp, Req->command);
#line 63
    return (__cil_tmp___0);
  }
#line 66
  __cil_tmp___12 = Client_Type(Client);
#line 66
  if (__cil_tmp___12 == 1) {
#line 66
    if (Req->argc == 1) {
#line 70
      __cil_tmp___2 = Client_Conn(Client);
#line 70
      LogDebug("Connection %d: got PASS command ...", __cil_tmp___2);
    } else {
      goto _L___1;
    }
  } else {
    _L___1: /* CIL Label */ 
#line 72
    __cil_tmp___10 = Client_Type(Client);
#line 72
    if (__cil_tmp___10 == 1) {
      goto _L___0;
    } else {
#line 72
      __cil_tmp___11 = Client_Type(Client);
#line 72
      if (__cil_tmp___11 == 128) {
        _L___0: /* CIL Label */ 
#line 72
        if (Req->argc == 3) {
#line 78
          __cil_tmp___3 = Client_Conn(Client);
#line 78
          LogDebug("Connection %d: got PASS command (new server link) ...", __cil_tmp___3);
        } else {
#line 72
          if (Req->argc == 4) {
#line 78
            __cil_tmp___3 = Client_Conn(Client);
#line 78
            LogDebug("Connection %d: got PASS command (new server link) ...", __cil_tmp___3);
          } else {
            goto _L;
          }
        }
      } else {
        _L: /* CIL Label */ 
#line 80
        __cil_tmp___8 = Client_Type(Client);
#line 80
        if (__cil_tmp___8 == 1) {
#line 83
          __cil_tmp___4 = Client_ID(Client);
#line 83
          __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                             __cil_tmp___4, Req->command);
#line 83
          return (__cil_tmp___5);
        } else {
#line 80
          __cil_tmp___9 = Client_Type(Client);
#line 80
          if (__cil_tmp___9 == 128) {
#line 83
            __cil_tmp___4 = Client_ID(Client);
#line 83
            __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                               __cil_tmp___4, Req->command);
#line 83
            return (__cil_tmp___5);
          } else {
#line 87
            __cil_tmp___6 = Client_ID(Client);
#line 87
            __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"462 %s :Connection already registered",
                                               __cil_tmp___6);
#line 87
            return (__cil_tmp___7);
          }
        }
      }
    }
  }
#line 91
  Client_SetPassword(Client, Req->argv[0]);
#line 92
  Client_SetType(Client, 2);
#line 95
  if (Req->argc >= 2) {
#line 95
    __cil_tmp___13 = strlen((char const   *)Req->argv[1]);
#line 95
    if (__cil_tmp___13 >= 4UL) {
#line 98
      c2 = (int )*(Req->argv[1] + 2);
#line 99
      c4 = (int )*(Req->argv[1] + 4);
#line 101
      *(Req->argv[1] + 4) = (char )'\000';
#line 102
      protolow = atoi((char const   *)(Req->argv[1] + 2));
#line 103
      *(Req->argv[1] + 2) = (char )'\000';
#line 104
      protohigh = atoi((char const   *)Req->argv[1]);
#line 106
      *(Req->argv[1] + 2) = (char )c2;
#line 107
      *(Req->argv[1] + 4) = (char )c4;
    } else {
#line 109
      protolow = 0;
#line 109
      protohigh = protolow;
    }
  } else {
#line 109
    protolow = 0;
#line 109
    protohigh = protolow;
  }
#line 112
  if (Req->argc >= 2) {
#line 112
    __cil_tmp___14 = strlen((char const   *)Req->argv[1]);
#line 112
    if (__cil_tmp___14 > 4UL) {
#line 113
      type = Req->argv[1] + 4;
    } else {
#line 115
      type = (char *)((void *)0);
    }
  } else {
#line 115
    type = (char *)((void *)0);
  }
#line 118
  if (Req->argc >= 4) {
#line 119
    orig_flags = Req->argv[3];
  } else {
#line 121
    orig_flags = (char *)"";
  }
#line 124
  if (Req->argc >= 3) {
#line 127
    impl = Req->argv[2];
#line 128
    ptr = strchr((char const   *)impl, '|');
#line 129
    if (ptr) {
#line 130
      *ptr = (char )'\000';
    }
#line 132
    if (type) {
#line 132
      __cil_tmp___16 = strcmp((char const   *)type, "-IRC+");
#line 132
      if (__cil_tmp___16 == 0) {
#line 135
        serverver = ptr + 1;
#line 136
        flags = strchr((char const   *)serverver, ':');
#line 137
        if (flags) {
#line 138
          *flags = (char )'\000';
#line 139
          flags ++;
        } else {
#line 141
          flags = (char *)"";
        }
#line 142
        Log(6, "Peer announces itself as %s-%s using protocol %d.%d/IRC+ (flags: \"%s\").",
            impl, serverver, protohigh, protolow, flags);
      } else {
        goto _L___2;
      }
    } else {
      _L___2: /* CIL Label */ 
#line 148
      serverver = (char *)"";
#line 149
      __cil_tmp___15 = strchr((char const   *)orig_flags, 'Z');
#line 149
      if (__cil_tmp___15) {
#line 150
        flags = (char *)"Z";
      } else {
#line 152
        flags = (char *)"";
      }
#line 153
      Log(6, "Peer announces itself as \"%s\" using protocol %d.%d (flags: \"%s\").",
          impl, protohigh, protolow, flags);
    }
#line 157
    Client_SetFlags(Client, flags);
  }
#line 160
  return (1);
}
}
#line 170 "irc-login.c"
int IRC_NICK(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *intr_c ;
  CLIENT *target ;
  CLIENT *c ;
  char *modes ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  CONN_ID __cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  char *__cil_tmp___15 ;
  CONN_ID __cil_tmp___16 ;
  char *__cil_tmp___17 ;
  char *__cil_tmp___18 ;
  char *__cil_tmp___19 ;
  CONN_ID __cil_tmp___20 ;
  int __cil_tmp___21 ;
  int __cil_tmp___22 ;
  int __cil_tmp___23 ;
  char *__cil_tmp___24 ;
  int __cil_tmp___25 ;
  char *__cil_tmp___26 ;
  int __cil_tmp___27 ;
  char *__cil_tmp___28 ;
  int __cil_tmp___29 ;
  int __cil_tmp___30 ;
  CONN_ID __cil_tmp___31 ;
  char const   *__cil_tmp___33 ;
  int __cil_tmp___34 ;
  int __cil_tmp___35 ;
  char *__cil_tmp___36 ;
  char *__cil_tmp___37 ;
  char *__cil_tmp___38 ;
  char const   *__cil_tmp___40 ;
  int __cil_tmp___41 ;
  int __cil_tmp___42 ;
  char *__cil_tmp___43 ;
  char *__cil_tmp___44 ;
  char *__cil_tmp___45 ;
  int __cil_tmp___46 ;
  int __cil_tmp___47 ;
  char *__cil_tmp___48 ;
  int __cil_tmp___49 ;
  int __cil_tmp___50 ;
  int __cil_tmp___51 ;
  int __cil_tmp___52 ;
  int __cil_tmp___53 ;
  int __cil_tmp___54 ;
  int __cil_tmp___55 ;
  int __cil_tmp___56 ;

  {
#line 182
  __cil_tmp___51 = Client_Type(Client);
#line 182
  if (__cil_tmp___51 == 1) {
    goto _L___0;
  } else {
#line 182
    __cil_tmp___52 = Client_Type(Client);
#line 182
    if (__cil_tmp___52 == 2) {
      goto _L___0;
    } else {
#line 182
      __cil_tmp___53 = Client_Type(Client);
#line 182
      if (__cil_tmp___53 == 4) {
        goto _L___0;
      } else {
#line 182
        __cil_tmp___54 = Client_Type(Client);
#line 182
        if (__cil_tmp___54 == 8) {
          goto _L___0;
        } else {
#line 182
          __cil_tmp___55 = Client_Type(Client);
#line 182
          if (__cil_tmp___55 == 16) {
            goto _L___0;
          } else {
#line 182
            __cil_tmp___56 = Client_Type(Client);
#line 182
            if (__cil_tmp___56 == 32) {
#line 182
              if (Req->argc == 1) {
                _L___0: /* CIL Label */ 
#line 199
                if (Req->argc != 1) {
#line 200
                  __cil_tmp = Client_ID(Client);
#line 200
                  __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                                     __cil_tmp, Req->command);
#line 200
                  return (__cil_tmp___0);
                }
#line 205
                __cil_tmp___6 = Client_Type(Client);
#line 205
                if (__cil_tmp___6 == 32) {
#line 207
                  target = Client_Search(Req->prefix);
#line 208
                  if (! target) {
#line 209
                    __cil_tmp___1 = Client_ID(Client);
#line 209
                    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                                       __cil_tmp___1, Req->argv[0]);
#line 209
                    return (__cil_tmp___2);
                  }
                } else {
#line 217
                  __cil_tmp___5 = Client_HasMode(Client, (char )'r');
#line 217
                  if (__cil_tmp___5) {
#line 218
                    __cil_tmp___3 = Client_ID(Client);
#line 218
                    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"484 %s :Your connection is restricted",
                                                       __cil_tmp___3);
#line 218
                    return (__cil_tmp___4);
                  }
#line 222
                  target = Client;
                }
#line 230
                __cil_tmp___7 = Client_ID(target);
#line 230
                __cil_tmp___8 = strcmp((char const   *)__cil_tmp___7, (char const   *)Req->argv[0]);
#line 230
                if (__cil_tmp___8 == 0) {
#line 231
                  return (1);
                }
#line 236
                __cil_tmp___10 = Client_ID(target);
#line 236
                __cil_tmp___11 = strcasecmp((char const   *)__cil_tmp___10, (char const   *)Req->argv[0]);
#line 236
                if (__cil_tmp___11 != 0) {
#line 238
                  __cil_tmp___9 = Client_CheckNick(target, Req->argv[0]);
#line 238
                  if (! __cil_tmp___9) {
#line 239
                    return (1);
                  }
                }
#line 242
                __cil_tmp___22 = Client_Type(target);
#line 242
                if (__cil_tmp___22 != 16) {
#line 242
                  __cil_tmp___23 = Client_Type(target);
#line 242
                  if (__cil_tmp___23 != 32) {
#line 246
                    __cil_tmp___12 = Client_Conn(Client);
#line 246
                    Log(7, "Connection %d: got valid NICK command ...", __cil_tmp___12);
#line 250
                    Client_SetID(target, Req->argv[0]);
#line 254
                    __cil_tmp___14 = Client_Type(Client);
#line 254
                    if (__cil_tmp___14 == 8) {
#line 255
                      __cil_tmp___13 = Hello_User(Client);
#line 255
                      return (__cil_tmp___13);
                    } else {
#line 257
                      Client_SetType(Client, 4);
                    }
                  } else {
                    goto _L;
                  }
                } else {
                  _L: /* CIL Label */ 
#line 262
                  __cil_tmp___20 = Client_Conn(target);
#line 262
                  if (__cil_tmp___20 > -1) {
#line 265
                    __cil_tmp___15 = Client_ID(target);
#line 265
                    __cil_tmp___16 = Client_Conn(target);
#line 265
                    __cil_tmp___17 = Client_Mask(target);
#line 265
                    Log(6, "User \"%s\" changed nick (connection %d): \"%s\" -> \"%s\".",
                        __cil_tmp___17, __cil_tmp___16, __cil_tmp___15, Req->argv[0]);
                  } else {
#line 273
                    __cil_tmp___18 = Client_ID(target);
#line 273
                    __cil_tmp___19 = Client_Mask(target);
#line 273
                    Log(7, "User \"%s\" changed nick: \"%s\" -> \"%s\".", __cil_tmp___19,
                        __cil_tmp___18, Req->argv[0]);
                  }
#line 281
                  __cil_tmp___21 = Client_Type(Client);
#line 281
                  if (__cil_tmp___21 == 16) {
#line 282
                    IRC_WriteStrClientPrefix(Client, Client, (char *)"NICK :%s", Req->argv[0]);
                  }
#line 285
                  IRC_WriteStrServersPrefix(Client, target, (char *)"NICK :%s", Req->argv[0]);
#line 287
                  IRC_WriteStrRelatedPrefix(target, target, 0, (char *)"NICK :%s",
                                            Req->argv[0]);
#line 291
                  Client_RegisterWhowas(target);
#line 294
                  Client_SetID(target, Req->argv[0]);
#line 296
                  IRC_SetPenalty(target, 2L);
                }
#line 299
                return (1);
              } else {
                goto _L___1;
              }
            } else {
              _L___1: /* CIL Label */ 
#line 301
              __cil_tmp___50 = Client_Type(Client);
#line 301
              if (__cil_tmp___50 == 32) {
#line 306
                if (Req->argc != 7) {
#line 306
                  __cil_tmp___24 = Client_ID(Client);
#line 306
                  __cil_tmp___25 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                                      __cil_tmp___24, Req->command);
#line 306
                  return (__cil_tmp___25);
                }
#line 309
                c = Client_Search(Req->argv[0]);
#line 310
                if (c) {
#line 315
                  __cil_tmp___26 = Client_ID(Client);
#line 315
                  Log(3, "Server %s introduces already registered nick \"%s\"!", __cil_tmp___26,
                      Req->argv[0]);
#line 316
                  Kill_Nick(Req->argv[0], (char *)"Nick collision");
#line 317
                  return (1);
                }
#line 321
                __cil_tmp___27 = atoi((char const   *)Req->argv[4]);
#line 321
                intr_c = Client_GetFromToken(Client, __cil_tmp___27);
#line 322
                if (! intr_c) {
#line 324
                  __cil_tmp___28 = Client_ID(Client);
#line 324
                  Log(3, "Server %s introduces nick \"%s\" on unknown server!?", __cil_tmp___28,
                      Req->argv[0]);
#line 325
                  Kill_Nick(Req->argv[0], (char *)"Unknown server");
#line 326
                  return (1);
                }
#line 330
                __cil_tmp___29 = atoi((char const   *)Req->argv[4]);
#line 330
                __cil_tmp___30 = atoi((char const   *)Req->argv[1]);
#line 330
                c = Client_NewRemoteUser(intr_c, Req->argv[0], __cil_tmp___30, Req->argv[2],
                                         Req->argv[3], __cil_tmp___29, Req->argv[5] + 1,
                                         Req->argv[6], 1);
#line 331
                if (! c) {
#line 336
                  __cil_tmp___31 = Client_Conn(Client);
#line 336
                  Log(1, "Can\'t create client structure! (on connection %d)", __cil_tmp___31);
#line 337
                  Kill_Nick(Req->argv[0], (char *)"Server error");
#line 338
                  return (1);
                }
#line 341
                modes = Client_Modes(c);
#line 342
                if (*modes) {
#line 342
                  __cil_tmp___34 = Client_Hops(c);
#line 342
                  if (__cil_tmp___34 > 1) {
#line 342
                    __cil_tmp___33 = "s";
                  } else {
#line 342
                    __cil_tmp___33 = "";
                  }
#line 342
                  __cil_tmp___35 = Client_Hops(c);
#line 342
                  __cil_tmp___36 = Client_ID(intr_c);
#line 342
                  __cil_tmp___37 = Client_ID(Client);
#line 342
                  __cil_tmp___38 = Client_Mask(c);
#line 342
                  Log(7, "User \"%s\" (+%s) registered (via %s, on %s, %d hop%s).",
                      __cil_tmp___38, modes, __cil_tmp___37, __cil_tmp___36, __cil_tmp___35,
                      __cil_tmp___33);
                } else {
#line 343
                  __cil_tmp___41 = Client_Hops(c);
#line 343
                  if (__cil_tmp___41 > 1) {
#line 343
                    __cil_tmp___40 = "s";
                  } else {
#line 343
                    __cil_tmp___40 = "";
                  }
#line 343
                  __cil_tmp___42 = Client_Hops(c);
#line 343
                  __cil_tmp___43 = Client_ID(intr_c);
#line 343
                  __cil_tmp___44 = Client_ID(Client);
#line 343
                  __cil_tmp___45 = Client_Mask(c);
#line 343
                  Log(7, "User \"%s\" registered (via %s, on %s, %d hop%s).", __cil_tmp___45,
                      __cil_tmp___44, __cil_tmp___43, __cil_tmp___42, __cil_tmp___40);
                }
#line 346
                __cil_tmp___46 = Client_MyToken(intr_c);
#line 346
                __cil_tmp___47 = atoi((char const   *)Req->argv[1]);
#line 346
                IRC_WriteStrServersPrefix(Client, Client, (char *)"NICK %s %d %s %s %d %s :%s",
                                          Req->argv[0], __cil_tmp___47 + 1, Req->argv[2],
                                          Req->argv[3], __cil_tmp___46, Req->argv[5],
                                          Req->argv[6]);
#line 348
                return (1);
              } else {
#line 350
                __cil_tmp___48 = Client_ID(Client);
#line 350
                __cil_tmp___49 = IRC_WriteStrClient(Client, (char *)"462 %s :Connection already registered",
                                                    __cil_tmp___48);
#line 350
                return (__cil_tmp___49);
              }
            }
          }
        }
      }
    }
  }
}
}
#line 354 "irc-login.c"
int IRC_USER(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  CONN_ID __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  int __cil_tmp___10 ;
  int __cil_tmp___11 ;
  int __cil_tmp___12 ;
  int __cil_tmp___13 ;

  {
#line 365
  __cil_tmp___11 = Client_Type(Client);
#line 365
  if (__cil_tmp___11 == 4) {
    goto _L;
  } else {
#line 365
    __cil_tmp___12 = Client_Type(Client);
#line 365
    if (__cil_tmp___12 == 2) {
      goto _L;
    } else {
#line 365
      __cil_tmp___13 = Client_Type(Client);
#line 365
      if (__cil_tmp___13 == 1) {
        _L: /* CIL Label */ 
#line 371
        if (Req->argc != 4) {
#line 371
          __cil_tmp = Client_ID(Client);
#line 371
          __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                             __cil_tmp, Req->command);
#line 371
          return (__cil_tmp___0);
        }
#line 378
        Client_SetUser(Client, Req->argv[0], 0);
#line 383
        if (*(Req->argv[3])) {
#line 383
          Client_SetInfo(Client, Req->argv[3]);
        } else {
#line 384
          Client_SetInfo(Client, (char *)"-");
        }
#line 386
        __cil_tmp___1 = Client_Conn(Client);
#line 386
        Log(7, "Connection %d: got valid USER command ...", __cil_tmp___1);
#line 387
        __cil_tmp___3 = Client_Type(Client);
#line 387
        if (__cil_tmp___3 == 4) {
#line 387
          __cil_tmp___2 = Hello_User(Client);
#line 387
          return (__cil_tmp___2);
        } else {
#line 388
          Client_SetType(Client, 8);
        }
#line 389
        return (1);
      } else {
#line 391
        __cil_tmp___8 = Client_Type(Client);
#line 391
        if (__cil_tmp___8 == 16) {
#line 393
          __cil_tmp___4 = Client_ID(Client);
#line 393
          __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"462 %s :Connection already registered",
                                             __cil_tmp___4);
#line 393
          return (__cil_tmp___5);
        } else {
#line 391
          __cil_tmp___9 = Client_Type(Client);
#line 391
          if (__cil_tmp___9 == 32) {
#line 393
            __cil_tmp___4 = Client_ID(Client);
#line 393
            __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"462 %s :Connection already registered",
                                               __cil_tmp___4);
#line 393
            return (__cil_tmp___5);
          } else {
#line 391
            __cil_tmp___10 = Client_Type(Client);
#line 391
            if (__cil_tmp___10 == 64) {
#line 393
              __cil_tmp___4 = Client_ID(Client);
#line 393
              __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"462 %s :Connection already registered",
                                                 __cil_tmp___4);
#line 393
              return (__cil_tmp___5);
            } else {
#line 395
              __cil_tmp___6 = Client_ID(Client);
#line 395
              __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"451 %s :Connection not registered",
                                                 __cil_tmp___6);
#line 395
              return (__cil_tmp___7);
            }
          }
        }
      }
    }
  }
}
}
#line 399 "irc-login.c"
int IRC_QUIT(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  char quitmsg[256] ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  CONN_ID __cil_tmp___4 ;
  int __cil_tmp___5 ;

  {
#line 409
  if (Req->argc > 1) {
#line 410
    __cil_tmp = Client_ID(Client);
#line 410
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 410
    return (__cil_tmp___0);
  }
#line 412
  if (Req->argc == 1) {
#line 413
    strlcpy(quitmsg, (char const   *)Req->argv[0], sizeof(quitmsg));
  }
#line 415
  __cil_tmp___5 = Client_Type(Client);
#line 415
  if (__cil_tmp___5 == 32) {
#line 418
    target = Client_Search(Req->prefix);
#line 419
    if (! target) {
#line 422
      __cil_tmp___1 = Client_ID(Client);
#line 422
      Log(4, "Got QUIT from %s for unknown client!?", __cil_tmp___1);
#line 423
      return (1);
    }
#line 426
    if (Req->argc == 1) {
#line 426
      __cil_tmp___2 = quitmsg;
    } else {
#line 426
      __cil_tmp___2 = (char *)((void *)0);
    }
#line 426
    Client_Destroy(target, (char *)"Got QUIT command.", __cil_tmp___2, 1);
#line 428
    return (1);
  } else {
#line 432
    if (Req->argc == 1) {
#line 432
      if ((int )quitmsg[0] != 34) {
#line 434
        strlcpy(quitmsg, "\"", sizeof(quitmsg));
#line 435
        strlcat(quitmsg, (char const   *)Req->argv[0], sizeof(quitmsg) - 1UL);
#line 436
        strlcat(quitmsg, "\"", sizeof(quitmsg));
      }
    }
#line 440
    if (Req->argc == 1) {
#line 440
      __cil_tmp___3 = quitmsg;
    } else {
#line 440
      __cil_tmp___3 = (char *)((void *)0);
    }
#line 440
    __cil_tmp___4 = Client_Conn(Client);
#line 440
    Conn_Close(__cil_tmp___4, (char *)"Got QUIT command.", __cil_tmp___3, 1);
#line 442
    return (0);
  }
}
}
#line 447 "irc-login.c"
int IRC_PING(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *from ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  CLIENT *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  CONN_ID __cil_tmp___12 ;
  char *__cil_tmp___13 ;
  int __cil_tmp___14 ;

  {
#line 456
  if (Req->argc < 1) {
#line 457
    __cil_tmp = Client_ID(Client);
#line 457
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"409 %s :No origin specified",
                                       __cil_tmp);
#line 457
    return (__cil_tmp___0);
  }
#line 466
  if (Req->argc > 1) {
#line 468
    target = Client_Search(Req->argv[1]);
#line 470
    if (! target) {
#line 471
      __cil_tmp___1 = Client_ID(Client);
#line 471
      __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                         __cil_tmp___1, Req->argv[1]);
#line 471
      return (__cil_tmp___2);
    } else {
#line 470
      __cil_tmp___3 = Client_Type(target);
#line 470
      if (__cil_tmp___3 != 32) {
#line 471
        __cil_tmp___1 = Client_ID(Client);
#line 471
        __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                           __cil_tmp___1, Req->argv[1]);
#line 471
        return (__cil_tmp___2);
      }
    }
#line 474
    __cil_tmp___8 = Client_ThisServer();
#line 474
    if ((unsigned int )target != (unsigned int )__cil_tmp___8) {
#line 476
      __cil_tmp___4 = Client_Type(Client);
#line 476
      if (__cil_tmp___4 == 32) {
#line 477
        from = Client_Search(Req->prefix);
      } else {
#line 479
        from = Client;
      }
#line 480
      if (! from) {
#line 481
        __cil_tmp___5 = Client_ID(Client);
#line 481
        __cil_tmp___6 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                           __cil_tmp___5, Req->prefix);
#line 481
        return (__cil_tmp___6);
      }
#line 485
      __cil_tmp___7 = IRC_WriteStrClientPrefix(target, from, (char *)"PING %s :%s",
                                               Req->argv[0], Req->argv[1]);
#line 485
      return (__cil_tmp___7);
    }
  }
#line 491
  __cil_tmp___9 = Client_Type(Client);
#line 491
  if (__cil_tmp___9 == 32) {
#line 492
    if (Req->prefix) {
#line 493
      from = Client_Search(Req->prefix);
    } else {
#line 495
      from = Client;
    }
  } else {
#line 497
    from = Client_ThisServer();
  }
#line 498
  if (! from) {
#line 499
    __cil_tmp___10 = Client_ID(Client);
#line 499
    __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                        __cil_tmp___10, Req->prefix);
#line 499
    return (__cil_tmp___11);
  }
#line 502
  __cil_tmp___12 = Client_Conn(Client);
#line 502
  Log(7, "Connection %d: got PING, sending PONG ...", __cil_tmp___12);
#line 511
  __cil_tmp___13 = Client_ID(from);
#line 511
  __cil_tmp___14 = IRC_WriteStrClient(Client, (char *)"PONG %s :%s", __cil_tmp___13,
                                      Req->argv[0]);
#line 511
  return (__cil_tmp___14);
}
}
#line 517 "irc-login.c"
int IRC_PONG(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *from ;
  char *s ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  CLIENT *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  CLIENT *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  time_t __cil_tmp___12 ;
  CONN_ID __cil_tmp___13 ;
  time_t __cil_tmp___14 ;
  CONN_ID __cil_tmp___15 ;
  CONN_ID __cil_tmp___16 ;
  CONN_ID __cil_tmp___17 ;

  {
#line 527
  if (Req->argc < 1) {
#line 528
    __cil_tmp = Client_ID(Client);
#line 528
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"409 %s :No origin specified",
                                       __cil_tmp);
#line 528
    return (__cil_tmp___0);
  }
#line 530
  if (Req->argc > 2) {
#line 531
    __cil_tmp___1 = Client_ID(Client);
#line 531
    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___1, Req->command);
#line 531
    return (__cil_tmp___2);
  }
#line 535
  if (Req->argc == 2) {
#line 535
    __cil_tmp___11 = Client_Type(Client);
#line 535
    if (__cil_tmp___11 == 32) {
#line 536
      target = Client_Search(Req->argv[0]);
#line 537
      if (! target) {
#line 538
        __cil_tmp___3 = Client_ID(Client);
#line 538
        __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                           __cil_tmp___3, Req->argv[0]);
#line 538
        return (__cil_tmp___4);
      }
#line 541
      from = Client_Search(Req->prefix);
#line 543
      __cil_tmp___10 = Client_ThisServer();
#line 543
      if ((unsigned int )target != (unsigned int )__cil_tmp___10) {
#line 543
        if ((unsigned int )target != (unsigned int )from) {
#line 545
          if (! from) {
#line 546
            __cil_tmp___5 = Client_ID(Client);
#line 546
            __cil_tmp___6 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                               __cil_tmp___5, Req->prefix);
#line 546
            return (__cil_tmp___6);
          }
#line 550
          __cil_tmp___7 = Client_NextHop(target);
#line 550
          __cil_tmp___8 = Client_Type(__cil_tmp___7);
#line 550
          if (__cil_tmp___8 != 32) {
#line 551
            s = Client_ID(from);
          } else {
#line 553
            s = Req->argv[0];
          }
#line 554
          __cil_tmp___9 = IRC_WriteStrClientPrefix(target, from, (char *)"PONG %s :%s",
                                                   s, Req->argv[1]);
#line 554
          return (__cil_tmp___9);
        }
      }
    }
  }
#line 562
  __cil_tmp___17 = Client_Conn(Client);
#line 562
  if (__cil_tmp___17 > -1) {
#line 563
    __cil_tmp___12 = time((time_t *)((void *)0));
#line 563
    __cil_tmp___13 = Client_Conn(Client);
#line 563
    __cil_tmp___14 = Conn_LastPing(__cil_tmp___13);
#line 563
    __cil_tmp___15 = Client_Conn(Client);
#line 563
    Log(7, "Connection %d: received PONG. Lag: %ld seconds.", __cil_tmp___15, __cil_tmp___12 - __cil_tmp___14);
  } else {
#line 568
    __cil_tmp___16 = Client_Conn(Client);
#line 568
    Log(7, "Connection %d: received PONG.", __cil_tmp___16);
  }
#line 571
  return (1);
}
}
#line 575 "irc-login.c"
static int Hello_User(CLIENT *Client ) 
{ CONN_ID __cil_tmp ;
  char *__cil_tmp___0 ;
  CONN_ID __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  CONN_ID __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  CLIENT *__cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  char *__cil_tmp___18 ;
  int __cil_tmp___19 ;
  CLIENT *__cil_tmp___20 ;
  char *__cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;
  int __cil_tmp___24 ;
  int __cil_tmp___25 ;
  int __cil_tmp___26 ;

  {
#line 585
  __cil_tmp___2 = Client_Password(Client);
#line 585
  __cil_tmp___3 = strcmp((char const   *)__cil_tmp___2, (char const   *)(Conf_ServerPwd));
#line 585
  if (__cil_tmp___3 != 0) {
#line 588
    __cil_tmp = Client_Conn(Client);
#line 588
    __cil_tmp___0 = Client_Mask(Client);
#line 588
    Log(3, "User \"%s\" rejected (connection %d): Bad password!", __cil_tmp___0, __cil_tmp);
#line 589
    __cil_tmp___1 = Client_Conn(Client);
#line 589
    Conn_Close(__cil_tmp___1, (char *)((void *)0), (char *)"Bad password", 1);
#line 590
    return (0);
  }
#line 593
  __cil_tmp___4 = Client_Conn(Client);
#line 593
  __cil_tmp___5 = Client_Mask(Client);
#line 593
  Log(5, "User \"%s\" registered (connection %d).", __cil_tmp___5, __cil_tmp___4);
#line 596
  __cil_tmp___6 = Client_Info(Client);
#line 596
  __cil_tmp___7 = Client_Modes(Client);
#line 596
  __cil_tmp___8 = Client_Hostname(Client);
#line 596
  __cil_tmp___9 = Client_User(Client);
#line 596
  __cil_tmp___10 = Client_ID(Client);
#line 596
  IRC_WriteStrServers((CLIENT *)((void *)0), (char *)"NICK %s 1 %s %s 1 +%s :%s",
                      __cil_tmp___10, __cil_tmp___9, __cil_tmp___8, __cil_tmp___7,
                      __cil_tmp___6);
#line 599
  __cil_tmp___11 = Client_Mask(Client);
#line 599
  __cil_tmp___12 = Client_ID(Client);
#line 599
  __cil_tmp___13 = IRC_WriteStrClient(Client, (char *)"001 %s :Welcome to the Internet Relay Network %s",
                                      __cil_tmp___12, __cil_tmp___11);
#line 599
  if (! __cil_tmp___13) {
#line 599
    return (0);
  }
#line 609
  __cil_tmp___14 = Client_ThisServer();
#line 609
  __cil_tmp___15 = Client_ID(__cil_tmp___14);
#line 609
  __cil_tmp___16 = Client_ID(Client);
#line 609
  __cil_tmp___17 = IRC_WriteStrClient(Client, (char *)"002 %s :Your host is %s, running version ngircd-%s (%s/%s/%s)",
                                      __cil_tmp___16, __cil_tmp___15, "0.11.1", "i386",
                                      "apple", "darwin9.4.0");
#line 609
  if (! __cil_tmp___17) {
#line 609
    return (0);
  }
#line 612
  __cil_tmp___18 = Client_ID(Client);
#line 612
  __cil_tmp___19 = IRC_WriteStrClient(Client, (char *)"003 %s :This server has been started %s",
                                      __cil_tmp___18, NGIRCd_StartStr);
#line 612
  if (! __cil_tmp___19) {
#line 612
    return (0);
  }
#line 616
  __cil_tmp___20 = Client_ThisServer();
#line 616
  __cil_tmp___21 = Client_ID(__cil_tmp___20);
#line 616
  __cil_tmp___22 = Client_ID(Client);
#line 616
  __cil_tmp___23 = IRC_WriteStrClient(Client, (char *)"004 %s %s ngircd-%s %s %s",
                                      __cil_tmp___22, __cil_tmp___21, "0.11.1", "aios",
                                      "biIklmnoPstv");
#line 616
  if (! __cil_tmp___23) {
#line 616
    return (0);
  }
#line 621
  __cil_tmp___24 = IRC_Send_ISUPPORT(Client);
#line 621
  if (! __cil_tmp___24) {
#line 622
    return (0);
  }
#line 624
  Client_SetType(Client, 16);
#line 626
  __cil_tmp___25 = IRC_Send_LUSERS(Client);
#line 626
  if (! __cil_tmp___25) {
#line 626
    return (0);
  }
#line 627
  __cil_tmp___26 = IRC_Show_MOTD(Client);
#line 627
  if (! __cil_tmp___26) {
#line 627
    return (0);
  }
#line 630
  IRC_SetPenalty(Client, 1L);
#line 632
  return (1);
}
}
#line 636 "irc-login.c"
static void Kill_Nick(char *Nick , char *Reason ) 
{ REQUEST r ;
  CLIENT *__cil_tmp ;
  CLIENT *__cil_tmp___0 ;

  {
#line 644
  __cil_tmp = Client_ThisServer();
#line 644
  r.prefix = (char *)__cil_tmp;
#line 645
  r.argv[0] = Nick;
#line 646
  r.argv[1] = Reason;
#line 647
  r.argc = 2;
#line 649
  Log(3, "User(s) with nick \"%s\" will be disconnected: %s", Nick, Reason);
#line 650
  __cil_tmp___0 = Client_ThisServer();
#line 650
  IRC_KILL(__cil_tmp___0, & r);
#line 651
  return;
}
}
#line 1 "irc-mode.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-C0RVJ5sj.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 33 "lists.h"
int Lists_CheckDupeMask(struct list_head  const  *h , char const   *Mask ) ;
#line 36
void Lists_Del(struct list_head *header , char const   *Mask ) ;
#line 42
char *Lists_MakeMask(char *Pattern ) ;
#line 21 "irc-mode.h"
int IRC_MODE(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_AWAY(CLIENT *Client , REQUEST *Req ) ;
#line 41 "irc-mode.c"
static int Client_Mode(CLIENT *Client , REQUEST *Req , CLIENT *Origin , CLIENT *Target ) ;
#line 42
static int Channel_Mode(CLIENT *Client , REQUEST *Req , CLIENT *Origin , CHANNEL *Channel ) ;
#line 44
static int Add_Invite(CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel , char *Pattern ) ;
#line 45
static int Add_Ban(CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel , char *Pattern ) ;
#line 47
static int Del_Invite(CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel , char *Pattern ) ;
#line 48
static int Del_Ban(CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel , char *Pattern ) ;
#line 50
static int Send_ListChange(char *Mode , CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel ,
                           char *Mask ) ;
#line 53 "irc-mode.c"
int IRC_MODE(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *cl ;
  CLIENT *origin ;
  CHANNEL *chan ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;

  {
#line 63
  if (Req->argc < 1) {
#line 63
    __cil_tmp = Client_ID(Client);
#line 63
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 63
    return (__cil_tmp___0);
  }
#line 66
  __cil_tmp___3 = Client_Type(Client);
#line 66
  if (__cil_tmp___3 == 32) {
#line 68
    origin = Client_Search(Req->prefix);
#line 69
    if (! origin) {
#line 69
      __cil_tmp___1 = Client_ID(Client);
#line 69
      __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                         __cil_tmp___1, Req->prefix);
#line 69
      return (__cil_tmp___2);
    }
  } else {
#line 71
    origin = Client;
  }
#line 74
  cl = (CLIENT *)((void *)0);
#line 74
  chan = (CHANNEL *)((void *)0);
#line 75
  __cil_tmp___4 = Client_IsValidNick((char const   *)Req->argv[0]);
#line 75
  if (__cil_tmp___4) {
#line 76
    cl = Client_Search(Req->argv[0]);
  }
#line 77
  __cil_tmp___5 = Channel_IsValidName((char const   *)Req->argv[0]);
#line 77
  if (__cil_tmp___5) {
#line 78
    chan = Channel_Search(Req->argv[0]);
  }
#line 80
  if (cl) {
#line 81
    __cil_tmp___6 = Client_Mode(Client, Req, origin, cl);
#line 81
    return (__cil_tmp___6);
  }
#line 82
  if (chan) {
#line 83
    __cil_tmp___7 = Channel_Mode(Client, Req, origin, chan);
#line 83
    return (__cil_tmp___7);
  }
#line 86
  __cil_tmp___8 = Client_ID(Client);
#line 86
  __cil_tmp___9 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                     __cil_tmp___8, Req->argv[0]);
#line 86
  return (__cil_tmp___9);
}
}
#line 91 "irc-mode.c"
static int Client_Mode(CLIENT *Client , REQUEST *Req , CLIENT *Origin , CLIENT *Target ) 
{ char the_modes[513] ;
  char x[2] ;
  char *mode_ptr ;
  int ok ;
  int set ;
  int mode_arg ;
  size_t len ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  size_t __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;
  int __cil_tmp___16 ;
  char *__cil_tmp___17 ;
  int __cil_tmp___18 ;
  int __cil_tmp___19 ;
  int __cil_tmp___20 ;
  size_t __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  char *__cil_tmp___24 ;
  int __cil_tmp___25 ;
  char *__cil_tmp___26 ;
  char *__cil_tmp___27 ;

  {
#line 102
  __cil_tmp___1 = Client_Type(Client);
#line 102
  if (__cil_tmp___1 == 16) {
#line 105
    if ((unsigned int )Target != (unsigned int )Client) {
#line 105
      __cil_tmp = Client_ID(Client);
#line 105
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"502 %s :Can\'t set/get mode for other users",
                                         __cil_tmp);
#line 105
      return (__cil_tmp___0);
    }
  }
#line 109
  if (Req->argc == 1) {
#line 109
    __cil_tmp___2 = Client_Modes(Target);
#line 109
    __cil_tmp___3 = Client_ID(Origin);
#line 109
    __cil_tmp___4 = IRC_WriteStrClient(Origin, (char *)"221 %s +%s", __cil_tmp___3,
                                       __cil_tmp___2);
#line 109
    return (__cil_tmp___4);
  }
#line 111
  mode_arg = 1;
#line 112
  mode_ptr = Req->argv[mode_arg];
#line 115
  if ((int )*mode_ptr == 43) {
#line 115
    set = 1;
  } else {
#line 116
    if ((int )*mode_ptr == 45) {
#line 116
      set = 0;
    } else {
#line 117
      __cil_tmp___5 = Client_ID(Origin);
#line 117
      __cil_tmp___6 = IRC_WriteStrClient(Origin, (char *)"501 %s :Unknown mode", __cil_tmp___5);
#line 117
      return (__cil_tmp___6);
    }
  }
#line 120
  if (set) {
#line 120
    strcpy(the_modes, "+");
  } else {
#line 121
    strcpy(the_modes, "-");
  }
#line 123
  x[1] = (char )'\000';
#line 124
  ok = 1;
#line 125
  while (mode_ptr) {
#line 127
    mode_ptr ++;
#line 128
    if (! *mode_ptr) {
#line 131
      mode_arg ++;
#line 132
      if (mode_arg < Req->argc) {
#line 132
        mode_ptr = Req->argv[mode_arg];
      } else {
#line 133
        break;
      }
    }
#line 136
    switch ((int )*mode_ptr) {
    case 43: 
    case 45: 
#line 140
    if ((int )*mode_ptr == 43) {
#line 140
      if (! set) {
        goto _L;
      } else {
        goto _L___0;
      }
    } else {
      _L___0: /* CIL Label */ 
#line 140
      if ((int )*mode_ptr == 45) {
#line 140
        if (set) {
          _L: /* CIL Label */ 
#line 143
          __cil_tmp___7 = strlen((char const   *)(the_modes));
#line 143
          len = __cil_tmp___7 - 1UL;
#line 144
          if ((int )the_modes[len] == 43) {
#line 147
            the_modes[len] = *mode_ptr;
          } else {
#line 144
            if ((int )the_modes[len] == 45) {
#line 147
              the_modes[len] = *mode_ptr;
            } else {
#line 152
              x[0] = *mode_ptr;
#line 153
              strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
            }
          }
#line 155
          if ((int )*mode_ptr == 43) {
#line 155
            set = 1;
          } else {
#line 156
            set = 0;
          }
        }
      }
    }
#line 158
    continue;
    }
#line 162
    x[0] = (char )'\000';
#line 163
    switch ((int )*mode_ptr) {
    case 105: 
    case 115: 
    case 119: 
#line 168
    x[0] = *mode_ptr;
#line 169
    break;
    case 97: 
#line 172
    __cil_tmp___9 = Client_Type(Client);
#line 172
    if (__cil_tmp___9 == 32) {
#line 174
      x[0] = (char )'a';
#line 175
      Client_SetAway(Origin, (char *)"Away");
    } else {
#line 177
      __cil_tmp___8 = Client_ID(Origin);
#line 177
      ok = IRC_WriteStrClient(Origin, (char *)"481 %s :Permission denied", __cil_tmp___8);
    }
#line 178
    break;
    case 111: 
#line 181
    if (! set) {
#line 183
      Client_SetOperByMe(Target, 0);
#line 184
      x[0] = (char )'o';
    } else {
#line 181
      __cil_tmp___11 = Client_Type(Client);
#line 181
      if (__cil_tmp___11 == 32) {
#line 183
        Client_SetOperByMe(Target, 0);
#line 184
        x[0] = (char )'o';
      } else {
#line 186
        __cil_tmp___10 = Client_ID(Origin);
#line 186
        ok = IRC_WriteStrClient(Origin, (char *)"481 %s :Permission denied", __cil_tmp___10);
      }
    }
#line 187
    break;
    case 114: 
#line 190
    if (set) {
#line 190
      x[0] = (char )'r';
    } else {
#line 190
      __cil_tmp___13 = Client_Type(Client);
#line 190
      if (__cil_tmp___13 == 32) {
#line 190
        x[0] = (char )'r';
      } else {
#line 191
        __cil_tmp___12 = Client_ID(Origin);
#line 191
        ok = IRC_WriteStrClient(Origin, (char *)"484 %s :Your connection is restricted",
                                __cil_tmp___12);
      }
    }
#line 192
    break;
    default: 
#line 195
    __cil_tmp___14 = Client_ID(Origin);
#line 195
    if (set) {
#line 195
      __cil_tmp___15 = '+';
    } else {
#line 195
      __cil_tmp___15 = '-';
    }
#line 195
    Log(7, "Unknown mode \"%c%c\" from \"%s\"!?", __cil_tmp___15, *mode_ptr, __cil_tmp___14);
#line 196
    __cil_tmp___18 = Client_Type(Client);
#line 196
    if (__cil_tmp___18 != 32) {
#line 196
      if (set) {
#line 196
        __cil_tmp___16 = '+';
      } else {
#line 196
        __cil_tmp___16 = '-';
      }
#line 196
      __cil_tmp___17 = Client_ID(Origin);
#line 196
      ok = IRC_WriteStrClient(Origin, (char *)"501 %s :Unknown mode \"%c%c\"", __cil_tmp___17,
                              __cil_tmp___16, *mode_ptr);
    }
#line 197
    x[0] = (char )'\000';
    goto client_exit;
    }
#line 200
    if (! ok) {
#line 200
      break;
    }
#line 203
    if (! x[0]) {
#line 203
      continue;
    }
#line 205
    if (set) {
#line 208
      __cil_tmp___19 = Client_ModeAdd(Target, x[0]);
#line 208
      if (__cil_tmp___19) {
#line 208
        strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
      }
    } else {
#line 214
      __cil_tmp___20 = Client_ModeDel(Target, x[0]);
#line 214
      if (__cil_tmp___20) {
#line 214
        strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
      }
    }
  }
  client_exit: 
#line 220
  if (the_modes[1]) {
#line 223
    __cil_tmp___21 = strlen((char const   *)(the_modes));
#line 223
    len = __cil_tmp___21 - 1UL;
#line 224
    if ((int )the_modes[len] == 43) {
#line 224
      the_modes[len] = (char )'\000';
    } else {
#line 224
      if ((int )the_modes[len] == 45) {
#line 224
        the_modes[len] = (char )'\000';
      }
    }
#line 226
    __cil_tmp___25 = Client_Type(Client);
#line 226
    if (__cil_tmp___25 == 32) {
#line 229
      __cil_tmp___22 = Client_ID(Target);
#line 229
      IRC_WriteStrServersPrefix(Client, Origin, (char *)"MODE %s :%s", __cil_tmp___22,
                                the_modes);
    } else {
#line 234
      __cil_tmp___23 = Client_ID(Target);
#line 234
      ok = IRC_WriteStrClientPrefix(Client, Origin, (char *)"MODE %s :%s", __cil_tmp___23,
                                    the_modes);
#line 235
      __cil_tmp___24 = Client_ID(Target);
#line 235
      IRC_WriteStrServersPrefix(Client, Origin, (char *)"MODE %s :%s", __cil_tmp___24,
                                the_modes);
    }
#line 237
    __cil_tmp___26 = Client_Modes(Target);
#line 237
    __cil_tmp___27 = Client_Mask(Target);
#line 237
    Log(7, "User \"%s\": Mode change, now \"%s\".", __cil_tmp___27, __cil_tmp___26);
  }
#line 240
  IRC_SetPenalty(Client, 1L);
#line 241
  return (ok);
}
}
#line 245 "irc-mode.c"
static int Channel_Mode(CLIENT *Client , REQUEST *Req , CLIENT *Origin , CHANNEL *Channel ) 
{ char the_modes[513] ;
  char the_args[513] ;
  char x[2] ;
  char argadd[21] ;
  char *mode_ptr ;
  int ok ;
  int set ;
  int modeok ;
  int skiponce ;
  int use_servermode ;
  int mode_arg ;
  int arg_arg ;
  CLIENT *client ;
  long l ;
  size_t len ;
  char *__cil_tmp ;
  char const   *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  unsigned long __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  char const   *__cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char const   *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  int __cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  size_t __cil_tmp___18 ;
  char const   *__cil_tmp___19 ;
  char *__cil_tmp___20 ;
  char const   *__cil_tmp___21 ;
  char *__cil_tmp___22 ;
  char *__cil_tmp___23 ;
  char const   *__cil_tmp___24 ;
  char *__cil_tmp___25 ;
  char *__cil_tmp___26 ;
  char const   *__cil_tmp___27 ;
  char *__cil_tmp___28 ;
  char const   *__cil_tmp___29 ;
  char *__cil_tmp___30 ;
  char *__cil_tmp___31 ;
  char *__cil_tmp___32 ;
  int __cil_tmp___33 ;
  int __cil_tmp___34 ;
  char const   *__cil_tmp___35 ;
  char *__cil_tmp___36 ;
  char *__cil_tmp___37 ;
  char const   *__cil_tmp___38 ;
  char *__cil_tmp___39 ;
  char *__cil_tmp___40 ;
  char const   *__cil_tmp___41 ;
  char *__cil_tmp___42 ;
  char const   *__cil_tmp___43 ;
  char *__cil_tmp___44 ;
  char const   *__cil_tmp___45 ;
  char *__cil_tmp___46 ;
  int __cil_tmp___47 ;
  int __cil_tmp___48 ;
  char *__cil_tmp___49 ;
  int __cil_tmp___50 ;
  char const   *__cil_tmp___51 ;
  char *__cil_tmp___52 ;
  char *__cil_tmp___53 ;
  int __cil_tmp___54 ;
  int __cil_tmp___55 ;
  char *__cil_tmp___56 ;
  char *__cil_tmp___57 ;
  char const   *__cil_tmp___58 ;
  char *__cil_tmp___59 ;
  int __cil_tmp___60 ;
  char *__cil_tmp___61 ;
  char const   *__cil_tmp___62 ;
  int __cil_tmp___63 ;
  char *__cil_tmp___64 ;
  char *__cil_tmp___65 ;
  char const   *__cil_tmp___66 ;
  char *__cil_tmp___67 ;
  int __cil_tmp___68 ;
  char *__cil_tmp___69 ;
  char const   *__cil_tmp___70 ;
  int __cil_tmp___71 ;
  size_t __cil_tmp___72 ;
  char const   *__cil_tmp___73 ;
  char const   *__cil_tmp___74 ;
  char const   *__cil_tmp___75 ;
  char const   *__cil_tmp___76 ;
  char const   *__cil_tmp___77 ;
  int __cil_tmp___78 ;

  {
#line 251
  modeok = 0;
#line 251
  use_servermode = 0;
#line 258
  if (Req->argc == 1) {
#line 261
    __cil_tmp___3 = Channel_IsMemberOf(Channel, Origin);
#line 261
    if (! __cil_tmp___3) {
#line 261
      __cil_tmp = Channel_Modes(Channel);
#line 261
      __cil_tmp___0 = Channel_Name((CHANNEL const   *)Channel);
#line 261
      __cil_tmp___1 = Client_ID(Origin);
#line 261
      __cil_tmp___2 = IRC_WriteStrClient(Origin, (char *)"324 %s %s +%s", __cil_tmp___1,
                                         __cil_tmp___0, __cil_tmp);
#line 261
      return (__cil_tmp___2);
    }
#line 264
    __cil_tmp___4 = Channel_Modes(Channel);
#line 264
    strlcpy(the_modes, (char const   *)__cil_tmp___4, sizeof(the_modes));
#line 265
    mode_ptr = the_modes;
#line 266
    the_args[0] = (char )'\000';
#line 267
    while (*mode_ptr) {
#line 269
      switch ((int )*mode_ptr) {
      case 108: 
#line 272
      __cil_tmp___5 = Channel_MaxUsers(Channel);
#line 272
      snprintf(argadd, sizeof(argadd), " %lu", __cil_tmp___5);
#line 273
      strlcat(the_args, (char const   *)(argadd), sizeof(the_args));
#line 274
      break;
      case 107: 
#line 276
      strlcat(the_args, " ", sizeof(the_args));
#line 277
      __cil_tmp___6 = Channel_Key(Channel);
#line 277
      strlcat(the_args, (char const   *)__cil_tmp___6, sizeof(the_args));
#line 278
      break;
      }
#line 280
      mode_ptr ++;
    }
#line 282
    if (the_args[0]) {
#line 282
      strlcat(the_modes, (char const   *)(the_args), sizeof(the_modes));
    }
#line 284
    __cil_tmp___7 = Channel_Name((CHANNEL const   *)Channel);
#line 284
    __cil_tmp___8 = Client_ID(Origin);
#line 284
    __cil_tmp___9 = IRC_WriteStrClient(Origin, (char *)"324 %s %s +%s", __cil_tmp___8,
                                       __cil_tmp___7, the_modes);
#line 284
    return (__cil_tmp___9);
  }
#line 288
  __cil_tmp___17 = Client_Type(Client);
#line 288
  if (__cil_tmp___17 == 16) {
#line 291
    __cil_tmp___13 = Channel_IsMemberOf(Channel, Origin);
#line 291
    if (! __cil_tmp___13) {
#line 291
      __cil_tmp___10 = Channel_Name((CHANNEL const   *)Channel);
#line 291
      __cil_tmp___11 = Client_ID(Origin);
#line 291
      __cil_tmp___12 = IRC_WriteStrClient(Origin, (char *)"442 %s %s :You are not on that channel",
                                          __cil_tmp___11, __cil_tmp___10);
#line 291
      return (__cil_tmp___12);
    }
#line 294
    __cil_tmp___15 = Channel_UserModes(Channel, Origin);
#line 294
    __cil_tmp___16 = strchr((char const   *)__cil_tmp___15, 'o');
#line 294
    if (__cil_tmp___16) {
#line 294
      modeok = 1;
    } else {
#line 295
      if (Conf_OperCanMode) {
#line 298
        __cil_tmp___14 = Client_OperByMe(Origin);
#line 298
        if (__cil_tmp___14) {
#line 299
          modeok = 1;
#line 300
          if (Conf_OperServerMode) {
#line 300
            use_servermode = 1;
          }
        }
      }
    }
  } else {
#line 304
    modeok = 1;
  }
#line 306
  mode_arg = 1;
#line 307
  mode_ptr = Req->argv[mode_arg];
#line 308
  if (Req->argc > mode_arg + 1) {
#line 308
    arg_arg = mode_arg + 1;
  } else {
#line 309
    arg_arg = -1;
  }
#line 312
  skiponce = 0;
#line 313
  if ((int )*mode_ptr == 45) {
#line 313
    set = 0;
  } else {
#line 314
    if ((int )*mode_ptr == 43) {
#line 314
      set = 1;
    } else {
#line 315
      skiponce = 1;
#line 315
      set = skiponce;
    }
  }
#line 318
  if (set) {
#line 318
    strcpy(the_modes, "+");
  } else {
#line 319
    strcpy(the_modes, "-");
  }
#line 320
  the_args[0] = (char )'\000';
#line 322
  x[1] = (char )'\000';
#line 323
  ok = 1;
#line 324
  while (mode_ptr) {
#line 326
    if (! skiponce) {
#line 326
      mode_ptr ++;
    }
#line 327
    if (! *mode_ptr) {
#line 330
      if (arg_arg > mode_arg) {
#line 330
        mode_arg = arg_arg;
      } else {
#line 331
        mode_arg ++;
      }
#line 332
      if (mode_arg < Req->argc) {
#line 332
        mode_ptr = Req->argv[mode_arg];
      } else {
#line 333
        break;
      }
#line 334
      if (Req->argc > mode_arg + 1) {
#line 334
        arg_arg = mode_arg + 1;
      } else {
#line 335
        arg_arg = -1;
      }
    }
#line 337
    skiponce = 0;
#line 339
    switch ((int )*mode_ptr) {
    case 43: 
    case 45: 
#line 343
    if ((int )*mode_ptr == 43) {
#line 343
      if (! set) {
        goto _L;
      } else {
        goto _L___0;
      }
    } else {
      _L___0: /* CIL Label */ 
#line 343
      if ((int )*mode_ptr == 45) {
#line 343
        if (set) {
          _L: /* CIL Label */ 
#line 346
          __cil_tmp___18 = strlen((char const   *)(the_modes));
#line 346
          len = __cil_tmp___18 - 1UL;
#line 347
          if ((int )the_modes[len] == 43) {
#line 350
            the_modes[len] = *mode_ptr;
          } else {
#line 347
            if ((int )the_modes[len] == 45) {
#line 350
              the_modes[len] = *mode_ptr;
            } else {
#line 355
              x[0] = *mode_ptr;
#line 356
              strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
            }
          }
#line 358
          if ((int )*mode_ptr == 43) {
#line 358
            set = 1;
          } else {
#line 359
            set = 0;
          }
        }
      }
    }
#line 361
    continue;
    }
#line 365
    if (arg_arg >= Req->argc) {
#line 365
      arg_arg = -1;
    }
#line 368
    x[0] = (char )'\000';
#line 369
    argadd[0] = (char )'\000';
#line 370
    client = (CLIENT *)((void *)0);
#line 371
    switch ((int )*mode_ptr) {
    case 105: 
    case 109: 
    case 110: 
    case 115: 
    case 116: 
#line 380
    if (modeok) {
#line 380
      x[0] = *mode_ptr;
    } else {
#line 381
      __cil_tmp___19 = Channel_Name((CHANNEL const   *)Channel);
#line 381
      __cil_tmp___20 = Client_ID(Origin);
#line 381
      ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                              __cil_tmp___20, __cil_tmp___19);
    }
#line 382
    break;
    case 107: 
#line 385
    if (! set) {
#line 387
      if (modeok) {
#line 387
        x[0] = *mode_ptr;
      } else {
#line 388
        __cil_tmp___21 = Channel_Name((CHANNEL const   *)Channel);
#line 388
        __cil_tmp___22 = Client_ID(Origin);
#line 388
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___22, __cil_tmp___21);
      }
#line 389
      break;
    }
#line 391
    if (arg_arg > mode_arg) {
#line 393
      if (modeok) {
#line 395
        Channel_ModeDel(Channel, (char )'k');
#line 396
        Channel_SetKey(Channel, Req->argv[arg_arg]);
#line 397
        __cil_tmp___23 = Channel_Key(Channel);
#line 397
        strlcpy(argadd, (char const   *)__cil_tmp___23, sizeof(argadd));
#line 398
        x[0] = *mode_ptr;
      } else {
#line 400
        __cil_tmp___24 = Channel_Name((CHANNEL const   *)Channel);
#line 400
        __cil_tmp___25 = Client_ID(Origin);
#line 400
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___25, __cil_tmp___24);
      }
#line 401
      *(Req->argv[arg_arg] + 0) = (char )'\000';
#line 402
      arg_arg ++;
    } else {
#line 404
      __cil_tmp___26 = Client_ID(Origin);
#line 404
      ok = IRC_WriteStrClient(Origin, (char *)"461 %s %s :Syntax error", __cil_tmp___26,
                              Req->command);
    }
#line 405
    break;
    case 108: 
#line 408
    if (! set) {
#line 410
      if (modeok) {
#line 410
        x[0] = *mode_ptr;
      } else {
#line 411
        __cil_tmp___27 = Channel_Name((CHANNEL const   *)Channel);
#line 411
        __cil_tmp___28 = Client_ID(Origin);
#line 411
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___28, __cil_tmp___27);
      }
#line 412
      break;
    }
#line 414
    if (arg_arg > mode_arg) {
#line 416
      if (modeok) {
#line 418
        l = atol((char const   *)Req->argv[arg_arg]);
#line 419
        if (l > 0L) {
#line 419
          if (l < 65535L) {
#line 421
            Channel_ModeDel(Channel, (char )'l');
#line 422
            Channel_SetMaxUsers(Channel, (unsigned long )l);
#line 423
            snprintf(argadd, sizeof(argadd), "%ld", l);
#line 424
            x[0] = *mode_ptr;
          }
        }
      } else {
#line 427
        __cil_tmp___29 = Channel_Name((CHANNEL const   *)Channel);
#line 427
        __cil_tmp___30 = Client_ID(Origin);
#line 427
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___30, __cil_tmp___29);
      }
#line 428
      *(Req->argv[arg_arg] + 0) = (char )'\000';
#line 429
      arg_arg ++;
    } else {
#line 431
      __cil_tmp___31 = Client_ID(Origin);
#line 431
      ok = IRC_WriteStrClient(Origin, (char *)"461 %s %s :Syntax error", __cil_tmp___31,
                              Req->command);
    }
#line 432
    break;
    case 80: 
#line 435
    if (modeok) {
#line 438
      if (set) {
#line 438
        __cil_tmp___33 = Client_OperByMe(Client);
#line 438
        if (__cil_tmp___33) {
#line 444
          x[0] = (char )'P';
        } else {
#line 438
          __cil_tmp___34 = Client_Type(Client);
#line 438
          if (__cil_tmp___34 == 32) {
#line 444
            x[0] = (char )'P';
          } else {
#line 440
            __cil_tmp___32 = Client_ID(Origin);
#line 440
            ok = IRC_WriteStrClient(Origin, (char *)"481 %s :Permission denied", __cil_tmp___32);
          }
        }
      } else {
#line 444
        x[0] = (char )'P';
      }
    } else {
#line 446
      __cil_tmp___35 = Channel_Name((CHANNEL const   *)Channel);
#line 446
      __cil_tmp___36 = Client_ID(Origin);
#line 446
      ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                              __cil_tmp___36, __cil_tmp___35);
    }
#line 450
    break;
    case 111: 
    case 118: 
#line 456
    if (arg_arg > mode_arg) {
#line 458
      if (modeok) {
#line 460
        client = Client_Search(Req->argv[arg_arg]);
#line 461
        if (client) {
#line 461
          x[0] = *mode_ptr;
        } else {
#line 462
          __cil_tmp___37 = Client_ID(Client);
#line 462
          ok = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                  __cil_tmp___37, Req->argv[arg_arg]);
        }
      } else {
#line 464
        __cil_tmp___38 = Channel_Name((CHANNEL const   *)Channel);
#line 464
        __cil_tmp___39 = Client_ID(Origin);
#line 464
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___39, __cil_tmp___38);
      }
#line 465
      *(Req->argv[arg_arg] + 0) = (char )'\000';
#line 466
      arg_arg ++;
    } else {
#line 468
      __cil_tmp___40 = Client_ID(Origin);
#line 468
      ok = IRC_WriteStrClient(Origin, (char *)"461 %s %s :Syntax error", __cil_tmp___40,
                              Req->command);
    }
#line 469
    break;
    case 73: 
#line 474
    if (arg_arg > mode_arg) {
#line 477
      if (modeok) {
#line 479
        if (set) {
#line 479
          Add_Invite(Origin, Client, Channel, Req->argv[arg_arg]);
        } else {
#line 480
          Del_Invite(Origin, Client, Channel, Req->argv[arg_arg]);
        }
      } else {
#line 482
        __cil_tmp___41 = Channel_Name((CHANNEL const   *)Channel);
#line 482
        __cil_tmp___42 = Client_ID(Origin);
#line 482
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___42, __cil_tmp___41);
      }
#line 483
      *(Req->argv[arg_arg] + 0) = (char )'\000';
#line 484
      arg_arg ++;
    } else {
#line 486
      Channel_ShowInvites(Origin, Channel);
    }
#line 487
    break;
    case 98: 
#line 490
    if (arg_arg > mode_arg) {
#line 493
      if (modeok) {
#line 495
        if (set) {
#line 495
          Add_Ban(Origin, Client, Channel, Req->argv[arg_arg]);
        } else {
#line 496
          Del_Ban(Origin, Client, Channel, Req->argv[arg_arg]);
        }
      } else {
#line 498
        __cil_tmp___43 = Channel_Name((CHANNEL const   *)Channel);
#line 498
        __cil_tmp___44 = Client_ID(Origin);
#line 498
        ok = IRC_WriteStrClient(Origin, (char *)"482 %s %s :You are not channel operator",
                                __cil_tmp___44, __cil_tmp___43);
      }
#line 499
      *(Req->argv[arg_arg] + 0) = (char )'\000';
#line 500
      arg_arg ++;
    } else {
#line 502
      Channel_ShowBans(Origin, Channel);
    }
#line 503
    break;
    default: 
#line 506
    __cil_tmp___45 = Channel_Name((CHANNEL const   *)Channel);
#line 506
    __cil_tmp___46 = Client_ID(Origin);
#line 506
    if (set) {
#line 506
      __cil_tmp___47 = '+';
    } else {
#line 506
      __cil_tmp___47 = '-';
    }
#line 506
    Log(7, "Unknown mode \"%c%c\" from \"%s\" on %s!?", __cil_tmp___47, *mode_ptr,
        __cil_tmp___46, __cil_tmp___45);
#line 507
    __cil_tmp___50 = Client_Type(Client);
#line 507
    if (__cil_tmp___50 != 32) {
#line 507
      if (set) {
#line 507
        __cil_tmp___48 = '+';
      } else {
#line 507
        __cil_tmp___48 = '-';
      }
#line 507
      __cil_tmp___49 = Client_ID(Origin);
#line 507
      ok = IRC_WriteStrClient(Origin, (char *)"501 %s :Unknown mode \"%c%c\"", __cil_tmp___49,
                              __cil_tmp___48, *mode_ptr);
    }
#line 508
    x[0] = (char )'\000';
    goto chan_exit;
    }
#line 511
    if (! ok) {
#line 511
      break;
    }
#line 514
    if (! x[0]) {
#line 514
      continue;
    }
#line 517
    if (client) {
#line 517
      __cil_tmp___55 = Channel_IsMemberOf(Channel, client);
#line 517
      if (! __cil_tmp___55) {
#line 519
        __cil_tmp___51 = Channel_Name((CHANNEL const   *)Channel);
#line 519
        __cil_tmp___52 = Client_ID(client);
#line 519
        __cil_tmp___53 = Client_ID(Origin);
#line 519
        __cil_tmp___54 = IRC_WriteStrClient(Origin, (char *)"441 %s %s %s :They aren\'t on that channel",
                                            __cil_tmp___53, __cil_tmp___52, __cil_tmp___51);
#line 519
        if (! __cil_tmp___54) {
#line 519
          break;
        }
#line 520
        continue;
      }
    }
#line 523
    if (set) {
#line 526
      if (client) {
#line 529
        __cil_tmp___60 = Channel_UserModeAdd(Channel, client, x[0]);
#line 529
        if (__cil_tmp___60) {
#line 531
          strlcat(the_args, " ", sizeof(the_args));
#line 532
          __cil_tmp___56 = Client_ID(client);
#line 532
          strlcat(the_args, (char const   *)__cil_tmp___56, sizeof(the_args));
#line 533
          strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
#line 534
          __cil_tmp___57 = Channel_UserModes(Channel, client);
#line 534
          __cil_tmp___58 = Channel_Name((CHANNEL const   *)Channel);
#line 534
          __cil_tmp___59 = Client_Mask(client);
#line 534
          Log(7, "User \"%s\": Mode change on %s, now \"%s\"", __cil_tmp___59, __cil_tmp___58,
              __cil_tmp___57);
        }
      } else {
#line 540
        __cil_tmp___63 = Channel_ModeAdd(Channel, x[0]);
#line 540
        if (__cil_tmp___63) {
#line 542
          strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
#line 543
          __cil_tmp___61 = Channel_Modes(Channel);
#line 543
          __cil_tmp___62 = Channel_Name((CHANNEL const   *)Channel);
#line 543
          Log(7, "Channel %s: Mode change, now \"%s\".", __cil_tmp___62, __cil_tmp___61);
        }
      }
    } else {
#line 550
      if (client) {
#line 553
        __cil_tmp___68 = Channel_UserModeDel(Channel, client, x[0]);
#line 553
        if (__cil_tmp___68) {
#line 555
          strlcat(the_args, " ", sizeof(the_args));
#line 556
          __cil_tmp___64 = Client_ID(client);
#line 556
          strlcat(the_args, (char const   *)__cil_tmp___64, sizeof(the_args));
#line 557
          strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
#line 558
          __cil_tmp___65 = Channel_UserModes(Channel, client);
#line 558
          __cil_tmp___66 = Channel_Name((CHANNEL const   *)Channel);
#line 558
          __cil_tmp___67 = Client_Mask(client);
#line 558
          Log(7, "User \"%s\": Mode change on %s, now \"%s\"", __cil_tmp___67, __cil_tmp___66,
              __cil_tmp___65);
        }
      } else {
#line 564
        __cil_tmp___71 = Channel_ModeDel(Channel, x[0]);
#line 564
        if (__cil_tmp___71) {
#line 566
          strlcat(the_modes, (char const   *)(x), sizeof(the_modes));
#line 567
          __cil_tmp___69 = Channel_Modes(Channel);
#line 567
          __cil_tmp___70 = Channel_Name((CHANNEL const   *)Channel);
#line 567
          Log(7, "Channel %s: Mode change, now \"%s\".", __cil_tmp___70, __cil_tmp___69);
        }
      }
    }
#line 573
    if (argadd[0]) {
#line 575
      strlcat(the_args, " ", sizeof(the_args));
#line 576
      strlcat(the_args, (char const   *)(argadd), sizeof(the_args));
    }
  }
  chan_exit: 
#line 582
  if (the_modes[1]) {
#line 585
    __cil_tmp___72 = strlen((char const   *)(the_modes));
#line 585
    len = __cil_tmp___72 - 1UL;
#line 586
    if ((int )the_modes[len] == 43) {
#line 586
      the_modes[len] = (char )'\000';
    } else {
#line 586
      if ((int )the_modes[len] == 45) {
#line 586
        the_modes[len] = (char )'\000';
      }
    }
#line 588
    __cil_tmp___78 = Client_Type(Client);
#line 588
    if (__cil_tmp___78 == 32) {
#line 591
      __cil_tmp___73 = Channel_Name((CHANNEL const   *)Channel);
#line 591
      IRC_WriteStrServersPrefix(Client, Origin, (char *)"MODE %s %s%s", __cil_tmp___73,
                                the_modes, the_args);
#line 592
      __cil_tmp___74 = Channel_Name((CHANNEL const   *)Channel);
#line 592
      IRC_WriteStrChannelPrefix(Client, Channel, Origin, 0, (char *)"MODE %s %s%s",
                                __cil_tmp___74, the_modes, the_args);
    } else {
#line 596
      if (use_servermode) {
#line 596
        Origin = Client_ThisServer();
      }
#line 599
      __cil_tmp___75 = Channel_Name((CHANNEL const   *)Channel);
#line 599
      ok = IRC_WriteStrClientPrefix(Client, Origin, (char *)"MODE %s %s%s", __cil_tmp___75,
                                    the_modes, the_args);
#line 600
      __cil_tmp___76 = Channel_Name((CHANNEL const   *)Channel);
#line 600
      IRC_WriteStrServersPrefix(Client, Origin, (char *)"MODE %s %s%s", __cil_tmp___76,
                                the_modes, the_args);
#line 601
      __cil_tmp___77 = Channel_Name((CHANNEL const   *)Channel);
#line 601
      IRC_WriteStrChannelPrefix(Client, Channel, Origin, 0, (char *)"MODE %s %s%s",
                                __cil_tmp___77, the_modes, the_args);
    }
  }
#line 605
  IRC_SetPenalty(Client, 1L);
#line 606
  return (1);
}
}
#line 610 "irc-mode.c"
int IRC_AWAY(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;

  {
#line 617
  if (Req->argc > 1) {
#line 617
    __cil_tmp = Client_ID(Client);
#line 617
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 617
    return (__cil_tmp___0);
  }
#line 619
  if (Req->argc == 1) {
#line 619
    if (*(Req->argv[0] + 0)) {
#line 622
      Client_SetAway(Client, Req->argv[0]);
#line 623
      Client_ModeAdd(Client, (char )'a');
#line 624
      __cil_tmp___1 = Client_ID(Client);
#line 624
      IRC_WriteStrServersPrefix(Client, Client, (char *)"MODE %s :+a", __cil_tmp___1);
#line 625
      __cil_tmp___2 = Client_ID(Client);
#line 625
      __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"306 %s :You have been marked as being away",
                                         __cil_tmp___2);
#line 625
      return (__cil_tmp___3);
    } else {
      goto _L;
    }
  } else {
    _L: /* CIL Label */ 
#line 630
    Client_ModeDel(Client, (char )'a');
#line 631
    __cil_tmp___4 = Client_ID(Client);
#line 631
    IRC_WriteStrServersPrefix(Client, Client, (char *)"MODE %s :-a", __cil_tmp___4);
#line 632
    __cil_tmp___5 = Client_ID(Client);
#line 632
    __cil_tmp___6 = IRC_WriteStrClient(Client, (char *)"305 %s :You are no longer marked as being away",
                                       __cil_tmp___5);
#line 632
    return (__cil_tmp___6);
  }
}
}
#line 637 "irc-mode.c"
static int Add_Invite(CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel , char *Pattern ) 
{ char *mask ;
  int already ;
  struct list_head *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 647
  mask = Lists_MakeMask(Pattern);
#line 649
  __cil_tmp = Channel_GetListInvites(Channel);
#line 649
  already = Lists_CheckDupeMask((struct list_head  const  *)__cil_tmp, (char const   *)mask);
#line 650
  if (! already) {
#line 651
    __cil_tmp___0 = Channel_AddInvite(Channel, (char const   *)mask, 0);
#line 651
    if (! __cil_tmp___0) {
#line 652
      return (1);
    }
  }
#line 654
  if (already) {
#line 654
    __cil_tmp___1 = Client_Type(Prefix);
#line 654
    if (__cil_tmp___1 == 32) {
#line 655
      return (1);
    }
  }
#line 657
  __cil_tmp___2 = Send_ListChange((char *)"+I", Prefix, Client, Channel, mask);
#line 657
  return (__cil_tmp___2);
}
}
#line 661 "irc-mode.c"
static int Add_Ban(CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel , char *Pattern ) 
{ char *mask ;
  int already ;
  struct list_head *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;

  {
#line 671
  mask = Lists_MakeMask(Pattern);
#line 673
  __cil_tmp = Channel_GetListBans(Channel);
#line 673
  already = Lists_CheckDupeMask((struct list_head  const  *)__cil_tmp, (char const   *)mask);
#line 674
  if (! already) {
#line 675
    __cil_tmp___0 = Channel_AddBan(Channel, (char const   *)mask);
#line 675
    if (! __cil_tmp___0) {
#line 676
      return (1);
    }
  }
#line 678
  if (already) {
#line 678
    __cil_tmp___1 = Client_Type(Prefix);
#line 678
    if (__cil_tmp___1 == 32) {
#line 679
      return (1);
    }
  }
#line 681
  __cil_tmp___2 = Send_ListChange((char *)"+b", Prefix, Client, Channel, mask);
#line 681
  return (__cil_tmp___2);
}
}
#line 685 "irc-mode.c"
static int Del_Invite(CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel , char *Pattern ) 
{ char *mask ;
  struct list_head *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 694
  mask = Lists_MakeMask(Pattern);
#line 695
  __cil_tmp = Channel_GetListInvites(Channel);
#line 695
  Lists_Del(__cil_tmp, (char const   *)mask);
#line 696
  __cil_tmp___0 = Send_ListChange((char *)"-I", Prefix, Client, Channel, mask);
#line 696
  return (__cil_tmp___0);
}
}
#line 700 "irc-mode.c"
static int Del_Ban(CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel , char *Pattern ) 
{ char *mask ;
  struct list_head *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 709
  mask = Lists_MakeMask(Pattern);
#line 710
  __cil_tmp = Channel_GetListBans(Channel);
#line 710
  Lists_Del(__cil_tmp, (char const   *)mask);
#line 711
  __cil_tmp___0 = Send_ListChange((char *)"-b", Prefix, Client, Channel, mask);
#line 711
  return (__cil_tmp___0);
}
}
#line 715 "irc-mode.c"
static int Send_ListChange(char *Mode , CLIENT *Prefix , CLIENT *Client , CHANNEL *Channel ,
                           char *Mask ) 
{ int ok ;
  char const   *__cil_tmp ;
  int __cil_tmp___0 ;
  char const   *__cil_tmp___1 ;
  char const   *__cil_tmp___2 ;

  {
#line 722
  __cil_tmp___0 = Client_Type(Client);
#line 722
  if (__cil_tmp___0 == 16) {
#line 725
    __cil_tmp = Channel_Name((CHANNEL const   *)Channel);
#line 725
    ok = IRC_WriteStrClientPrefix(Client, Prefix, (char *)"MODE %s %s %s", __cil_tmp,
                                  Mode, Mask);
  } else {
#line 727
    ok = 1;
  }
#line 730
  __cil_tmp___1 = Channel_Name((CHANNEL const   *)Channel);
#line 730
  IRC_WriteStrServersPrefix(Client, Prefix, (char *)"MODE %s %s %s", __cil_tmp___1,
                            Mode, Mask);
#line 733
  __cil_tmp___2 = Channel_Name((CHANNEL const   *)Channel);
#line 733
  IRC_WriteStrChannelPrefix(Client, Channel, Prefix, 0, (char *)"MODE %s %s %s", __cil_tmp___2,
                            Mode, Mask);
#line 735
  return (ok);
}
}
#line 1 "irc-op.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-9CIOjifT.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 21 "irc-op.h"
int IRC_KICK(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_INVITE(CLIENT *Client , REQUEST *Req ) ;
#line 38 "irc-op.c"
int IRC_KICK(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  CLIENT *from ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___7 ;

  {
#line 47
  if (Req->argc < 2) {
#line 47
    __cil_tmp = Client_ID(Client);
#line 47
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 47
    return (__cil_tmp___0);
  } else {
#line 47
    if (Req->argc > 3) {
#line 47
      __cil_tmp = Client_ID(Client);
#line 47
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                         __cil_tmp, Req->command);
#line 47
      return (__cil_tmp___0);
    }
  }
#line 49
  __cil_tmp___1 = Client_Type(Client);
#line 49
  if (__cil_tmp___1 == 32) {
#line 49
    from = Client_Search(Req->prefix);
  } else {
#line 50
    from = Client;
  }
#line 51
  if (! from) {
#line 51
    __cil_tmp___2 = Client_ID(Client);
#line 51
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 51
    return (__cil_tmp___3);
  }
#line 54
  target = Client_Search(Req->argv[1]);
#line 55
  if (! target) {
#line 55
    __cil_tmp___4 = Client_ID(from);
#line 55
    __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___4, Req->argv[1]);
#line 55
    return (__cil_tmp___5);
  }
#line 57
  if (Req->argc == 3) {
#line 57
    __cil_tmp___7 = Req->argv[2];
  } else {
#line 57
    __cil_tmp___7 = Client_ID(from);
  }
#line 57
  Channel_Kick(target, from, Req->argv[0], __cil_tmp___7);
#line 58
  return (1);
}
}
#line 62 "irc-op.c"
int IRC_INVITE(CLIENT *Client , REQUEST *Req ) 
{ CHANNEL *chan ;
  CLIENT *target ;
  CLIENT *from ;
  int remember ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;
  int __cil_tmp___8 ;
  int __cil_tmp___9 ;
  char const   *__cil_tmp___10 ;
  char *__cil_tmp___11 ;
  int __cil_tmp___12 ;
  char *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  int __cil_tmp___18 ;
  int __cil_tmp___19 ;
  struct list_head *__cil_tmp___20 ;
  int __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;
  char *__cil_tmp___24 ;
  char *__cil_tmp___25 ;
  int __cil_tmp___26 ;
  CONN_ID __cil_tmp___27 ;

  {
#line 67
  remember = 0;
#line 73
  if (Req->argc != 2) {
#line 73
    __cil_tmp = Client_ID(Client);
#line 73
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 73
    return (__cil_tmp___0);
  }
#line 75
  __cil_tmp___1 = Client_Type(Client);
#line 75
  if (__cil_tmp___1 == 32) {
#line 75
    from = Client_Search(Req->prefix);
  } else {
#line 76
    from = Client;
  }
#line 77
  if (! from) {
#line 77
    __cil_tmp___2 = Client_ID(Client);
#line 77
    __cil_tmp___3 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___2, Req->prefix);
#line 77
    return (__cil_tmp___3);
  }
#line 80
  target = Client_Search(Req->argv[0]);
#line 81
  if (! target) {
#line 81
    __cil_tmp___4 = Client_ID(Client);
#line 81
    __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___4, Req->argv[0]);
#line 81
    return (__cil_tmp___5);
  } else {
#line 81
    __cil_tmp___6 = Client_Type(target);
#line 81
    if (__cil_tmp___6 != 16) {
#line 81
      __cil_tmp___4 = Client_ID(Client);
#line 81
      __cil_tmp___5 = IRC_WriteStrClient(from, (char *)"401 %s %s :No such nick or channel name",
                                         __cil_tmp___4, Req->argv[0]);
#line 81
      return (__cil_tmp___5);
    }
  }
#line 83
  chan = Channel_Search(Req->argv[1]);
#line 85
  if (chan) {
#line 88
    __cil_tmp___9 = Channel_IsMemberOf(chan, from);
#line 88
    if (! __cil_tmp___9) {
#line 88
      __cil_tmp___7 = Client_ID(Client);
#line 88
      __cil_tmp___8 = IRC_WriteStrClient(from, (char *)"442 %s %s :You are not on that channel",
                                         __cil_tmp___7, Req->argv[1]);
#line 88
      return (__cil_tmp___8);
    }
#line 91
    __cil_tmp___15 = Channel_Modes(chan);
#line 91
    __cil_tmp___16 = strchr((char const   *)__cil_tmp___15, 'i');
#line 91
    if (__cil_tmp___16) {
#line 94
      __cil_tmp___13 = Channel_UserModes(chan, from);
#line 94
      __cil_tmp___14 = strchr((char const   *)__cil_tmp___13, 'o');
#line 94
      if (! __cil_tmp___14) {
#line 94
        __cil_tmp___10 = Channel_Name((CHANNEL const   *)chan);
#line 94
        __cil_tmp___11 = Client_ID(from);
#line 94
        __cil_tmp___12 = IRC_WriteStrClient(from, (char *)"482 %s %s :You are not channel operator",
                                            __cil_tmp___11, __cil_tmp___10);
#line 94
        return (__cil_tmp___12);
      }
#line 95
      remember = 1;
    }
#line 99
    __cil_tmp___19 = Channel_IsMemberOf(chan, target);
#line 99
    if (__cil_tmp___19) {
#line 99
      __cil_tmp___17 = Client_ID(from);
#line 99
      __cil_tmp___18 = IRC_WriteStrClient(from, (char *)"443 %s %s %s :is already on channel",
                                          __cil_tmp___17, Req->argv[0], Req->argv[1]);
#line 99
      return (__cil_tmp___18);
    }
#line 102
    __cil_tmp___20 = Channel_GetListBans(chan);
#line 102
    __cil_tmp___21 = Lists_Check(__cil_tmp___20, target);
#line 102
    if (__cil_tmp___21) {
#line 102
      remember = 1;
    }
#line 104
    if (remember) {
#line 106
      __cil_tmp___22 = Client_Mask(target);
#line 106
      __cil_tmp___23 = Channel_AddInvite(chan, (char const   *)__cil_tmp___22, 1);
#line 106
      if (! __cil_tmp___23) {
#line 107
        return (1);
      }
    }
  }
#line 111
  __cil_tmp___24 = Client_Mask(from);
#line 111
  LogDebug("User \"%s\" invites \"%s\" to \"%s\" ...", __cil_tmp___24, Req->argv[0],
           Req->argv[1]);
#line 114
  IRC_WriteStrClientPrefix(target, from, (char *)"INVITE %s %s", Req->argv[0], Req->argv[1]);
#line 116
  __cil_tmp___27 = Client_Conn(target);
#line 116
  if (__cil_tmp___27 > -1) {
#line 119
    __cil_tmp___25 = Client_ID(from);
#line 119
    __cil_tmp___26 = IRC_WriteStrClientPrefix(from, target, (char *)"341 %s %s %s",
                                              __cil_tmp___25, Req->argv[0], Req->argv[1]);
#line 119
    if (! __cil_tmp___26) {
#line 119
      return (0);
    }
  }
#line 122
  return (1);
}
}
#line 1 "irc-oper.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-GgmwMsuI.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 21 "irc-oper.h"
int IRC_OPER(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_DIE(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_REHASH(CLIENT *Client , REQUEST *Req ) ;
#line 24
int IRC_RESTART(CLIENT *Client , REQUEST *Req ) ;
#line 25
int IRC_CONNECT(CLIENT *Client , REQUEST *Req ) ;
#line 26
int IRC_DISCONNECT(CLIENT *Client , REQUEST *Req ) ;
#line 27
int IRC_WALLOPS(CLIENT *Client , REQUEST *Req ) ;
#line 40 "irc-oper.c"
static int Bad_OperPass(CLIENT *Client , char *errtoken , char *errmsg ) 
{ char *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 43
  __cil_tmp = Client_Mask(Client);
#line 43
  Log(4, "Got invalid OPER from \"%s\": \"%s\" -- %s", __cil_tmp, errtoken, errmsg);
#line 45
  IRC_SetPenalty(Client, 3L);
#line 46
  __cil_tmp___0 = Client_ID(Client);
#line 46
  __cil_tmp___1 = IRC_WriteStrClient(Client, (char *)"464 %s :Invalid password", __cil_tmp___0);
#line 46
  return (__cil_tmp___1);
}
}
#line 50 "irc-oper.c"
int IRC_OPER(CLIENT *Client , REQUEST *Req ) 
{ unsigned int i ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  int __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  char *__cil_tmp___14 ;
  int __cil_tmp___15 ;

  {
#line 59
  if (Req->argc != 2) {
#line 59
    __cil_tmp = Client_ID(Client);
#line 59
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 59
    return (__cil_tmp___0);
  }
#line 62
  i = 0U;
#line 62
  while (i < Conf_Oper_Count) {
#line 64
    if (Conf_Oper[i].name[0]) {
#line 64
      if (Conf_Oper[i].pwd[0]) {
#line 64
        __cil_tmp___1 = strcmp((char const   *)(Conf_Oper[i].name), (char const   *)Req->argv[0]);
#line 64
        if (__cil_tmp___1 == 0) {
#line 64
          break;
        }
      }
    }
#line 62
    i ++;
  }
#line 66
  if (i >= Conf_Oper_Count) {
#line 67
    __cil_tmp___2 = Bad_OperPass(Client, Req->argv[0], (char *)"not configured");
#line 67
    return (__cil_tmp___2);
  }
#line 70
  __cil_tmp___4 = strcmp((char const   *)(Conf_Oper[i].pwd), (char const   *)Req->argv[1]);
#line 70
  if (__cil_tmp___4 != 0) {
#line 71
    __cil_tmp___3 = Bad_OperPass(Client, Conf_Oper[i].name, (char *)"Bad password");
#line 71
    return (__cil_tmp___3);
  }
#line 74
  if (Conf_Oper[i].mask) {
#line 74
    __cil_tmp___6 = Client_Mask(Client);
#line 74
    __cil_tmp___7 = Match((char const   *)Conf_Oper[i].mask, (char const   *)__cil_tmp___6);
#line 74
    if (! __cil_tmp___7) {
#line 75
      __cil_tmp___5 = Bad_OperPass(Client, Conf_Oper[i].mask, (char *)"hostmask check failed");
#line 75
      return (__cil_tmp___5);
    }
  }
#line 77
  __cil_tmp___11 = Client_HasMode(Client, (char )'o');
#line 77
  if (! __cil_tmp___11) {
#line 80
    Client_ModeAdd(Client, (char )'o');
#line 81
    __cil_tmp___8 = Client_ID(Client);
#line 81
    __cil_tmp___9 = IRC_WriteStrClient(Client, (char *)"MODE %s :+o", __cil_tmp___8);
#line 81
    if (! __cil_tmp___9) {
#line 81
      return (0);
    }
#line 82
    __cil_tmp___10 = Client_ID(Client);
#line 82
    IRC_WriteStrServersPrefix((CLIENT *)((void *)0), Client, (char *)"MODE %s :+o",
                              __cil_tmp___10);
  }
#line 85
  __cil_tmp___13 = Client_OperByMe(Client);
#line 85
  if (! __cil_tmp___13) {
#line 85
    __cil_tmp___12 = Client_Mask(Client);
#line 85
    Log(1029, "Got valid OPER from \"%s\", user is an IRC operator now.", __cil_tmp___12);
  }
#line 87
  Client_SetOperByMe(Client, 1);
#line 88
  __cil_tmp___14 = Client_ID(Client);
#line 88
  __cil_tmp___15 = IRC_WriteStrClient(Client, (char *)"381 %s :You are now an IRC Operator",
                                      __cil_tmp___14);
#line 88
  return (__cil_tmp___15);
}
}
#line 92 "irc-oper.c"
int IRC_DIE(CLIENT *Client , REQUEST *Req ) 
{ CONN_ID c ;
  CLIENT *cl ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  char *__cil_tmp___7 ;

  {
#line 104
  __cil_tmp___1 = Client_HasMode(Client, (char )'o');
#line 104
  if (__cil_tmp___1) {
#line 104
    __cil_tmp___2 = Client_OperByMe(Client);
#line 104
    if (! __cil_tmp___2) {
#line 105
      __cil_tmp = Client_ID(Client);
#line 105
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 105
      return (__cil_tmp___0);
    }
  } else {
#line 105
    __cil_tmp = Client_ID(Client);
#line 105
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                       __cil_tmp);
#line 105
    return (__cil_tmp___0);
  }
#line 112
  if (Req->argc > 1) {
#line 114
    __cil_tmp___3 = Client_ID(Client);
#line 114
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 114
    return (__cil_tmp___4);
  }
#line 118
  if (Req->argc > 0) {
#line 119
    c = Conn_First();
#line 120
    while (c != -1) {
#line 121
      cl = Conn_GetClient(c);
#line 122
      __cil_tmp___6 = Client_Type(cl);
#line 122
      if (__cil_tmp___6 == 16) {
#line 123
        __cil_tmp___5 = Client_ID(cl);
#line 123
        IRC_WriteStrClient(cl, (char *)"NOTICE %s :%s", __cil_tmp___5, Req->argv[0]);
      }
#line 125
      c = Conn_Next(c);
    }
  }
#line 129
  __cil_tmp___7 = Client_Mask(Client);
#line 129
  Log(1029, "Got DIE command from \"%s\" ...", __cil_tmp___7);
#line 131
  NGIRCd_SignalQuit = 1;
#line 133
  return (1);
}
}
#line 137 "irc-oper.c"
int IRC_REHASH(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;

  {
#line 146
  __cil_tmp___1 = Client_HasMode(Client, (char )'o');
#line 146
  if (__cil_tmp___1) {
#line 146
    __cil_tmp___2 = Client_OperByMe(Client);
#line 146
    if (! __cil_tmp___2) {
#line 146
      __cil_tmp = Client_ID(Client);
#line 146
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 146
      return (__cil_tmp___0);
    }
  } else {
#line 146
    __cil_tmp = Client_ID(Client);
#line 146
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                       __cil_tmp);
#line 146
    return (__cil_tmp___0);
  }
#line 149
  if (Req->argc != 0) {
#line 149
    __cil_tmp___3 = Client_ID(Client);
#line 149
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 149
    return (__cil_tmp___4);
  }
#line 151
  __cil_tmp___5 = Client_Mask(Client);
#line 151
  Log(1029, "Got REHASH command from \"%s\" ...", __cil_tmp___5);
#line 152
  NGIRCd_SignalRehash = 1;
#line 154
  return (1);
}
}
#line 158 "irc-oper.c"
int IRC_RESTART(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;

  {
#line 167
  __cil_tmp___1 = Client_HasMode(Client, (char )'o');
#line 167
  if (__cil_tmp___1) {
#line 167
    __cil_tmp___2 = Client_OperByMe(Client);
#line 167
    if (! __cil_tmp___2) {
#line 167
      __cil_tmp = Client_ID(Client);
#line 167
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 167
      return (__cil_tmp___0);
    }
  } else {
#line 167
    __cil_tmp = Client_ID(Client);
#line 167
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                       __cil_tmp);
#line 167
    return (__cil_tmp___0);
  }
#line 170
  if (Req->argc != 0) {
#line 170
    __cil_tmp___3 = Client_ID(Client);
#line 170
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 170
    return (__cil_tmp___4);
  }
#line 172
  __cil_tmp___5 = Client_Mask(Client);
#line 172
  Log(1029, "Got RESTART command from \"%s\" ...", __cil_tmp___5);
#line 173
  NGIRCd_SignalRestart = 1;
#line 174
  return (1);
}
}
#line 181 "irc-oper.c"
int IRC_CONNECT(CLIENT *Client , REQUEST *Req ) 
{ char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  char *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int __cil_tmp___10 ;
  int __cil_tmp___11 ;
  char *__cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  int __cil_tmp___15 ;
  char *__cil_tmp___16 ;
  int __cil_tmp___17 ;
  int __cil_tmp___18 ;
  int __cil_tmp___19 ;

  {
#line 189
  __cil_tmp___1 = Client_HasMode(Client, (char )'o');
#line 189
  if (__cil_tmp___1) {
#line 189
    __cil_tmp___2 = Client_OperByMe(Client);
#line 189
    if (! __cil_tmp___2) {
#line 190
      __cil_tmp = Client_ID(Client);
#line 190
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 190
      return (__cil_tmp___0);
    }
  } else {
#line 190
    __cil_tmp = Client_ID(Client);
#line 190
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                       __cil_tmp);
#line 190
    return (__cil_tmp___0);
  }
#line 194
  if (Req->argc != 1) {
#line 194
    if (Req->argc != 2) {
#line 194
      if (Req->argc != 5) {
#line 195
        __cil_tmp___3 = Client_ID(Client);
#line 195
        __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                           __cil_tmp___3, Req->command);
#line 195
        return (__cil_tmp___4);
      }
    }
  }
#line 199
  if (Req->argc > 1) {
#line 199
    __cil_tmp___7 = atoi((char const   *)Req->argv[1]);
#line 199
    if (__cil_tmp___7 < 1) {
#line 200
      __cil_tmp___5 = Client_ID(Client);
#line 200
      __cil_tmp___6 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                         __cil_tmp___5, Req->command);
#line 200
      return (__cil_tmp___6);
    }
  }
#line 203
  __cil_tmp___8 = Client_Mask(Client);
#line 203
  Log(1029, "Got CONNECT command from \"%s\" for \"%s\".", __cil_tmp___8, Req->argv[0]);
#line 207
  switch (Req->argc) {
  case 1: 
#line 209
  __cil_tmp___11 = Conf_EnablePassiveServer((char const   *)Req->argv[0]);
#line 209
  if (! __cil_tmp___11) {
#line 210
    __cil_tmp___9 = Client_ID(Client);
#line 210
    __cil_tmp___10 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                        __cil_tmp___9, Req->argv[0]);
#line 210
    return (__cil_tmp___10);
  }
#line 213
  break;
  case 2: 
#line 216
  __cil_tmp___14 = atoi((char const   *)Req->argv[1]);
#line 216
  __cil_tmp___15 = Conf_EnableServer(Req->argv[0], (unsigned short )__cil_tmp___14);
#line 216
  if (! __cil_tmp___15) {
#line 218
    __cil_tmp___12 = Client_ID(Client);
#line 218
    __cil_tmp___13 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                        __cil_tmp___12, Req->argv[0]);
#line 218
    return (__cil_tmp___13);
  }
#line 221
  break;
  default: 
#line 224
  __cil_tmp___18 = atoi((char const   *)Req->argv[1]);
#line 224
  __cil_tmp___19 = Conf_AddServer(Req->argv[0], (unsigned short )__cil_tmp___18, Req->argv[2],
                                  Req->argv[3], Req->argv[4]);
#line 224
  if (! __cil_tmp___19) {
#line 227
    __cil_tmp___16 = Client_ID(Client);
#line 227
    __cil_tmp___17 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                        __cil_tmp___16, Req->argv[0]);
#line 227
    return (__cil_tmp___17);
  }
  }
#line 232
  return (1);
}
}
#line 236 "irc-oper.c"
int IRC_DISCONNECT(CLIENT *Client , REQUEST *Req ) 
{ CONN_ID my_conn ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  char *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  CLIENT *__cil_tmp___9 ;

  {
#line 247
  __cil_tmp___1 = Client_HasMode(Client, (char )'o');
#line 247
  if (__cil_tmp___1) {
#line 247
    __cil_tmp___2 = Client_OperByMe(Client);
#line 247
    if (! __cil_tmp___2) {
#line 247
      __cil_tmp = Client_ID(Client);
#line 247
      __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                         __cil_tmp);
#line 247
      return (__cil_tmp___0);
    }
  } else {
#line 247
    __cil_tmp = Client_ID(Client);
#line 247
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                       __cil_tmp);
#line 247
    return (__cil_tmp___0);
  }
#line 250
  if (Req->argc != 1) {
#line 250
    __cil_tmp___3 = Client_ID(Client);
#line 250
    __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp___3, Req->command);
#line 250
    return (__cil_tmp___4);
  }
#line 252
  __cil_tmp___5 = Client_Mask(Client);
#line 252
  Log(1029, "Got DISCONNECT command from \"%s\" for0 \"%s\".", __cil_tmp___5, Req->argv[0]);
#line 255
  my_conn = Client_Conn(Client);
#line 258
  __cil_tmp___8 = Conf_DisableServer(Req->argv[0]);
#line 258
  if (! __cil_tmp___8) {
#line 258
    __cil_tmp___6 = Client_ID(Client);
#line 258
    __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"402 %s %s :No such server",
                                       __cil_tmp___6, Req->argv[0]);
#line 258
    return (__cil_tmp___7);
  }
#line 261
  __cil_tmp___9 = Conn_GetClient(my_conn);
#line 261
  if (__cil_tmp___9) {
#line 261
    return (1);
  } else {
#line 262
    return (0);
  }
}
}
#line 266 "irc-oper.c"
int IRC_WALLOPS(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *to ;
  CLIENT *from ;
  int client_type ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  CONN_ID __cil_tmp___6 ;
  int __cil_tmp___7 ;

  {
#line 275
  if (Req->argc != 1) {
#line 276
    __cil_tmp = Client_ID(Client);
#line 276
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 276
    return (__cil_tmp___0);
  }
#line 278
  client_type = Client_Type(Client);
#line 279
  switch (client_type) {
  case 16: 
#line 281
  __cil_tmp___3 = Client_OperByMe(Client);
#line 281
  if (! __cil_tmp___3) {
#line 282
    __cil_tmp___1 = Client_ID(Client);
#line 282
    __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"481 %s :Permission denied",
                                       __cil_tmp___1);
#line 282
    return (__cil_tmp___2);
  }
#line 283
  from = Client;
#line 284
  break;
  case 32: 
#line 286
  from = Client_Search(Req->prefix);
#line 287
  break;
  default: ;
#line 289
  return (1);
  }
#line 292
  if (! from) {
#line 293
    __cil_tmp___4 = Client_ID(Client);
#line 293
    __cil_tmp___5 = IRC_WriteStrClient(Client, (char *)"401 %s %s :No such nick or channel name",
                                       __cil_tmp___4, Req->prefix);
#line 293
    return (__cil_tmp___5);
  }
#line 295
  to = Client_First();
#line 295
  while ((unsigned int )to != (unsigned int )((void *)0)) {
#line 296
    __cil_tmp___6 = Client_Conn(to);
#line 296
    if (__cil_tmp___6 < 0) {
      goto __Cont;
    }
#line 299
    client_type = Client_Type(to);
#line 300
    switch (client_type) {
    case 16: 
#line 302
    __cil_tmp___7 = Client_HasMode(to, (char )'w');
#line 302
    if (__cil_tmp___7) {
#line 303
      IRC_WriteStrClientPrefix(to, from, (char *)"WALLOPS :%s", Req->argv[0]);
    }
#line 304
    break;
    case 32: 
#line 306
    if ((unsigned int )to != (unsigned int )Client) {
#line 307
      IRC_WriteStrClientPrefix(to, from, (char *)"WALLOPS :%s", Req->argv[0]);
    }
#line 308
    break;
    }
    __Cont: /* CIL Label */ 
#line 295
    to = Client_Next(to);
  }
#line 311
  return (1);
}
}
#line 1 "irc-server.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-DeZxvyxI.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 19 "numeric.h"
int IRC_Num_ENDOFMOTD(CLIENT *Client , REQUEST *Req  __attribute__((__unused__)) ) ;
#line 21 "irc-server.h"
int IRC_SERVER(CLIENT *Client , REQUEST *Req ) ;
#line 22
int IRC_NJOIN(CLIENT *Client , REQUEST *Req ) ;
#line 23
int IRC_SQUIT(CLIENT *Client , REQUEST *Req ) ;
#line 50 "irc-server.c"
int IRC_SERVER(CLIENT *Client , REQUEST *Req ) 
{ char str[256] ;
  char *ptr ;
  CLIENT *from ;
  CLIENT *c ;
  int ok ;
  int i ;
  CONN_ID con ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  CONN_ID __cil_tmp___1 ;
  CONN_ID __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;
  CONN_ID __cil_tmp___6 ;
  CONN_ID __cil_tmp___7 ;
  CONN_ID __cil_tmp___8 ;
  CONN_ID __cil_tmp___9 ;
  char *__cil_tmp___10 ;
  int __cil_tmp___11 ;
  int __cil_tmp___12 ;
  int __cil_tmp___13 ;
  int __cil_tmp___14 ;
  int __cil_tmp___15 ;
  int __cil_tmp___16 ;
  char *__cil_tmp___17 ;
  int __cil_tmp___18 ;
  char *__cil_tmp___19 ;
  char *__cil_tmp___20 ;
  int __cil_tmp___21 ;
  char *__cil_tmp___22 ;
  int __cil_tmp___23 ;
  int __cil_tmp___24 ;
  CONN_ID __cil_tmp___25 ;
  CONN_ID __cil_tmp___26 ;
  int __cil_tmp___27 ;
  int __cil_tmp___28 ;
  CONN_ID __cil_tmp___29 ;
  CONN_ID __cil_tmp___30 ;
  char *__cil_tmp___31 ;
  int __cil_tmp___32 ;
  char const   *__cil_tmp___34 ;
  int __cil_tmp___35 ;
  int __cil_tmp___36 ;
  char *__cil_tmp___37 ;
  char *__cil_tmp___38 ;
  char *__cil_tmp___39 ;
  int __cil_tmp___40 ;
  int __cil_tmp___41 ;
  char *__cil_tmp___42 ;
  char *__cil_tmp___43 ;
  int __cil_tmp___44 ;
  int __cil_tmp___45 ;
  int __cil_tmp___46 ;

  {
#line 63
  __cil_tmp___1 = Client_Conn(Client);
#line 63
  if (__cil_tmp___1 <= -1) {
#line 64
    __cil_tmp = Client_ID(Client);
#line 64
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"421 %s %s :Unknown command",
                                       __cil_tmp, Req->command);
#line 64
    return (__cil_tmp___0);
  }
#line 67
  __cil_tmp___46 = Client_Type(Client);
#line 67
  if (__cil_tmp___46 == 2) {
#line 70
    __cil_tmp___2 = Client_Conn(Client);
#line 70
    LogDebug("Connection %d: got SERVER command (new server link) ...", __cil_tmp___2);
#line 74
    if (Req->argc != 2) {
#line 74
      if (Req->argc != 3) {
#line 74
        __cil_tmp___3 = Client_ID(Client);
#line 74
        __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                           __cil_tmp___3, Req->command);
#line 74
        return (__cil_tmp___4);
      }
    }
#line 77
    i = 0;
#line 77
    while (i < 16) {
#line 77
      __cil_tmp___5 = strcasecmp((char const   *)Req->argv[0], (char const   *)(Conf_Server[i].name));
#line 77
      if (__cil_tmp___5 == 0) {
#line 77
        break;
      }
#line 77
      i ++;
    }
#line 78
    if (i >= 16) {
#line 81
      __cil_tmp___6 = Client_Conn(Client);
#line 81
      Log(3, "Connection %d: Server \"%s\" not configured here!", __cil_tmp___6, Req->argv[0]);
#line 82
      __cil_tmp___7 = Client_Conn(Client);
#line 82
      Conn_Close(__cil_tmp___7, (char *)((void *)0), (char *)"Server not configured here",
                 1);
#line 83
      return (0);
    }
#line 85
    __cil_tmp___10 = Client_Password(Client);
#line 85
    __cil_tmp___11 = strcmp((char const   *)__cil_tmp___10, (char const   *)(Conf_Server[i].pwd_in));
#line 85
    if (__cil_tmp___11 != 0) {
#line 88
      __cil_tmp___8 = Client_Conn(Client);
#line 88
      Log(3, "Connection %d: Got bad password from server \"%s\"!", __cil_tmp___8,
          Req->argv[0]);
#line 89
      __cil_tmp___9 = Client_Conn(Client);
#line 89
      Conn_Close(__cil_tmp___9, (char *)((void *)0), (char *)"Bad password", 1);
#line 90
      return (0);
    }
#line 94
    __cil_tmp___12 = Client_CheckID(Client, Req->argv[0]);
#line 94
    if (! __cil_tmp___12) {
#line 94
      return (0);
    }
#line 97
    Client_SetID(Client, Req->argv[0]);
#line 98
    Client_SetHops(Client, 1);
#line 99
    Client_SetInfo(Client, Req->argv[Req->argc - 1]);
#line 103
    con = Client_Conn(Client);
#line 104
    __cil_tmp___15 = Client_Token(Client);
#line 104
    if (__cil_tmp___15 != -2) {
#line 107
      ok = 1;
#line 108
      __cil_tmp___13 = IRC_WriteStrClient(Client, (char *)"PASS %s %s", Conf_Server[i].pwd_out,
                                          NGIRCd_ProtoID);
#line 108
      if (__cil_tmp___13) {
#line 109
        ok = IRC_WriteStrClient(Client, (char *)"SERVER %s 1 :%s", Conf_ServerName,
                                Conf_ServerInfo);
      } else {
#line 108
        ok = 0;
      }
#line 110
      if (! ok) {
#line 112
        Conn_Close(con, (char *)"Unexpected server behavior!", (char *)((void *)0),
                   0);
#line 113
        return (0);
      }
#line 115
      Client_SetIntroducer(Client, Client);
#line 116
      Client_SetToken(Client, 1);
    } else {
#line 122
      __cil_tmp___14 = atoi((char const   *)Req->argv[1]);
#line 122
      Client_SetToken(Client, __cil_tmp___14);
    }
#line 126
    Conf_SetServer(i, con);
#line 128
    Client_SetType(Client, 128);
#line 144
    __cil_tmp___19 = Client_Flags(Client);
#line 144
    __cil_tmp___20 = strchr((char const   *)__cil_tmp___19, 'H');
#line 144
    if (__cil_tmp___20) {
#line 145
      LogDebug("Peer supports IRC+ extended server handshake ...");
#line 146
      __cil_tmp___16 = IRC_Send_ISUPPORT(Client);
#line 146
      if (! __cil_tmp___16) {
#line 147
        return (0);
      }
#line 148
      __cil_tmp___17 = Client_ID(Client);
#line 148
      __cil_tmp___18 = IRC_WriteStrClient(Client, (char *)"376 %s :End of MOTD command",
                                          __cil_tmp___17);
#line 148
      return (__cil_tmp___18);
    } else {
#line 152
      if (Conf_MaxNickLength != 10U) {
#line 153
        Log(2, "Attention: this server uses a non-standard nick length, but the peer doesn\'t support the IRC+ extended server handshake!");
      }
    }
#line 159
    __cil_tmp___21 = IRC_Num_ENDOFMOTD(Client, Req);
#line 159
    return (__cil_tmp___21);
  } else {
#line 161
    __cil_tmp___45 = Client_Type(Client);
#line 161
    if (__cil_tmp___45 == 32) {
#line 166
      if (Req->argc != 4) {
#line 166
        __cil_tmp___22 = Client_ID(Client);
#line 166
        __cil_tmp___23 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                            __cil_tmp___22, Req->command);
#line 166
        return (__cil_tmp___23);
      }
#line 169
      __cil_tmp___24 = Client_CheckID(Client, Req->argv[0]);
#line 169
      if (! __cil_tmp___24) {
#line 169
        return (0);
      }
#line 172
      ptr = strchr((char const   *)(Req->argv[3] + 2), '[');
#line 173
      if (! ptr) {
#line 173
        ptr = Req->argv[3];
      }
#line 175
      from = Client_Search(Req->prefix);
#line 176
      if (! from) {
#line 179
        __cil_tmp___25 = Client_Conn(Client);
#line 179
        Log(1, "Unknown ID in prefix of SERVER: \"%s\"! (on connection %d)", Req->prefix,
            __cil_tmp___25);
#line 180
        __cil_tmp___26 = Client_Conn(Client);
#line 180
        Conn_Close(__cil_tmp___26, (char *)((void *)0), (char *)"Unknown ID in prefix of SERVER",
                   1);
#line 181
        return (0);
      }
#line 185
      __cil_tmp___27 = atoi((char const   *)Req->argv[2]);
#line 185
      __cil_tmp___28 = atoi((char const   *)Req->argv[1]);
#line 185
      c = Client_NewRemoteServer(Client, Req->argv[0], from, __cil_tmp___28, __cil_tmp___27,
                                 ptr, 1);
#line 186
      if (! c) {
#line 189
        __cil_tmp___29 = Client_Conn(Client);
#line 189
        Log(1, "Can\'t create client structure for server! (on connection %d)", __cil_tmp___29);
#line 190
        __cil_tmp___30 = Client_Conn(Client);
#line 190
        Conn_Close(__cil_tmp___30, (char *)((void *)0), (char *)"Can\'t allocate client structure for remote server",
                   1);
#line 191
        return (0);
      }
#line 195
      __cil_tmp___32 = Client_Hops(c);
#line 195
      if (__cil_tmp___32 > 1) {
#line 195
        if (*(Req->prefix + 0)) {
#line 195
          __cil_tmp___31 = Client_ID(from);
#line 195
          snprintf(str, sizeof(str), "connected to %s, ", __cil_tmp___31);
        } else {
#line 196
          strcpy(str, "");
        }
      } else {
#line 196
        strcpy(str, "");
      }
#line 197
      __cil_tmp___35 = Client_Hops(c);
#line 197
      if (__cil_tmp___35 > 1) {
#line 197
        __cil_tmp___34 = "s";
      } else {
#line 197
        __cil_tmp___34 = "";
      }
#line 197
      __cil_tmp___36 = Client_Hops(c);
#line 197
      __cil_tmp___37 = Client_ID(Client);
#line 197
      __cil_tmp___38 = Client_ID(c);
#line 197
      Log(1029, "Server \"%s\" registered (via %s, %s%d hop%s).", __cil_tmp___38,
          __cil_tmp___37, str, __cil_tmp___36, __cil_tmp___34);
#line 200
      __cil_tmp___39 = Client_Info(c);
#line 200
      __cil_tmp___40 = Client_MyToken(c);
#line 200
      __cil_tmp___41 = Client_Hops(c);
#line 200
      __cil_tmp___42 = Client_ID(c);
#line 200
      IRC_WriteStrServersPrefix(Client, from, (char *)"SERVER %s %d %d :%s", __cil_tmp___42,
                                __cil_tmp___41 + 1, __cil_tmp___40, __cil_tmp___39);
#line 202
      return (1);
    } else {
#line 204
      __cil_tmp___43 = Client_ID(Client);
#line 204
      __cil_tmp___44 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                          __cil_tmp___43, Req->command);
#line 204
      return (__cil_tmp___44);
    }
  }
}
}
#line 209 "irc-server.c"
int IRC_NJOIN(CLIENT *Client , REQUEST *Req ) 
{ char nick_in[513] ;
  char nick_out[513] ;
  char *channame ;
  char *ptr ;
  char modes[8] ;
  int is_op ;
  int is_voiced ;
  CHANNEL *chan ;
  CLIENT *c ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  CLIENT *__cil_tmp___3 ;

  {
#line 221
  if (Req->argc != 2) {
#line 221
    __cil_tmp = Client_ID(Client);
#line 221
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 221
    return (__cil_tmp___0);
  }
#line 223
  strlcpy(nick_in, (char const   *)Req->argv[1], sizeof(nick_in));
#line 224
  strcpy(nick_out, "");
#line 226
  channame = Req->argv[0];
#line 227
  ptr = strtok(nick_in, ",");
#line 228
  while (ptr) {
#line 230
    is_voiced = 0;
#line 230
    is_op = is_voiced;
#line 233
    while (1) {
#line 233
      if (! ((int )*ptr == 64)) {
#line 233
        if (! ((int )*ptr == 43)) {
#line 233
          break;
        }
      }
#line 235
      if ((int )*ptr == 64) {
#line 235
        is_op = 1;
      }
#line 236
      if ((int )*ptr == 43) {
#line 236
        is_voiced = 1;
      }
#line 237
      ptr ++;
    }
#line 240
    c = Client_Search(ptr);
#line 241
    if (c) {
#line 243
      Channel_Join(c, channame);
#line 244
      chan = Channel_Search(channame);
#line 247
      if (is_op) {
#line 247
        Channel_UserModeAdd(chan, c, (char )'o');
      }
#line 248
      if (is_voiced) {
#line 248
        Channel_UserModeAdd(chan, c, (char )'v');
      }
#line 251
      IRC_WriteStrChannelPrefix(Client, chan, c, 0, (char *)"JOIN :%s", channame);
#line 254
      __cil_tmp___1 = Channel_UserModes(chan, c);
#line 254
      strlcpy(modes, (char const   *)__cil_tmp___1, sizeof(modes));
#line 255
      if (modes[0]) {
#line 258
        __cil_tmp___2 = Client_ID(c);
#line 258
        IRC_WriteStrChannelPrefix(Client, chan, Client, 0, (char *)"MODE %s +%s %s",
                                  channame, modes, __cil_tmp___2);
      }
#line 261
      if ((int )nick_out[0] != 0) {
#line 261
        strlcat(nick_out, ",", sizeof(nick_out));
      }
#line 262
      if (is_op) {
#line 262
        strlcat(nick_out, "@", sizeof(nick_out));
      }
#line 263
      if (is_voiced) {
#line 263
        strlcat(nick_out, "+", sizeof(nick_out));
      }
#line 264
      strlcat(nick_out, (char const   *)ptr, sizeof(nick_out));
    } else {
#line 266
      Log(3, "Got NJOIN for unknown nick \"%s\" for channel \"%s\"!", ptr, channame);
    }
#line 269
    ptr = strtok((char *)((void *)0), ",");
  }
#line 273
  if ((int )nick_out[0] != 0) {
#line 273
    __cil_tmp___3 = Client_ThisServer();
#line 273
    IRC_WriteStrServersPrefix(Client, __cil_tmp___3, (char *)"NJOIN %s :%s", Req->argv[0],
                              nick_out);
  }
#line 275
  return (1);
}
}
#line 279 "irc-server.c"
int IRC_SQUIT(CLIENT *Client , REQUEST *Req ) 
{ CLIENT *target ;
  char msg[320] ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  char *__cil_tmp___1 ;
  char *__cil_tmp___2 ;
  size_t __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  char *__cil_tmp___5 ;
  CONN_ID __cil_tmp___6 ;
  CONN_ID __cil_tmp___7 ;
  CONN_ID __cil_tmp___8 ;

  {
#line 289
  if (Req->argc != 2) {
#line 289
    __cil_tmp = Client_ID(Client);
#line 289
    __cil_tmp___0 = IRC_WriteStrClient(Client, (char *)"461 %s %s :Syntax error",
                                       __cil_tmp, Req->command);
#line 289
    return (__cil_tmp___0);
  }
#line 291
  __cil_tmp___1 = Client_ID(Client);
#line 291
  Log(7, "Got SQUIT from %s for \"%s\": \"%s\" ...", __cil_tmp___1, Req->argv[0],
      Req->argv[1]);
#line 293
  target = Client_Search(Req->argv[0]);
#line 294
  if (! target) {
#line 297
    __cil_tmp___2 = Client_ID(Client);
#line 297
    Log(4, "Got SQUIT from %s for unknown server \"%s\"!?", __cil_tmp___2, Req->argv[0]);
#line 298
    return (1);
  }
#line 301
  if (*(Req->argv[1] + 0)) {
#line 303
    __cil_tmp___3 = strlen((char const   *)Req->argv[1]);
#line 303
    if (__cil_tmp___3 > 256UL) {
#line 303
      *(Req->argv[1] + 256) = (char )'\000';
    }
#line 304
    __cil_tmp___4 = Client_ID(Client);
#line 304
    snprintf(msg, sizeof(msg), "%s (SQUIT from %s).", Req->argv[1], __cil_tmp___4);
  } else {
#line 306
    __cil_tmp___5 = Client_ID(Client);
#line 306
    snprintf(msg, sizeof(msg), "Got SQUIT from %s.", __cil_tmp___5);
  }
#line 308
  __cil_tmp___8 = Client_Conn(target);
#line 308
  if (__cil_tmp___8 > -1) {
#line 311
    if (*(Req->argv[1] + 0)) {
#line 311
      __cil_tmp___6 = Client_Conn(target);
#line 311
      Conn_Close(__cil_tmp___6, msg, Req->argv[1], 1);
    } else {
#line 312
      __cil_tmp___7 = Client_Conn(target);
#line 312
      Conn_Close(__cil_tmp___7, msg, (char *)((void *)0), 1);
    }
#line 313
    return (0);
  } else {
#line 318
    Client_Destroy(target, msg, Req->argv[1], 0);
#line 319
    return (1);
  }
}
}
#line 1 "irc-write.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-lDvDwgaY.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 24 "irc-write.h"
int IRC_WriteStrChannel(CLIENT *Client , CHANNEL *Chan , int Remote , char *Format 
                        , ...) ;
#line 42 "irc-write.c"
static char *Get_Prefix(CLIENT *Target , CLIENT *Client ) ;
#line 46 "irc-write.c"
int IRC_WriteStrClient(CLIENT *Client , char *Format  , ...) 
{ char buffer[1000] ;
  int ok ;
  va_list ap ;
  CLIENT *__cil_tmp ;

  {
#line 57
  ok = 1;
#line 64
  __builtin_va_start(ap, Format);
#line 68
  vsnprintf(buffer, 1000UL, (char const   *)Format, ap);
#line 69
  __builtin_va_end(ap);
#line 72
  __cil_tmp = Client_ThisServer();
#line 72
  ok = IRC_WriteStrClientPrefix(Client, __cil_tmp, (char *)"%s", buffer);
#line 74
  return (ok);
}
}
#line 79 "irc-write.c"
int IRC_WriteStrClientPrefix(CLIENT *Client , CLIENT *Prefix , char *Format  , ...) 
{ char buffer[1000] ;
  va_list ap ;
  CLIENT *__cil_tmp ;
  char *__cil_tmp___0 ;
  CLIENT *__cil_tmp___1 ;
  CONN_ID __cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 100
  __builtin_va_start(ap, Format);
#line 104
  vsnprintf(buffer, 1000UL, (char const   *)Format, ap);
#line 105
  __builtin_va_end(ap);
#line 107
  __cil_tmp = Client_NextHop(Client);
#line 107
  __cil_tmp___0 = Get_Prefix(__cil_tmp, Prefix);
#line 107
  __cil_tmp___1 = Client_NextHop(Client);
#line 107
  __cil_tmp___2 = Client_Conn(__cil_tmp___1);
#line 107
  __cil_tmp___3 = Conn_WriteStr(__cil_tmp___2, (char *)":%s %s", __cil_tmp___0, buffer);
#line 107
  return (__cil_tmp___3);
}
}
#line 112 "irc-write.c"
int IRC_WriteStrChannel(CLIENT *Client , CHANNEL *Chan , int Remote , char *Format 
                        , ...) 
{ char buffer[1000] ;
  va_list ap ;
  CLIENT *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 131
  __builtin_va_start(ap, Format);
#line 135
  vsnprintf(buffer, 1000UL, (char const   *)Format, ap);
#line 136
  __builtin_va_end(ap);
#line 138
  __cil_tmp = Client_ThisServer();
#line 138
  __cil_tmp___0 = IRC_WriteStrChannelPrefix(Client, Chan, __cil_tmp, Remote, (char *)"%s",
                                            buffer);
#line 138
  return (__cil_tmp___0);
}
}
#line 143 "irc-write.c"
int IRC_WriteStrChannelPrefix(CLIENT *Client , CHANNEL *Chan , CLIENT *Prefix , int Remote ,
                              char *Format  , ...) 
{ int ok ;
  char buffer[1000] ;
  CL2CHAN *cl2chan ;
  CONN_ID conn ;
  CLIENT *c ;
  va_list ap ;
  int __cil_tmp ;
  CONN_ID __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;

  {
#line 156
  ok = 1;
#line 169
  __builtin_va_start(ap, Format);
#line 173
  vsnprintf(buffer, 1000UL, (char const   *)Format, ap);
#line 174
  __builtin_va_end(ap);
#line 176
  Conn_ClearFlags();
#line 180
  cl2chan = Channel_FirstMember(Chan);
#line 181
  while (cl2chan) {
#line 183
    c = Channel_GetClient(cl2chan);
#line 184
    if (! Remote) {
#line 186
      __cil_tmp___0 = Client_Conn(c);
#line 186
      if (__cil_tmp___0 <= -1) {
#line 186
        c = (CLIENT *)((void *)0);
      } else {
#line 187
        __cil_tmp = Client_Type(c);
#line 187
        if (__cil_tmp == 32) {
#line 187
          c = (CLIENT *)((void *)0);
        }
      }
    }
#line 189
    if (c) {
#line 189
      c = Client_NextHop(c);
    }
#line 191
    if (c) {
#line 191
      if ((unsigned int )c != (unsigned int )Client) {
#line 194
        conn = Client_Conn(c);
#line 195
        __cil_tmp___1 = Client_Type(c);
#line 195
        if (__cil_tmp___1 == 32) {
#line 195
          Conn_SetFlag(conn, 2);
        } else {
#line 196
          Conn_SetFlag(conn, 1);
        }
      }
    }
#line 198
    cl2chan = Channel_NextMember(Chan, cl2chan);
  }
#line 202
  conn = Conn_First();
#line 203
  while (conn != -1) {
#line 206
    __cil_tmp___5 = Conn_Flag(conn);
#line 206
    if (__cil_tmp___5 == 2) {
#line 206
      __cil_tmp___2 = Client_ID(Prefix);
#line 206
      ok = Conn_WriteStr(conn, (char *)":%s %s", __cil_tmp___2, buffer);
    } else {
#line 207
      __cil_tmp___4 = Conn_Flag(conn);
#line 207
      if (__cil_tmp___4 == 1) {
#line 207
        __cil_tmp___3 = Client_Mask(Prefix);
#line 207
        ok = Conn_WriteStr(conn, (char *)":%s %s", __cil_tmp___3, buffer);
      }
    }
#line 208
    if (! ok) {
#line 208
      break;
    }
#line 211
    conn = Conn_Next(conn);
  }
#line 214
  return (ok);
}
}
#line 219 "irc-write.c"
void IRC_WriteStrServers(CLIENT *ExceptOf , char *Format  , ...) 
{ char buffer[1000] ;
  va_list ap ;
  CLIENT *__cil_tmp ;

  {
#line 235
  __builtin_va_start(ap, Format);
#line 239
  vsnprintf(buffer, 1000UL, (char const   *)Format, ap);
#line 240
  __builtin_va_end(ap);
#line 243
  __cil_tmp = Client_ThisServer();
#line 243
  IRC_WriteStrServersPrefix(ExceptOf, __cil_tmp, (char *)"%s", buffer);
#line 244
  return;
}
}
#line 248 "irc-write.c"
void IRC_WriteStrServersPrefix(CLIENT *ExceptOf , CLIENT *Prefix , char *Format  , ...) 
{ char buffer[1000] ;
  va_list ap ;

  {
#line 266
  __builtin_va_start(ap, Format);
#line 270
  vsnprintf(buffer, 1000UL, (char const   *)Format, ap);
#line 271
  __builtin_va_end(ap);
#line 273
  IRC_WriteStrServersPrefixFlag(ExceptOf, Prefix, (char )'\000', (char *)"%s", buffer);
#line 274
  return;
}
}
#line 278 "irc-write.c"
void IRC_WriteStrServersPrefixFlag(CLIENT *ExceptOf , CLIENT *Prefix , char Flag ,
                                   char *Format  , ...) 
{ char buffer[1000] ;
  CLIENT *c ;
  va_list ap ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  CONN_ID __cil_tmp___2 ;
  CLIENT *__cil_tmp___3 ;

  {
#line 298
  __builtin_va_start(ap, Format);
#line 302
  vsnprintf(buffer, 1000UL, (char const   *)Format, ap);
#line 303
  __builtin_va_end(ap);
#line 305
  c = Client_First();
#line 306
  while (c) {
#line 308
    __cil_tmp___1 = Client_Type(c);
#line 308
    if (__cil_tmp___1 == 32) {
#line 308
      __cil_tmp___2 = Client_Conn(c);
#line 308
      if (__cil_tmp___2 > -1) {
#line 308
        __cil_tmp___3 = Client_ThisServer();
#line 308
        if ((unsigned int )c != (unsigned int )__cil_tmp___3) {
#line 308
          if ((unsigned int )c != (unsigned int )ExceptOf) {
#line 311
            if ((int )Flag == 0) {
#line 311
              IRC_WriteStrClientPrefix(c, Prefix, (char *)"%s", buffer);
            } else {
#line 311
              __cil_tmp = Client_Flags(c);
#line 311
              __cil_tmp___0 = strchr((char const   *)__cil_tmp, (int )Flag);
#line 311
              if ((unsigned int )__cil_tmp___0 != (unsigned int )((void *)0)) {
#line 311
                IRC_WriteStrClientPrefix(c, Prefix, (char *)"%s", buffer);
              }
            }
          }
        }
      }
    }
#line 313
    c = Client_Next(c);
  }
#line 315
  return;
}
}
#line 319 "irc-write.c"
int IRC_WriteStrRelatedPrefix(CLIENT *Client , CLIENT *Prefix , int Remote , char *Format 
                              , ...) 
{ int ok ;
  CL2CHAN *chan_cl2chan ;
  CL2CHAN *cl2chan ;
  char buffer[1000] ;
  CHANNEL *chan ;
  CONN_ID conn ;
  va_list ap ;
  CLIENT *c ;
  int __cil_tmp ;
  CONN_ID __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  char *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  int __cil_tmp___5 ;

  {
#line 331
  ok = 1;
#line 344
  __builtin_va_start(ap, Format);
#line 348
  vsnprintf(buffer, 1000UL, (char const   *)Format, ap);
#line 349
  __builtin_va_end(ap);
#line 352
  Conn_ClearFlags();
#line 356
  chan_cl2chan = Channel_FirstChannelOf(Client);
#line 357
  while (chan_cl2chan) {
#line 360
    chan = Channel_GetChannel(chan_cl2chan);
#line 361
    cl2chan = Channel_FirstMember(chan);
#line 362
    while (cl2chan) {
#line 364
      c = Channel_GetClient(cl2chan);
#line 365
      if (! Remote) {
#line 367
        __cil_tmp___0 = Client_Conn(c);
#line 367
        if (__cil_tmp___0 <= -1) {
#line 367
          c = (CLIENT *)((void *)0);
        } else {
#line 368
          __cil_tmp = Client_Type(c);
#line 368
          if (__cil_tmp == 32) {
#line 368
            c = (CLIENT *)((void *)0);
          }
        }
      }
#line 370
      if (c) {
#line 370
        c = Client_NextHop(c);
      }
#line 372
      if (c) {
#line 372
        if ((unsigned int )c != (unsigned int )Client) {
#line 375
          conn = Client_Conn(c);
#line 376
          __cil_tmp___1 = Client_Type(c);
#line 376
          if (__cil_tmp___1 == 32) {
#line 376
            Conn_SetFlag(conn, 2);
          } else {
#line 377
            Conn_SetFlag(conn, 1);
          }
        }
      }
#line 379
      cl2chan = Channel_NextMember(chan, cl2chan);
    }
#line 383
    chan_cl2chan = Channel_NextChannelOf(Client, chan_cl2chan);
  }
#line 387
  conn = Conn_First();
#line 388
  while (conn != -1) {
#line 391
    __cil_tmp___5 = Conn_Flag(conn);
#line 391
    if (__cil_tmp___5 == 2) {
#line 391
      __cil_tmp___2 = Client_ID(Prefix);
#line 391
      ok = Conn_WriteStr(conn, (char *)":%s %s", __cil_tmp___2, buffer);
    } else {
#line 392
      __cil_tmp___4 = Conn_Flag(conn);
#line 392
      if (__cil_tmp___4 == 1) {
#line 392
        __cil_tmp___3 = Client_Mask(Prefix);
#line 392
        ok = Conn_WriteStr(conn, (char *)":%s %s", __cil_tmp___3, buffer);
      }
    }
#line 393
    if (! ok) {
#line 393
      break;
    }
#line 396
    conn = Conn_Next(conn);
  }
#line 398
  return (ok);
}
}
#line 402 "irc-write.c"
void IRC_SetPenalty(CLIENT *Client , time_t Seconds ) 
{ CONN_ID c ;
  int __cil_tmp ;

  {
#line 410
  __cil_tmp = Client_Type(Client);
#line 410
  if (__cil_tmp == 32) {
#line 410
    return;
  }
#line 412
  c = Client_Conn(Client);
#line 413
  if (c > -1) {
#line 414
    Conn_SetPenalty(c, Seconds);
  }
#line 415
  return;
}
}
#line 418 "irc-write.c"
static char *Get_Prefix(CLIENT *Target , CLIENT *Client ) 
{ char *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 424
  __cil_tmp___1 = Client_Type(Target);
#line 424
  if (__cil_tmp___1 == 32) {
#line 424
    __cil_tmp = Client_ID(Client);
#line 424
    return (__cil_tmp);
  } else {
#line 425
    __cil_tmp___0 = Client_Mask(Client);
#line 425
    return (__cil_tmp___0);
  }
}
}
#line 1 "lists.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-iM6CGgw6.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 47 "lists.c"
char const   *Lists_GetMask(struct list_elem  const  *e ) 
{ 

  {
#line 50
  return ((char const   *)(e->mask));
}
}
#line 54 "lists.c"
struct list_elem *Lists_GetFirst(struct list_head  const  *h ) 
{ 

  {
#line 57
  return ((struct list_elem *)h->first);
}
}
#line 61 "lists.c"
struct list_elem *Lists_GetNext(struct list_elem  const  *e ) 
{ 

  {
#line 64
  return ((struct list_elem *)e->next);
}
}
#line 68 "lists.c"
int Lists_Add(struct list_head *header , char const   *Mask , int OnlyOnce ) 
{ struct list_elem *e ;
  struct list_elem *newelem ;
  int __cil_tmp ;
  void *__cil_tmp___0 ;

  {
#line 76
  __cil_tmp = Lists_CheckDupeMask((struct list_head  const  *)header, Mask);
#line 76
  if (__cil_tmp) {
#line 76
    return (1);
  }
#line 78
  e = Lists_GetFirst((struct list_head  const  *)header);
#line 80
  __cil_tmp___0 = malloc(sizeof(struct list_elem ));
#line 80
  newelem = (struct list_elem *)__cil_tmp___0;
#line 81
  if (! newelem) {
#line 82
    Log(0, "Can\'t allocate memory for new Ban/Invite entry!");
#line 83
    return (0);
  }
#line 86
  strlcpy(newelem->mask, Mask, sizeof(newelem->mask));
#line 87
  newelem->onlyonce = OnlyOnce;
#line 88
  newelem->next = e;
#line 89
  header->first = newelem;
#line 91
  LogDebug("Added \"%s\" to invite list", Mask);
#line 92
  return (1);
}
}
#line 96 "lists.c"
static void Lists_Unlink(struct list_head *header , struct list_elem *p , struct list_elem *victim ) 
{ 

  {
#line 102
  if (p) {
#line 102
    p->next = victim->next;
  } else {
#line 103
    header->first = victim->next;
  }
#line 105
  free((void *)victim);
#line 106
  return;
}
}
#line 109 "lists.c"
void Lists_Del(struct list_head *header , char const   *Mask ) 
{ struct list_elem *e ;
  struct list_elem *last ;
  struct list_elem *victim ;
  int __cil_tmp ;

  {
#line 117
  last = (struct list_elem *)((void *)0);
#line 118
  e = Lists_GetFirst((struct list_head  const  *)header);
#line 119
  while (e) {
#line 120
    __cil_tmp = strcasecmp((char const   *)(e->mask), Mask);
#line 120
    if (__cil_tmp == 0) {
#line 121
      LogDebug("Deleted \"%s\" from list", e->mask);
#line 122
      victim = e;
#line 123
      e = victim->next;
#line 124
      Lists_Unlink(header, last, victim);
#line 125
      continue;
    }
#line 127
    last = e;
#line 128
    e = e->next;
  }
#line 130
  return;
}
}
#line 133 "lists.c"
void Lists_Free(struct list_head *head ) 
{ struct list_elem *e ;
  struct list_elem *victim ;

  {
#line 140
  e = head->first;
#line 141
  head->first = (struct list_elem *)((void *)0);
#line 142
  while (e) {
#line 143
    LogDebug("Deleted \"%s\" from invite list", e->mask);
#line 144
    victim = e;
#line 145
    e = e->next;
#line 146
    free((void *)victim);
  }
#line 148
  return;
}
}
#line 151 "lists.c"
int Lists_CheckDupeMask(struct list_head  const  *h , char const   *Mask ) 
{ struct list_elem *e ;
  int __cil_tmp ;

  {
#line 155
  e = (struct list_elem *)h->first;
#line 156
  while (e) {
#line 157
    __cil_tmp = strcasecmp((char const   *)(e->mask), Mask);
#line 157
    if (__cil_tmp == 0) {
#line 158
      return (1);
    }
#line 159
    e = e->next;
  }
#line 161
  return (0);
}
}
#line 173 "lists.c"
static char TheMask[128]  ;
#line 165 "lists.c"
char *Lists_MakeMask(char *Pattern ) 
{ char *excl ;
  char *at ;

  {
#line 178
  excl = strchr((char const   *)Pattern, '!');
#line 179
  at = strchr((char const   *)Pattern, '@');
#line 181
  if (at) {
#line 181
    if ((unsigned int )at < (unsigned int )excl) {
#line 181
      excl = (char *)((void *)0);
    }
  }
#line 183
  if (! at) {
#line 183
    if (! excl) {
#line 186
      strlcpy(TheMask, (char const   *)Pattern, sizeof(TheMask) - 5UL);
#line 187
      strlcat(TheMask, "!*@*", sizeof(TheMask));
#line 188
      return (TheMask);
    }
  }
#line 191
  if (! at) {
#line 191
    if (excl) {
#line 194
      strlcpy(TheMask, (char const   *)Pattern, sizeof(TheMask) - 3UL);
#line 195
      strlcat(TheMask, "@*", sizeof(TheMask));
#line 196
      return (TheMask);
    }
  }
#line 199
  if (at) {
#line 199
    if (! excl) {
#line 202
      *at = (char )'\000';
#line 202
      at ++;
#line 203
      strlcpy(TheMask, (char const   *)Pattern, sizeof(TheMask) - 5UL);
#line 204
      strlcat(TheMask, "!*@", sizeof(TheMask));
#line 205
      strlcat(TheMask, (char const   *)at, sizeof(TheMask));
#line 206
      return (TheMask);
    }
  }
#line 210
  strlcpy(TheMask, (char const   *)Pattern, sizeof(TheMask));
#line 211
  return (TheMask);
}
}
#line 216 "lists.c"
int Lists_Check(struct list_head *header , CLIENT *Client ) 
{ struct list_elem *e ;
  struct list_elem *last ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 223
  e = header->first;
#line 224
  last = (struct list_elem *)((void *)0);
#line 226
  while (e) {
#line 227
    __cil_tmp = Client_Mask(Client);
#line 227
    __cil_tmp___0 = Match((char const   *)(e->mask), (char const   *)__cil_tmp);
#line 227
    if (__cil_tmp___0) {
#line 228
      if (e->onlyonce) {
#line 229
        LogDebug("Deleted \"%s\" from list", e->mask);
#line 230
        Lists_Unlink(header, last, e);
      }
#line 232
      return (1);
    }
#line 234
    last = e;
#line 235
    e = e->next;
  }
#line 238
  return (0);
}
}
#line 1 "log.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-s6MOVIBf.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 50 "log.h"
void Log_Init_Resolver(void) ;
#line 51
void Log_Exit_Resolver(void) ;
#line 53
void Log_Resolver(int Level , char const   *Format  , ...) ;
#line 47 "log.c"
static char Init_Txt[127]  ;
#line 48 "log.c"
static int Is_Daemon  ;
#line 55
static void Wall_ServerNotice(char *Msg ) ;
#line 58 "log.c"
void Log_Init(int Daemon_Mode ) 
{ 

  {
#line 61
  Is_Daemon = Daemon_Mode;
#line 75
  Log(5, "%s started.", NGIRCd_Version);
#line 78
  Init_Txt[0] = (char )'\000';
#line 85
  if (! Is_Daemon) {
#line 87
    if (Init_Txt[0]) {
#line 87
      strlcat(Init_Txt, ", ", sizeof(Init_Txt));
    }
#line 88
    strlcat(Init_Txt, "no-daemon-mode", sizeof(Init_Txt));
  }
#line 90
  if (NGIRCd_Passive) {
#line 92
    if (Init_Txt[0]) {
#line 92
      strlcat(Init_Txt, ", ", sizeof(Init_Txt));
    }
#line 93
    strlcat(Init_Txt, "passive-mode", sizeof(Init_Txt));
  }
#line 102
  if (Init_Txt[0]) {
#line 102
    Log(6, "Activating: %s.", Init_Txt);
  }
#line 107
  return;
}
}
#line 143 "log.c"
void Log_Exit(void) 
{ 

  {
#line 147
  if (NGIRCd_SignalRestart) {
#line 147
    Log(5, "%s done (restarting).", "ngircd");
  } else {
#line 148
    Log(5, "%s done.", "ngircd");
  }
#line 162
  return;
}
}
#line 211 "log.c"
void Log(int Level , char const   *Format  , ...) 
{ char msg[256] ;
  int snotice ;
  va_list ap ;
  pid_t __cil_tmp ;

  {
#line 228
  if (Level & 1024) {
#line 231
    snotice = 1;
#line 232
    Level &= -1025;
  } else {
#line 234
    snotice = 0;
  }
#line 239
  if (Level == 7) {
#line 239
    return;
  }
#line 244
  __builtin_va_start(ap, Format);
#line 248
  vsnprintf(msg, 256UL, Format, ap);
#line 249
  __builtin_va_end(ap);
#line 251
  if (! Is_Daemon) {
#line 254
    __cil_tmp = getpid();
#line 254
    fprintf(__stdoutp, "[%d:%d] %s\n", __cil_tmp, Level, msg);
#line 255
    fflush(__stdoutp);
  }
#line 265
  if (Level <= 2) {
#line 268
    fprintf(__stderrp, "%s\n", msg);
#line 269
    fflush(__stderrp);
  }
#line 272
  if (snotice) {
#line 275
    Wall_ServerNotice(msg);
  }
#line 277
  return;
}
}
#line 280 "log.c"
void Log_Init_Resolver(void) 
{ 

  {
#line 289
  return;
}
}
#line 292 "log.c"
void Log_Exit_Resolver(void) 
{ 

  {
#line 301
  return;
}
}
#line 305 "log.c"
void Log_Resolver(int Level , char const   *Format  , ...) 
{ char msg[256] ;
  va_list ap ;
  pid_t __cil_tmp ;

  {
#line 325
  if (Level == 7) {
#line 325
    return;
  }
#line 330
  __builtin_va_start(ap, Format);
#line 334
  vsnprintf(msg, 256UL, Format, ap);
#line 335
  __builtin_va_end(ap);
#line 337
  if (! Is_Daemon) {
#line 340
    __cil_tmp = getpid();
#line 340
    fprintf(__stdoutp, "[%d:%d] %s\n", __cil_tmp, Level, msg);
#line 341
    fflush(__stdoutp);
  }
#line 346
  return;
}
}
#line 353 "log.c"
static void Wall_ServerNotice(char *Msg ) 
{ CLIENT *c ;
  char *__cil_tmp ;
  CONN_ID __cil_tmp___0 ;
  int __cil_tmp___1 ;

  {
#line 360
  c = Client_First();
#line 361
  while (c) {
#line 362
    __cil_tmp___0 = Client_Conn(c);
#line 362
    if (__cil_tmp___0 > -1) {
#line 362
      __cil_tmp___1 = Client_HasMode(c, (char )'s');
#line 362
      if (__cil_tmp___1) {
#line 363
        __cil_tmp = Client_ID(c);
#line 363
        IRC_WriteStrClient(c, (char *)"NOTICE %s :%s%s", __cil_tmp, "", Msg);
      }
    }
#line 366
    c = Client_Next(c);
  }
#line 368
  return;
}
}
#line 1 "match.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-6qjGThEj.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 35 "match.c"
static int Matche(char const   *p , char const   *t ) ;
#line 36
static int Matche_After_Star(char const   *p , char const   *t ) ;
#line 47 "match.c"
int Match(char const   *Pattern , char const   *String ) 
{ int __cil_tmp ;

  {
#line 51
  __cil_tmp = Matche(Pattern, String);
#line 51
  if (__cil_tmp == 1) {
#line 51
    return (1);
  } else {
#line 52
    return (0);
  }
}
}
#line 56 "match.c"
static int Matche(char const   *p , char const   *t ) 
{ register char range_start ;
  register char range_end ;
  int invert ;
  int member_match ;
  int loop ;
  int __cil_tmp ;
  int __cil_tmp___0 ;

  {
#line 64
  while (*p) {
#line 67
    if (! *t) {
#line 69
      if ((int const   )*p == 42) {
#line 69
        p ++;
#line 69
        if ((int const   )*p == 0) {
#line 69
          __cil_tmp = 1;
        } else {
#line 69
          __cil_tmp = 3;
        }
      } else {
#line 69
        __cil_tmp = 3;
      }
#line 69
      return (__cil_tmp);
    }
#line 73
    switch ((int )*p) {
    case 63: 
#line 76
    break;
    case 42: 
#line 79
    __cil_tmp___0 = Matche_After_Star(p, t);
#line 79
    return (__cil_tmp___0);
    case 91: 
#line 83
    p ++;
#line 86
    invert = 0;
#line 87
    if ((int const   )*p == 33) {
#line 89
      invert = 1;
#line 90
      p ++;
    } else {
#line 87
      if ((int const   )*p == 94) {
#line 89
        invert = 1;
#line 90
        p ++;
      }
    }
#line 94
    if ((int const   )*p == 93) {
#line 94
      return (6);
    }
#line 96
    member_match = 0;
#line 97
    loop = 1;
#line 99
    while (loop) {
#line 102
      if ((int const   )*p == 93) {
#line 104
        loop = 0;
#line 105
        continue;
      }
#line 109
      if ((int const   )*p == 92) {
#line 109
        p ++;
#line 109
        range_end = (char )*p;
#line 109
        range_start = range_end;
      } else {
#line 110
        range_end = (char )*p;
#line 110
        range_start = range_end;
      }
#line 113
      if (! *p) {
#line 113
        return (6);
      }
#line 116
      p ++;
#line 116
      if ((int const   )*p == 45) {
#line 119
        p ++;
#line 119
        range_end = (char )*p;
#line 122
        if ((int )range_end == 0) {
#line 122
          return (6);
        } else {
#line 122
          if ((int )range_end == 93) {
#line 122
            return (6);
          }
        }
#line 125
        if ((int )range_end == 92) {
#line 127
          p ++;
#line 127
          range_end = (char )*p;
#line 130
          if (! range_end) {
#line 130
            return (6);
          }
        }
#line 134
        p ++;
      }
#line 139
      if ((int )range_start < (int )range_end) {
#line 141
        if ((int const   )*t >= (int const   )range_start) {
#line 141
          if ((int const   )*t <= (int const   )range_end) {
#line 143
            member_match = 1;
#line 144
            loop = 0;
          }
        }
      } else {
#line 149
        if ((int const   )*t >= (int const   )range_end) {
#line 149
          if ((int const   )*t <= (int const   )range_start) {
#line 151
            member_match = 1;
#line 152
            loop = 0;
          }
        }
      }
    }
#line 159
    if (invert) {
#line 159
      if (member_match) {
#line 159
        return (4);
      } else {
        goto _L;
      }
    } else {
      _L: /* CIL Label */ 
#line 159
      if (! invert) {
#line 159
        if (! member_match) {
#line 159
          return (4);
        }
      }
    }
#line 163
    if (member_match) {
#line 165
      while ((int const   )*p != 93) {
#line 168
        if (! *p) {
#line 168
          return (6);
        }
#line 171
        if ((int const   )*p == 92) {
#line 173
          p ++;
#line 176
          if (! *p) {
#line 176
            return (6);
          }
        }
#line 180
        p ++;
      }
    }
#line 183
    break;
    case 92: 
#line 186
    p ++;
#line 189
    if (! *p) {
#line 189
      return (6);
    }
    default: ;
#line 193
    if ((int const   )*p != (int const   )*t) {
#line 193
      return (5);
    }
    }
#line 64
    p ++;
#line 64
    t ++;
  }
#line 198
  if (*t) {
#line 198
    return (2);
  } else {
#line 199
    return (1);
  }
}
}
#line 203 "match.c"
static int Matche_After_Star(char const   *p , char const   *t ) 
{ register int nextp ;
  register int match ;
  char const   *__cil_tmp ;
  char const   *__cil_tmp___0 ;

  {
#line 206
  match = 0;
#line 209
  while (1) {
#line 209
    if (! ((int const   )*p == 63)) {
#line 209
      if (! ((int const   )*p == 42)) {
#line 209
        break;
      }
    }
#line 212
    if ((int const   )*p == 63) {
#line 215
      __cil_tmp = t;
#line 215
      t ++;
#line 215
      if (! *__cil_tmp) {
#line 215
        return (3);
      }
    }
#line 219
    p ++;
  }
#line 223
  if (! *p) {
#line 223
    return (1);
  }
#line 226
  nextp = (int )*p;
#line 227
  if (nextp == 92) {
#line 229
    nextp = (int )*(p + 1);
#line 232
    if (! nextp) {
#line 232
      return (6);
    }
  }
#line 236
  while (1) {
#line 242
    if (nextp == (int )*t) {
#line 242
      match = Matche(p, t);
    } else {
#line 242
      if (nextp == 91) {
#line 242
        match = Matche(p, t);
      }
    }
#line 245
    __cil_tmp___0 = t;
#line 245
    t ++;
#line 245
    if (! *__cil_tmp___0) {
#line 245
      match = 3;
    }
#line 236
    if (match != 1) {
#line 236
      if (match != 3) {
#line 236
        if (! (match != 6)) {
#line 236
          break;
        }
      } else {
#line 236
        break;
      }
    } else {
#line 236
      break;
    }
  }
#line 249
  return (match);
}
}
#line 1 "numeric.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-sI0AhO25.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 20 "numeric.h"
int IRC_Num_ISUPPORT(CLIENT *Client , REQUEST *Req ) ;
#line 46 "numeric.c"
static int Announce_Server(CLIENT *Client , CLIENT *Server ) 
{ CLIENT *c ;
  char *__cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  char *__cil_tmp___2 ;
  int __cil_tmp___3 ;
  CONN_ID __cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int __cil_tmp___10 ;

  {
#line 51
  __cil_tmp___4 = Client_Conn(Server);
#line 51
  if (__cil_tmp___4 > -1) {
#line 54
    __cil_tmp = Client_Info(Client);
#line 54
    __cil_tmp___0 = Client_MyToken(Client);
#line 54
    __cil_tmp___1 = Client_Hops(Client);
#line 54
    __cil_tmp___2 = Client_ID(Client);
#line 54
    __cil_tmp___3 = IRC_WriteStrClient(Server, (char *)"SERVER %s %d %d :%s", __cil_tmp___2,
                                       __cil_tmp___1 + 1, __cil_tmp___0, __cil_tmp);
#line 54
    if (! __cil_tmp___3) {
#line 58
      return (0);
    }
  }
#line 61
  __cil_tmp___5 = Client_Hops(Server);
#line 61
  if (__cil_tmp___5 == 1) {
#line 62
    c = Client_ThisServer();
  } else {
#line 64
    c = Client_Introducer(Server);
  }
#line 67
  __cil_tmp___6 = Client_Info(Server);
#line 67
  __cil_tmp___7 = Client_MyToken(Server);
#line 67
  __cil_tmp___8 = Client_Hops(Server);
#line 67
  __cil_tmp___9 = Client_ID(Server);
#line 67
  __cil_tmp___10 = IRC_WriteStrClientPrefix(Client, c, (char *)"SERVER %s %d %d :%s",
                                            __cil_tmp___9, __cil_tmp___8 + 1, __cil_tmp___7,
                                            __cil_tmp___6);
#line 67
  return (__cil_tmp___10);
}
}
#line 78 "numeric.c"
static int Announce_User(CLIENT *Client , CLIENT *User ) 
{ char *__cil_tmp ;
  char *__cil_tmp___0 ;
  CLIENT *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;

  {
#line 81
  __cil_tmp = Client_Info(User);
#line 81
  __cil_tmp___0 = Client_Modes(User);
#line 81
  __cil_tmp___1 = Client_Introducer(User);
#line 81
  __cil_tmp___2 = Client_MyToken(__cil_tmp___1);
#line 81
  __cil_tmp___3 = Client_Hostname(User);
#line 81
  __cil_tmp___4 = Client_User(User);
#line 81
  __cil_tmp___5 = Client_Hops(User);
#line 81
  __cil_tmp___6 = Client_ID(User);
#line 81
  __cil_tmp___7 = IRC_WriteStrClient(Client, (char *)"NICK %s %d %s %s %d +%s :%s",
                                     __cil_tmp___6, __cil_tmp___5 + 1, __cil_tmp___4,
                                     __cil_tmp___3, __cil_tmp___2, __cil_tmp___0,
                                     __cil_tmp);
#line 81
  return (__cil_tmp___7);
}
}
#line 94 "numeric.c"
static int Synchronize_Lists(CLIENT *Client ) 
{ CHANNEL *c ;
  struct list_head *head ;
  struct list_elem *elem ;
  char const   *__cil_tmp ;
  char const   *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  char const   *__cil_tmp___2 ;
  char const   *__cil_tmp___3 ;
  int __cil_tmp___4 ;

  {
#line 103
  c = Channel_First();
#line 104
  while (c) {
#line 106
    head = Channel_GetListBans(c);
#line 107
    elem = Lists_GetFirst((struct list_head  const  *)head);
#line 108
    while (elem) {
#line 109
      __cil_tmp = Lists_GetMask((struct list_elem  const  *)elem);
#line 109
      __cil_tmp___0 = Channel_Name((CHANNEL const   *)c);
#line 109
      __cil_tmp___1 = IRC_WriteStrClient(Client, (char *)"MODE %s +b %s", __cil_tmp___0,
                                         __cil_tmp);
#line 109
      if (! __cil_tmp___1) {
#line 112
        return (0);
      }
#line 114
      elem = Lists_GetNext((struct list_elem  const  *)elem);
    }
#line 118
    head = Channel_GetListInvites(c);
#line 119
    elem = Lists_GetFirst((struct list_head  const  *)head);
#line 120
    while (elem) {
#line 121
      __cil_tmp___2 = Lists_GetMask((struct list_elem  const  *)elem);
#line 121
      __cil_tmp___3 = Channel_Name((CHANNEL const   *)c);
#line 121
      __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"MODE %s +I %s", __cil_tmp___3,
                                         __cil_tmp___2);
#line 121
      if (! __cil_tmp___4) {
#line 124
        return (0);
      }
#line 126
      elem = Lists_GetNext((struct list_elem  const  *)elem);
    }
#line 129
    c = Channel_Next(c);
  }
#line 131
  return (1);
}
}
#line 140 "numeric.c"
static int Send_CHANINFO(CLIENT *Client , CHANNEL *Chan ) 
{ char *modes ;
  char *topic ;
  int has_k ;
  int has_l ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  char const   *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  char const   *__cil_tmp___3 ;
  int __cil_tmp___4 ;
  unsigned long __cil_tmp___6 ;
  char const   *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  char const   *__cil_tmp___10 ;
  int __cil_tmp___11 ;

  {
#line 150
  modes = Channel_Modes(Chan);
#line 151
  topic = Channel_Topic(Chan);
#line 153
  if (! *modes) {
#line 153
    if (! *topic) {
#line 154
      return (1);
    }
  }
#line 156
  __cil_tmp = strchr((char const   *)modes, 'k');
#line 156
  has_k = (unsigned int )__cil_tmp != (unsigned int )((void *)0);
#line 157
  __cil_tmp___0 = strchr((char const   *)modes, 'l');
#line 157
  has_l = (unsigned int )__cil_tmp___0 != (unsigned int )((void *)0);
#line 160
  if (! has_k) {
#line 160
    if (! has_l) {
#line 161
      if (! *topic) {
#line 163
        __cil_tmp___1 = Channel_Name((CHANNEL const   *)Chan);
#line 163
        __cil_tmp___2 = IRC_WriteStrClient(Client, (char *)"CHANINFO %s +%s", __cil_tmp___1,
                                           modes);
#line 163
        return (__cil_tmp___2);
      }
#line 167
      __cil_tmp___3 = Channel_Name((CHANNEL const   *)Chan);
#line 167
      __cil_tmp___4 = IRC_WriteStrClient(Client, (char *)"CHANINFO %s +%s :%s", __cil_tmp___3,
                                         modes, topic);
#line 167
      return (__cil_tmp___4);
    }
  }
#line 171
  if (has_l) {
#line 171
    __cil_tmp___6 = Channel_MaxUsers(Chan);
  } else {
#line 171
    __cil_tmp___6 = 0UL;
  }
#line 171
  if (has_k) {
#line 171
    __cil_tmp___9 = Channel_Key(Chan);
#line 171
    __cil_tmp___8 = (char const   *)__cil_tmp___9;
  } else {
#line 171
    __cil_tmp___8 = "*";
  }
#line 171
  __cil_tmp___10 = Channel_Name((CHANNEL const   *)Chan);
#line 171
  __cil_tmp___11 = IRC_WriteStrClient(Client, (char *)"CHANINFO %s +%s %s %lu :%s",
                                      __cil_tmp___10, modes, __cil_tmp___8, __cil_tmp___6,
                                      topic);
#line 171
  return (__cil_tmp___11);
}
}
#line 185 "numeric.c"
int IRC_Num_ENDOFMOTD(CLIENT *Client , REQUEST *Req  __attribute__((__unused__)) ) 
{ char str[256] ;
  int max_hops ;
  int i ;
  CLIENT *c ;
  CLIENT *cl ;
  CHANNEL *chan ;
  CL2CHAN *cl2chan ;
  CONN_ID __cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  CLIENT *__cil_tmp___4 ;
  int __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  int __cil_tmp___8 ;
  char *__cil_tmp___9 ;
  char *__cil_tmp___10 ;
  char const   *__cil_tmp___11 ;
  size_t __cil_tmp___12 ;
  char *__cil_tmp___13 ;
  char *__cil_tmp___14 ;
  char *__cil_tmp___15 ;
  char *__cil_tmp___16 ;
  char *__cil_tmp___17 ;
  int __cil_tmp___18 ;
  char const   *__cil_tmp___19 ;
  size_t __cil_tmp___20 ;
  int __cil_tmp___21 ;
  size_t __cil_tmp___22 ;
  int __cil_tmp___23 ;
  char *__cil_tmp___24 ;
  char *__cil_tmp___25 ;

  {
#line 194
  Client_SetType(Client, 32);
#line 196
  __cil_tmp = Client_Conn(Client);
#line 196
  __cil_tmp___0 = Client_ID(Client);
#line 196
  Log(1029, "Server \"%s\" registered (connection %d, 1 hop - direct link).", __cil_tmp___0,
      __cil_tmp);
#line 201
  max_hops = 0;
#line 202
  c = Client_First();
#line 203
  while (c) {
#line 204
    __cil_tmp___1 = Client_Hops(c);
#line 204
    if (__cil_tmp___1 > max_hops) {
#line 205
      max_hops = Client_Hops(c);
    }
#line 206
    c = Client_Next(c);
  }
#line 213
  i = 0;
#line 213
  while (i < max_hops + 1) {
#line 214
    c = Client_First();
#line 214
    while ((unsigned int )c != (unsigned int )((void *)0)) {
#line 215
      __cil_tmp___2 = Client_Type(c);
#line 215
      if (__cil_tmp___2 != 32) {
        goto __Cont;
      }
#line 217
      __cil_tmp___3 = Client_Hops(c);
#line 217
      if (__cil_tmp___3 != i) {
        goto __Cont;
      }
#line 219
      if ((unsigned int )c == (unsigned int )Client) {
        goto __Cont;
      } else {
#line 219
        __cil_tmp___4 = Client_ThisServer();
#line 219
        if ((unsigned int )c == (unsigned int )__cil_tmp___4) {
          goto __Cont;
        }
      }
#line 222
      __cil_tmp___5 = Announce_Server(Client, c);
#line 222
      if (! __cil_tmp___5) {
#line 223
        return (0);
      }
      __Cont: /* CIL Label */ 
#line 214
      c = Client_Next(c);
    }
#line 213
    i ++;
  }
#line 228
  c = Client_First();
#line 229
  while (c) {
#line 230
    __cil_tmp___7 = Client_Type(c);
#line 230
    if (__cil_tmp___7 == 16) {
#line 231
      __cil_tmp___6 = Announce_User(Client, c);
#line 231
      if (! __cil_tmp___6) {
#line 232
        return (0);
      }
    }
#line 234
    c = Client_Next(c);
  }
#line 238
  chan = Channel_First();
#line 239
  while (chan) {
#line 242
    __cil_tmp___9 = Client_Flags(Client);
#line 242
    __cil_tmp___10 = strchr((char const   *)__cil_tmp___9, 'C');
#line 242
    if (__cil_tmp___10) {
#line 243
      __cil_tmp___8 = Send_CHANINFO(Client, chan);
#line 243
      if (! __cil_tmp___8) {
#line 244
        return (0);
      }
    }
#line 249
    cl2chan = Channel_FirstMember(chan);
#line 250
    __cil_tmp___11 = Channel_Name((CHANNEL const   *)chan);
#line 250
    snprintf(str, sizeof(str), "NJOIN %s :", __cil_tmp___11);
#line 251
    while (cl2chan) {
#line 252
      cl = Channel_GetClient(cl2chan);
#line 256
      __cil_tmp___12 = strlen((char const   *)(str));
#line 256
      if ((int )str[__cil_tmp___12 - 1UL] != 58) {
#line 257
        strlcat(str, ",", sizeof(str));
      }
#line 258
      __cil_tmp___13 = Channel_UserModes(chan, cl);
#line 258
      __cil_tmp___14 = strchr((char const   *)__cil_tmp___13, 'v');
#line 258
      if (__cil_tmp___14) {
#line 259
        strlcat(str, "+", sizeof(str));
      }
#line 260
      __cil_tmp___15 = Channel_UserModes(chan, cl);
#line 260
      __cil_tmp___16 = strchr((char const   *)__cil_tmp___15, 'o');
#line 260
      if (__cil_tmp___16) {
#line 261
        strlcat(str, "@", sizeof(str));
      }
#line 262
      __cil_tmp___17 = Client_ID(cl);
#line 262
      strlcat(str, (char const   *)__cil_tmp___17, sizeof(str));
#line 265
      __cil_tmp___20 = strlen((char const   *)(str));
#line 265
      if (__cil_tmp___20 > 216UL) {
#line 266
        __cil_tmp___18 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 266
        if (! __cil_tmp___18) {
#line 267
          return (0);
        }
#line 268
        __cil_tmp___19 = Channel_Name((CHANNEL const   *)chan);
#line 268
        snprintf(str, sizeof(str), "NJOIN %s :", __cil_tmp___19);
      }
#line 272
      cl2chan = Channel_NextMember(chan, cl2chan);
    }
#line 276
    __cil_tmp___22 = strlen((char const   *)(str));
#line 276
    if ((int )str[__cil_tmp___22 - 1UL] != 58) {
#line 278
      __cil_tmp___21 = IRC_WriteStrClient(Client, (char *)"%s", str);
#line 278
      if (! __cil_tmp___21) {
#line 279
        return (0);
      }
    }
#line 283
    chan = Channel_Next(chan);
  }
#line 287
  __cil_tmp___24 = Client_Flags(Client);
#line 287
  __cil_tmp___25 = strchr((char const   *)__cil_tmp___24, 'L');
#line 287
  if (__cil_tmp___25) {
#line 288
    LogDebug("Synchronizing INVITE- and BAN-lists ...");
#line 289
    __cil_tmp___23 = Synchronize_Lists(Client);
#line 289
    if (! __cil_tmp___23) {
#line 290
      return (0);
    }
  }
#line 294
  return (1);
}
}
#line 301 "numeric.c"
int IRC_Num_ISUPPORT(CLIENT *Client , REQUEST *Req ) 
{ int i ;
  char *key ;
  char *value ;
  char *__cil_tmp ;
  long __cil_tmp___0 ;
  int __cil_tmp___1 ;
  CONN_ID __cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 307
  i = 1;
#line 307
  while (i < Req->argc - 1) {
#line 308
    key = Req->argv[i];
#line 309
    value = strchr((char const   *)key, '=');
#line 310
    if (value) {
#line 311
      __cil_tmp = value;
#line 311
      value ++;
#line 311
      *__cil_tmp = (char )'\000';
    } else {
#line 313
      value = (char *)"";
    }
#line 315
    __cil_tmp___3 = strcmp("NICKLEN", (char const   *)key);
#line 315
    if (__cil_tmp___3 == 0) {
#line 316
      __cil_tmp___0 = atol((char const   *)value);
#line 316
      if ((unsigned int )__cil_tmp___0 == Conf_MaxNickLength - 1U) {
        goto __Cont;
      }
#line 320
      __cil_tmp___1 = atoi((char const   *)value);
#line 320
      Log(3, "Peer uses incompatible nick name length (%d/%d)! Disconnecting ...",
          Conf_MaxNickLength - 1U, __cil_tmp___1);
#line 323
      __cil_tmp___2 = Client_Conn(Client);
#line 323
      Conn_Close(__cil_tmp___2, (char *)"Incompatible nick name length", (char *)((void *)0),
                 0);
#line 326
      return (0);
    }
    __Cont: /* CIL Label */ 
#line 307
    i ++;
  }
#line 330
  return (1);
}
}
#line 1 "parse.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-HxQoJC9p.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 56 "parse.c"
COMMAND My_Commands[45]  = 
#line 56 "parse.c"
  {      {(char *)"ADMIN", & IRC_ADMIN, 48, 0L, 0L, 0L}, 
        {(char *)"AWAY", & IRC_AWAY, 16, 0L, 0L, 0L}, 
        {(char *)"CONNECT", & IRC_CONNECT, 16, 0L, 0L, 0L}, 
        {(char *)"DIE", & IRC_DIE, 16, 0L, 0L, 0L}, 
        {(char *)"DISCONNECT", & IRC_DISCONNECT, 16, 0L, 0L, 0L}, 
        {(char *)"ERROR", & IRC_ERROR, 65535, 0L, 0L, 0L}, 
        {(char *)"HELP", & IRC_HELP, 16, 0L, 0L, 0L}, 
        {(char *)"INVITE", & IRC_INVITE, 48, 0L, 0L, 0L}, 
        {(char *)"ISON", & IRC_ISON, 16, 0L, 0L, 0L}, 
        {(char *)"JOIN", & IRC_JOIN, 48, 0L, 0L, 0L}, 
        {(char *)"KICK", & IRC_KICK, 48, 0L, 0L, 0L}, 
        {(char *)"KILL", & IRC_KILL, 48, 0L, 0L, 0L}, 
        {(char *)"LINKS", & IRC_LINKS, 48, 0L, 0L, 0L}, 
        {(char *)"LIST", & IRC_LIST, 48, 0L, 0L, 0L}, 
        {(char *)"LUSERS", & IRC_LUSERS, 48, 0L, 0L, 0L}, 
        {(char *)"MODE", & IRC_MODE, 48, 0L, 0L, 0L}, 
        {(char *)"MOTD", & IRC_MOTD, 48, 0L, 0L, 0L}, 
        {(char *)"NAMES", & IRC_NAMES, 48, 0L, 0L, 0L}, 
        {(char *)"NICK", & IRC_NICK, 65535, 0L, 0L, 0L}, 
        {(char *)"NJOIN", & IRC_NJOIN, 32, 0L, 0L, 0L}, 
        {(char *)"NOTICE", & IRC_NOTICE, 65535, 0L, 0L, 0L}, 
        {(char *)"OPER", & IRC_OPER, 16, 0L, 0L, 0L}, 
        {(char *)"PART", & IRC_PART, 48, 0L, 0L, 0L}, 
        {(char *)"PASS", & IRC_PASS, 65535, 0L, 0L, 0L}, 
        {(char *)"PING", & IRC_PING, 48, 0L, 0L, 0L}, 
        {(char *)"PONG", & IRC_PONG, 48, 0L, 0L, 0L}, 
        {(char *)"PRIVMSG", & IRC_PRIVMSG, 48, 0L, 0L, 0L}, 
        {(char *)"QUIT", & IRC_QUIT, 65535, 0L, 0L, 0L}, 
        {(char *)"REHASH", & IRC_REHASH, 16, 0L, 0L, 0L}, 
        {(char *)"RESTART", & IRC_RESTART, 16, 0L, 0L, 0L}, 
        {(char *)"SERVER", & IRC_SERVER, 65535, 0L, 0L, 0L}, 
        {(char *)"SQUIT", & IRC_SQUIT, 32, 0L, 0L, 0L}, 
        {(char *)"STATS", & IRC_STATS, 48, 0L, 0L, 0L}, 
        {(char *)"TIME", & IRC_TIME, 48, 0L, 0L, 0L}, 
        {(char *)"TOPIC", & IRC_TOPIC, 48, 0L, 0L, 0L}, 
        {(char *)"TRACE", & IRC_TRACE, 48, 0L, 0L, 0L}, 
        {(char *)"USER", & IRC_USER, 65535, 0L, 0L, 0L}, 
        {(char *)"USERHOST", & IRC_USERHOST, 16, 0L, 0L, 0L}, 
        {(char *)"VERSION", & IRC_VERSION, 48, 0L, 0L, 0L}, 
        {(char *)"WALLOPS", & IRC_WALLOPS, 48, 0L, 0L, 0L}, 
        {(char *)"WHO", & IRC_WHO, 16, 0L, 0L, 0L}, 
        {(char *)"WHOIS", & IRC_WHOIS, 48, 0L, 0L, 0L}, 
        {(char *)"WHOWAS", & IRC_WHOWAS, 48, 0L, 0L, 0L}, 
        {(char *)"CHANINFO", & IRC_CHANINFO, 32, 0L, 0L, 0L}, 
        {(char *)((void *)0), (int (*)(CLIENT *Client , REQUEST *Request ))((void *)0),
      0, 0L, 0L, 0L}};
#line 107 "parse.c"
NUMERIC My_Numerics[3]  = {      {5, & IRC_Num_ISUPPORT}, 
        {376, & IRC_Num_ENDOFMOTD}, 
        {0, (int (*)(CLIENT *Client , REQUEST *Request ))((void *)0)}};
#line 115
static void Init_Request(REQUEST *Req ) ;
#line 117
static int Validate_Prefix(CONN_ID Idx , REQUEST *Req , int *Closed ) ;
#line 118
static int Validate_Command(CONN_ID Idx  __attribute__((__unused__)) , REQUEST *Req  __attribute__((__unused__)) ,
                            int *Closed ) ;
#line 119
static int Validate_Args(CONN_ID Idx  __attribute__((__unused__)) , REQUEST *Req  __attribute__((__unused__)) ,
                         int *Closed ) ;
#line 121
static int Handle_Request(CONN_ID Idx , REQUEST *Req ) ;
#line 130 "parse.c"
COMMAND *Parse_GetCommandStruct(void) 
{ 

  {
#line 133
  return (My_Commands);
}
}
#line 155 "parse.c"
int Parse_Request(CONN_ID Idx , char *Request ) 
{ REQUEST req ;
  char *start ;
  char *ptr ;
  int closed ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;

  {
#line 169
  Init_Request(& req);
#line 172
  ngt_TrimStr(Request);
#line 175
  if ((int )*(Request + 0) == 58) {
#line 178
    req.prefix = Request + 1;
#line 179
    ptr = strchr((char const   *)Request, ' ');
#line 180
    if (! ptr) {
#line 182
      Log(7, "Connection %d: Parse error: prefix without command!?", Idx);
#line 183
      __cil_tmp = Conn_WriteStr(Idx, (char *)"ERROR :Prefix without command!?");
#line 183
      return (__cil_tmp);
    }
#line 185
    *ptr = (char )'\000';
#line 189
    while ((int )*(ptr + 1) == 32) {
#line 189
      ptr ++;
    }
#line 191
    start = ptr + 1;
  } else {
#line 193
    start = Request;
  }
#line 196
  ptr = strchr((char const   *)start, ' ');
#line 197
  if (ptr) {
#line 199
    *ptr = (char )'\000';
#line 203
    while ((int )*(ptr + 1) == 32) {
#line 203
      ptr ++;
    }
  }
#line 206
  req.command = start;
#line 209
  if (ptr) {
#line 212
    start = ptr + 1;
#line 213
    while (start) {
#line 216
      if ((int )*(start + 0) == 58) {
#line 218
        req.argv[req.argc] = start + 1;
#line 219
        ptr = (char *)((void *)0);
      } else {
#line 223
        req.argv[req.argc] = start;
#line 224
        ptr = strchr((char const   *)start, ' ');
#line 225
        if (ptr) {
#line 227
          *ptr = (char )'\000';
#line 231
          while ((int )*(ptr + 1) == 32) {
#line 231
            ptr ++;
          }
        }
      }
#line 236
      (req.argc) ++;
#line 238
      if ((int )*(start + 0) == 58) {
#line 238
        break;
      }
#line 239
      if (req.argc > 14) {
#line 239
        break;
      }
#line 241
      if (ptr) {
#line 241
        start = ptr + 1;
      } else {
#line 242
        start = (char *)((void *)0);
      }
    }
  }
#line 247
  __cil_tmp___0 = Validate_Prefix(Idx, & req, & closed);
#line 247
  if (! __cil_tmp___0) {
#line 247
    return (! closed);
  }
#line 248
  __cil_tmp___1 = Validate_Command(Idx, & req, & closed);
#line 248
  if (! __cil_tmp___1) {
#line 248
    return (! closed);
  }
#line 249
  __cil_tmp___2 = Validate_Args(Idx, & req, & closed);
#line 249
  if (! __cil_tmp___2) {
#line 249
    return (! closed);
  }
#line 251
  __cil_tmp___3 = Handle_Request(Idx, & req);
#line 251
  return (__cil_tmp___3);
}
}
#line 259 "parse.c"
static void Init_Request(REQUEST *Req ) 
{ int i ;
  int __cil_tmp ;

  {
#line 268
  Req->prefix = (char *)((void *)0);
#line 269
  Req->command = (char *)((void *)0);
#line 270
  i = 0;
#line 270
  while (i < 15) {
#line 270
    __cil_tmp = i;
#line 270
    i ++;
#line 270
    Req->argv[__cil_tmp] = (char *)((void *)0);
  }
#line 271
  Req->argc = 0;
#line 272
  return;
}
}
#line 275 "parse.c"
static int Validate_Prefix(CONN_ID Idx , REQUEST *Req , int *Closed ) 
{ CLIENT *client ;
  CLIENT *c ;
  int __cil_tmp ;
  int __cil_tmp___0 ;
  int __cil_tmp___1 ;
  int __cil_tmp___2 ;
  CLIENT *__cil_tmp___3 ;
  char *__cil_tmp___4 ;
  CLIENT *__cil_tmp___5 ;

  {
#line 283
  *Closed = 0;
#line 286
  if (! Req->prefix) {
#line 286
    return (1);
  }
#line 289
  client = Conn_GetClient(Idx);
#line 293
  __cil_tmp = Client_Type(client);
#line 293
  if (__cil_tmp != 16) {
#line 293
    __cil_tmp___0 = Client_Type(client);
#line 293
    if (__cil_tmp___0 != 32) {
#line 293
      __cil_tmp___1 = Client_Type(client);
#line 293
      if (__cil_tmp___1 != 64) {
#line 297
        Req->prefix = (char *)((void *)0);
#line 298
        return (1);
      }
    }
  }
#line 302
  c = Client_Search(Req->prefix);
#line 303
  if (! c) {
#line 306
    Log(3, "Invalid prefix \"%s\", client not known (connection %d, command %s)!?",
        Req->prefix, Idx, Req->command);
#line 307
    __cil_tmp___2 = Conn_WriteStr(Idx, (char *)"ERROR :Invalid prefix \"%s\", client not known!?",
                                  Req->prefix);
#line 307
    if (! __cil_tmp___2) {
#line 307
      *Closed = 1;
    }
#line 308
    return (0);
  }
#line 314
  __cil_tmp___5 = Client_NextHop(c);
#line 314
  if ((unsigned int )__cil_tmp___5 != (unsigned int )client) {
#line 318
    __cil_tmp___3 = Conn_GetClient(Idx);
#line 318
    __cil_tmp___4 = Client_Mask(__cil_tmp___3);
#line 318
    Log(3, "Spoofed prefix \"%s\" from \"%s\" (connection %d, command %s)!", Req->prefix,
        __cil_tmp___4, Idx, Req->command);
#line 319
    Conn_Close(Idx, (char *)((void *)0), (char *)"Spoofed prefix", 1);
#line 320
    *Closed = 1;
#line 321
    return (0);
  }
#line 324
  return (1);
}
}
#line 328 "parse.c"
static int Validate_Command(CONN_ID Idx  __attribute__((__unused__)) , REQUEST *Req  __attribute__((__unused__)) ,
                            int *Closed ) 
{ 

  {
#line 333
  *Closed = 0;
#line 335
  return (1);
}
}
#line 339 "parse.c"
static int Validate_Args(CONN_ID Idx  __attribute__((__unused__)) , REQUEST *Req  __attribute__((__unused__)) ,
                         int *Closed ) 
{ 

  {
#line 344
  *Closed = 0;
#line 346
  return (1);
}
}
#line 350 "parse.c"
static int Handle_Request(CONN_ID Idx , REQUEST *Req ) 
{ CLIENT *client ;
  CLIENT *target ;
  CLIENT *prefix ;
  char str[256] ;
  int result ;
  COMMAND *cmd ;
  NUMERIC *num ;
  int i ;
  int client_type ;
  char *__cil_tmp ;
  CLIENT *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  int __cil_tmp___3 ;
  int __cil_tmp___4 ;
  size_t __cil_tmp___5 ;
  int __cil_tmp___6 ;
  int __cil_tmp___7 ;
  long __cil_tmp___8 ;
  char *__cil_tmp___9 ;
  int __cil_tmp___10 ;
  int __cil_tmp___11 ;
  int __cil_tmp___12 ;
  int __cil_tmp___13 ;
  char const   *__cil_tmp___14 ;
  char const   *__cil_tmp___15 ;
  CONN_ID __cil_tmp___16 ;
  char *__cil_tmp___17 ;
  int __cil_tmp___18 ;

  {
#line 367
  client = Conn_GetClient(Idx);
#line 371
  __cil_tmp___3 = Client_Type(client);
#line 371
  if (__cil_tmp___3 == 32) {
    goto _L;
  } else {
#line 371
    __cil_tmp___4 = Client_Type(client);
#line 371
    if (__cil_tmp___4 == 128) {
      _L: /* CIL Label */ 
#line 371
      __cil_tmp___5 = strlen((char const   *)Req->command);
#line 371
      if (__cil_tmp___5 == 3UL) {
#line 371
        __cil_tmp___6 = atoi((char const   *)Req->command);
#line 371
        if (__cil_tmp___6 > 1) {
#line 377
          if (Req->argc > 0) {
#line 378
            target = Client_Search(Req->argv[0]);
          } else {
#line 380
            target = (CLIENT *)((void *)0);
          }
#line 381
          if (! target) {
#line 383
            if (Req->argc > 0) {
#line 384
              Log(4, "Unknown target for status code %s: \"%s\"", Req->command, Req->argv[0]);
            } else {
#line 388
              Log(4, "Unknown target for status code %s!", Req->command);
            }
#line 391
            return (1);
          }
#line 393
          __cil_tmp___0 = Client_ThisServer();
#line 393
          if ((unsigned int )target == (unsigned int )__cil_tmp___0) {
#line 395
            i = atoi((char const   *)Req->command);
#line 397
            num = My_Numerics;
#line 398
            while (num->numeric > 0) {
#line 399
              if (i != num->numeric) {
#line 400
                num ++;
#line 401
                continue;
              }
#line 403
              result = (*(num->function))(client, Req);
#line 404
              return (result);
            }
#line 407
            __cil_tmp = Client_ID(client);
#line 407
            LogDebug("Ignored status code %s from \"%s\".", Req->command, __cil_tmp);
#line 409
            return (1);
          }
#line 413
          if (! *(Req->prefix + 0)) {
#line 416
            __cil_tmp___1 = Client_ID(client);
#line 416
            Log(4, "Got status code %s from \"%s\" without prefix!?", Req->command,
                __cil_tmp___1);
#line 417
            return (1);
          } else {
#line 419
            prefix = Client_Search(Req->prefix);
          }
#line 420
          if (! prefix) {
#line 423
            Log(4, "Got status code %s from unknown source: \"%s\"", Req->command,
                Req->prefix);
#line 424
            return (1);
          }
#line 428
          strlcpy(str, (char const   *)Req->command, sizeof(str));
#line 429
          i = 0;
#line 429
          while (i < Req->argc) {
#line 431
            if (i < Req->argc - 1) {
#line 431
              strlcat(str, " ", sizeof(str));
            } else {
#line 432
              strlcat(str, " :", sizeof(str));
            }
#line 433
            strlcat(str, (char const   *)Req->argv[i], sizeof(str));
#line 429
            i ++;
          }
#line 435
          __cil_tmp___2 = IRC_WriteStrClientPrefix(target, prefix, (char *)"%s", str);
#line 435
          return (__cil_tmp___2);
        }
      }
    }
  }
#line 438
  cmd = My_Commands;
#line 439
  client_type = Client_Type(client);
#line 440
  while (cmd->name) {
#line 443
    __cil_tmp___7 = strcasecmp((char const   *)Req->command, (char const   *)cmd->name);
#line 443
    if (__cil_tmp___7 != 0) {
#line 445
      cmd ++;
#line 445
      continue;
    }
#line 448
    if (client_type & cmd->type) {
#line 451
      Conn_ResetWCounter();
#line 452
      result = (*(cmd->function))(client, Req);
#line 453
      __cil_tmp___8 = Conn_WCounter();
#line 453
      cmd->bytes += __cil_tmp___8;
#line 456
      if (client_type != 32) {
#line 456
        (cmd->lcount) ++;
      } else {
#line 457
        (cmd->rcount) ++;
      }
#line 459
      return (result);
    } else {
#line 464
      __cil_tmp___9 = Client_ID(client);
#line 464
      __cil_tmp___10 = IRC_WriteStrClient(client, (char *)"451 %s :Connection not registered",
                                          __cil_tmp___9);
#line 464
      return (__cil_tmp___10);
    }
  }
#line 468
  __cil_tmp___11 = Client_Type(client);
#line 468
  if (__cil_tmp___11 != 16) {
#line 468
    __cil_tmp___12 = Client_Type(client);
#line 468
    if (__cil_tmp___12 != 32) {
#line 468
      __cil_tmp___13 = Client_Type(client);
#line 468
      if (__cil_tmp___13 != 64) {
#line 471
        return (1);
      }
    }
  }
#line 474
  if (Req->prefix) {
#line 474
    __cil_tmp___14 = "";
  } else {
#line 474
    __cil_tmp___14 = " no";
  }
#line 474
  if (Req->argc == 1) {
#line 474
    __cil_tmp___15 = "parameter";
  } else {
#line 474
    __cil_tmp___15 = "parameters";
  }
#line 474
  __cil_tmp___16 = Client_Conn(client);
#line 474
  Log(7, "Connection %d: Unknown command \"%s\", %d %s,%s prefix.", __cil_tmp___16,
      Req->command, Req->argc, __cil_tmp___15, __cil_tmp___14);
#line 479
  __cil_tmp___18 = Client_Type(client);
#line 479
  if (__cil_tmp___18 != 32) {
#line 480
    __cil_tmp___17 = Client_ID(client);
#line 480
    result = IRC_WriteStrClient(client, (char *)"421 %s %s :Unknown command", __cil_tmp___17,
                                Req->command);
#line 482
    Conn_SetPenalty(Idx, 1L);
#line 483
    return (result);
  }
#line 486
  return (1);
}
}
#line 1 "rendezvous.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-W2llvntR.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 1 "resolve.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-Z5QahL7f.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 82 "/usr/include/string.h"
extern int memcmp(void const   * , void const   * , size_t  ) ;
#line 470 "/usr/include/unistd.h"
extern int pipe(int * ) ;
#line 267 "/usr/include/netdb.h"
extern struct hostent *gethostbyaddr(void const   * , socklen_t  , int  ) ;
#line 45 "resolve.c"
static void Do_ResolveAddr(struct sockaddr_in *Addr , int identsock , int w_fd ) ;
#line 46
static void Do_ResolveName(char const   *Host , int w_fd ) ;
#line 47
static int register_callback(RES_STAT *s , void (*cbfunc)(int  , short  ) ) ;
#line 53 "resolve.c"
static pid_t Resolver_fork(int *pipefds ) 
{ pid_t pid ;
  int *__cil_tmp ;
  char *__cil_tmp___0 ;
  int __cil_tmp___1 ;
  int *__cil_tmp___2 ;
  char *__cil_tmp___3 ;

  {
#line 58
  __cil_tmp___1 = pipe((int *)pipefds);
#line 58
  if (__cil_tmp___1 != 0) {
#line 59
    __cil_tmp = __error();
#line 59
    __cil_tmp___0 = strerror(*__cil_tmp);
#line 59
    Log(1, "Resolver: Can\'t create output pipe: %s!", __cil_tmp___0);
#line 60
    return (-1);
  }
#line 63
  pid = fork();
#line 64
  switch (pid) {
  case -1: 
#line 66
  __cil_tmp___2 = __error();
#line 66
  __cil_tmp___3 = strerror(*__cil_tmp___2);
#line 66
  Log(2, "Resolver: Can\'t fork: %s!", __cil_tmp___3);
#line 67
  close(*(pipefds + 0));
#line 68
  close(*(pipefds + 1));
#line 69
  return (-1);
  case 0: 
#line 71
  close(*(pipefds + 0));
#line 72
  Log_Init_Resolver();
#line 73
  return (0);
  }
#line 76
  close(*(pipefds + 1));
#line 77
  return (pid);
}
}
#line 84 "resolve.c"
int Resolve_Addr(RES_STAT *s , struct sockaddr_in *Addr , int identsock , void (*cbfunc)(int  ,
                                                                                         short  ) ) 
{ int pipefd[2] ;
  pid_t pid ;
  int __cil_tmp ;

  {
#line 93
  pid = Resolver_fork(pipefd);
#line 94
  if (pid > 0) {
#line 98
    s->pid = pid;
#line 99
    s->resolver_fd = pipefd[0];
#line 100
    __cil_tmp = register_callback(s, cbfunc);
#line 100
    return (__cil_tmp);
  } else {
#line 101
    if (pid == 0) {
#line 103
      Do_ResolveAddr(Addr, identsock, pipefd[1]);
#line 104
      Log_Exit_Resolver();
#line 105
      exit(0);
    }
  }
#line 107
  return (0);
}
}
#line 114 "resolve.c"
int Resolve_Name(RES_STAT *s , char const   *Host , void (*cbfunc)(int  , short  ) ) 
{ int pipefd[2] ;
  pid_t pid ;
  int __cil_tmp ;

  {
#line 122
  pid = Resolver_fork(pipefd);
#line 123
  if (pid > 0) {
#line 128
    s->pid = pid;
#line 129
    s->resolver_fd = pipefd[0];
#line 130
    __cil_tmp = register_callback(s, cbfunc);
#line 130
    return (__cil_tmp);
  } else {
#line 131
    if (pid == 0) {
#line 133
      Do_ResolveName(Host, pipefd[1]);
#line 134
      Log_Exit_Resolver();
#line 135
      exit(0);
    }
  }
#line 137
  return (0);
}
}
#line 141 "resolve.c"
void Resolve_Init(RES_STAT *s ) 
{ 

  {
#line 145
  s->resolver_fd = -1;
#line 146
  s->pid = 0;
#line 147
  return;
}
}
#line 150 "resolve.c"
static void Do_ResolveAddr(struct sockaddr_in *Addr , int identsock , int w_fd ) 
{ char hostname[64] ;
  char ipstr[64] ;
  struct hostent *h ;
  size_t len ;
  struct in_addr *addr ;
  char *ntoaptr ;
  array resolved_addr ;
  char *__cil_tmp ;
  char *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  int __cil_tmp___2 ;
  size_t __cil_tmp___3 ;
  char *__cil_tmp___4 ;
  int *__cil_tmp___5 ;
  char *__cil_tmp___6 ;
  int __cil_tmp___7 ;
  int *__cil_tmp___8 ;
  char *__cil_tmp___9 ;
  void *__cil_tmp___10 ;
  ssize_t __cil_tmp___11 ;

  {
#line 166
  array_init(& resolved_addr);
#line 171
  h = gethostbyaddr((void const   *)((char *)(& Addr->sin_addr)), (unsigned int )sizeof(Addr->sin_addr),
                    2);
#line 172
  if (! h) {
#line 176
    __cil_tmp = inet_ntoa(Addr->sin_addr);
#line 176
    Log_Resolver(4, "Can\'t resolve address \"%s\"!", __cil_tmp);
#line 178
    __cil_tmp___0 = inet_ntoa(Addr->sin_addr);
#line 178
    strlcpy(hostname, (char const   *)__cil_tmp___0, sizeof(hostname));
  } else {
#line 172
    __cil_tmp___3 = strlen((char const   *)h->h_name);
#line 172
    if (__cil_tmp___3 >= sizeof(hostname)) {
#line 176
      __cil_tmp = inet_ntoa(Addr->sin_addr);
#line 176
      Log_Resolver(4, "Can\'t resolve address \"%s\"!", __cil_tmp);
#line 178
      __cil_tmp___0 = inet_ntoa(Addr->sin_addr);
#line 178
      strlcpy(hostname, (char const   *)__cil_tmp___0, sizeof(hostname));
    } else {
#line 180
      strlcpy(hostname, (char const   *)h->h_name, sizeof(hostname));
#line 182
      h = gethostbyname((char const   *)(hostname));
#line 183
      if (h) {
#line 184
        __cil_tmp___2 = memcmp((void const   *)*(h->h_addr_list + 0), (void const   *)(& Addr->sin_addr),
                               sizeof(struct in_addr ));
#line 184
        if (__cil_tmp___2) {
#line 185
          addr = (struct in_addr *)*(h->h_addr_list + 0);
#line 186
          __cil_tmp___1 = inet_ntoa(*addr);
#line 186
          strlcpy(ipstr, (char const   *)__cil_tmp___1, sizeof(ipstr));
#line 187
          ntoaptr = inet_ntoa(Addr->sin_addr);
#line 188
          Log(4, "Possible forgery: %s resolved to %s (which is at ip %s!)", ntoaptr,
              hostname, ipstr);
#line 190
          strlcpy(hostname, (char const   *)ntoaptr, sizeof(hostname));
        }
      } else {
#line 193
        ntoaptr = inet_ntoa(Addr->sin_addr);
#line 194
        Log(4, "Possible forgery: %s resolved to %s (which has no ip address)", ntoaptr,
            hostname);
#line 196
        strlcpy(hostname, (char const   *)ntoaptr, sizeof(hostname));
      }
    }
  }
#line 199
  __cil_tmp___4 = inet_ntoa(Addr->sin_addr);
#line 199
  Log_Resolver(7, "Ok, translated %s to \"%s\".", __cil_tmp___4, hostname);
#line 201
  len = strlen((char const   *)(hostname));
#line 202
  hostname[len] = (char )'\n';
#line 202
  len ++;
#line 203
  __cil_tmp___7 = array_copyb(& resolved_addr, (char const   *)(hostname), len);
#line 203
  if (! __cil_tmp___7) {
#line 204
    __cil_tmp___5 = __error();
#line 204
    __cil_tmp___6 = strerror(*__cil_tmp___5);
#line 204
    Log_Resolver(2, "Resolver: Can\'t copy resolved name: %s!", __cil_tmp___6);
#line 205
    close(w_fd);
#line 206
    return;
  }
#line 231
  len = resolved_addr.used;
#line 232
  __cil_tmp___10 = array_start((array const   *)(& resolved_addr));
#line 232
  __cil_tmp___11 = write(w_fd, (void const   *)__cil_tmp___10, len);
#line 232
  if ((unsigned long )__cil_tmp___11 != len) {
#line 233
    __cil_tmp___8 = __error();
#line 233
    __cil_tmp___9 = strerror(*__cil_tmp___8);
#line 233
    Log_Resolver(2, "Resolver: Can\'t write result to parent: %s!", __cil_tmp___9);
  }
#line 235
  close(w_fd);
#line 236
  array_free(& resolved_addr);
#line 237
  return;
}
}
#line 240 "resolve.c"
static void Do_ResolveName(char const   *Host , int w_fd ) 
{ char ip[16] ;
  struct hostent *h ;
  struct in_addr *addr ;
  size_t len ;
  char *__cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;
  ssize_t __cil_tmp___2 ;

  {
#line 251
  Log_Resolver(7, "Now resolving \"%s\" ...", Host);
#line 254
  h = gethostbyname(Host);
#line 255
  if (h) {
#line 256
    addr = (struct in_addr *)*(h->h_addr_list + 0);
#line 257
    __cil_tmp = inet_ntoa(*addr);
#line 257
    strlcpy(ip, (char const   *)__cil_tmp, sizeof(ip));
  } else {
#line 262
    Log_Resolver(4, "Can\'t resolve \"%s\"!", Host);
#line 264
    close(w_fd);
#line 265
    return;
  }
#line 271
  len = strlen((char const   *)(ip));
#line 272
  __cil_tmp___2 = write(w_fd, (void const   *)(ip), len);
#line 272
  if ((unsigned long )__cil_tmp___2 != len) {
#line 273
    __cil_tmp___0 = __error();
#line 273
    __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 273
    Log_Resolver(2, "Resolver: Can\'t write to parent: %s!", __cil_tmp___1);
#line 274
    close(w_fd);
  }
#line 276
  return;
}
}
#line 304 "resolve.c"
static int register_callback(RES_STAT *s , void (*cbfunc)(int  , short  ) ) 
{ int __cil_tmp ;
  int __cil_tmp___0 ;
  int *__cil_tmp___1 ;
  char *__cil_tmp___2 ;

  {
#line 311
  __cil_tmp = io_setnonblock(s->resolver_fd);
#line 311
  if (__cil_tmp) {
#line 311
    __cil_tmp___0 = io_event_create(s->resolver_fd, (short)1, cbfunc);
#line 311
    if (__cil_tmp___0) {
#line 313
      return (1);
    }
  }
#line 315
  __cil_tmp___1 = __error();
#line 315
  __cil_tmp___2 = strerror(*__cil_tmp___1);
#line 315
  Log(2, "Resolver: Could not register callback function: %s!", __cil_tmp___2);
#line 316
  close(s->resolver_fd);
#line 317
  Resolve_Init(s);
#line 318
  return (0);
}
}
#line 322 "resolve.c"
int Resolve_Shutdown(RES_STAT *s ) 
{ int ret ;

  {
#line 325
  ret = 0;
#line 330
  if (s->resolver_fd >= 0) {
#line 331
    ret = io_close(s->resolver_fd);
  }
#line 333
  Resolve_Init(s);
#line 334
  return (ret);
}
}
#line 341 "resolve.c"
size_t Resolve_Read(RES_STAT *s , void *readbuf , size_t buflen ) 
{ ssize_t bytes_read ;
  int *__cil_tmp ;
  int *__cil_tmp___0 ;
  char *__cil_tmp___1 ;

  {
#line 349
  bytes_read = read(s->resolver_fd, readbuf, buflen);
#line 350
  if (bytes_read < 0L) {
#line 351
    __cil_tmp = __error();
#line 351
    if (*__cil_tmp == 35) {
#line 352
      return (0UL);
    }
#line 354
    __cil_tmp___0 = __error();
#line 354
    __cil_tmp___1 = strerror(*__cil_tmp___0);
#line 354
    Log(2, "Resolver: Can\'t read result: %s!", __cil_tmp___1);
#line 355
    bytes_read = 0L;
  }
#line 361
  Resolve_Shutdown(s);
#line 362
  return ((unsigned long )bytes_read);
}
}
#line 1 "strlcpy.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-AjPxDTmO.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 1 "strdup.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-VAdc5yzJ.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 1 "vsnprintf.o"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-a3OEhnCE.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 101 "vsnprintf.c"
void dummy_snprintf(void) ;
#line 102 "vsnprintf.c"
void dummy_snprintf(void) 
{ 

  {
#line 102
  return;
}
}
#line 1 "libngtool.a"
#pragma merger(0,"/var/folders/4u/4unNC1vxGsycmylQ4BTTVk+++TI/-Tmp-/cil-5w1asGe8.i","-fno-builtin,-g,-O2,-pipe,-W,-Wall,-Wpointer-arith,-Wstrict-prototypes,-fstack-protector")
#line 206 "/usr/include/ctype.h"
extern __darwin_ct_rune_t __tolower(__darwin_ct_rune_t  ) ;
#line 308 "/usr/include/ctype.h"
__inline static int tolower(int _c ) 
{ __darwin_ct_rune_t __cil_tmp ;

  {
#line 311
  __cil_tmp = __tolower(_c);
#line 311
  return (__cil_tmp);
}
}
#line 104 "/usr/include/arpa/inet.h"
extern int inet_aton(char const   * , struct in_addr * ) ;
#line 35 "tool.c"
void ngt_TrimStr(char *String ) 
{ char *start ;
  char *end ;

  {
#line 42
  start = String;
#line 45
  while (1) {
#line 45
    if (! ((int )*start == 32)) {
#line 45
      if (! ((int )*start == 9)) {
#line 45
        if (! ((int )*start == 10)) {
#line 45
          if (! ((int )*start == 13)) {
#line 45
            break;
          }
        }
      }
    }
#line 47
    start ++;
  }
#line 49
  if (! *start) {
#line 50
    *String = (char )'\000';
#line 51
    return;
  }
#line 55
  end = strchr((char const   *)start, '\000');
#line 56
  end --;
#line 57
  while (1) {
#line 57
    if ((int )*end == 32) {
      goto _L;
    } else {
#line 57
      if ((int )*end == 9) {
        goto _L;
      } else {
#line 57
        if ((int )*end == 10) {
          goto _L;
        } else {
#line 57
          if ((int )*end == 13) {
            _L: /* CIL Label */ 
#line 57
            if (! ((unsigned int )end >= (unsigned int )start)) {
#line 57
              break;
            }
          } else {
#line 57
            break;
          }
        }
      }
    }
#line 59
    end --;
  }
#line 62
  end ++;
#line 62
  *end = (char )'\000';
#line 64
  memmove((void *)String, (void const   *)start, (unsigned long )(end - start) + 1UL);
#line 65
  return;
}
}
#line 68 "tool.c"
char *ngt_LowerStr(char *String ) 
{ char *ptr ;
  int __cil_tmp ;

  {
#line 80
  ptr = String;
#line 81
  while (*ptr) {
#line 83
    __cil_tmp = tolower((int )*ptr);
#line 83
    *ptr = (char )__cil_tmp;
#line 84
    ptr ++;
  }
#line 87
  return (String);
}
}
#line 91 "tool.c"
void ngt_TrimLastChr(char *String , char Chr ) 
{ unsigned int len ;
  size_t __cil_tmp ;

  {
#line 101
  __cil_tmp = strlen((char const   *)String);
#line 101
  len = (unsigned int )__cil_tmp;
#line 102
  if (len == 0U) {
#line 102
    return;
  }
#line 104
  len --;
#line 106
  if ((int )*(String + len) == (int )Chr) {
#line 106
    *(String + len) = (char )'\000';
  }
#line 107
  return;
}
}
#line 110 "tool.c"
int ngt_IPStrToBin(char const   *ip_str , struct in_addr *inaddr ) 
{ int __cil_tmp ;

  {
#line 115
  __cil_tmp = inet_aton(ip_str, inaddr);
#line 115
  if (__cil_tmp == 0) {
#line 116
    return (0);
  }
#line 122
  return (1);
}
}
