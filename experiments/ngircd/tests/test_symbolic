#
#  $1 = DATA_DIR
#  $2 = PROJ_DIR
#  $3 = test name
#  $4 = cov type
#
DATA_DIR=$1
PROJ_DIR=$2
TEST_NAME=$3
COVTYPE=$4

COVDIR=../codeCoverageTest
EXPDIR=../..
STATSFILE=$COVDIR/ngircd.stats

TOPDIR=../../..
LIBCDIR=$TOPDIR/libc
MOCKEDDIR=$COVDIR/mockedFns

MARSHALDIR=$DATA_DIR/marshal
mkdir -p $MARSHALDIR

MACRO="\
-DSYM_CONF_PREDEFCHANNELSONLY \
-DSYM_CONF_CONNECTRETRY \
-DSYM_CONF_UID \
-DSYM_CONF_GID \
-DSYM_CONF_OPERCANMODE \
-DSYM_CONF_NODNS \
-DSYM_CONF_LISTENIPV4 \
-DSYM_CONF_OPERSERVERMODE \
-DSYM_CONF_MAXJOINS \
-DSYM_CONF_MAXCONNECTIONSIP \
-DSYM_CONF_MAXNICKLENGTH \
-DSYM_CONF_PINGTIMEOUT \
-DSYM_CONF_PONGTIMEOUT"


echo \#BEGIN TEST_SYMBOLIC TEST_NAME=$TEST_NAME COVTYPE=\"$COVTYPE\" MACRO=\"$MACRO\"
date

CILLY_DONT_COMPILE_AFTER_MERGE= \
$TOPDIR/cil/bin/cilly \
	--merge \
	$MACRO \
	--useLogicalOperators \
	-D_FILE_OFFSET_BITS=64 \
	-U __OPTIMIZE__ \
	-I $MOCKEDDIR \
	--doexecute \
	--disallowDuplication \
	--printLittle \
	--printNoEscapedString \
	--covStats=$STATSFILE \
	$COVTYPE \
	--timeout=40000 \
	--marshalCoverageTo=$MARSHALDIR/$TEST_NAME.marshal \
	$PROJ_DIR \
	$COVDIR/otherFiles/$TEST_NAME.c

echo \#DONE TEST_SYMBOLIC TEST_NAME=$TEST_NAME COVTYPE=\"$COVTYPE\" MACRO=\"$MACRO\" 
date

#	--lineCov \
