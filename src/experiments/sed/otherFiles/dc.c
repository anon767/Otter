#include "iosim.h"
#include <stdlib.h>

void symtest_initialize() {
	IOSIM_fd[1] = malloc(sizeof(sym_file_stream_t));
	IOSIM_fd[1]->offset = 0;
	IOSIM_fd[1]->fd = 1;
	IOSIM_fd[1]->sym_file = malloc(sizeof(sym_file_t));
	IOSIM_fd[1]->sym_file->contents = NULL;
	IOSIM_fd[1]->sym_file->stat.st_size = 0;
	stdout = IOSIM_fd[1];

	sym_file_t* sed = IOSIM_addfile("dc.sed", 0);
	sed->contents = "\ns/^/|P|K0|I10|O10|?~/\n\n: next\ns/|?./|?/\ns/|?#[	 -}]*/|?/\n/|?!*[lLsS;:<>=]\\{0,1\\}$/N\n/|?!*[-+*/%^<>=]/b binop\n/^|.*|?[dpPfQXZvxkiosStT;:]/b binop\n/|?[_0-9A-F.]/b number\n/|?\\[/b string\n/|?l/b load\n/|?L/b Load\n/|?[sS]/b save\n/|?c/ s/[^|]*//\n/|?d/ s/[^~]*~/&&/\n/|?f/ s//&[pSbz0<aLb]dSaxsaLa/\n/|?x/ s/\\([^~]*~\\)\\(.*|?x\\)~*/\\2\\1/\n/|?[KIO]/ s/.*|\\([KIO]\\)\\([^|]*\\).*|?\\1/\\2~&/\n/|?T/ s/\\.*0*~/~/\n/|?;/ s/|?;\\([^{}]\\)/|?~[s}s{L{s}q]S}[S}l\\1L}1-d0>}s\\1L\\1l{xS\\1]dS{xL}/\n/|?:/ s/|?:\\([^{}]\\)/|?~[s}L{s}L{s}L}s\\1q]S}S}S{[L}1-d0>}S}l\\1s\\1L\\1l{xS\\1]dS{x/\n/|?[ ~	cdfxKIOT]/b next\n/|?\\n/b next\n/|?[pP]/b print\n/|?k/ s/^\\([0-9]\\{1,3\\}\\)\\([.~].*|K\\)[^|]*/\\2\\1/\n/|?i/ s/^\\(-\\{0,1\\}[0-9]*\\.\\{0,1\\}[0-9]\\{1,\\}\\)\\(~.*|I\\)[^|]*/\\2\\1/\n/|?o/ s/^\\(-\\{0,1\\}[1-9][0-9]*\\.\\{0,1\\}[0-9]*\\)\\(~.*|O\\)[^|]*/\\2\\1/\n/|?[kio]/b pop\n/|?t/b trunc\n/|??/b input\n/|?Q/b break\n/|?q/b quit\nh\n/|?[XZz]/b count\n/|?v/b sqrt\ns/.*|?\\([^Y]\\).*/\\1 is unimplemented/\ns/\\n/\\\\n/g\nl\ng\nb next\n\n: print\n/^-\\{0,1\\}[0-9]*\\.\\{0,1\\}[0-9]\\{1,\\}~.*|?p/!b Print\n/|O10|/b Print\n\ns,|?p,&KSa0kd[[-]Psa0la-]Sad0>a[0P]sad0=a[A*2+]saOtd0>a1-ZSd[[[[ ]P]sclb1\\\n!=cSbLdlbtZ[[[-]P0lb-sb]sclb0>c1+]sclb0!<c[0P1+dld>c]scdld>cscSdLbP]q]Sb\\\n[t[1P1-d0<c]scd0<c]ScO_1>bO1!<cO[16]<bOX0<b[[q]sc[dSbdA>c[A]sbdA=c[B]sbd\\\nB=c[C]sbdC=c[D]sbdD=c[E]sbdE=c[F]sb]xscLbP]~Sd[dtdZOZ+k1O/Tdsb[.5]*[.1]O\\\nX^*dZkdXK-1+ktsc0kdSb-[Lbdlb*lc+tdSbO*-lb0!=aldx]dsaxLbsb]sad1!>a[[.]POX\\\n+sb1[SbO*dtdldx-LbO*dZlb!<a]dsax]sadXd0<asbsasaLasbLbscLcsdLdsdLdLak[]pP,\nb next\n\n: Print\n/|?p/s/[^~]*/&\\\n~&/\ns/\\(.*|P\\)\\([^|]*\\)/\\\n\\2\\1/\ns/\\([^~]*\\)\\n\\([^~]*\\)\\(.*|P\\)/\\1\\3\\2/\nh\ns/~.*//\n/./{ s/.//; p; }\ng\n\n: pop\ns/[^~]*~//\nb next\n\n: load\ns/\\(.*|?.\\)\\(.\\)/\\20~\\1/\ns/^\\(.\\)0\\(.*|r\\1\\([^~|]*\\)~\\)/\\1\\3\\2/\ns/.//\nb next\n\n: Load\ns/\\(.*|?.\\)\\(.\\)/\\2\\1/\ns/^\\(.\\)\\(.*|r\\1\\)\\([^~|]*~\\)/|\\3\\2/\n/^|/!i\\\nregister empty\ns/.//\nb next\n\n: save\ns/\\(.*|?.\\)\\(.\\)/\\2\\1/\n/^\\(.\\).*|r\\1/ !s/\\(.\\).*|/&r\\1|/\n/|?S/ s/\\(.\\).*|r\\1/&~/\ns/\\(.\\)\\([^~]*~\\)\\(.*|r\\1\\)[^~|]*~\\{0,1\\}/\\3\\2/\nb next\n\n: quit\nt quit\ns/|?[^~]*~[^~]*~/|?q/\nt next\ns/.*|P\\([^|]*\\).*/\\1/\nq\n\n: break\ns/[0-9]*/&;987654321009;/\n: break1\ns/^\\([^;]*\\)\\([1-9]\\)\\(0*\\)\\([^1]*\\2\\(.\\)[^;]*\\3\\(9*\\).*|?.\\)[^~]*~/\\1\\5\\6\\4/\nt break1\nb pop\n\n: input\nN\ns/|??\\(.*\\)\\(\\n.*\\)/|?\\2~\\1/\nb next\n\n: count\n/|?Z/ s/~.*//\n/^-\\{0,1\\}[0-9]*\\.\\{0,1\\}[0-9]\\{1,\\}$/ s/[-.0]*\\([^.]*\\)\\.*/\\1/\n/|?X/ s/-*[0-9A-F]*\\.*\\([0-9A-F]*\\).*/\\1/\ns/|.*//\n/~/ s/[^~]//g\n\ns/./a/g\n: count1\n	s/a\\{10\\}/b/g\n	s/b*a*/&a9876543210;/\n	s/a.\\{9\\}\\(.\\).*;/\\1/\n	y/b/a/\n/a/b count1\nG\n/|?z/ s/\\n/&~/\ns/\\n[^~]*//\nb next\n\n: trunc\ns/\\([^.~]*\\.*\\)\\(.*|K\\([^|]*\\)\\)/\\3;9876543210009909:\\1,\\2/\n: trunc1\n	s/^\\([^;]*\\)\\([1-9]\\)\\(0*\\)\\([^1]*\\2\\(.\\)[^:]*X*\\3\\(9*\\)[^,]*\\),\\([0-9]\\)/\\1\\5\\6\\4\\7,/\nt trunc1\ns/[^:]*:\\([^,]*\\)[^~]*/\\1/\nb normal\n\n: number\ns/\\(.*|?\\)\\(_\\{0,1\\}[0-9A-F]*\\.\\{0,1\\}[0-9A-F]*\\)/\\2~\\1~/\ns/^_/-/\n/^[^A-F~]*~.*|I10|/b normal\n/^[-0.]*~/b normal\ns:\\([^.~]*\\)\\.*\\([^~]*\\):[Ilb^lbk/,\\1\\2~0A1B2C3D4E5F1=11223344556677889900;.\\2:\n: digit\n    s/^\\([^,]*\\),\\(-*\\)\\([0-F]\\)\\([^;]*\\(.\\)\\3[^1;]*\\(1*\\)\\)/I*+\\1\\2\\6\\5~,\\2\\4/\nt digit\ns:...\\([^/]*.\\)\\([^,]*\\)[^.]*\\(.*|?.\\):\\2\\3KSb[99]k\\1]SaSaXSbLalb0<aLakLbktLbk:\nb next\n\n: string\n/|?[^]]*$/N\ns/\\(|?[^]]*\\)\\[\\([^]]*\\)]/\\1|{\\2|}/\n/|?\\[/b string\ns/\\(.*|?\\)|{\\(.*\\)|}/\\2~\\1[/\ns/|{/[/g\ns/|}/]/g\nb next\n\n: binop\n/^[^~|]*~[^|]/ !i\\\nstack empty\n//!b next\n/^-\\{0,1\\}[0-9]*\\.\\{0,1\\}[0-9]\\{1,\\}~/ !s/[^~]*\\(.*|?!*[^!=<>]\\)/0\\1/\n/^[^~]*~-\\{0,1\\}[0-9]*\\.\\{0,1\\}[0-9]\\{1,\\}~/ !s/~[^~]*\\(.*|?!*[^!=<>]\\)/~0\\1/\nh\n/|?\\*/b mul\n/|?\\//b div\n/|?%/b rem\n/|?^/b exp\n\n/|?[+-]/ s/^\\(-*\\)\\([^~]*~\\)\\(-*\\)\\([^~]*~\\).*|?\\(-\\{0,1\\}\\).*/\\2\\4s\\3o\\1\\3\\5/\ns/\\([^.~]*\\)\\([^~]*~[^.~]*\\)\\(.*\\)/<\\1,\\2,\\3|=-~.0,123456789<></\n/^<\\([^,]*,[^~]*\\)\\.*0*~\\1\\.*0*~/ s/</=/\n: cmp1\n	s/^\\(<[^,]*\\)\\([0-9]\\),\\([^,]*\\)\\([0-9]\\),/\\1,\\2\\3,\\4/\nt cmp1\n/^<\\([^~]*\\)\\([^~]\\)[^~]*~\\1\\(.\\).*|=.*\\3.*\\2/ s/</>/\n/|?/{\n	s/^\\([<>]\\)\\(-[^~]*~-.*\\1\\)\\(.\\)/\\3\\2/\n	s/^\\(.\\)\\(.*|?!*\\)\\1/\\2!\\1/\n	s/|?![^!]\\(.\\)/&l\\1x/\n	s/[^~]*~[^~]*~\\(.*|?\\)!*.\\(.*\\)|=.*/\\1\\2/\n	b next\n}\ns/\\(-*\\)\\1|=.*/;9876543210;9876543210/\n/o-/ s/;9876543210/;0123456789/\ns/^>\\([^~]*~\\)\\([^~]*~\\)s\\(-*\\)\\(-*o\\3\\(-*\\)\\)/>\\2\\1s\\5\\4/\n\ns/,\\([0-9]*\\)\\.*\\([^,]*\\),\\([0-9]*\\)\\.*\\([0-9]*\\)/\\1,\\2\\3.,\\4;0/\n: right1\n	s/,\\([0-9]\\)\\([^,]*\\),;*\\([0-9]\\)\\([0-9]*\\);*0*/\\1,\\2\\3,\\4;0/\nt right1\ns/.\\([^,]*\\),~\\(.*\\);0~s\\(-*\\)o-*/\\1~\\30\\2~/\n\n: addsub1\n	s/\\(.\\{0,1\\}\\)\\(~[^,]*\\)\\([0-9]\\)\\(\\.*\\),\\([^;]*\\)\\(;\\([^;]*\\(\\3[^;]*\\)\\).*X*\\1\\(.*\\)\\)/\\2,\\4\\5\\9\\8\\7\\6/\n	s/,\\([^~]*~\\).\\{10\\}\\(.\\)[^;]\\{0,9\\}\\([^;]\\{0,1\\}\\)[^;]*/,\\2\\1\\3/\n/^~.*~;/!b addsub1\n\n: endbin\ns/.\\([^,]*\\),\\([0-9.]*\\).*/\\1\\2/\nG\ns/\\n[^~]*~[^~]*//\n\n: normal\ns/^\\(-*\\)0*\\([0-9.]*[0-9]\\)[^~]*/\\1\\2/\ns/^[^1-9~]*~/0~/\nb next\n\n: mul\ns/\\(-*\\)\\([0-9]*\\)\\.*\\([0-9]*\\)~\\(-*\\)\\([0-9]*\\)\\.*\\([0-9]*\\).*|K\\([^|]*\\).*/\\1\\4\\2\\5.!\\3\\6,|\\2<\\3~\\5>\\6:\\7;9876543210009909/\n\n: mul1\n    s/![0-9]\\([^<]*\\)<\\([0-9]\\{0,1\\}\\)\\([^>]*\\)>\\([0-9]\\{0,1\\}\\)/0!\\1\\2<\\3\\4>/\n    /![0-9]/ s/\\(:[^;]*\\)\\([1-9]\\)\\(0*\\)\\([^0]*\\2\\(.\\).*X*\\3\\(9*\\)\\)/\\1\\5\\6\\4/\n/<~[^>]*>:0*;/!t mul1\n\ns/\\(-*\\)\\1\\([^>]*\\).*/;\\2^>:9876543210aaaaaaaaa/\n\n: mul2\n    s/\\([0-9]~*\\)^/^\\1/\n    s/<\\([0-9]*\\)\\(.*[~^]\\)\\([0-9]*\\)>/\\1<\\2>\\3/\n\n    : mul3\n	s/>\\([0-9]\\)\\(.*\\1.\\{9\\}\\(a*\\)\\)/\\1>\\2;9\\38\\37\\36\\35\\34\\33\\32\\31\\30/\n	s/\\(;[^<]*\\)\\([0-9]\\)<\\([^;]*\\).*\\2[0-9]*\\(.*\\)/\\4\\1<\\2\\3/\n	s/a[0-9]/a/g\n	s/a\\{10\\}/b/g\n	s/b\\{10\\}/c/g\n    /|0*[1-9][^>]*>0*[1-9]/b mul3\n\n    s/;/a9876543210;/\n    s/a.\\{9\\}\\(.\\)[^;]*\\([^,]*\\)[0-9]\\([.!]*\\),/\\2,\\1\\3/\n    y/cb/ba/\n/|<^/!b mul2\nb endbin\n\n: div\n/^[-.0]*[1-9]/ !i\\\ndivide by 0\n//!b pop\ns/\\(-*\\)\\([0-9]*\\)\\.*\\([^~]*~-*\\)\\([0-9]*\\)\\.*\\([^~]*\\)/\\2.\\3\\1;0\\4.\\5;0/\n: div1\n	s/^\\.0\\([^.]*\\)\\.;*\\([0-9]\\)\\([0-9]*\\);*0*/.\\1\\2.\\3;0/\n	s/^\\([^.]*\\)\\([0-9]\\)\\.\\([^;]*;\\)0*\\([0-9]*\\)\\([0-9]\\)\\./\\1.\\2\\30\\4.\\5/\nt div1\ns/~\\(-*\\)\\1\\(-*\\);0*\\([^;]*[0-9]\\)[^~]*/~123456789743222111~\\2\\3/\ns/\\(.\\(.\\)[^~]*\\)[^9]*\\2.\\{8\\}\\(.\\)[^~]*/\\3~\\1/\ns,|?.,&SaSadSaKdlaZ+LaX-1+[sb1]Sbd1>bkLatsbLa[dSa2lbla*-*dLa!=a]dSaxsakLasbLb*t,\nb next\n\n: rem\ns,|?%,&Sadla/LaKSa[999]k*Lak-,\nb next\n\n: exp\n/^[^~]*\\./i\\\nfraction in exponent ignored\ns,[^-0-9].*,;9d**dd*8*d*d7dd**d*6d**d5d*d*4*d3d*2lbd**1lb*0,\n: exp1\n	s/\\([0-9]\\);\\(.*\\1\\([d*]*\\)[^l]*\\([^*]*\\)\\(\\**\\)\\)/;dd*d**d*\\4\\3\\5\\2/\nt exp1\nG\ns,-*.\\{9\\}\\([^9]*\\)[^0]*0.\\(.*|?.\\),\\2~saSaKdsaLb0kLbkK*+k1\\1LaktsbkLax,\ns,|?.,&SadSbdXSaZla-SbKLaLadSb[0Lb-d1lb-*d+K+0kkSb[1Lb/]q]Sa0>a[dk]sadK<a[Lb],\nb next\n\n: sqrt\n/^-/i\\\nsquare root of negative number\n/^[-0]/b next\ns/~.*//\n/^\\./ s/0\\([0-9]\\)/\\1/g\n/^\\./ !s/[0-9][0-9]/7/g\nG\ns/\\n/~/\ns,|?.,&K1+k KSbSb[dk]SadXdK<asadlb/lb+[.5]*[sbdlb/lb+[.5]*dlb>a]dsaxsasaLbsaLatLbk K1-kt,\nb next\n";
	sed->stat.st_size = 6456;

	sym_file_t* input = IOSIM_addfile("dc.inp", 0);
	input->contents = "\n2002\n\n[ddsf[lfp[too early\n]Pq]s@1583>@\nddd19%1+sg100/1+d3*4/12-sx8*5+25/5-sz5*4/lx-10-sdlg11*20+lz+lx-30%\nd[30+]s@0>@d[[1+]s@lg11<@]s@25=@d[1+]s@24=@se44le-d[30+]s@21>@dld+7%-7+\n[March ]smd[31-[April ]sm]s@31<@psnlmPpsn1z>p]splpx\n\n\n16oAk2vpq";
	input->stat.st_size = 242;
}